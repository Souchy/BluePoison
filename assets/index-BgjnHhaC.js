var Dw=Object.defineProperty;var Bw=(s,e,t)=>e in s?Dw(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var G=(s,e,t)=>Bw(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function Hw(){Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"))}function eh(s){return typeof s=="object"&&s!==null||typeof s=="function"}const $t={get(s,e){var t;return(t=e[Symbol.metadata])==null?void 0:t[s]},define(s,e,...t){var r;let n=(r=Object.getOwnPropertyDescriptor(e,Symbol.metadata))==null?void 0:r.value;n==null&&Object.defineProperty(e,Symbol.metadata,{value:n=Object.create(null),enumerable:!0,configurable:!0,writable:!0});const i=t.length;switch(i){case 0:throw new Error("At least one key must be provided");case 1:n[t[0]]=s;return;case 2:n[t[0]]=n[t[1]]=s;return;default:{for(let o=0;o<i;++o)n[t[o]]=s;return}}},has(s,e){const t=e[Symbol.metadata];return t==null?!1:s in t},delete(s,e){const t=e[Symbol.metadata];t!=null&&Reflect.deleteProperty(t,s)}},Jo=Object.freeze,wg=Object.assign,Uw=String,jn=$t.get,Mo=$t.define,Ve=s=>s instanceof Promise,ze=s=>s instanceof Array,Kr=s=>s instanceof Set,Fi=s=>s instanceof Map,hr=s=>s instanceof Object,pe=s=>typeof s=="function",ue=s=>typeof s=="string",Fw=s=>typeof s=="number",be=()=>Object.create(null),Es=Object.is,He=(s,...e)=>new Error(`AUR${Uw(s).padStart(4,"0")}: ${Vw(s,...e)}`),Kw={1:"No registration for interface: '{{0}}'",2:`'{{0}}' was registered with "none" resolver, are you injecting the right key?`,3:"Cyclic dependency found: {{0}}",4:"Resolver for {{0}} returned a null factory",5:"Invalid resolver strategy specified: {{0}}. Did you assign an invalid strategy value?",6:"Unable to autoregister dependency: {{0}}",7:'Resource key "{{0}}" already registered',8:"Unable to resolve key: {{0}}",9:"Attempted to jitRegister something that is not a constructor: '{{0}}'. Did you forget to register this resource?",10:'Attempted to jitRegister an intrinsic type: "{{0}}". Did you forget to add @inject(Key)',11:"Invalid resolver, null/undefined returned from the static register method.",12:"Attempted to jitRegister an interface: {{0}}",13:"Cannot call resolve '{{0}}' before calling prepare or after calling dispose.",14:"Key cannot be null or undefined. Are you trying to inject/register something that doesn't exist with DI?A common cause is circular dependency with bundler, did you accidentally introduce circular dependency into your module graph?",15:"'{{0}}' is a native function and cannot be safely constructed by DI. If this is intentional, please use a callback or cachedCallback resolver.",16:'There is not a currently active container to resolve "{{0}}". Are you trying to "new Class(...)" that has a resolve(...) call?',17:"Failed to instantiate '{{0}}' via @newInstanceOf/@newInstanceForScope, there's no registration and no default implementation, or the default implementation does not result in factory for constructing the instances.",18:"Invalid channel name or instance: '{{0}}'.",19:"Invalid channel name or type: {{0}}.",20:"No defined value found when calling firstDefined()",21:"Invalid module transform input: {{0}}. Expected Promise or Object.",22:"The @inject decorator on the target ('{{0}}') type '{{1}}' is not supported.",23:"Resource key '{{0}}' has already been registered."},Vw=(s,...e)=>{let t=Kw[s];for(let n=0;n<e.length;++n)t=t.replace(`{{${n}}}`,String(e[n]));return t},Rr=(...s)=>globalThis.console.error(...s),xo=(()=>{const s={};let e=!1,t=0,n=0,i=0;return r=>{switch(typeof r){case"number":return r>=0&&(r|0)===r;case"string":if(e=s[r],e!==void 0)return e;if(t=r.length,t===0)return s[r]=!1;for(n=0,i=0;i<t;++i)if(n=r.charCodeAt(i),i===0&&n===48&&t>1||n<48||n>57)return s[r]=!1;return s[r]=!0;default:return!1}}})(),Cg=function(){const s=wg(be(),{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0}),e=t=>t===""?0:t!==t.toUpperCase()?3:t!==t.toLowerCase()?2:s[t]===!0?1:0;return(t,n)=>{const i=t.length;if(i===0)return t;let r=!1,o="",a,c="",l=0,h=t.charAt(0),u=e(h),d=0;for(;d<i;++d)a=l,c=h,l=u,h=t.charAt(d+1),u=e(h),l===0?o.length>0&&(r=!0):(!r&&o.length>0&&l===2&&(r=a===3||u===3),o+=n(c,r),r=!1);return o}}(),st=function(){const s=be(),e=(t,n)=>n?t.toUpperCase():t.toLowerCase();return t=>{let n=s[t];return n===void 0&&(n=s[t]=Cg(t,e)),n}}(),Sg=function(){const s=be();return e=>{let t=s[e];return t===void 0&&(t=st(e),t.length>0&&(t=t[0].toUpperCase()+t.slice(1)),s[e]=t),t}}(),Ag=function(){const s=be(),e=(t,n)=>n?`-${t.toLowerCase()}`:t.toLowerCase();return t=>{let n=s[t];return n===void 0&&(n=s[t]=Cg(t,e)),n}}(),rl=s=>{const e=s.length,t=Array(e);let n=0;for(;n<e;++n)t[n]=s[n];return t},Qs=(s,e)=>{const t=e.name;e.addInitializer(function(){Reflect.defineProperty(this,t,{value:s.bind(this),writable:!0,configurable:!0,enumerable:!1})})},We=(...s)=>{const e=[];let t=0;const n=s.length;let i=0,r,o=0;for(;o<n;++o)if(r=s[o],r!==void 0){i=r.length;let a=0;for(;a<i;++a)e[t++]=r[a]}return e},Bi=(...s)=>{const e=s.length;let t,n=0;for(;e>n;++n)if(t=s[n],t!==void 0)return t;throw He(20)},jw=function(){const s=Function.prototype,e=Object.getPrototypeOf,t=new WeakMap;let n=s,i=0,r;return function(o){if(r=t.get(o),r===void 0)for(t.set(o,r=[n=o]),i=0;(n=e(n))!==s;)r[++i]=n;return r}}();function th(...s){return wg(be(),...s)}const mf=(()=>{const s=new WeakMap;let e=!1,t="",n=0;return i=>(e=s.get(i),e==null&&(n=(t=i.toString()).length,e=n>28&&t.indexOf("[native code] }")===n-15,s.set(i,e)),e)})(),X=(s,e)=>Ve(s)?s.then(e):e(s),Je=(...s)=>{let e,t,n,i=0,r=s.length;for(;i<r;++i)e=s[i],Ve(e=s[i])&&(t===void 0?t=e:n===void 0?n=[t,e]:n.push(e));return n===void 0?t:Promise.all(n)},zw=(s,e)=>new en(s,0,e),$o=(s,e)=>new en(s,1,e),Tg=(s,e)=>new en(s,2,e),qw=(s,e)=>new en(s,3,e),Gw=(s,e)=>new en(s,3,Ig(e)),Da=(s,e)=>new en(e,5,s),Ww=(s,...e)=>new hC(s,e),vf=new WeakMap,Ig=s=>(e,t,n)=>{let i=vf.get(e);if(i===void 0&&vf.set(e,i=new WeakMap),i.has(n))return i.get(n);const r=s(e,t,n);return i.set(n,r),r},Ci={instance:zw,singleton:$o,transient:Tg,callback:qw,cachedCallback:Gw,aliasTo:Da,defer:Ww},Ec=function(s){return function(t){t.register($o(this,this),Da(this,s))}},As="au:annotation",Ki=(s,e)=>e===void 0?`${As}:${s}`:`${As}:${s}:${e}`,Qw=(s,e)=>{const t=jn(As,s);t===void 0?Mo([e],s,As):t.push(e)},Yw=Jo({name:"au:annotation",appendTo:Qw,set(s,e,t){Mo(t,s,Ki(e))},get:(s,e)=>jn(Ki(e),s),getKeys(s){let e=jn(As,s);return e===void 0&&Mo(e=[],s,As),e},isKey:s=>s.startsWith(As),keyFor:Ki}),xn="au:resource",ki=(s,e,t)=>`${xn}:${s}`,cu={annotation:Yw},kg=Object.prototype.hasOwnProperty;function ln(s,e,t,n){let i=jn(Ki(s),t);return i===void 0?(i=e[s],i===void 0?(i=t[s],i===void 0||!kg.call(t,s)?n():i):i):i}function Tn(s,e,t){let n=jn(Ki(s),e);return n===void 0?(n=e[s],n===void 0||!kg.call(e,s)?t():n):n}function In(s,e,t){const n=e[s];return n===void 0?t():n}const Qn=Symbol.for("au:registrable"),Jw={none(s){throw He(2,s)},singleton:s=>new en(s,1,s),transient:s=>new en(s,2,s)};class Fn{constructor(e,t){this.inheritParentResources=e,this.defaultResolver=t}static from(e){return e===void 0||e===Fn.DEFAULT?Fn.DEFAULT:new Fn(e.inheritParentResources??!1,e.defaultResolver??Jw.singleton)}}Fn.DEFAULT=Fn.from({});const Xw=s=>new fo(null,Fn.from(s)),Zw=new Set("Array ArrayBuffer Boolean DataView Date Error EvalError Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Number Object Promise RangeError ReferenceError RegExp Set SharedArrayBuffer String SyntaxError TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array URIError WeakMap WeakSet".split(" "));let eC=0,xe=null;class fo{get depth(){return this._parent===null?0:this._parent.depth+1}get parent(){return this._parent}constructor(e,t){if(this.id=++eC,this._registerDepth=0,this._disposableResolvers=new Map,this._parent=e,this.config=t,this._resolvers=new Map,this.res={},e===null)this.root=this,this._factories=new Map;else if(this.root=e.root,this._factories=e._factories,t.inheritParentResources)for(const n in e.res)this.registerResolver(n,e.res[n]);this._resolvers.set(Ri,nC)}register(...e){var h,u,d,f;if(++this._registerDepth===100)throw He(6,...e);let t,n,i,r,o,a=0,c=e.length,l;for(;a<c;++a)if(t=e[a],!!eh(t))if(co(t))t.register(this);else if((l=jn(xn,t))!=null)l.register(this);else if(sC(t)){const p=(h=t[Symbol.metadata])==null?void 0:h[Qn];if(co(p))p.register(this);else if(ue((u=t.$au)==null?void 0:u.type)){const m=t.$au,g=(t.aliases??ie).concat(m.aliases??ie);let v=`${xn}:${m.type}:${m.name}`;if(this.has(v,!1)){(d=globalThis.console)==null||d.warn(He(7,v));continue}for(Da(t,v).register(this),this.has(t,!1)||$o(t,t).register(this),r=0,o=g.length;r<o;++r){if(v=`${xn}:${m.type}:${g[r]}`,this.has(v,!1)){(f=globalThis.console)==null||f.warn(He(7,v));continue}Da(t,v).register(this)}}else $o(t,t).register(this)}else for(n=Object.keys(t),r=0,o=n.length;r<o;++r)i=t[n[r]],eh(i)&&(co(i)?i.register(this):this.register(i));return--this._registerDepth,this}registerResolver(e,t,n=!1){Zr(e);const i=this._resolvers,r=i.get(e);if(r==null){if(i.set(e,t),ol(e)){if(this.res[e]!==void 0)throw He(7,e);this.res[e]=t}}else r instanceof en&&r._strategy===4?r._state.push(t):i.set(e,new en(e,4,[r,t]));return n&&this._disposableResolvers.set(e,t),t}deregister(e){Zr(e);const t=this._resolvers.get(e);t!=null&&(this._resolvers.delete(e),ol(e)&&delete this.res[e],this._disposableResolvers.has(e)&&(t.dispose(),this._disposableResolvers.delete(e)))}registerTransformer(e,t){const n=this.getResolver(e);if(n==null)return!1;if(n.getFactory){const i=n.getFactory(this);return i==null?!1:(i.registerTransformer(t),!0)}return!1}getResolver(e,t=!0){if(Zr(e),e.resolve!==void 0)return e;const n=xe;let i=xe=this,r,o;try{for(;i!=null;)if(r=i._resolvers.get(e),r==null){if(i._parent==null)return o=bf(e)?this:i,t?this._jitRegister(e,o):null;i=i._parent}else return r}finally{xe=n}return null}has(e,t=!1){var n;return this._resolvers.has(e)||ol(e)&&e in this.res||((t&&((n=this._parent)==null?void 0:n.has(e,!0)))??!1)}get(e){if(Zr(e),e.$isResolver)return e.resolve(this,this);const t=xe;let n=xe=this,i,r;try{for(;n!=null;)if(i=n._resolvers.get(e),i==null){if(n._parent==null)return r=bf(e)?this:n,i=this._jitRegister(e,r),i.resolve(n,this);n=n._parent}else return i.resolve(n,this)}finally{xe=t}throw He(8,e)}getAll(e,t=!1){Zr(e);const n=xe,i=xe=this;let r=i,o,a=ie;try{if(t){for(;r!=null;)o=r._resolvers.get(e),o!=null&&(a=a.concat(_f(o,r,i))),r=r._parent;return a}for(;r!=null;)if(o=r._resolvers.get(e),o==null){if(r=r._parent,r==null)return ie}else return _f(o,r,i)}finally{xe=n}return ie}invoke(e,t){if(mf(e))throw He(15,e);const n=xe;xe=this;{let i,r;try{i=ur(e).map(o=>this.get(r=o))}catch(o){throw Rr(`[DEV:aurelia] Error during construction of ${e.name?e.name:`(Anonymous) ${String(e)}`}, caused by dependency: ${String(r)}`),xe=n,o}try{return t===void 0?new e(...i):new e(...i,...t)}catch(o){throw Rr(`[DEV:aurelia] Error during construction of ${e.name?e.name:`(Anonymous) ${String(e)}`}`),o}finally{xe=n}}try{return t===void 0?new e(...ur(e).map(Lo,this)):new e(...ur(e).map(Lo,this),...t)}finally{xe=n}}hasFactory(e){return this._factories.has(e)}getFactory(e){let t=this._factories.get(e);if(t===void 0){if(mf(e))throw He(15,e);this._factories.set(e,t=new tC(e,ur(e)))}return t}registerFactory(e,t){this._factories.set(e,t)}createChild(e){return e===void 0&&this.config.inheritParentResources?this.config===Fn.DEFAULT?new fo(this,this.config):new fo(this,Fn.from({...this.config,inheritParentResources:!1})):new fo(this,Fn.from(e??this.config))}disposeResolvers(){var r;const e=this._resolvers,t=this._disposableResolvers;let n,i;for([i,n]of t.entries())(r=n.dispose)==null||r.call(n),e.delete(i);t.clear()}useResources(e){const t=e.res;for(const n in t)this.registerResolver(n,t[n])}find(e,t){var o,a;const n=ue(t)?`${xn}:${e}:${t}`:e;let i=this,r=i.res[n];return r==null&&(i=i.root,r=i.res[n]),r==null?null:((a=(o=r.getFactory)==null?void 0:o.call(r,i))==null?void 0:a.Type)??null}dispose(){this._disposableResolvers.size>0&&this.disposeResolvers(),this._resolvers.clear(),this.root===this&&(this._factories.clear(),this.res={})}_jitRegister(e,t){const n=co(e);if(!pe(e)&&!n)throw He(9,e);if(Zw.has(e.name))throw He(10,e);if(n){const r=e.register(t,e);if(!(r instanceof Object)||r.resolve==null){const o=t._resolvers.get(e);if(o!=null)return o;throw He(11,e)}return r}if(e.$isInterface)throw He(12,e.friendlyName);const i=this.config.defaultResolver(e,t);return t._resolvers.set(e,i),i}}class tC{constructor(e,t){this.Type=e,this.dependencies=t,this.transformers=null}construct(e,t){const n=xe;xe=e;let i;{let r,o;try{r=this.dependencies.map(a=>e.get(o=a))}catch(a){throw Rr(`[DEV:aurelia] Error during construction of ${this.Type.name?this.Type.name:`(Anonymous) ${String(this.Type)}`}, caused by dependency: ${String(o)}`),xe=n,a}try{return t===void 0?i=new this.Type(...r):i=new this.Type(...r,...t),this.transformers==null?i:this.transformers.reduce(yf,i)}catch(a){throw Rr(`[DEV:aurelia] Error during construction of ${this.Type.name?this.Type.name:`(Anonymous) ${String(this.Type)}`}`),a}finally{xe=n}}try{return t===void 0?i=new this.Type(...this.dependencies.map(Lo,e)):i=new this.Type(...this.dependencies.map(Lo,e),...t),this.transformers==null?i:this.transformers.reduce(yf,i)}finally{xe=n}}registerTransformer(e){(this.transformers??(this.transformers=[])).push(e)}}function yf(s,e){return e(s)}function Zr(s){if(s==null)throw He(14)}function Lo(s){return this.get(s)}function k(...s){if(xe==null)throw He(16,...s);if(s.length===1)try{return xe.get(s[0])}catch(e){throw Rr(`[DEV:aurelia] resolve() call error for: ${String(s[0])}`),e}else{let e;try{return s.map(t=>xe.get(e=t))}catch(t){throw Rr(`[DEV:aurelia] resolve() call error for: ${String(e)}`),t}}return s.length===1?xe.get(s[0]):s.map(Lo,xe)}const _f=(s,e,t)=>{if(s instanceof en&&s._strategy===4){const n=s._state,i=n.length,r=Array(i);let o=0;for(;o<i;++o)r[o]=n[o].resolve(e,t);return r}return[s.resolve(e,t)]},nC={$isResolver:!0,resolve(s,e){return e}},co=s=>pe(s==null?void 0:s.register),iC=s=>co(s)&&typeof s.registerInRequestor=="boolean",bf=s=>iC(s)&&s.registerInRequestor,sC=s=>s.prototype!==void 0,ol=s=>ue(s)&&s.indexOf(":")>0;class rC{constructor(e,t){this._container=e,this._key=t}instance(e){return this._registerResolver(0,e)}singleton(e){return this._registerResolver(1,e)}transient(e){return this._registerResolver(2,e)}callback(e){return this._registerResolver(3,e)}cachedCallback(e){return this._registerResolver(3,Ig(e))}aliasTo(e){return this._registerResolver(5,e)}_registerResolver(e,t){const{_container:n,_key:i}=this;return this._container=this._key=void 0,n.registerResolver(i,new en(i,e,t))}}const eo=s=>{const e=s.slice(),t=Object.keys(s),n=t.length;let i;for(let r=0;r<n;++r)i=t[r],xo(i)||(e[i]=s[i]);return e},ka=Ki("di:paramtypes"),oC=s=>jn(ka,s),Eg=s=>jn("design:paramtypes",s),wf=s=>{var e;return(e=s.metadata)[ka]??(e[ka]=[])},ur=s=>{const e=Ki("di:dependencies");let t=jn(e,s);if(t===void 0){const n=s.inject;if(n===void 0){const i=Eg(s),r=oC(s);if(i===void 0)if(r===void 0){const o=Object.getPrototypeOf(s);pe(o)&&o!==Function.prototype?t=eo(ur(o)):t=[]}else t=eo(r);else if(r===void 0)t=eo(i);else{t=eo(i);let o=r.length,a,c=0;for(;c<o;++c)a=r[c],a!==void 0&&(t[c]=a);const l=Object.keys(r);let h;for(c=0,o=l.length,c=0;c<o;++c)h=l[c],xo(h)||(t[h]=r[h])}}else t=eo(n);Mo(t,s,e)}return t},Ei=(s,e)=>{const t=pe(s)?s:e,n=(ue(s)?s:void 0)??"(anonymous)",i={$isInterface:!0,friendlyName:n,toString:()=>`InterfaceSymbol<${n}>`,register:t!=null?(r,o)=>t(new rC(r,o??i)):void 0};return i},nn=(...s)=>(e,t)=>{switch(t.kind){case"class":{const n=wf(t);let i,r=0;for(;r<s.length;++r)i=s[r],i!==void 0&&(n[r]=i);break}case"field":{const n=wf(t),i=s[0];i!==void 0&&(n[t.name]=i);break}default:throw He(22,String(t.name),t.kind)}},sn=(Hw(),{createContainer:Xw,getDesignParamtypes:Eg,getDependencies:ur,createInterface:Ei,inject:nn,transient(s){return s.register=function(e){return Tg(s,s).register(e,s)},s.registerInRequestor=!1,s},singleton(s,e=lC){return s.register=function(t){return $o(s,s).register(t,s)},s.registerInRequestor=e.scoped,s}}),Ri=Ei("IContainer"),aC=Ri;function Cf(s,e){return sn.transient(s)}function cC(s,e){return s==null?Cf:Cf(s)}const lC={scoped:!1};class en{get $isResolver(){return!0}constructor(e,t,n){this._resolving=!1,this._cachedFactory=null,this._key=e,this._strategy=t,this._state=n}register(e,t){return e.registerResolver(t||this._key,this)}resolve(e,t){switch(this._strategy){case 0:return this._state;case 1:{if(this._resolving)throw He(3,this._state.name);return this._resolving=!0,this._state=(this._cachedFactory=e.getFactory(this._state)).construct(t),this._strategy=0,this._resolving=!1,this._state}case 2:{const n=e.getFactory(this._state);if(n===null)throw He(4,this._key);return n.construct(t)}case 3:return this._state(e,t,this);case 4:return this._state[0].resolve(e,t);case 5:return t.get(this._state);default:throw He(5,this._strategy)}}getFactory(e){var t,n;switch(this._strategy){case 1:case 2:return e.getFactory(this._state);case 5:return((n=(t=e.getResolver(this._state))==null?void 0:t.getFactory)==null?void 0:n.call(t,e))??null;case 0:return this._cachedFactory;default:return null}}}class Qe{get friendlyName(){return this._name}constructor(e,t=null,n=null){this._name=e,this._instance=t,this._Type=n}prepare(e){this._instance=e}get $isResolver(){return!0}resolve(){if(this._instance==null)throw He(13,this._name);return this._instance}getFactory(e){return this._Type==null?null:e.getFactory(this._Type)}dispose(){this._instance=null}}class hC{constructor(e,t){this.key=e,this.params=t}register(e){e.has(this.key,!0)?e.get(this.key).register(e,...this.params):e.register(...this.params.filter(t=>typeof t=="object"))}}const ie=Jo([]),uC=Jo({});function gi(){}const Vr=Ei("IPlatform");function Xo(s){return function(e){function t(n,i){nn(t)(n,i)}return t.$isResolver=!0,t.resolve=function(n,i){return s(e,n,i)},t}}const lu=(s,e=!1)=>{function t(n,i){nn(t)(n,i)}return t.$isResolver=!0,t.resolve=(n,i)=>i.getAll(s,e),t},Rg=Xo((s,e,t)=>{if(t.has(s,!0))return t.get(s)}),dC=Xo((s,e,t)=>t.has(s,!1)?t.get(s):void 0),Pr=Xo((s,e,t)=>t.has(s,!1)?t.get(s):t.root.get(s)),fC=Xo((s,e,t)=>t.has(s,!1)?t.get(s):t.root.has(s,!1)?t.root.get(s):void 0),pC=Xo((s,e,t)=>t===t.root?t.getAll(s,!1):t.has(s,!1)?t.getAll(s,!1).concat(t.root.getAll(s,!1)):t.root.getAll(s,!1));function Ys(s,e,t,n,i,r){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var a=n.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=s?n.static?s:s.prototype:null,h=l?Object.getOwnPropertyDescriptor(l,n.name):{},u,d=!1,f=t.length-1;f>=0;f--){var p={};for(var m in n)p[m]=m==="access"?{}:n[m];for(var m in n.access)p.access[m]=n.access[m];p.addInitializer=function(v){if(d)throw new TypeError("Cannot add initializers after decoration has completed");r.push(o(v||null))};var g=(0,t[f])(a==="accessor"?{get:h.get,set:h.set}:h[c],p);if(a==="accessor"){if(g===void 0)continue;if(g===null||typeof g!="object")throw new TypeError("Object expected");(u=o(g.get))&&(h.get=u),(u=o(g.set))&&(h.set=u),(u=o(g.init))&&i.unshift(u)}else(u=o(g))&&(a==="field"?i.unshift(u):h[c]=u)}l&&Object.defineProperty(l,n.name,h),d=!0}function gC(s,e,t){for(var n=arguments.length>2,i=0;i<e.length;i++)t=n?e[i].call(s,t):e[i].call(s);return n?t:void 0}const po=0,go=1,mo=2,Sr=3,vo=4,yo=5,mC=6,vC=Jo({trace:po,debug:go,info:mo,warn:Sr,error:vo,fatal:yo,none:mC}),Pg=Ei("ILogConfig",s=>s.instance(new CC("no-colors",Sr))),yC=Ei("ISink"),_C=Ei("ILogEventFactory",s=>s.singleton(AC)),ji=Ei("ILogger",s=>s.singleton(TC)),bC=Ei("ILogScope"),wC=Jo({key:Ki("logger-sink-handles"),define(s,e){Mo(e.handles,s,this.key)},getHandles(s){return jn(this.key,s.constructor)}}),ci=th({red(s){return`\x1B[31m${s}\x1B[39m`},green(s){return`\x1B[32m${s}\x1B[39m`},yellow(s){return`\x1B[33m${s}\x1B[39m`},blue(s){return`\x1B[34m${s}\x1B[39m`},magenta(s){return`\x1B[35m${s}\x1B[39m`},cyan(s){return`\x1B[36m${s}\x1B[39m`},white(s){return`\x1B[37m${s}\x1B[39m`},grey(s){return`\x1B[90m${s}\x1B[39m`}});class CC{constructor(e,t){this.colorOptions=e,this.level=t}}const al=function(){const s={"no-colors":th({TRC:"TRC",DBG:"DBG",INF:"INF",WRN:"WRN",ERR:"ERR",FTL:"FTL",QQQ:"???"}),colors:th({TRC:ci.grey("TRC"),DBG:ci.grey("DBG"),INF:ci.white("INF"),WRN:ci.yellow("WRN"),ERR:ci.red("ERR"),FTL:ci.red("FTL"),QQQ:ci.grey("???")})};return(e,t)=>e<=po?s[t].TRC:e<=go?s[t].DBG:e<=mo?s[t].INF:e<=Sr?s[t].WRN:e<=vo?s[t].ERR:e<=yo?s[t].FTL:s[t].QQQ}(),Sf=(s,e)=>e==="no-colors"?s.join("."):s.map(ci.cyan).join("."),cl=(s,e)=>e==="no-colors"?new Date(s).toISOString():ci.grey(new Date(s).toISOString());class SC{constructor(e,t,n,i,r,o){this.severity=e,this.message=t,this.optionalParams=n,this.scope=i,this.colorOptions=r,this.timestamp=o}toString(){const{severity:e,message:t,scope:n,colorOptions:i,timestamp:r}=this;return n.length===0?`${cl(r,i)} [${al(e,i)}] ${t}`:`${cl(r,i)} [${al(e,i)} ${Sf(n,i)}] ${t}`}getFormattedLogInfo(e=!1){const{severity:t,message:n,scope:i,colorOptions:r,timestamp:o,optionalParams:a}=this;let c=null,l="";e&&n instanceof Error?c=n:l=n;const h=i.length===0?"":` ${Sf(i,r)}`;let u=`${cl(o,r)} [${al(t,r)}${h}] ${l}`;if(a===void 0||a.length===0)return c===null?[u]:[u,c];let d=0;for(;u.includes("%s");)u=u.replace("%s",String(a[d++]));return c!==null?[u,c,...a.slice(d)]:[u,...a.slice(d)]}}class AC{constructor(){this.config=k(Pg)}createLogEvent(e,t,n,i){return new SC(t,n,i,e.scope,this.config.colorOptions,Date.now())}}let TC=(()=>{var s;let e=[],t,n,i,r,o,a;return s=class{constructor(l=k(Pg),h=k(_C),u=k(lu(yC)),d=k(Rg(bC))??[],f=null){this.scope=(gC(this,e),d),this._scopedLoggers=be();let p,m,g,v,S,R;if(this.config=l,this._factory=h,this.sinks=u,f===null){this.root=this,this.parent=this,p=this._traceSinks=[],m=this._debugSinks=[],g=this._infoSinks=[],v=this._warnSinks=[],S=this._errorSinks=[],R=this._fatalSinks=[];for(const C of u){const I=wC.getHandles(C);((I==null?void 0:I.includes(po))??!0)&&p.push(C),((I==null?void 0:I.includes(go))??!0)&&m.push(C),((I==null?void 0:I.includes(mo))??!0)&&g.push(C),((I==null?void 0:I.includes(Sr))??!0)&&v.push(C),((I==null?void 0:I.includes(vo))??!0)&&S.push(C),((I==null?void 0:I.includes(yo))??!0)&&R.push(C)}}else this.root=f.root,this.parent=f,p=this._traceSinks=f._traceSinks,m=this._debugSinks=f._debugSinks,g=this._infoSinks=f._infoSinks,v=this._warnSinks=f._warnSinks,S=this._errorSinks=f._errorSinks,R=this._fatalSinks=f._fatalSinks}trace(l,...h){this.config.level<=po&&this._emit(this._traceSinks,po,l,h)}debug(l,...h){this.config.level<=go&&this._emit(this._debugSinks,go,l,h)}info(l,...h){this.config.level<=mo&&this._emit(this._infoSinks,mo,l,h)}warn(l,...h){this.config.level<=Sr&&this._emit(this._warnSinks,Sr,l,h)}error(l,...h){this.config.level<=vo&&this._emit(this._errorSinks,vo,l,h)}fatal(l,...h){this.config.level<=yo&&this._emit(this._fatalSinks,yo,l,h)}scopeTo(l){const h=this._scopedLoggers;let u=h[l];return u===void 0&&(u=h[l]=new s(this.config,this._factory,null,this.scope.concat(l),this)),u}_emit(l,h,u,d){const f=pe(u)?u():u,p=this._factory.createLogEvent(this,h,f,d);for(let m=0,g=l.length;m<g;++m)l[m].handleEvent(p)}},(()=>{const c=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;t=[Qs],n=[Qs],i=[Qs],r=[Qs],o=[Qs],a=[Qs],Ys(s,null,t,{kind:"method",name:"trace",static:!1,private:!1,access:{has:l=>"trace"in l,get:l=>l.trace},metadata:c},null,e),Ys(s,null,n,{kind:"method",name:"debug",static:!1,private:!1,access:{has:l=>"debug"in l,get:l=>l.debug},metadata:c},null,e),Ys(s,null,i,{kind:"method",name:"info",static:!1,private:!1,access:{has:l=>"info"in l,get:l=>l.info},metadata:c},null,e),Ys(s,null,r,{kind:"method",name:"warn",static:!1,private:!1,access:{has:l=>"warn"in l,get:l=>l.warn},metadata:c},null,e),Ys(s,null,o,{kind:"method",name:"error",static:!1,private:!1,access:{has:l=>"error"in l,get:l=>l.error},metadata:c},null,e),Ys(s,null,a,{kind:"method",name:"fatal",static:!1,private:!1,access:{has:l=>"fatal"in l,get:l=>l.fatal},metadata:c},null,e),c&&Object.defineProperty(s,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:c})})(),s})();class IC{constructor(e,t){this.type=e,this.cb=t}handle(e){e instanceof this.type&&this.cb.call(null,e)}}const jr=Ei("IEventAggregator",s=>s.singleton(Yn));class Yn{constructor(){this.eventLookup={},this.messageHandlers=[]}publish(e,t){if(!e)throw He(18,e);if(ue(e)){let n=this.eventLookup[e];if(n!==void 0){n=n.slice();let i=n.length;for(;i-- >0;)n[i](t,e)}}else{const n=this.messageHandlers.slice();let i=n.length;for(;i-- >0;)n[i].handle(e)}}subscribe(e,t){if(!e)throw He(19,e);let n,i;return ue(e)?(this.eventLookup[e]===void 0&&(this.eventLookup[e]=[]),n=t,i=this.eventLookup[e]):(n=new IC(e,t),i=this.messageHandlers),i.push(n),{dispose(){const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}}subscribeOnce(e,t){const n=this.subscribe(e,(i,r)=>{n.dispose(),t(i,r)});return n}}const Og="AccessThis",kC="AccessBoundary",hu="AccessGlobal",uu="AccessScope",EC="ArrayLiteral",RC="ObjectLiteral",PC="PrimitiveLiteral",OC="Template",NC="Unary",MC="CallScope",xC="CallMember",$C="CallFunction",LC="CallGlobal",Rc="AccessMember",Ng="AccessKeyed",DC="TaggedTemplate",BC="Binary",HC="Conditional",UC="Assign",FC="ArrowFunction",KC="ValueConverter",VC="BindingBehavior",Mg="ArrayBindingPattern",xg="ObjectBindingPattern",$g="BindingIdentifier",jC="ForOfStatement",zC="Interpolation",Lg="ArrayDestructuring",qC="ObjectDestructuring",GC="DestructuringAssignmentLeaf",WC="Custom";class Dg{constructor(e){this.value=e,this.$kind=WC}evaluate(...e){return this.value}assign(...e){return e}bind(...e){}unbind(...e){}accept(e){}}class QC{constructor(e,t,n){this.expression=e,this.name=t,this.args=n,this.$kind=VC,this.key=`_bb_${t}`}}class YC{constructor(e,t,n){this.expression=e,this.name=t,this.args=n,this.$kind=KC}}class JC{constructor(e,t,n="="){this.target=e,this.value=t,this.op=n,this.$kind=UC}}class XC{constructor(e,t,n){this.condition=e,this.yes=t,this.no=n,this.$kind=HC}}class ZC{constructor(e){this.name=e,this.$kind=hu}}class _o{constructor(e=0){this.ancestor=e,this.$kind=Og}}class eS{constructor(){this.$kind=kC}}class bo{constructor(e,t=0){this.name=e,this.ancestor=t,this.$kind=uu}}const Bg=s=>s.$kind===hu||(s.$kind===Rc||s.$kind===Ng)&&s.accessGlobal;class nh{constructor(e,t,n=!1){this.object=e,this.name=t,this.optional=n,this.$kind=Rc,this.accessGlobal=Bg(e)}}class Hg{constructor(e,t,n=!1){this.object=e,this.key=t,this.optional=n,this.$kind=Ng,this.accessGlobal=Bg(e)}}class Ug{constructor(e,t,n=0,i=!1){this.name=e,this.args=t,this.ancestor=n,this.optional=i,this.$kind=MC}}class Ba{constructor(e,t,n,i=!1,r=!1){this.object=e,this.name=t,this.args=n,this.optionalMember=i,this.optionalCall=r,this.$kind=xC}}class Ea{constructor(e,t,n=!1){this.func=e,this.args=t,this.optional=n,this.$kind=$C}}class tS{constructor(e,t){this.name=e,this.args=t,this.$kind=LC}}class nS{constructor(e,t,n){this.operation=e,this.left=t,this.right=n,this.$kind=BC}}class Af{constructor(e,t,n=0){this.operation=e,this.expression=t,this.pos=n,this.$kind=NC}}class ot{constructor(e){this.value=e,this.$kind=PC}}ot.$undefined=new ot(void 0);ot.$null=new ot(null);ot.$true=new ot(!0);ot.$false=new ot(!1);ot.$empty=new ot("");class ih{constructor(e){this.elements=e,this.$kind=EC}}ih.$empty=new ih(ie);class sh{constructor(e,t){this.keys=e,this.values=t,this.$kind=RC}}sh.$empty=new sh(ie,ie);class Ha{constructor(e,t=ie){this.cooked=e,this.expressions=t,this.$kind=OC}}Ha.$empty=new Ha([""]);class Fg{constructor(e,t,n,i=ie){this.cooked=e,this.func=n,this.expressions=i,this.$kind=DC,e.raw=t}}class iS{constructor(e){this.elements=e,this.$kind=Mg}}class sS{constructor(e,t){this.keys=e,this.values=t,this.$kind=xg}}class Ua{constructor(e){this.name=e,this.$kind=$g}}class rS{constructor(e,t,n){this.declaration=e,this.iterable=t,this.semiIdx=n,this.$kind=jC}}class oS{constructor(e,t=ie){this.parts=e,this.expressions=t,this.$kind=zC,this.isMulti=t.length>1,this.firstExpression=t[0]}}class aS{constructor(e,t,n,i){this.$kind=e,this.list=t,this.source=n,this.initializer=i}}class Kg{constructor(e,t,n){this.target=e,this.source=t,this.initializer=n,this.$kind=GC}}class rh{constructor(e,t,n=!1){this.args=e,this.body=t,this.rest=n,this.$kind=FC}}const oh=String,Ra=()=>Object.create(null),Ie=(s,...e)=>new Error(`AUR${oh(s).padStart(4,"0")}: ${lS(s,...e)}`),cS={99:"Method {{0}} not implemented",101:'Ast eval error: binding behavior "{{0}}" could not be found. Did you forget to register it as a dependency?',102:'Ast eval error: binding behavior "{{0}}" already applied.',103:'Ast eval error: value converter "{{0}}" could not be found. Did you forget to register it as a dependency?',105:"Ast eval error: unable to find $host context. Did you forget [au-slot] attribute?",106:'Ast eval error: invalid assignment. "$host" is a reserved keyword.',107:"Ast eval error: expression is not a function.",109:'Ast eval error: unknown unary operator: "{{0}}"',108:'Ast eval error: unknown binary operator: "{{0}}"',110:"Ast eval error: left-hand side of tagged template expression is not a function.",111:'Ast eval error: expected "{{0}}" to be a function',112:"Ast eval error: cannot use non-object value for destructuring assignment.",151:'Expression error: invalid start: "{{0}}"',152:'Expression error: spread operator is not supported: "{{0}}"',153:'Expression error: expected identifier: "{{0}}"',154:'Expression error: invalid member expression: "{{0}}"',155:'Expression error: unexpected end of expression: "{{0}}"',156:'Expression error: unconsumed token: "{{0}}" at position {{1}} of "{{2}}"',157:"Expression error: invalid empty expression. Empty expression is only valid in event bindings (trigger, delegate, capture etc...)",158:'Expression error: left hand side of expression is not assignable: "{{0}}"',159:'Expression error: expected identifier to come after value converter operator: "{{0}}"',160:"Expression error: expected identifier to come after binding behavior operator: {{0}}",161:'Expression error: unexpected keyword "of": "{{0}}"',162:'Expression error: unexpected keyword "import": "{{0}}"',163:'Expression error: invalid BindingIdentifier at left hand side of "of": "{{0}}" | kind: {{1}}',164:'Expression error: invalid or unsupported property definition in object literal: "{{0}}"',165:'Expression error: unterminated quote in string literal: "{{0}}"',166:'Expression error: unterminated template string: "{{0}}"',167:'Expression error: missing expected token "{{0}}" in "{{1}}"',168:'Expression error: unexpected character: "{{0}}"',170:'Expression error: unexpected "{{0}}" at position "{{1}}" for destructuring assignment in "{{2}}"',171:'Expression error: unexpected {{0}} at position "{{1}}" for optional chain in "{{2}}"',172:'Expression error: invalid tagged template on optional chain in "{{1}}"',173:'Expression error: invalid arrow parameter list in "{{0}}"',174:'Expression error: arrow function with default parameters is not supported: "{{0}}"',175:'Expression error: arrow function with destructuring parameters is not supported: "{{0}}"',176:'Expression error: rest parameter must be last formal parameter in arrow function: "{{0}}"',178:'Expression error: arrow function with function body is not supported: "{{0}}"',179:`Expression error: unexpected token '.' at position "{{1}}" in "{{0}}"`},lS=(s,...e)=>{var n;let t=cS[s];for(let i=0;i<e.length;++i){const r=new RegExp(`{{${i}(:.*)?}}`,"g");let o=r.exec(t);for(;o!=null;){const a=(n=o[1])==null?void 0:n.slice(1);let c=e[i];if(c!=null)switch(a){case"toString":c=Object.prototype.toString.call(c);break;case"join(!=)":c=c.join("!=");break;case"element":c=c==="*"?"all elements":`<${c} />`;break;default:a!=null&&a.startsWith(".")?c=oh(c[a.slice(1)]):c=oh(c)}t=t.slice(0,o.index)+c+t.slice(r.lastIndex),o=r.exec(t)}}return t},Zo=sn.createInterface("IExpressionParser",s=>s.singleton(hS));class hS{constructor(){this._expressionLookup=Ra(),this._forOfLookup=Ra(),this._interpolationLookup=Ra()}parse(e,t){let n;switch(t){case zg:return new Dg(e);case Fa:return n=this._interpolationLookup[e],n===void 0&&(n=this._interpolationLookup[e]=this.$parse(e,t)),n;case ui:return n=this._forOfLookup[e],n===void 0&&(n=this._forOfLookup[e]=this.$parse(e,t)),n;default:{if(e.length===0){if(t===gS||t===Tf)return ot.$empty;throw OS()}return n=this._expressionLookup[e],n===void 0&&(n=this._expressionLookup[e]=this.$parse(e,t)),n}}}$parse(e,t){return de=e,se=0,zn=e.length,Ft=0,Rs=0,B=6291456,Re="",Ae=Ps(0),ge=!0,le=!1,lo=!0,fu=-1,Ue(61,t===void 0?Tf:t)}}function du(s){switch(s){case 98:return 8;case 116:return 9;case 110:return 10;case 118:return 11;case 102:return 12;case 114:return 13;case 34:return 34;case 39:return 39;case 92:return 92;default:return s}}const uS=ot.$false,dS=ot.$true,fS=ot.$null,Vg=ot.$undefined,wo=new _o(0),ll=new _o(1),pS=new eS,mi="None",Fa="Interpolation",ui="IsIterator",jg="IsChainable",gS="IsFunction",Tf="IsProperty",zg="IsCustom";let de="",se=0,zn=0,Ft=0,Rs=0,B=6291456,Re="",Ae,ge=!0,le=!1,lo=!0,fu=-1;const Do=String.fromCharCode,Ps=s=>de.charCodeAt(s),vi=()=>de.slice(Rs,se),mS="Infinity NaN isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent Array BigInt Boolean Date Map Number Object RegExp Set String JSON Math Intl".split(" ");function Ue(s,e){if(e===zg)return new Dg(de);if(se===0){if(e===Fa)return AS();if(q(),B&4194304)throw ES()}ge=513>s,le=!1,lo=514>s;let t=!1,n,i=0;if(B&131072){const r=nr[B&63];q(),n=new Af(r,Ue(514,e)),ge=!1}else{e:switch(B){case 12295:i=Ft,ge=!1,lo=!1;do switch(q(),++i,B){case 65546:if(q(),!(B&12288))throw oi();break;case 11:case 12:throw oi();case 2162701:if(le=!0,q(),!(B&12288)){n=i===0?wo:i===1?ll:new _o(i),t=!0;break e}break;default:if(B&2097152){n=i===0?wo:i===1?ll:new _o(i);break e}throw RS()}while(B===12295);case 4096:{const r=Re;if(e===ui)n=new Ua(r);else if(lo&&mS.includes(r))n=new ZC(r);else{if(lo&&r==="import")throw LS();n=new bo(r,i)}if(ge=!le,q(),Rn(51)){if(B===524297)throw Yg();const o=le,a=Ft;++Ft;const c=Ue(62,mi);le=o,Ft=a,ge=!1,n=new rh([new Ua(r)],c)}break}case 11:throw FS();case 12:throw ah();case 12292:switch(ge=!1,q(),Ft){case 0:n=wo;break;case 1:n=ll;break;default:n=new _o(Ft);break}break;case 12293:ge=!1,q(),n=pS;break;case 2688008:n=_S(e);break;case 2688019:n=de.search(/\s+of\s+/)>se?vS():bS(e);break;case 524297:n=SS(e);break;case 2163760:n=new Ha([Re]),ge=!1,q();break;case 2163761:n=hl(e,n,!1);break;case 16384:case 32768:n=new ot(Re),ge=!1,q();break;case 8194:case 8195:case 8193:case 8192:n=nr[B&63],ge=!1,q();break;default:throw se>=zn?PS():ul()}if(e===ui)return CS(n);switch(B){case 2228280:case 2228281:n=new Af(nr[B&63],n,1),q(),ge=!1;break}if(514<s)return n;if(B===11||B===12)throw oi();if(n.$kind===Og)switch(B){case 2162701:if(le=!0,ge=!1,q(),!(B&13312))throw pu();if(B&12288)n=new bo(Re,n.ancestor),q();else if(B===2688008)n=new Ea(n,fn(),!0);else if(B===2688019)n=Pa(n,!0);else throw Oa();break;case 65546:if(ge=!le,q(),!(B&12288))throw oi();n=new bo(Re,n.ancestor),q();break;case 11:case 12:throw oi();case 2688008:n=new Ea(n,fn(),t);break;case 2688019:n=Pa(n,t);break;case 2163760:n=If(n);break;case 2163761:n=hl(e,n,!0);break}for(;(B&65536)>0;)switch(B){case 2162701:n=yS(n);break;case 65546:if(q(),!(B&12288))throw oi();n=qg(n,!1);break;case 11:case 12:throw oi();case 2688008:n.$kind===uu?n=new Ug(n.name,fn(),n.ancestor,!1):n.$kind===Rc?n=new Ba(n.object,n.name,fn(),n.optional,!1):n.$kind===hu?n=new tS(n.name,fn()):n=new Ea(n,fn(),!1);break;case 2688019:n=Pa(n,!1);break;case 2163760:if(le)throw Oa();n=If(n);break;case 2163761:if(le)throw Oa();n=hl(e,n,!0);break}}if(B===11||B===12)throw oi();if(513<s)return n;for(;(B&262144)>0;){const r=B;if((r&960)<=s)break;q(),n=new nS(nr[r&63],n,Ue(r&960,e)),ge=!1}if(63<s)return n;if(Rn(6291479)){const r=Ue(62,e);mn(6291477),n=new XC(n,r,Ue(62,e)),ge=!1}if(62<s)return n;switch(B){case 4194350:case 4194356:case 4194357:case 4194358:case 4194359:{if(!ge)throw NS();const r=nr[B&63];q(),n=new JC(n,Ue(62,e),r);break}}if(61<s)return n;for(;Rn(6291481);){if(B===6291456)throw MS();const r=Re;q();const o=new Array;for(;Rn(6291477);)o.push(Ue(62,e));n=new YC(n,r,o)}for(;Rn(6291480);){if(B===6291456)throw xS();const r=Re;q();const o=new Array;for(;Rn(6291477);)o.push(Ue(62,e));n=new QC(n,r,o)}if(B!==6291456){if(e===Fa&&B===7340046)return n;if(e===jg&&B===6291478){if(se===zn)throw ul();return fu=se-1,n}throw vi()==="of"?$S():ul()}return n}function vS(){const s=[],e=new aS(Lg,s,void 0,void 0);let t="",n=!0,i=0;for(;n;)switch(q(),B){case 7340052:n=!1,r();break;case 6291472:r();break;case 4096:t=vi();break;default:throw HS()}return mn(7340052),e;function r(){t!==""?(s.push(new Kg(new nh(wo,t),new Hg(wo,new ot(i++)),void 0)),t=""):i++}}function fn(){const s=le;q();const e=[];for(;B!==7340047&&(e.push(Ue(62,mi)),!!Rn(6291472)););return mn(7340047),ge=!1,le=s,e}function Pa(s,e){const t=le;return q(),s=new Hg(s,Ue(62,mi),e),mn(7340052),ge=!t,le=t,s}function yS(s){if(le=!0,ge=!1,q(),!(B&13312))throw pu();if(B&12288)return qg(s,!0);if(B===2688008)return s.$kind===uu?new Ug(s.name,fn(),s.ancestor,!0):s.$kind===Rc?new Ba(s.object,s.name,fn(),s.optional,!0):new Ea(s,fn(),!0);if(B===2688019)return Pa(s,!0);throw Oa()}function qg(s,e){const t=Re;switch(B){case 2162701:{le=!0,ge=!1;const n=se,i=Rs,r=B,o=Ae,a=Re,c=ge,l=le;if(q(),!(B&13312))throw pu();return B===2688008?new Ba(s,t,fn(),e,!0):(se=n,Rs=i,B=r,Ae=o,Re=a,ge=c,le=l,new nh(s,t,e))}case 2688008:return ge=!1,new Ba(s,t,fn(),e,!1);default:return ge=!le,q(),new nh(s,t,e)}}function _S(s){q();const e=se,t=Rs,n=B,i=Ae,r=Re,o=le,a=[];let c=1,l=!1;e:for(;;){if(B===12){if(q(),B!==4096)throw oi();if(a.push(new Ua(Re)),q(),B===6291472)throw US();if(B!==7340047||(q(),B!==51))throw ah();q();const d=le,f=Ft;++Ft;const p=Ue(62,mi);return le=d,Ft=f,ge=!1,new rh(a,p,!0)}switch(B){case 4096:a.push(new Ua(Re)),q();break;case 7340047:q();break e;case 524297:case 2688019:q(),c=4;break;case 6291472:c=2,l=!0;break e;case 2688008:c=2;break e;default:q(),c=2;break}switch(B){case 6291472:if(q(),l=!0,c===1)break;break e;case 7340047:q();break e;case 4194350:c===1&&(c=3);break e;case 51:if(l)throw ca();q(),c=2;break e;default:c===1&&(c=2);break e}}if(B===51){if(c===1){if(q(),B===524297)throw Yg();const d=le,f=Ft;++Ft;const p=Ue(62,mi);return le=d,Ft=f,ge=!1,new rh(a,p)}throw ca()}else if(c===1&&a.length===0)throw Qg(51);if(l)switch(c){case 2:throw ca();case 3:throw Rf();case 4:throw Pf()}se=e,Rs=t,B=n,Ae=i,Re=r,le=o;const h=le,u=Ue(62,s);if(le=h,mn(7340047),B===51)switch(c){case 2:throw ca();case 3:throw Rf();case 4:throw Pf()}return u}function bS(s){const e=le;q();const t=new Array;for(;B!==7340052;)if(Rn(6291472)){if(t.push(Vg),B===7340052)break}else if(t.push(Ue(62,s===ui?mi:s)),Rn(6291472)){if(B===7340052)break}else break;return le=e,mn(7340052),s===ui?new iS(t):(ge=!1,new ih(t))}const wS=[Mg,xg,$g,Lg,qC];function CS(s){if(!wS.includes(s.$kind)||B!==4204594)throw Ef(s.$kind);q();const e=s,t=Ue(61,jg);return new rS(e,t,fu)}function SS(s){const e=le,t=new Array,n=new Array;for(q();B!==7340046;){if(t.push(Re),B&49152)q(),mn(6291477),n.push(Ue(62,s===ui?mi:s));else if(B&12288){const i=Ae,r=B,o=se;q(),Rn(6291477)?n.push(Ue(62,s===ui?mi:s)):(Ae=i,B=r,se=o,n.push(Ue(515,s===ui?mi:s)))}else throw DS();B!==7340046&&mn(6291472)}return le=e,mn(7340046),s===ui?new sS(t,n):(ge=!1,new sh(t,n))}function AS(){const s=[],e=[],t=zn;let n="";for(;se<t;){switch(Ae){case 36:if(Ps(se+1)===123){s.push(n),n="",se+=2,Ae=Ps(se),q();const i=Ue(61,Fa);e.push(i);continue}else n+="$";break;case 92:n+=Do(du(J()));break;default:n+=Do(Ae)}J()}return e.length?(s.push(n),new oS(s,e)):null}function hl(s,e,t){const n=le,i=[Re];mn(2163761);const r=[Ue(62,s)];for(;(B=kS())!==2163760;)i.push(Re),mn(2163761),r.push(Ue(62,s));return i.push(Re),ge=!1,le=n,t?(q(),new Fg(i,i,e,r)):(q(),new Ha(i,r))}function If(s){ge=!1;const e=[Re];return q(),new Fg(e,e,s)}function q(){for(;se<zn;)if(Rs=se,(B=VS[Ae]())!=null)return;B=6291456}function J(){return Ae=Ps(++se)}function TS(){for(;jS[J()];);const s=KS[Re=vi()];return s===void 0?4096:s}function kf(s){let e=Ae;if(s===!1){do e=J();while(e<=57&&e>=48);if(e!==46)return Re=parseInt(vi(),10),32768;if(e=J(),se>=zn)return Re=parseInt(vi().slice(0,-1),10),32768}if(e<=57&&e>=48)do e=J();while(e<=57&&e>=48);else Ae=Ps(--se);return Re=parseFloat(vi()),32768}function IS(){const s=Ae;J();let e=0;const t=new Array;let n=se;for(;Ae!==s;)if(Ae===92)t.push(de.slice(n,se)),J(),e=du(Ae),J(),t.push(Do(e)),n=se;else{if(se>=zn)throw BS();J()}const i=de.slice(n,se);return J(),t.push(i),Re=t.join(""),16384}function Gg(){let s=!0,e="";for(;J()!==96;)if(Ae===36)if(se+1<zn&&Ps(se+1)===123){se++,s=!1;break}else e+="$";else if(Ae===92)e+=Do(du(J()));else{if(se>=zn)throw Wg();e+=Do(Ae)}return J(),Re=e,s?2163760:2163761}const kS=()=>{if(se>=zn)throw Wg();return se--,Gg()},Rn=s=>B===s?(q(),!0):!1,mn=s=>{if(B===s)q();else throw Qg(s)},ES=()=>Ie(151,de),ah=()=>Ie(152,de),oi=()=>Ie(153,de),RS=()=>Ie(154,de),PS=()=>Ie(155,de),ul=()=>Ie(156,vi(),se,de),OS=()=>Ie(157),NS=()=>Ie(158,de),MS=()=>Ie(159,de),xS=()=>Ie(160,de),$S=()=>Ie(161,de),LS=()=>Ie(162,de),Ef=s=>Ie(163,de,s),DS=()=>Ie(164,de),BS=()=>Ie(165,de),Wg=()=>Ie(166,de),Qg=s=>Ie(167,nr[s&63],de),HS=()=>Ie(170,vi(),se,de),pu=()=>Ie(171,vi(),se-1,de),Oa=()=>Ie(172,de),ca=()=>Ie(173,de),Rf=()=>Ie(174,de),Pf=()=>Ie(175,de),US=()=>Ie(176,de),Yg=()=>Ie(178,de),FS=()=>Ie(179,se-1,de),nr=[uS,dS,fS,Vg,"this","$this",null,"$parent","(","{",".","..","...","?.","}",")",",","[","]",":",";","?","'",'"',"&","|","??","||","&&","==","!=","===","!==","<",">","<=",">=","in","instanceof","+","-","typeof","void","*","%","/","=","!",2163760,2163761,"of","=>","+=","-=","*=","/=","++","--"],KS=Object.assign(Ra(),{true:8193,null:8194,false:8192,undefined:8195,this:12293,$this:12292,$parent:12295,in:6562213,instanceof:6562214,typeof:139305,void:139306,of:4204594}),{CharScanners:VS,IdParts:jS}=(()=>{const s=()=>{throw Ie(168,de)};s.notMapped=!0;const e={AsciiIdPart:[36,0,48,58,65,91,95,0,97,123],IdStart:[36,0,65,91,95,0,97,123,170,0,186,0,192,215,216,247,248,697,736,741,7424,7462,7468,7517,7522,7526,7531,7544,7545,7615,7680,7936,8305,0,8319,0,8336,8349,8490,8492,8498,0,8526,0,8544,8585,11360,11392,42786,42888,42891,42927,42928,42936,42999,43008,43824,43867,43868,43877,64256,64263,65313,65339,65345,65371],Digit:[48,58],Skip:[0,33,127,161]},t=(o,a,c,l)=>{const h=c.length;for(let u=0;u<h;u+=2){const d=c[u];let f=c[u+1];f=f>0?f:d+1,o&&o.fill(l,d,f)}},n=(o=>(t(o,null,e.IdStart,1),t(o,null,e.Digit,1),o))(new Uint8Array(65535)),i=o=>()=>(J(),o),r=new Array(65535);return r.fill(s,0,65535),t(r,null,e.Skip,()=>(J(),null)),t(r,null,e.IdStart,TS),t(r,null,e.Digit,()=>kf(!1)),r[34]=r[39]=()=>IS(),r[96]=()=>Gg(),r[33]=()=>J()!==61?131119:J()!==61?6553950:(J(),6553952),r[61]=()=>J()===62?(J(),51):Ae!==61?4194350:J()!==61?6553949:(J(),6553951),r[38]=()=>J()!==38?6291480:(J(),6553884),r[124]=()=>J()!==124?6291481:(J(),6553819),r[63]=()=>{if(J()===46){const o=Ps(se+1);return o<=48||o>=57?(J(),2162701):6291479}return Ae!==63?6291479:(J(),6553754)},r[46]=()=>J()<=57&&Ae>=48?kf(!0):Ae===46?J()!==46?11:(J(),12):65546,r[60]=()=>J()!==61?6554017:(J(),6554019),r[62]=()=>J()!==61?6554018:(J(),6554020),r[37]=i(6554156),r[40]=i(2688008),r[41]=i(7340047),r[42]=()=>J()!==61?6554155:(J(),4194358),r[43]=()=>J()===43?(J(),2228280):Ae!==61?2490855:(J(),4194356),r[44]=i(6291472),r[45]=()=>J()===45?(J(),2228281):Ae!==61?2490856:(J(),4194357),r[47]=()=>J()!==61?6554157:(J(),4194359),r[58]=i(6291477),r[59]=i(6291478),r[91]=i(2688019),r[93]=i(7340052),r[123]=i(524297),r[125]=i(7340046),{CharScanners:r,IdParts:n}})(),zS=Object.prototype.hasOwnProperty,zi=Reflect.defineProperty;function Si(s,e,t){return zi(s,e,{enumerable:!1,configurable:!0,writable:!0,value:t}),t}function hi(s,e,t){e in s||Si(s,e,t)}const Jg=Object.assign,gu=Object.freeze,Ka=String,Pc=sn.createInterface,qS=$t.get,GS=$t.define,Xg=sn.createInterface("ICoercionConfiguration"),Oc=0,Ji=1,WS=2,QS=4,mu=gu({None:Oc,Observer:Ji,Node:WS,Layout:QS});function Os(s=0){const e=Array(s);let t=0;for(;t<s;)e[t]=t++;return e.deletedIndices=[],e.deletedItems=[],e.isIndexMap=!0,e}let YS=!1;const _n=(()=>{function s(a,c){return a==null?r:r(a)}function e(){return Si(this,"subs",new o)}function t(a){return this.subs.add(a)}function n(a){return this.subs.remove(a)}const i=new WeakSet;function r(a,c){if(!i.has(a)){i.add(a);const l=a.prototype;zi(l,"subs",{get:e}),hi(l,"subscribe",t),hi(l,"unsubscribe",n)}return a}class o{constructor(){this.count=0,this._subs=[],this._requestDirtySubs=[],this._hasDirtySubs=!1}add(c){return this._subs.includes(c)?!1:(this._subs[this._subs.length]=c,"handleDirty"in c&&(this._requestDirtySubs[this._requestDirtySubs.length]=c,this._hasDirtySubs=!0),++this.count,!0)}remove(c){let l=this._subs.indexOf(c);return l!==-1?(this._subs.splice(l,1),l=this._requestDirtySubs.indexOf(c),l!==-1&&(this._requestDirtySubs.splice(l,1),this._hasDirtySubs=this._requestDirtySubs.length>0),--this.count,!0):!1}notify(c,l){for(const h of this._subs.slice(0))h.handleChange(c,l)}notifyCollection(c,l){const h=this._subs.slice(0),u=h.length;let d=0;for(;d<u;++d)h[d].handleCollectionChange(c,l)}notifyDirty(){if(this._hasDirtySubs)for(const c of this._requestDirtySubs.slice(0))c.handleDirty()}}return s})(),Lt=(s,...e)=>new Error(`AUR${Ka(s).padStart(4,"0")}: ${XS(s,...e)}`),JS={99:"Method {{0}} not implemented",101:'Ast eval error: binding behavior "{{0}}" could not be found. Did you forget to register it as a dependency?',102:'Ast eval error: binding behavior "{{0}}" already applied.',103:'Ast eval error: value converter "{{0}}" could not be found. Did you forget to register it as a dependency?',105:"Ast eval error: unable to find $host context. Did you forget [au-slot] attribute?",106:'Ast eval error: invalid assignment. "$host" is a reserved keyword.',107:"Ast eval error: expression is not a function.",109:'Ast eval error: unknown unary operator: "{{0}}"',108:'Ast eval error: unknown binary operator: "{{0}}"',110:"Ast eval error: left-hand side of tagged template expression is not a function.",111:'Ast eval error: expected "{{0}}" to be a function',112:"Ast eval error: cannot use non-object value for destructuring assignment.",151:'Expression error: invalid start: "{{0}}"',152:'Expression error: spread operator is not supported: "{{0}}"',153:'Expression error: expected identifier: "{{0}}"',154:'Expression error: invalid member expression: "{{0}}"',155:'Expression error: unexpected end of expression: "{{0}}"',156:'Expression error: unconsumed token: "{{0}}" at position {{1}} of "{{2}}"',157:"Expression error: invalid empty expression. Empty expression is only valid in event bindings (trigger, delegate, capture etc...)",158:'Expression error: left hand side of expression is not assignable: "{{0}}"',159:'Expression error: expected identifier to come after value converter operator: "{{0}}"',160:"Expression error: expected identifier to come after binding behavior operator: {{0}}",161:'Expression error: unexpected keyword "of": "{{0}}"',162:'Expression error: unexpected keyword "import": "{{0}}"',163:'Expression error: invalid BindingIdentifier at left hand side of "of": "{{0}}" | kind: {{1}}',164:'Expression error: invalid or unsupported property definition in object literal: "{{0}}"',165:'Expression error: unterminated quote in string literal: "{{0}}"',166:'Expression error: unterminated template string: "{{0}}"',167:'Expression error: missing expected token "{{0}}" in "{{1}}"',168:'Expression error: unexpected character: "{{0}}"',170:'Expression error: unexpected "{{0}}" at position "{{1}}" for destructuring assignment in "{{2}}"',171:'Expression error: unexpected {{0}} at position "{{1}}" for optional chain in "{{2}}"',172:'Expression error: invalid tagged template on optional chain in "{{1}}"',173:'Expression error: invalid arrow parameter list in "{{0}}"',174:'Expression error: arrow function with default parameters is not supported: "{{0}}"',175:'Expression error: arrow function with destructuring parameters is not supported: "{{0}}"',176:'Expression error: rest parameter must be last formal parameter in arrow function: "{{0}}"',178:'Expression error: arrow function with function body is not supported: "{{0}}"',179:`Expression error: unexpected token '.' at position "{{1}}" in "{{0}}"`,199:"Trying to observe property {{0}} on null/undefined",203:"Trying to retrieve a property or build a scope from a null/undefined scope",204:"Trying to create a scope with null/undefined binding context",206:"Trying to switch to a null/undefined connectable",207:"Trying to enter an active connectable",208:"Trying to pop a null/undefined connectable",209:"Trying to exit an inactive connectable",210:"Unrecognised collection type {{0:toString}}.",217:"There is no registration for IDirtyChecker interface. If you want to use your own dirty checker, make sure you register it.",218:"Dirty checked is not permitted in this application. Property key {{0}} is being dirty checked.",219:"Trying to set value for property {{0}} in dirty checker",220:'Map/Set "size" is a readonly property',221:'Trying to assign value to readonly property "{{0}}" through computed observer.',224:"Invalid @observable decorator usage, cannot determine property name",225:"Trying to stop an effect that has already been stopped",226:"Maximum number of recursive effect run reached. Consider handle effect dependencies differently."},XS=(s,...e)=>{var n;let t=JS[s];for(let i=0;i<e.length;++i){const r=new RegExp(`{{${i}(:.*)?}}`,"g");let o=r.exec(t);for(;o!=null;){const a=(n=o[1])==null?void 0:n.slice(1);let c=e[i];if(c!=null)switch(a){case"typeof":c=typeof c;break;case"toString":c=Object.prototype.toString.call(c);break;case"join(!=)":c=c.join("!=");break;case"element":c=c==="*"?"all elements":`<${c} />`;break;default:a!=null&&a.startsWith(".")?c=Ka(c[a.slice(1)]):c=Ka(c)}t=t.slice(0,o.index)+c+t.slice(r.lastIndex),o=r.exec(t)}}return t};class Zg{constructor(e){this.owner=e,this.type=Ji,this._value=(this._obj=e.collection).length}getValue(){return this._obj.length}setValue(e){e!==this._value&&(Number.isNaN(e)?console.warn(`Invalid value "${e}" for array length`):(this._obj.splice(e),this._value=this._obj.length))}handleDirty(){this._value!==this._obj.length&&this.subs.notifyDirty()}handleCollectionChange(e,t){const n=this._value,i=this._obj.length;(this._value=i)!==n&&(this.subs.notifyDirty(),this.subs.notify(this._value,n))}}em(Zg);class vu{constructor(e){this.owner=e,this.type=Ji,this._value=(this._obj=e.collection).size}getValue(){return this._obj.size}setValue(){throw Lt(220)}handleDirty(){this._value!==this._obj.size&&this.subs.notifyDirty()}handleCollectionChange(e,t){const n=this._value,i=this._obj.size;(this._value=i)!==n&&this.subs.notify(this._value,n)}}em(vu);function em(s){const e=s.prototype;return hi(e,"subscribe",ZS),hi(e,"unsubscribe",eA),_n(s,null)}function ZS(s){this.subs.add(s)&&this.subs.count===1&&this.owner.subscribe(this)}function eA(s){this.subs.remove(s)&&this.subs.count===0&&this.owner.subscribe(this)}const Co=(()=>{const s=Symbol.for("__au_arr_obs__"),e=Array[s]??Si(Array,s,new WeakMap);function t(m,g){return m===g?0:(m=m===null?"null":m.toString(),g=g===null?"null":g.toString(),m<g?-1:1)}function n(m,g){return m===void 0?g===void 0?0:1:g===void 0?-1:0}function i(m,g,v,S,R){let C,I,$,x,F,D,V;for(D=v+1;D<S;D++){for(C=m[D],I=g[D],V=D-1;V>=v&&($=m[V],x=g[V],F=R($,C),F>0);V--)m[V+1]=$,g[V+1]=x;m[V+1]=C,g[V+1]=I}}function r(m,g,v,S,R){let C=0,I=0,$,x,F,D,V,ce,qe,Ne,Me,Ge,P,Ce,ct,j,Se,St,ut,rn,b;for(;;){if(S-v<=10){i(m,g,v,S,R);return}C=v+(S-v>>1),$=m[v],D=g[v],x=m[S-1],V=g[S-1],F=m[C],ce=g[C],qe=R($,x),qe>0&&(Ge=$,P=D,$=x,D=V,x=Ge,V=P),Ne=R($,F),Ne>=0?(Ge=$,P=D,$=F,D=ce,F=x,ce=V,x=Ge,V=P):(Me=R(x,F),Me>0&&(Ge=x,P=V,x=F,V=ce,F=Ge,ce=P)),m[v]=$,g[v]=D,m[S-1]=F,g[S-1]=ce,Ce=x,ct=V,j=v+1,Se=S-1,m[C]=m[j],g[C]=g[j],m[j]=Ce,g[j]=ct;e:for(I=j+1;I<Se;I++)if(St=m[I],ut=g[I],rn=R(St,Ce),rn<0)m[I]=m[j],g[I]=g[j],m[j]=St,g[j]=ut,j++;else if(rn>0){do{if(Se--,Se==I)break e;b=m[Se],rn=R(b,Ce)}while(rn>0);m[I]=m[Se],g[I]=g[Se],m[Se]=St,g[Se]=ut,rn<0&&(St=m[I],ut=g[I],m[I]=m[j],g[I]=g[j],m[j]=St,g[j]=ut,j++)}S-Se<j-v?(r(m,g,Se,S,R),S=j):(r(m,g,v,j,R),v=Se)}}const o=Array.prototype,a=["push","unshift","pop","shift","splice","reverse","sort"];let c;function l(){const m=o.push,g=o.unshift,v=o.pop,S=o.shift,R=o.splice,C=o.reverse,I=o.sort;c={push:function(...$){const x=e.get(this);if(x===void 0)return m.apply(this,$);const F=this.length,D=$.length;if(D===0)return F;this.length=x.indexMap.length=F+D;let V=F;for(;V<this.length;)this[V]=$[V-F],x.indexMap[V]=-2,V++;return x.notify(),this.length},unshift:function(...$){const x=e.get(this);if(x===void 0)return g.apply(this,$);const F=$.length,D=new Array(F);let V=0;for(;V<F;)D[V++]=-2;g.apply(x.indexMap,D);const ce=g.apply(this,$);return x.notify(),ce},pop:function(){const $=e.get(this);if($===void 0)return v.call(this);const x=$.indexMap,F=v.call(this),D=x.length-1;return x[D]>-1&&(x.deletedIndices.push(x[D]),x.deletedItems.push(F)),v.call(x),$.notify(),F},shift:function(){const $=e.get(this);if($===void 0)return S.call(this);const x=$.indexMap,F=S.call(this);return x[0]>-1&&(x.deletedIndices.push(x[0]),x.deletedItems.push(F)),S.call(x),$.notify(),F},splice:function(...$){const x=$[0],F=$[1],D=e.get(this);if(D===void 0)return R.apply(this,$);const V=this.length,ce=x|0,qe=ce<0?Math.max(V+ce,0):Math.min(ce,V),Ne=D.indexMap,Me=$.length,Ge=Me===0?0:Me===1?V-qe:F;let P=qe;if(Ge>0){const ct=P+Ge;for(;P<ct;)Ne[P]>-1&&(Ne.deletedIndices.push(Ne[P]),Ne.deletedItems.push(this[P])),P++}if(P=0,Me>2){const ct=Me-2,j=new Array(ct);for(;P<ct;)j[P++]=-2;R.call(Ne,x,F,...j)}else R.apply(Ne,$);const Ce=R.apply(this,$);return(Ge>0||P>0)&&D.notify(),Ce},reverse:function(){const $=e.get(this);if($===void 0)return C.call(this),this;const x=this.length,F=x/2|0;let D=0;for(;D!==F;){const V=x-D-1,ce=this[D],qe=$.indexMap[D],Ne=this[V],Me=$.indexMap[V];this[D]=Ne,$.indexMap[D]=Me,this[V]=ce,$.indexMap[V]=qe,D++}return $.notify(),this},sort:function($){const x=e.get(this);if(x===void 0)return I.call(this,$),this;let F=this.length;if(F<2)return this;r(this,x.indexMap,0,F,n);let D=0;for(;D<F&&this[D]!==void 0;)D++;($===void 0||!pe($))&&($=t),r(this,x.indexMap,0,D,$);let V=!1;for(D=0,F=x.indexMap.length;F>D;++D)if(x.indexMap[D]!==D){V=!0;break}return(V||YS)&&x.notify(),this}};for(const $ of a)zi(c[$],"observing",{value:!0,writable:!1,configurable:!1,enumerable:!1})}let h=!1;const u="__au_arr_on__";function d(){if(c===void 0&&l(),!(qS(u,Array)??!1)){GS(!0,Array,u);for(const m of a)o[m].observing!==!0&&Si(o,m,c[m])}}class f{constructor(g){this.type=Ji,h||(h=!0,d()),this.indexObservers={},this.collection=g,this.indexMap=Os(g.length),this.lenObs=void 0,e.set(g,this)}notify(){const g=this.subs;g.notifyDirty();const v=this.indexMap,S=this.collection,R=S.length;this.indexMap=Os(R),g.notifyCollection(S,v)}getLengthObserver(){return this.lenObs??(this.lenObs=new Zg(this))}getIndexObserver(g){var v;return(v=this.indexObservers)[g]??(v[g]=new p(this,g))}}_n(f,null);class p{constructor(g,v){this.owner=g,this.index=v,this.doNotCache=!0,this.value=this.getValue()}getValue(){return this.owner.collection[this.index]}setValue(g){if(g===this.getValue())return;const v=this.owner,S=this.index,R=v.indexMap;R[S]>-1&&R.deletedIndices.push(R[S]),R[S]=-2,v.collection[S]=g,v.notify()}handleDirty(){this.value!==this.getValue()&&this.subs.notifyDirty()}handleCollectionChange(g,v){const S=this.index;if(v[S]===S)return;const C=this.value,I=this.value=this.getValue();C!==I&&this.subs.notify(I,C)}subscribe(g){this.subs.add(g)&&this.subs.count===1&&this.owner.subscribe(this)}unsubscribe(g){this.subs.remove(g)&&this.subs.count===0&&this.owner.unsubscribe(this)}}return _n(p,null),function(g){let v=e.get(g);return v===void 0&&(e.set(g,v=new f(g)),d()),v}})(),Va=(()=>{const s=Symbol.for("__au_set_obs__"),e=Set[s]??Si(Set,s,new WeakMap),{add:t,clear:n,delete:i}=Set.prototype,r=["add","clear","delete"],o={add:function(l){const h=e.get(this);if(h===void 0)return t.call(this,l),this;const u=this.size;return t.call(this,l),this.size===u?this:(h.indexMap[u]=-2,h.notify(),this)},clear:function(){const l=e.get(this);if(l===void 0)return n.call(this);if(this.size>0){const u=l.indexMap;let d=0;for(const f of this.keys())u[d]>-1&&(u.deletedIndices.push(u[d]),u.deletedItems.push(f)),d++;n.call(this),u.length=0,l.notify()}},delete:function(l){const h=e.get(this);if(h===void 0)return i.call(this,l);if(this.size===0)return!1;let d=0;const f=h.indexMap;for(const p of this.keys()){if(p===l){f[d]>-1&&(f.deletedIndices.push(f[d]),f.deletedItems.push(p)),f.splice(d,1);const m=i.call(this,l);return m===!0&&h.notify(),m}d++}return!1}};function a(l){for(const h of r)Si(l,h,o[h])}class c{constructor(h){this.type=Ji,this.collection=h,this.indexMap=Os(h.size),this.lenObs=void 0}notify(){const h=this.subs;h.notifyDirty();const u=this.indexMap,d=this.collection,f=d.size;this.indexMap=Os(f),h.notifyCollection(d,u)}getLengthObserver(){return this.lenObs??(this.lenObs=new vu(this))}}return _n(c,null),function(h){let u=e.get(h);return u===void 0&&(e.set(h,u=new c(h)),a(h)),u}})(),ja=(()=>{const s=Symbol.for("__au_map_obs__"),e=Map[s]??Si(Map,s,new WeakMap),{set:t,clear:n,delete:i}=Map.prototype,r=["set","clear","delete"],o={set:function(l,h){const u=e.get(this);if(u===void 0)return t.call(this,l,h),this;const d=this.get(l),f=this.size;if(t.call(this,l,h),this.size===f){let m=0;for(const g of this.entries()){if(g[0]===l)return g[1]!==d&&(u.indexMap.deletedIndices.push(u.indexMap[m]),u.indexMap.deletedItems.push(g),u.indexMap[m]=-2,u.notify()),this;m++}return this}return u.indexMap[f]=-2,u.notify(),this},clear:function(){const l=e.get(this);if(l===void 0)return n.call(this);if(this.size>0){const u=l.indexMap;let d=0;for(const f of this.keys())u[d]>-1&&(u.deletedIndices.push(u[d]),u.deletedItems.push(f)),d++;n.call(this),u.length=0,l.notify()}},delete:function(l){const h=e.get(this);if(h===void 0)return i.call(this,l);if(this.size===0)return!1;let d=0;const f=h.indexMap;for(const p of this.keys()){if(p===l){f[d]>-1&&(f.deletedIndices.push(f[d]),f.deletedItems.push(p)),f.splice(d,1);const m=i.call(this,l);return m===!0&&h.notify(),m}++d}return!1}};function a(l){for(const h of r)Si(l,h,o[h])}class c{constructor(h){this.type=Ji,this.collection=h,this.indexMap=Os(h.size),this.lenObs=void 0}notify(){const h=this.subs;h.notifyDirty();const u=this.indexMap,d=this.collection,f=d.size;this.indexMap=Os(f),h.notifyCollection(d,u)}getLengthObserver(){return this.lenObs??(this.lenObs=new vu(this))}}return _n(c,null),function(h){let u=e.get(h);return u===void 0&&(e.set(h,u=new c(h)),a(h)),u}})(),Of=(()=>{class s{constructor(h){this.version=0,this.count=0,this.o=new Map,this.b=h}add(h){this.o.has(h)||(h.subscribe(this.b),++this.count),this.o.set(h,this.version)}clear(){this.o.forEach(t,this),this.count=this.o.size}clearAll(){this.o.forEach(e,this),this.o.clear(),this.count=0}}function e(l,h){h.unsubscribe(this.b)}function t(l,h){this.version!==l&&(h.unsubscribe(this.b),this.o.delete(h))}function n(){return Si(this,"obs",new s(this))}function i(l,h){this.obs.add(this.oL.getObserver(l,h))}function r(l){let h;if(ze(l))h=Co(l);else if(Kr(l))h=Va(l);else if(Fi(l))h=ja(l);else throw Lt(210,l);this.obs.add(h)}function o(l){this.obs.add(l)}function a(){throw Lt(99,"handleChange")}function c(){throw Lt(99,"handleCollectionChange")}return function(h,u){const d=h.prototype;return hi(d,"observe",i),hi(d,"observeCollection",r),hi(d,"subscribeTo",o),zi(d,"obs",{get:n}),hi(d,"handleChange",a),hi(d,"handleCollectionChange",c),h}})();function Jn(s,e){return s==null?Of:Of(s,e)}let ae=null;const dr=[];let Ai=!1;function tA(){Ai=!1}function nA(){Ai=!0}function yu(){return ae}function _u(s){if(s==null)throw Lt(206);if(ae==null){ae=s,dr[0]=ae,Ai=!0;return}if(ae===s)throw Lt(207);dr.push(s),ae=s,Ai=!0}function bu(s){if(s==null)throw Lt(208);if(ae!==s)throw Lt(209);dr.pop(),ae=dr.length>0?dr[dr.length-1]:null,Ai=ae!=null}const iA=gu({get current(){return ae},get connecting(){return Ai},enter:_u,exit:bu,pause:tA,resume:nA}),Or=Reflect.get,sA=Object.prototype.toString,ch=new WeakMap,rA="__au_nw__",oA="__au_nw";function tm(s){switch(sA.call(s)){case"[object Object]":return s.constructor[rA]!==!0;case"[object Array]":case"[object Map]":case"[object Set]":return!0;default:return!1}}const zr="__raw__";function re(s){return tm(s)?Nc(s):s}function Nc(s){return ch.get(s)??aA(s)}function fe(s){return s[zr]??s}function Pt(s){return tm(s)&&s[zr]||s}function wu(s,e){return e==="constructor"||e==="__proto__"||e==="$observers"||e===Symbol.toPrimitive||e===Symbol.toStringTag||s.constructor[`${oA}_${Ka(e)}__`]===!0}function aA(s){const e=ze(s)?lA:Fi(s)||Kr(s)?NA:cA,t=new Proxy(s,e);return ch.set(s,t),ch.set(t,t),t}const cA={get(s,e,t){if(e===zr)return s;const n=yu();return!Ai||wu(s,e)||n==null?Or(s,e,t):(n.observe(s,e),re(Or(s,e,t)))}},lA={get(s,e,t){if(e===zr)return s;if(!Ai||wu(s,e)||ae==null)return Or(s,e,t);switch(e){case"length":return ae.observe(s,"length"),s.length;case"map":return hA;case"includes":return fA;case"indexOf":return pA;case"lastIndexOf":return gA;case"every":return uA;case"filter":return dA;case"find":return vA;case"findIndex":return mA;case"flat":return yA;case"flatMap":return _A;case"join":return bA;case"push":return CA;case"pop":return wA;case"reduce":return PA;case"reduceRight":return OA;case"reverse":return IA;case"shift":return SA;case"unshift":return AA;case"slice":return RA;case"splice":return TA;case"some":return kA;case"sort":return EA;case"keys":return nm;case"values":case Symbol.iterator:return lh;case"entries":return hh}return ae.observe(s,e),re(Or(s,e,t))},ownKeys(s){var e;return(e=yu())==null||e.observe(s,"length"),Reflect.ownKeys(s)}};function hA(s,e){const t=fe(this),n=t.map((i,r)=>Pt(s.call(e,re(i),r,this)));return De(ae,t),re(n)}function uA(s,e){const t=fe(this),n=t.every((i,r)=>s.call(e,re(i),r,this));return De(ae,t),n}function dA(s,e){const t=fe(this),n=t.filter((i,r)=>Pt(s.call(e,re(i),r,this)));return De(ae,t),re(n)}function fA(s){const e=fe(this),t=e.includes(Pt(s));return De(ae,e),t}function pA(s){const e=fe(this),t=e.indexOf(Pt(s));return De(ae,e),t}function gA(s){const e=fe(this),t=e.lastIndexOf(Pt(s));return De(ae,e),t}function mA(s,e){const t=fe(this),n=t.findIndex((i,r)=>Pt(s.call(e,re(i),r,this)));return De(ae,t),n}function vA(s,e){const t=fe(this),n=t.find((i,r)=>s(re(i),r,this),e);return De(ae,t),re(n)}function yA(){const s=fe(this);return De(ae,s),re(s.flat())}function _A(s,e){const t=fe(this);return De(ae,t),Nc(t.flatMap((n,i)=>re(s.call(e,re(n),i,this))))}function bA(s){const e=fe(this);return De(ae,e),e.join(s)}function wA(){return re(fe(this).pop())}function CA(...s){return fe(this).push(...s)}function SA(){return re(fe(this).shift())}function AA(...s){return fe(this).unshift(...s)}function TA(...s){return re(fe(this).splice(...s))}function IA(...s){const e=fe(this),t=e.reverse();return De(ae,e),re(t)}function kA(s,e){const t=fe(this),n=t.some((i,r)=>Pt(s.call(e,re(i),r,this)));return De(ae,t),n}function EA(s){const e=fe(this),t=e.sort(s);return De(ae,e),re(t)}function RA(s,e){const t=fe(this);return De(ae,t),Nc(t.slice(s,e))}function PA(s,e){const t=fe(this),n=t.reduce((i,r,o)=>s(i,re(r),o,this),e);return De(ae,t),re(n)}function OA(s,e){const t=fe(this),n=t.reduceRight((i,r,o)=>s(i,re(r),o,this),e);return De(ae,t),re(n)}const NA={get(s,e,t){if(e===zr)return s;const n=yu();if(!Ai||wu(s,e)||n==null)return Or(s,e,t);switch(e){case"size":return n.observe(s,"size"),s.size;case"clear":return BA;case"delete":return HA;case"forEach":return MA;case"add":if(Kr(s))return DA;break;case"get":if(Fi(s))return $A;break;case"set":if(Fi(s))return LA;break;case"has":return xA;case"keys":return nm;case"values":return lh;case"entries":return hh;case Symbol.iterator:return Fi(s)?hh:lh}return re(Or(s,e,t))}};function MA(s,e){const t=fe(this);return De(ae,t),t.forEach((n,i)=>{s.call(e,re(n),re(i),this)})}function xA(s){const e=fe(this);return De(ae,e),e.has(Pt(s))}function $A(s){const e=fe(this);return De(ae,e),re(e.get(Pt(s)))}function LA(s,e){return re(fe(this).set(Pt(s),Pt(e)))}function DA(s){return re(fe(this).add(Pt(s)))}function BA(){return re(fe(this).clear())}function HA(s){return re(fe(this).delete(Pt(s)))}function nm(){const s=fe(this);De(ae,s);const e=s.keys();return{next(){const t=e.next(),n=t.value,i=t.done;return i?{value:void 0,done:i}:{value:re(n),done:i}},[Symbol.iterator](){return this}}}function lh(){const s=fe(this);De(ae,s);const e=s.values();return{next(){const t=e.next(),n=t.value,i=t.done;return i?{value:void 0,done:i}:{value:re(n),done:i}},[Symbol.iterator](){return this}}}function hh(){const s=fe(this);De(ae,s);const e=s.entries();return{next(){const t=e.next(),n=t.value,i=t.done;return i?{value:void 0,done:i}:{value:[re(n[0]),re(n[1])],done:i}},[Symbol.iterator](){return this}}}const De=(s,e)=>s==null?void 0:s.observeCollection(e),UA=gu({getProxy:Nc,getRaw:fe,wrap:re,unwrap:Pt,rawKey:zr});class za{constructor(e,t,n,i,r){this.type=Ji,this._value=void 0,this._isRunning=!1,this._isDirty=!1,this._callback=void 0,this._coercer=void 0,this._coercionConfig=void 0,this._obj=e,this._wrapped=r?re(e):e,this.$get=t,this.$set=n,this.oL=i}init(e){this._value=e,this._isDirty=!1}getValue(){return this.subs.count===0?this.$get.call(this._obj,this._obj,this):(this._isDirty&&(this.compute(),this._isDirty=!1),this._value)}setValue(e){if(pe(this.$set))this._coercer!==void 0&&(e=this._coercer.call(null,e,this._coercionConfig)),Es(e,this._value)||(this._isRunning=!0,this.$set.call(this._obj,e),this._isRunning=!1,this.run());else throw Lt(221)}useCoercer(e,t){return this._coercer=e,this._coercionConfig=t,!0}useCallback(e){return this._callback=e,!0}handleDirty(){this._isDirty||(this._isDirty=!0,this.subs.notifyDirty())}handleChange(){this._isDirty=!0,this.subs.count>0&&this.run()}handleCollectionChange(){this._isDirty=!0,this.subs.count>0&&this.run()}subscribe(e){this.subs.add(e)&&this.subs.count===1&&(this.compute(),this._isDirty=!1)}unsubscribe(e){this.subs.remove(e)&&this.subs.count===0&&(this._isDirty=!0,this.obs.clearAll())}run(){var n;if(this._isRunning)return;const e=this._value,t=this.compute();this._isDirty=!1,Es(t,e)||((n=this._callback)==null||n.call(this,t,e),this.subs.notify(this._value,e))}compute(){this._isRunning=!0,this.obs.version++;try{return _u(this),this._value=Pt(this.$get.call(this._wrapped,this._wrapped,this))}finally{this.obs.clear(),this._isRunning=!1,bu(this)}}}Jn(za,null),_n(za,null);const Cu=Pc("IDirtyChecker",s=>s.callback(()=>{throw Lt(217)})),FA={timeoutsPerCheck:25,disabled:!1,throw:!1,resetToDefault(){this.timeoutsPerCheck=6,this.disabled=!1,this.throw=!1}};class KA{static register(e){e.register(Ci.singleton(this,this),Ci.aliasTo(this,Cu))}constructor(){this.tracked=[],this._task=null,this._elapsedFrames=0,this.p=k(Vr),this.check=()=>{if(++this._elapsedFrames<FA.timeoutsPerCheck)return;this._elapsedFrames=0;const e=this.tracked,t=e.length;let n,i=0;for(;i<t;++i)n=e[i],n.isDirty()&&n.flush()},_n(Nf,null)}createProperty(e,t){return new Nf(this,e,t)}addProperty(e){this.tracked.push(e),this.tracked.length===1&&(this._task=this.p.taskQueue.queueTask(this.check,{persistent:!0}))}removeProperty(e){this.tracked.splice(this.tracked.indexOf(e),1),this.tracked.length===0&&(this._task.cancel(),this._task=null)}}class Nf{constructor(e,t,n){this.obj=t,this.key=n,this.type=Oc,this._oldValue=void 0,this._dirtyChecker=e}getValue(){return this.obj[this.key]}setValue(e){throw Lt(219,this.key)}isDirty(){return this._oldValue!==this.obj[this.key]}flush(){const e=this._oldValue,t=this.getValue();this._oldValue=t,this.subs.notify(t,e)}subscribe(e){this.subs.add(e)&&this.subs.count===1&&(this._oldValue=this.obj[this.key],this._dirtyChecker.addProperty(this))}unsubscribe(e){this.subs.remove(e)&&this.subs.count===0&&this._dirtyChecker.removeProperty(this)}}class VA{get doNotCache(){return!0}constructor(e,t){this.type=Oc,this._obj=e,this._key=t}getValue(){return this._obj[this._key]}setValue(){}subscribe(){}unsubscribe(){}}class im{constructor(){this.type=Oc}getValue(e,t){return e[t]}setValue(e,t,n){t[n]=e}}class Su{constructor(e,t){this.type=Ji,this._value=void 0,this._observing=!1,this._callback=void 0,this._coercer=void 0,this._coercionConfig=void 0,this._obj=e,this._key=t}getValue(){return this._value}setValue(e){var t,n;if(this._coercer!==void 0&&(e=this._coercer.call(void 0,e,this._coercionConfig)),this._observing){if(Es(e,this._value))return;la=this._value,this._value=e,(t=this._callback)==null||t.call(this,e,la),this.subs.notifyDirty(),this.subs.notify(e,la)}else this._value=this._obj[this._key]=e,(n=this._callback)==null||n.call(this,e,la)}useCallback(e){return this._callback=e,this.start(),!0}useCoercer(e,t){return this._coercer=e,this._coercionConfig=t,this.start(),!0}subscribe(e){this._observing===!1&&this.start(),this.subs.add(e)}start(){return this._observing===!1&&(this._observing=!0,this._value=this._obj[this._key],zi(this._obj,this._key,{enumerable:!0,configurable:!0,get:Jg(()=>this.getValue(),{getObserver:()=>this}),set:e=>{this.setValue(e)}})),this}stop(){return this._observing&&(zi(this._obj,this._key,{enumerable:!0,configurable:!0,writable:!0,value:this._value}),this._observing=!1),this}}_n(Su,null);let la;const uh=new im,qr=Pc("IObserverLocator",s=>s.singleton(qA)),Au=Pc("INodeObserverLocator",s=>s.cachedCallback(e=>(e.getAll(ji).forEach(t=>{t.error("Using default INodeObserverLocator implementation. Will not be able to observe nodes (HTML etc...).")}),new jA)));class jA{handles(){return!1}getObserver(){return uh}getAccessor(){return uh}}const zA=Pc("IComputedObserverLocator",s=>s.singleton(class{getObserver(t,n,i,r){const o=new za(t,i.get,i.set,r,!0);return zi(t,n,{enumerable:i.enumerable,configurable:!0,get:Jg(()=>o.getValue(),{getObserver:()=>o}),set:a=>{o.setValue(a)}}),o}}));class qA{constructor(){this._adapters=[],this._dirtyChecker=k(Cu),this._nodeObserverLocator=k(Au),this._computedObserverLocator=k(zA)}addAdapter(e){this._adapters.push(e)}getObserver(e,t){if(e==null)throw Lt(199,t);if(!hr(e))return new VA(e,pe(t)?"":t);if(pe(t))return new za(e,t,void 0,this,!0);const n=sm(e);let i=n[t];return i===void 0&&(i=this.createObserver(e,t),i.doNotCache||(n[t]=i)),i}getAccessor(e,t){var i;const n=(i=e.$observers)==null?void 0:i[t];return n!==void 0?n:this._nodeObserverLocator.handles(e,t,this)?this._nodeObserverLocator.getAccessor(e,t,this):uh}getArrayObserver(e){return Co(e)}getMapObserver(e){return ja(e)}getSetObserver(e){return Va(e)}createObserver(e,t){var i,r;if(this._nodeObserverLocator.handles(e,t,this))return this._nodeObserverLocator.getObserver(e,t,this);switch(t){case"length":if(ze(e))return Co(e).getLengthObserver();break;case"size":if(Fi(e))return ja(e).getLengthObserver();if(Kr(e))return Va(e).getLengthObserver();break;default:if(ze(e)&&xo(t))return Co(e).getIndexObserver(Number(t));break}let n=xf(e,t);if(n===void 0){let o=Mf(e);for(;o!==null&&(n=xf(o,t),n===void 0);)o=Mf(o)}if(n!==void 0&&!zS.call(n,"value")){let o=this._getAdapterObserver(e,t,n);return o==null&&(o=(r=(i=n.get)==null?void 0:i.getObserver)==null?void 0:r.call(i,e)),o??(n.configurable?this._computedObserverLocator.getObserver(e,t,n,this):this._dirtyChecker.createProperty(e,t))}return new Su(e,t)}_getAdapterObserver(e,t,n){if(this._adapters.length>0)for(const i of this._adapters){const r=i.getObserver(e,t,n,this);if(r!=null)return r}return null}}const Tu=s=>{let e;return ze(s)?e=Co(s):Fi(s)?e=ja(s):Kr(s)&&(e=Va(s)),e},Mf=Object.getPrototypeOf,xf=Object.getOwnPropertyDescriptor,sm=s=>{let e=s.$observers;return e===void 0&&zi(s,"$observers",{enumerable:!1,value:e=be()}),e};class GA{constructor(e,t){this.oL=e,this.fn=t,this.maxRunCount=10,this.queued=!1,this.running=!1,this.runCount=0,this.stopped=!1}handleChange(){this.queued=!0,this.run()}handleCollectionChange(){this.queued=!0,this.run()}run(){if(this.stopped)throw Lt(225);if(!this.running){++this.runCount,this.running=!0,this.queued=!1,++this.obs.version;try{_u(this),this.fn(this)}finally{this.obs.clear(),this.running=!1,bu(this)}if(this.queued){if(this.runCount>this.maxRunCount)throw this.runCount=0,Lt(226);this.run()}else this.runCount=0}}stop(){this.stopped=!0,this.obs.clearAll()}}Jn(GA,null);const Mc=s=>typeof s=="string",Xn=sn.createInterface,Gr=Object.freeze,{aliasTo:$f,singleton:Iu}=Ci,hn="Interpolation",rm="IsFunction",Zn="IsProperty",ir="custom-element",Wr=Gr({default:0,oneTime:1,toView:2,fromView:4,twoWay:6}),xc=Xn("ITemplateCompiler"),om=Xn("IAttrMapper"),Be=(s,...e)=>new Error(`AUR${String(s).padStart(4,"0")}: ${QA(s,...e)}`),WA={88:"AttributeParser is already initialized; cannot add patterns after initialization.",89:'Attribute pattern "{{0}}" has already been registered.',99:"Method {{0}} not implemented",157:"Binding command {{0}} has already been registered.",701:'Template compilation error in element "{{0:name}}": the root <template> cannot be a local element template.',702:'Template compilation error: attribute "{{0}}" is invalid on element surrogate.',703:'Template compilation error: template controller "{{0}}" is invalid on element surrogate.',704:'Template compilation error: Invalid command "{{0:.command}}" for <let>. Only to-view/bind supported.',706:'Template compilation error: detected projection with [au-slot="{{0}}"] attempted on a non custom element {{1}}.',707:"Template compilation error: creating binding to non-bindable property {{0}} on {{1}}.",708:'Template compilation error: the custom element "{{0}}" does not have any content other than local template(s).',709:'Template compilation error: local element template needs to be defined directly under root of element "{{0}}".',710:'Template compilation error: bindable properties of local element "{{0}}" template needs to be defined directly under <template>.',711:`Template compilation error: the attribute 'property' is missing in {{0:outerHTML}} in local element "{{1}}"`,712:"Template compilation error: Bindable property and attribute needs to be unique; found property: {{0}}, attribute: {{1}}",713:'Template compilation error: unknown binding command: "{{0}}".{{0:bindingCommandHelp}}',714:'Template compilation error: primary already exists on element/attribute "{{0}}"',715:'Template compilation error: the value of "as-custom-element" attribute cannot be empty for local element in element "{{0}}"',716:'Template compilation error: duplicate definition of the local template named "{{0}} in element {{1}}"',717:'Template compilation error: detected a usage of "<slot>" element without specifying shadow DOM options in element: {{0}}',718:'Spreading template controller "{{0}}" is not supported.',719:"Attribute {{0}} has been already registered for {{1:element}}",720:'Spreading syntax "...xxx" is reserved. Encountered "...{{0}}"',721:'Usage of $bindables is only allowed on custom element. Encountered: <{{0}} {{1}}="{{2}}">',722:"Invalid platform object provided to the compilation, no DOM API found.",9998:"Spread binding does not support spreading custom attributes/template controllers. Did you build the spread instruction manually?"},QA=(s,...e)=>{var n;let t=WA[s];for(let i=0;i<e.length;++i){const r=new RegExp(`{{${i}(:.*)?}}`,"g");let o=r.exec(t);for(;o!=null;){const a=(n=o[1])==null?void 0:n.slice(1);let c=e[i];if(c!=null)switch(a){case"nodeName":c=c.nodeName.toLowerCase();break;case"name":c=c.name;break;case"typeof":c=typeof c;break;case"ctor":c=c.constructor.name;break;case"controller":c=c.controller.name;break;case"target@property":c=`${c.target}@${c.targetProperty}`;break;case"toString":c=Object.prototype.toString.call(c);break;case"join(!=)":c=c.join("!=");break;case"bindingCommandHelp":c=YA(c);break;case"element":c=c==="*"?"all elements":`<${c} />`;break;default:a!=null&&a.startsWith(".")?c=String(c[a.slice(1)]):c=String(c)}t=t.slice(0,o.index)+c+t.slice(r.lastIndex),o=r.exec(t)}}return t};function YA(s){switch(s){case"delegate":return`
The ".delegate" binding command has been removed in v2. Binding command ".trigger" should be used instead. If you are migrating v1 application, install compat package to add back the ".delegate" binding command for ease of migration.`;case"call":return`
The ".call" binding command has been removed in v2. If you want to pass a callback that preserves the context of the function call, you can use lambda instead. Refer to lambda expression doc for more details.`;default:return""}}var am,cm,lm,hm,um;class ku{constructor(e,t,n,i){if(this.chars=e,this.repeat=t,this.isSymbol=n,this.isInverted=i,i)switch(e.length){case 0:this.has=this._hasOfNoneInverse;break;case 1:this.has=this._hasOfSingleInverse;break;default:this.has=this._hasOfMultipleInverse}else switch(e.length){case 0:this.has=this._hasOfNone;break;case 1:this.has=this._hasOfSingle;break;default:this.has=this._hasOfMultiple}}equals(e){return this.chars===e.chars&&this.repeat===e.repeat&&this.isSymbol===e.isSymbol&&this.isInverted===e.isInverted}_hasOfMultiple(e){return this.chars.includes(e)}_hasOfSingle(e){return this.chars===e}_hasOfNone(e){return!1}_hasOfMultipleInverse(e){return!this.chars.includes(e)}_hasOfSingleInverse(e){return this.chars!==e}_hasOfNoneInverse(e){return!0}}class JA{constructor(){this.parts=ie,this._pattern="",this._currentRecord={},this._partsRecord={}}get pattern(){const e=this._pattern;return e===""?null:e}set pattern(e){e==null?(this._pattern="",this.parts=ie):(this._pattern=e,this.parts=this._partsRecord[e])}append(e,t){const n=this._currentRecord;n[e]===void 0?n[e]=t:n[e]+=t}next(e){const t=this._currentRecord;let n;t[e]!==void 0&&(n=this._partsRecord,n[e]===void 0?n[e]=[t[e]]:n[e].push(t[e]),t[e]=void 0)}}class Eu{get _pattern(){return this._isEndpoint?this._patterns[0]:null}constructor(e,...t){this.charSpec=e,this._nextStates=[],this._types=null,this._isEndpoint=!1,this._patterns=t}findChild(e){const t=this._nextStates,n=t.length;let i=null,r=0;for(;r<n;++r)if(i=t[r],e.equals(i.charSpec))return i;return null}append(e,t){const n=this._patterns;n.includes(t)||n.push(t);let i=this.findChild(e);return i==null&&(i=new Eu(e,t),this._nextStates.push(i),e.repeat&&i._nextStates.push(i)),i}findMatches(e,t){const n=[],i=this._nextStates,r=i.length;let o=0,a=null,c=0,l=0;for(;c<r;++c)if(a=i[c],a.charSpec.has(e))if(n.push(a),o=a._patterns.length,l=0,a.charSpec.isSymbol)for(;l<o;++l)t.next(a._patterns[l]);else for(;l<o;++l)t.append(a._patterns[l],e);return n}}let Lf=class{constructor(e){this.text=e;const t=this._len=e.length,n=this._specs=[];let i=0;for(;t>i;++i)n.push(new ku(e[i],!1,!1,!1))}eachChar(e){const t=this._len,n=this._specs;let i=0;for(;t>i;++i)e(n[i])}},XA=class{constructor(e){this.text="PART",this._spec=new ku(e,!0,!1,!0)}eachChar(e){e(this._spec)}};class ZA{constructor(e){this.text=e,this._spec=new ku(e,!1,!0,!1)}eachChar(e){e(this._spec)}}class eT{constructor(){this.statics=0,this.dynamics=0,this.symbols=0}}const tT=Xn("ISyntaxInterpreter",s=>s.singleton(nT));class nT{constructor(){this._rootState=new Eu(null),this._initialStates=[this._rootState]}add(e){e=e.slice(0).sort((d,f)=>d.pattern>f.pattern?1:-1);const t=e.length;let n,i,r,o,a,c,l,h=0,u;for(;t>h;){for(n=this._rootState,i=e[h],r=i.pattern,o=new eT,a=this._parse(i,o),c=a.length,l=d=>n=n.append(d,r),u=0;c>u;++u)a[u].eachChar(l);n._types=o,n._isEndpoint=!0,++h}}interpret(e){const t=new JA,n=e.length;let i=this._initialStates,r=0,o;for(;r<n&&(i=this._getNextStates(i,e.charAt(r),t),i.length!==0);++r);return i=i.filter(iT),i.length>0&&(i.sort(sT),o=i[0],o.charSpec.isSymbol||t.next(o._pattern),t.pattern=o._pattern),t}_getNextStates(e,t,n){const i=[];let r=null;const o=e.length;let a=0;for(;a<o;++a)r=e[a],i.push(...r.findMatches(t,n));return i}_parse(e,t){const n=[],i=e.pattern,r=i.length,o=e.symbols;let a=0,c=0,l="";for(;a<r;)l=i.charAt(a),o.length===0||!o.includes(l)?a===c&&l==="P"&&i.slice(a,a+4)==="PART"?(c=a=a+4,n.push(new XA(o)),++t.dynamics):++a:a!==c?(n.push(new Lf(i.slice(c,a))),++t.statics,c=a):(n.push(new ZA(i.slice(c,a+1))),++t.symbols,c=++a);return c!==a&&(n.push(new Lf(i.slice(c,a))),++t.statics),n}}function iT(s){return s._isEndpoint}function sT(s,e){const t=s._types,n=e._types;return t.statics!==n.statics?n.statics-t.statics:t.dynamics!==n.dynamics?n.dynamics-t.dynamics:t.symbols!==n.symbols?n.symbols-t.symbols:0}class qt{constructor(e,t,n,i,r=null){this.rawName=e,this.rawValue=t,this.target=n,this.command=i,this.parts=r}}const rT=Xn("IAttributePattern"),Ru=Xn("IAttributeParser",s=>s.singleton(oT));class oT{constructor(){this._cache={},this._patterns={},this._initialized=!1,this._allDefinitions=[],this._interpreter=k(tT),this._container=k(Ri)}registerPattern(e,t){if(this._initialized)throw Be(88);const n=this._patterns;for(const{pattern:i}of e){if(n[i]!=null)throw Be(89,i);n[i]={patternType:t}}this._allDefinitions.push(...e)}_initialize(){this._interpreter.add(this._allDefinitions);const e=this._container;for(const[,t]of Object.entries(this._patterns))t.pattern=e.get(t.patternType)}parse(e,t){this._initialized||(this._initialize(),this._initialized=!0);let n=this._cache[e];n==null&&(n=this._cache[e]=this._interpreter.interpret(e));const i=n.pattern;return i==null?new qt(e,t,e,null,null):this._patterns[i].pattern[i](e,t,n.parts)}}const Xi=Gr({name:ki("attribute-pattern"),create(s,e){return{register(t){t.get(Ru).registerPattern(s,e),Iu(rT,e).register(t)}}}});class dh{"PART.PART"(e,t,n){return new qt(e,t,n[0],n[1])}"PART.PART.PART"(e,t,n){return new qt(e,t,`${n[0]}.${n[1]}`,n[2])}}am=Symbol.metadata;dh[am]={[Qn]:Xi.create([{pattern:"PART.PART",symbols:"."},{pattern:"PART.PART.PART",symbols:"."}],dh)};class fh{ref(e,t,n){return new qt(e,t,"element","ref")}"PART.ref"(e,t,n){let i=n[0];return i==="view-model"&&(i="component",console.warn(`[aurelia] Detected view-model.ref usage: "${e}=${t}". This is deprecated and component.ref should be used instead`)),new qt(e,t,i,"ref")}}cm=Symbol.metadata;fh[cm]={[Qn]:Xi.create([{pattern:"ref",symbols:""},{pattern:"PART.ref",symbols:"."}],fh)};class ph{"PART.trigger:PART"(e,t,n){return new qt(e,t,n[0],"trigger",n)}"PART.capture:PART"(e,t,n){return new qt(e,t,n[0],"capture",n)}}lm=Symbol.metadata;ph[lm]={[Qn]:Xi.create([{pattern:"PART.trigger:PART",symbols:".:"},{pattern:"PART.capture:PART",symbols:".:"}],ph)};class Df{":PART"(e,t,n){return new qt(e,t,n[0],"bind")}}hm=Symbol.metadata;Df[hm]={[Qn]:Xi.create([{pattern:":PART",symbols:":"}],Df)};class Bf{"@PART"(e,t,n){return new qt(e,t,n[0],"trigger")}"@PART:PART"(e,t,n){return new qt(e,t,n[0],"trigger",[n[0],"trigger",...n.slice(1)])}}um=Symbol.metadata;Bf[um]={[Qn]:Xi.create([{pattern:"@PART",symbols:"@"},{pattern:"@PART:PART",symbols:"@:"}],Bf)};const gh=$t.get,Hf=$t.define,dm="ra",fm="rb",pm="rc",gm="rd",mm="re",vm="rf",Pu="rg",ym="ri",_m="rj",bm="rk",wm="rl",Cm="ha",Sm="hb",Am="hc",aT="hd",Tm="he",Im="hf",km="hg",Em="hs",Rm="hp",Pm="svb",Ye=Gr({hydrateElement:dm,hydrateAttribute:fm,hydrateTemplateController:pm,hydrateLetElement:gm,setProperty:mm,interpolation:vm,propertyBinding:Pu,letBinding:ym,refBinding:_m,iteratorBinding:bm,multiAttr:wm,textBinding:Cm,listenerBinding:Sm,attributeBinding:Am,stylePropertyBinding:aT,setAttribute:Tm,setClassAttribute:Im,setStyleAttribute:km,spreadTransferedBinding:Em,spreadElementProp:Rm,spreadValueBinding:Pm}),Vs=Xn("Instruction");class ii{constructor(e,t){this.from=e,this.to=t,this.type=vm}}class ea{constructor(e,t,n){this.from=e,this.to=t,this.mode=n,this.type=Pu}}class cT{constructor(e,t,n){this.forOf=e,this.to=t,this.props=n,this.type=bm}}class lT{constructor(e,t){this.from=e,this.to=t,this.type=_m}}class Js{constructor(e,t){this.value=e,this.to=t,this.type=mm}}class hT{constructor(e,t,n){this.value=e,this.to=t,this.command=n,this.type=wm}}class uT{constructor(e,t,n,i,r,o){this.res=e,this.props=t,this.projections=n,this.containerless=i,this.captures=r,this.data=o,this.type=dm}}class dl{constructor(e,t,n){this.res=e,this.alias=t,this.props=n,this.type=fm}}class dT{constructor(e,t,n,i){this.def=e,this.res=t,this.alias=n,this.props=i,this.type=pm}}class fT{constructor(e,t){this.instructions=e,this.toBindingContext=t,this.type=gm}}class Uf{constructor(e,t){this.from=e,this.to=t,this.type=ym}}class pT{constructor(e){this.from=e,this.type=Cm}}class Om{constructor(e,t,n,i){this.from=e,this.to=t,this.capture=n,this.modifier=i,this.type=Sm}}class Ff{constructor(e,t){this.value=e,this.to=t,this.type=Tm}}class Kf{constructor(e){this.value=e,this.type=Im}}class Vf{constructor(e){this.value=e,this.type=km}}class Ou{constructor(e,t,n){this.attr=e,this.from=t,this.to=n,this.type=Am}}class jf{constructor(){this.type=Em}}class zf{constructor(e){this.instruction=e,this.type=Rm}}class mh{constructor(e,t){this.target=e,this.from=t,this.type=Pm}}class qa{constructor(e,t,n,i){this.Type=e,this.name=t,this.aliases=n,this.key=i}static create(e,t){let n,i;return Mc(e)?(n=e,i={name:n}):(n=e.name,i=e),new qa(t,Bi(vh(t,"name"),n),We(vh(t,"aliases"),i.aliases,t.aliases),Ar(n))}register(e,t){const n=this.Type,i=typeof t=="string"?Ar(t):this.key,r=this.aliases;e.has(i,!1)?console.warn(`[DEV:aurelia] ${Be(157,this.name)}`):e.register(e.has(n,!1)?null:Iu(n,n),$f(n,i),...r.map(o=>$f(n,Ar(o))))}}const bt="binding-command",Na=ki(bt),Ar=s=>`${Na}:${s}`,vh=(s,e)=>gh(cu.annotation.keyFor(e),s),gT=(()=>{const s="__au_static_resource__",e=(t,n,i)=>{var o;let r=gh(s,t);return r==null&&((o=t.$au)==null?void 0:o.type)===n&&(r=i(t.$au,t),Hf(r,t,s)),r};return Gr({name:Na,keyFrom:Ar,define(t,n){const i=qa.create(t,n),r=i.Type;return Hf(i,r,Na,xn),r},getAnnotation:vh,find(t,n){const i=t.find(bt,n);return i==null?null:gh(Na,i)??e(i,bt,qa.create)??null},get(t,n){try{return t.get(Pr(Ar(n)))}catch(i){throw console.log(`


[DEV:aurelia] Cannot retrieve binding command with name




`,n),i}return t.get(Pr(Ar(n)))}})})();class Nm{get ignoreAttr(){return!1}build(e,t,n){let r=e.attr.target,o=e.attr.rawValue;return o=o===""?st(r):o,e.bindable==null?r=n.map(e.node,r)??st(r):r=e.bindable.name,new ea(t.parse(o,Zn),r,1)}}Nm.$au={type:bt,name:"one-time"};class Mm{get ignoreAttr(){return!1}build(e,t,n){let r=e.attr.target,o=e.attr.rawValue;return o=o===""?st(r):o,e.bindable==null?r=n.map(e.node,r)??st(r):r=e.bindable.name,new ea(t.parse(o,Zn),r,2)}}Mm.$au={type:bt,name:"to-view"};class xm{get ignoreAttr(){return!1}build(e,t,n){const i=e.attr;let r=i.target,o=i.rawValue;return o=o===""?st(r):o,e.bindable==null?r=n.map(e.node,r)??st(r):r=e.bindable.name,new ea(t.parse(o,Zn),r,4)}}xm.$au={type:bt,name:"from-view"};class $m{get ignoreAttr(){return!1}build(e,t,n){const i=e.attr;let r=i.target,o=i.rawValue;return o=o===""?st(r):o,e.bindable==null?r=n.map(e.node,r)??st(r):r=e.bindable.name,new ea(t.parse(o,Zn),r,6)}}$m.$au={type:bt,name:"two-way"};class Lm{get ignoreAttr(){return!1}build(e,t,n){const i=e.attr,r=e.bindable;let o=i.rawValue,a=i.target,c,l;return o=o===""?st(a):o,r==null?(l=n.isTwoWay(e.node,a)?6:2,a=n.map(e.node,a)??st(a)):(c=e.def.defaultBindingMode??0,l=r.mode===0||r.mode==null?c==null||c===0?2:c:r.mode,a=r.name),new ea(t.parse(o,Zn),a,Mc(l)?Wr[l]??0:l)}}Lm.$au={type:bt,name:"bind"};class Dm{constructor(){this._attrParser=k(Ru)}get ignoreAttr(){return!1}build(e,t){const n=e.bindable===null?st(e.attr.target):e.bindable.name,i=t.parse(e.attr.rawValue,"IsIterator");let r=ie;if(i.semiIdx>-1){const o=e.attr.rawValue.slice(i.semiIdx+1),a=o.indexOf(":");if(a>-1){const c=o.slice(0,a).trim(),l=o.slice(a+1).trim(),h=this._attrParser.parse(c,l);r=[new hT(l,h.target,h.command)]}}return new cT(i,n,r)}}Dm.$au={type:bt,name:"for"};class Bm{get ignoreAttr(){return!0}build(e,t){var n;return new Om(t.parse(e.attr.rawValue,rm),e.attr.target,!1,((n=e.attr.parts)==null?void 0:n[2])??null)}}Bm.$au={type:bt,name:"trigger"};class Hm{get ignoreAttr(){return!0}build(e,t){var n;return new Om(t.parse(e.attr.rawValue,rm),e.attr.target,!0,((n=e.attr.parts)==null?void 0:n[2])??null)}}Hm.$au={type:bt,name:"capture"};class Um{get ignoreAttr(){return!0}build(e,t){const n=e.attr,i=n.target;let r=n.rawValue;return r=r===""?st(i):r,new Ou(i,t.parse(r,Zn),i)}}Um.$au={type:bt,name:"attr"};class Fm{get ignoreAttr(){return!0}build(e,t){return new Ou("style",t.parse(e.attr.rawValue,Zn),e.attr.target)}}Fm.$au={type:bt,name:"style"};class Km{get ignoreAttr(){return!0}build(e,t){return new Ou("class",t.parse(e.attr.rawValue,Zn),e.attr.target)}}Km.$au={type:bt,name:"class"};class Vm{get ignoreAttr(){return!0}build(e,t){return new lT(t.parse(e.attr.rawValue,Zn),e.attr.target)}}Vm.$au={type:bt,name:"ref"};class jm{get ignoreAttr(){return!1}build(e){return new mh(e.attr.target,e.attr.rawValue)}}jm.$au={type:bt,name:"spread"};const mT=Xn("ITemplateElementFactory",s=>s.singleton(vT)),qf={};class vT{constructor(){this.p=k(Vr),this._template=this.t()}t(){return this.p.document.createElement("template")}createTemplate(e){var n;if(Mc(e)){let i=qf[e];if(i===void 0){const r=this._template;r.innerHTML=e;const o=r.content.firstElementChild;t(o)?(this._template=this.t(),i=r):(r.content.removeChild(o),i=o),qf[e]=i}return i.cloneNode(!0)}if(e.nodeName!=="TEMPLATE"){const i=this.t();return i.content.appendChild(e),i}return(n=e.parentNode)==null||n.removeChild(e),e.cloneNode(!0);function t(i){if(i==null||i.nodeName!=="TEMPLATE"||i.nextElementSibling!=null)return!0;const o=i.previousSibling;if(o!=null)switch(o.nodeType){case 3:return o.textContent.trim().length>0}const a=i.nextSibling;if(a!=null)switch(a.nodeType){case 3:return a.textContent.trim().length>0}return!1}}}const fl="au-start",pl="au-end",gl=(s,e,t)=>s.insertBefore(e,t),Gf=(s,e,t)=>{if(s===null)return;const n=t.length;let i=0;for(;n>i;)s.insertBefore(t[i],e),++i},as=(s,e)=>s.content.appendChild(e),Wf=(s,e)=>{const t=e.length;let n=0;for(;t>n;)s.content.appendChild(e[n]),++n},Qf=s=>s.nodeType===1,Yf=s=>s.nodeType===3,to="au-slot",Jf="default",no=(s=>()=>`anonymous-${++s}`)(0);class zm{constructor(){this.debug=!1,this.resolveResources=!0}compile(e,t){var u,d;if(e.template==null||e.needsCompile===!1)return e;const n=new Ga(e,t,null,null,void 0),i=Mc(e.template)||!e.enhance?n._templateFactory.createTemplate(e.template):e.template,r=i.nodeName===ml&&i.content!=null,o=r?i.content:i,a=ST.findAll(t),c=a.length;let l=0;if(c>0)for(;c>l;)(d=(u=a[l]).compiling)==null||d.call(u,i),++l;if(i.hasAttribute(yh))throw Be(701,e);return this._compileLocalElement(o,n),this._compileNode(o,n),{...e,name:e.name||no(),dependencies:(e.dependencies??ie).concat(n.deps??ie),instructions:n.rows,surrogates:r?this._compileSurrogate(i,n):ie,template:i,hasSlots:n.hasSlot,needsCompile:!1}}compileSpread(e,t,n,i,r){const o=new Ga(e,n,null,null,void 0),a=[],c=r??o._findElement(i.nodeName.toLowerCase()),l=c!==null,h=o._exprParser,u=t.length;let d=0,f,p=null,m,g,v,S,R,C=null,I,$,x,F;for(;u>d;++d){if(f=t[d],x=f.target,F=f.rawValue,x==="...$attrs"){a.push(new jf);continue}if(C=o._getCommand(f),C!==null&&C.ignoreAttr){H.node=i,H.attr=f,H.bindable=null,H.def=null,a.push(C.build(H,o._exprParser,o._attrMapper));continue}if(l&&(v=o._getBindables(c),S=v.attrs[x],S!==void 0)){C==null?(I=h.parse(F,hn),a.push(new zf(I==null?new Js(F,S.name):new ii(I,S.name)))):(H.node=i,H.attr=f,H.bindable=S,H.def=c,a.push(new zf(C.build(H,o._exprParser,o._attrMapper))));continue}if(p=o._findAttr(x),p!==null){if(p.isTemplateController)throw Be(9998,x);v=o._getBindables(p),$=p.noMultiBindings===!1&&C===null&&vl(F),$?g=this._compileMultiBindings(i,F,p,o):(R=v.primary,C===null?(I=h.parse(F,hn),g=[I===null?new Js(F,R.name):new ii(I,R.name)]):(H.node=i,H.attr=f,H.bindable=R,H.def=p,g=[C.build(H,o._exprParser,o._attrMapper)])),(m??(m=[])).push(new dl(this.resolveResources?p:p.name,p.aliases!=null&&p.aliases.includes(x)?x:void 0,g));continue}if(C==null)if(I=h.parse(F,hn),I!=null)a.push(new ii(I,o._attrMapper.map(i,x)??st(x)));else switch(x){case"class":a.push(new Kf(F));break;case"style":a.push(new Vf(F));break;default:a.push(new Ff(F,x))}else H.node=i,H.attr=f,H.bindable=null,H.def=null,a.push(C.build(H,o._exprParser,o._attrMapper))}return ha(),m!=null?m.concat(a):a}_compileSurrogate(e,t){const n=[],i=e.attributes,r=t._exprParser;let o=i.length,a=0,c,l,h,u,d=null,f,p,m,g,v=null,S,R,C,I;for(;o>a;++a){if(c=i[a],l=c.name,h=c.value,u=t._attrParser.parse(l,h),C=u.target,I=u.rawValue,_T[C])throw Be(702,l);if(v=t._getCommand(u),v!==null&&v.ignoreAttr){H.node=e,H.attr=u,H.bindable=null,H.def=null,n.push(v.build(H,t._exprParser,t._attrMapper));continue}if(d=t._findAttr(C),d!==null){if(d.isTemplateController)throw Be(703,C);m=t._getBindables(d),R=d.noMultiBindings===!1&&v===null&&vl(I),R?p=this._compileMultiBindings(e,I,d,t):(g=m.primary,v===null?(S=r.parse(I,hn),p=S===null?I===""?[]:[new Js(I,g.name)]:[new ii(S,g.name)]):(H.node=e,H.attr=u,H.bindable=g,H.def=d,p=[v.build(H,t._exprParser,t._attrMapper)])),e.removeAttribute(l),--a,--o,(f??(f=[])).push(new dl(this.resolveResources?d:d.name,d.aliases!=null&&d.aliases.includes(C)?C:void 0,p));continue}if(v===null)if(S=r.parse(I,hn),S!=null)e.removeAttribute(l),--a,--o,n.push(new ii(S,t._attrMapper.map(e,C)??st(C)));else switch(l){case"class":n.push(new Kf(I));break;case"style":n.push(new Vf(I));break;default:n.push(new Ff(I,l))}else H.node=e,H.attr=u,H.bindable=null,H.def=null,n.push(v.build(H,t._exprParser,t._attrMapper))}return ha(),f!=null?f.concat(n):n}_compileNode(e,t){switch(e.nodeType){case 1:switch(e.nodeName){case"LET":return this._compileLet(e,t);default:return this._compileElement(e,t)}case 3:return this._compileText(e,t);case 11:{let n=e.firstChild;for(;n!==null;)n=this._compileNode(n,t);break}}return e.nextSibling}_compileLet(e,t){const n=e.attributes,i=n.length,r=[],o=t._exprParser;let a=!1,c=0,l,h,u,d,f,p,m,g;for(;i>c;++c){if(l=n[c],u=l.name,d=l.value,u==="to-binding-context"){a=!0;continue}if(h=t._attrParser.parse(u,d),p=h.target,m=h.rawValue,f=t._getCommand(h),f!==null){if(h.command==="bind")r.push(new Uf(o.parse(m,Zn),st(p)));else throw Be(704,h);continue}g=o.parse(m,hn),g===null&&console.warn(`[DEV:aurelia] Property "${p}" is declared with literal string ${m}. Did you mean ${p}.bind="${m}"?`),r.push(new Uf(g===null?new ot(m):g,st(p)))}return t.rows.push([new fT(r,a)]),this._markAsTarget(e,t).nextSibling}_compileElement(e,t){var Nt,w,O,ee,Z,ke,tt,Cn;const n=e.nextSibling,i=(e.getAttribute("as-element")??e.nodeName).toLowerCase(),r=t._findElement(i),o=r!==null,a=o&&r.shadowOptions!=null,c=r==null?void 0:r.capture,l=c!=null&&typeof c!="boolean",h=c?[]:ie,u=t._exprParser,d=this.debug?gi:()=>{e.removeAttribute(S),--g,--m};let f=e.attributes,p,m=f.length,g=0,v,S,R,C,I,$,x=null,F=!1,D,V,ce,qe,Ne,Me,Ge,P=null,Ce,ct,j,Se,St=!0,ut=!1,rn=!1,b=!1,E,y=0;if(i==="slot"){if(t.root.def.shadowOptions==null)throw Be(717,t.root.def.name);t.root.hasSlot=!0}for(o&&(E={},St=(Nt=r.processContent)==null?void 0:Nt.call(r.Type,e,t.p,E),f=e.attributes,m=f.length);m>g;++g){switch(v=f[g],S=v.name,R=v.value,S){case"as-element":case"containerless":d(),ut=ut||S==="containerless";continue}if(C=t._attrParser.parse(S,R),P=t._getCommand(C),j=C.target,Se=C.rawValue,c&&(!l||l&&c(j))){if(P!=null&&P.ignoreAttr){d(),h.push(C);continue}if(rn=j!==to&&j!=="slot"&&((y=j.indexOf("..."))===-1||y===0&&j==="...$attrs"),rn&&(Ce=t._getBindables(r),Ce.attrs[j]==null&&!((w=t._findAttr(j))!=null&&w.isTemplateController))){d(),h.push(C);continue}}if(j==="...$attrs"){(I??(I=[])).push(new jf),d();continue}if(P!=null&&P.ignoreAttr){H.node=e,H.attr=C,H.bindable=null,H.def=null,(I??(I=[])).push(P.build(H,t._exprParser,t._attrMapper)),d();continue}if(j.indexOf("...")===0){if(o&&(j=j.slice(3))!=="$element"){($??($=[])).push(new mh("$bindables",j==="$bindables"?Se:j)),d();continue}throw(j==="$bindable"||j==="bindables")&&console.warn(`[DEV:aurelia] Detected usage of ${j} on <${e.nodeName}>, did you mean "$bindables"?`),Be(720,j)}if(o){if(Ce=t._getBindables(r),D=Ce.attrs[j],D!==void 0){P===null?(Me=u.parse(Se,hn),($??($=[])).push(Me==null?new Js(Se,D.name):new ii(Me,D.name))):(H.node=e,H.attr=C,H.bindable=D,H.def=r,($??($=[])).push(P.build(H,t._exprParser,t._attrMapper))),d(),x=t._findAttr(j),x!==null&&console.warn(`[DEV:aurelia] Binding with bindable "${j}" on custom element "${r.name}" is ambiguous.There is a custom attribute with the same name.`);continue}if(j==="$bindables"){if(P!=null){H.node=e,H.attr=C,H.bindable=null,H.def=r;{const te=P.build(H,t._exprParser,t._attrMapper);te instanceof mh||console.warn(`[DEV:aurelia] Binding with "$bindables" on custom element "${r.name}" with command ${C.command}  did not result in a spread binding instruction. This likely won't work as expected.`),($??($=[])).push(te)}}else console.warn(`[DEV:aurelia] Usage of "$bindables" on custom element "<${r.name}>" is ignored.`);d();continue}}if(j==="$bindables")throw Be(721,e.nodeName,j,Se);if(x=t._findAttr(j),x!==null){Ce=t._getBindables(x),F=x.noMultiBindings===!1&&P===null&&vl(Se),F?ce=this._compileMultiBindings(e,Se,x,t):(ct=Ce.primary,P===null?(Me=u.parse(Se,hn),ce=Me===null?Se===""?[]:[new Js(Se,ct.name)]:[new ii(Me,ct.name)]):(H.node=e,H.attr=C,H.bindable=ct,H.def=x,ce=[P.build(H,t._exprParser,t._attrMapper)])),d(),x.isTemplateController?(qe??(qe=[])).push(new dT(yT,this.resolveResources?x:x.name,void 0,ce)):(V??(V=[])).push(new dl(this.resolveResources?x:x.name,x.aliases!=null&&x.aliases.includes(j)?j:void 0,ce));continue}if(P===null){Me=u.parse(Se,hn),Me!=null&&(d(),(I??(I=[])).push(new ii(Me,t._attrMapper.map(e,j)??st(j))));continue}H.node=e,H.attr=C,H.bindable=null,H.def=null,(I??(I=[])).push(P.build(H,t._exprParser,t._attrMapper)),d()}ha(),this._shouldReorderAttrs(e,I)&&I!=null&&I.length>1&&this._reorder(e,I),o&&(Ge=new uT(this.resolveResources?r:r.name,$??ie,null,ut,h,E)),(I!=null||Ge!=null||V!=null)&&(p=ie.concat(Ge??ie,V??ie,I??ie),b=!0);let T;if(qe!=null){m=qe.length-1,g=m,Ne=qe[g];let te;Xf(e)?(te=t.t(),Wf(te,[t._marker(),t._comment(fl),t._comment(pl)])):(this._replaceByMarker(e,t),e.nodeName==="TEMPLATE"?te=e:(te=t.t(),as(te,e)));const on=te,At=t._createChild(p==null?[]:[p]);let Jr,an,ss=!1,rs,cn,Sn,An,Xr,Mi,os=0,pf=0,dt=e.firstChild,gf=!1;if(St!==!1)for(;dt!==null;){if(an=Qf(dt)?dt.getAttribute(to):null,ss=an!==null||o&&!a,Jr=dt.nextSibling,ss){if(!o)throw Be(706,an,i);(O=dt.removeAttribute)==null||O.call(dt,to),gf=Yf(dt)&&dt.textContent.trim()==="",gf||((ee=cn??(cn={}))[Z=an||Jf]??(ee[Z]=[])).push(dt),e.removeChild(dt)}dt=Jr}if(cn!=null){rs={};for(an in cn){for(te=t.t(),Sn=cn[an],os=0,pf=Sn.length;pf>os;++os)An=Sn[os],An.nodeName==="TEMPLATE"?An.attributes.length>0?as(te,An):as(te,An.content):as(te,An);Mi=t._createChild(),this._compileNode(te.content,Mi),rs[an]={name:no(),type:ir,template:te,instructions:Mi.rows,needsCompile:!1}}Ge.projections=rs}if(b&&(o&&(ut||r.containerless)?this._replaceByMarker(e,t):this._markAsTarget(e,t)),T=!o||!r.containerless&&!ut&&St!==!1,T)if(e.nodeName===ml)this._compileNode(e.content,At);else for(dt=e.firstChild;dt!==null;)dt=this._compileNode(dt,At);for(Ne.def={name:no(),type:ir,template:on,instructions:At.rows,needsCompile:!1};g-- >0;)Ne=qe[g],te=t.t(),Xr=t._marker(),Wf(te,[Xr,t._comment(fl),t._comment(pl)]),Ne.def={name:no(),type:ir,template:te,needsCompile:!1,instructions:[[qe[g+1]]]};t.rows.push([Ne])}else{p!=null&&t.rows.push(p);let te=e.firstChild,on,At,Jr=!1,an=null,ss,rs,cn,Sn,An,Xr=!1,Mi=0,os=0;if(St!==!1)for(;te!==null;){if(At=Qf(te)?te.getAttribute(to):null,Jr=At!==null||o&&!a,on=te.nextSibling,Jr){if(!o)throw Be(706,At,i);(ke=te.removeAttribute)==null||ke.call(te,to),Xr=Yf(te)&&te.textContent.trim()==="",Xr||((tt=ss??(ss={}))[Cn=At||Jf]??(tt[Cn]=[])).push(te),e.removeChild(te)}te=on}if(ss!=null){an={};for(At in ss){for(Sn=t.t(),rs=ss[At],Mi=0,os=rs.length;os>Mi;++Mi)cn=rs[Mi],cn.nodeName===ml?cn.attributes.length>0?as(Sn,cn):as(Sn,cn.content):as(Sn,cn);An=t._createChild(),this._compileNode(Sn.content,An),an[At]={name:no(),type:ir,template:Sn,instructions:An.rows,needsCompile:!1}}Ge.projections=an}if(b&&(o&&(ut||r.containerless)?this._replaceByMarker(e,t):this._markAsTarget(e,t)),T=!o||!r.containerless&&!ut&&St!==!1,T&&e.childNodes.length>0)for(te=e.firstChild;te!==null;)te=this._compileNode(te,t)}return n}_compileText(e,t){const n=e.parentNode,i=t._exprParser.parse(e.textContent,hn),r=e.nextSibling;let o,a,c,l,h;if(i!==null){for({parts:o,expressions:a}=i,(h=o[0])&&gl(n,t._text(h),e),c=0,l=a.length;l>c;++c)Gf(n,e,[t._marker(),t._text(" ")]),(h=o[c+1])&&gl(n,t._text(h),e),t.rows.push([new pT(a[c])]);n.removeChild(e)}return r}_compileMultiBindings(e,t,n,i){const r=i._getBindables(n),o=t.length,a=[];let c,l,h=0,u=0,d,f,p,m;for(let g=0;g<o;++g)if(u=t.charCodeAt(g),u===92)++g;else if(u===58){for(c=t.slice(h,g);t.charCodeAt(++g)<=32;);for(h=g;g<o;++g)if(u=t.charCodeAt(g),u===92)++g;else if(u===59){l=t.slice(h,g);break}if(l===void 0&&(l=t.slice(h)),f=i._attrParser.parse(c,l),p=i._getCommand(f),m=r.attrs[f.target],m==null)throw Be(707,f.target,n.name);for(p===null?(d=i._exprParser.parse(l,hn),a.push(d===null?new Js(l,m.name):new ii(d,m.name))):(H.node=e,H.attr=f,H.bindable=m,H.def=n,a.push(p.build(H,i._exprParser,i._attrMapper)));g<o&&t.charCodeAt(++g)<=32;);h=g,c=void 0,l=void 0}return ha(),a}_compileLocalElement(e,t){const n=t.root.def.name,i=e,r=rl(i.querySelectorAll("template[as-custom-element]")),o=r.length;if(o===0)return;if(o===i.childElementCount)throw Be(708,n);const a=new Set,c=[];for(const h of r){if(h.parentNode!==i)throw Be(709,n);const u=CT(n,h,a),d=h.content,f=rl(d.querySelectorAll("bindable")),p=new Set,m=new Set,g=f.reduce((S,R)=>{if(R.parentNode!==d)throw Be(710,u);const C=R.getAttribute("name");if(C===null)throw Be(711,R,u);const I=R.getAttribute("attribute");if(I!==null&&m.has(I)||p.has(C))throw Be(712,p,I);I!==null&&m.add(I),p.add(C);const $=rl(R.attributes).filter(x=>!Zf.includes(x.name));return $.length>0&&console.warn(`[DEV:aurelia] The attribute(s) ${$.map(x=>x.name).join(", ")} will be ignored for ${R.outerHTML}. Only ${Zf.join(", ")} are processed.`),R.remove(),S[C]={name:C,attribute:I??void 0,mode:R.getAttribute("mode")??"default"},S},{});class v{}v.$au={type:ir,name:u,template:h,bindables:g},Reflect.defineProperty(v,"name",{value:Sg(u)}),c.push(v),i.removeChild(h)}const l=(t.root.def.dependencies??[]).concat(t.root.def.Type==null?ie:[t.root.def.Type]);for(const h of c)h.dependencies=l.concat(c.filter(u=>u!==h)),t._addLocalDep(h)}_shouldReorderAttrs(e,t){const n=e.nodeName;return n==="INPUT"&&bT[e.type]===1||n==="SELECT"&&(e.hasAttribute("multiple")||(t==null?void 0:t.some(i=>i.type===Pu&&i.to==="multiple")))}_reorder(e,t){switch(e.nodeName){case"INPUT":{const n=t;let i,r,o=0,a;for(let c=0;c<n.length&&o<3;c++)switch(a=n[c],a.to){case"model":case"value":case"matcher":i=c,o++;break;case"checked":r=c,o++;break}r!==void 0&&i!==void 0&&r<i&&([n[i],n[r]]=[n[r],n[i]]);break}case"SELECT":{const n=t;let i=0,r=0,o=0,a;for(let c=0;c<n.length&&o<2;++c){switch(a=n[c],a.to){case"multiple":r=c,o++;break;case"value":i=c,o++;break}o===2&&i<r&&([n[r],n[i]]=[n[i],n[r]])}}}}_markAsTarget(e,t){return gl(e.parentNode,t._comment("au*"),e),e}_replaceByMarker(e,t){if(Xf(e))return e;const n=e.parentNode,i=t._marker();return Gf(n,e,[i,t._comment(fl),t._comment(pl)]),n.removeChild(e),i}}zm.register=Ec(xc);const ml="TEMPLATE",Xf=s=>s.nodeValue==="au*";class Ga{constructor(e,t,n,i,r){var a;this.hasSlot=!1,this.deps=null;const o=n!==null;if(this.c=t,this.root=i===null?this:i,this.def=e,this.parent=n,this._resourceResolver=o?n._resourceResolver:t.get(qm),this._commandResolver=o?n._commandResolver:t.get(wT),this._templateFactory=o?n._templateFactory:t.get(mT),this._attrParser=o?n._attrParser:t.get(Ru),this._exprParser=o?n._exprParser:t.get(Zo),this._attrMapper=o?n._attrMapper:t.get(om),this._logger=o?n._logger:t.get(ji),typeof((a=(this.p=o?n.p:t.get(Vr)).document)==null?void 0:a.nodeType)!="number")throw Be(722);this.localEls=o?n.localEls:new Set,this.rows=r??[]}_addLocalDep(e){var t;return((t=this.root).deps??(t.deps=[])).push(e),this.root.c.register(e),this}_text(e){return this.p.document.createTextNode(e)}_comment(e){return this.p.document.createComment(e)}_marker(){return this._comment("au*")}h(e){const t=this.p.document.createElement(e);return e==="template"&&this.p.document.adoptNode(t.content),t}t(){return this.h("template")}_findElement(e){return this._resourceResolver.el(this.c,e)}_findAttr(e){return this._resourceResolver.attr(this.c,e)}_getBindables(e){return this._resourceResolver.bindables(e)}_createChild(e){return new Ga(this.def,this.c,this,this.root,e)}_getCommand(e){const t=e.command;return t===null?null:this._commandResolver.get(this.c,t)}}const vl=s=>{const e=s.length;let t=0,n=0;for(;e>n;){if(t=s.charCodeAt(n),t===92)++n;else{if(t===58)return!0;if(t===36&&s.charCodeAt(n+1)===123)return!1}++n}return!1},ha=()=>{H.node=H.attr=H.bindable=H.def=null},yT={name:"unnamed",type:ir},H={node:null,attr:null,bindable:null,def:null},_T={id:!0,name:!0,"au-slot":!0,"as-element":!0},bT={checkbox:1,radio:1},qm=Xn("IResourceResolver"),wT=Xn("IBindingCommandResolver",s=>{class e{constructor(){this._cache=new WeakMap}get(n,i){let r=this._cache.get(n);return r||this._cache.set(n,r={}),i in r?r[i]:r[i]=gT.get(n,i)}}return s.singleton(e)}),Zf=Gr(["name","attribute","mode"]),yh="as-custom-element",CT=(s,e,t)=>{const n=e.getAttribute(yh);if(n===null||n==="")throw Be(715,s);if(t.has(n))throw Be(716,n,s);return t.add(n),e.removeAttribute(yh),n},ep=Xn("ITemplateCompilerHooks"),ST=Gr({name:ki("compiler-hooks"),define(s){return{register(e){Iu(ep,s).register(e)}}},findAll(s){return s.get(pC(ep))}}),io="pending",Ma="running",yl="completed",ua="canceled",_l=new Map,tp=s=>()=>{throw Ns(`AUR1005: The PLATFORM did not receive a valid reference to the global function '${s}'.`)};class Nu{constructor(e,t={}){var n,i;this.macroTaskRequested=!1,this.macroTaskHandle=-1,this.globalThis=e,"decodeURI decodeURIComponent encodeURI encodeURIComponent Date Reflect console".split(" ").forEach(r=>{this[r]=r in t?t[r]:e[r]}),"clearInterval clearTimeout queueMicrotask setInterval setTimeout".split(" ").forEach(r=>{var o;this[r]=r in t?t[r]:((o=e[r])==null?void 0:o.bind(e))??tp(r)}),this.performanceNow="performanceNow"in t?t.performanceNow:((i=(n=e.performance)==null?void 0:n.now)==null?void 0:i.bind(e.performance))??tp("performance.now"),this.flushMacroTask=this.flushMacroTask.bind(this),this.taskQueue=new Mu(this,this.requestMacroTask.bind(this),this.cancelMacroTask.bind(this))}static getOrCreate(e,t={}){let n=_l.get(e);return n===void 0&&_l.set(e,n=new Nu(e,t)),n}static set(e,t){_l.set(e,t)}requestMacroTask(){this.macroTaskRequested=!0,this.macroTaskHandle===-1&&(this.macroTaskHandle=this.setTimeout(this.flushMacroTask,0))}cancelMacroTask(){this.macroTaskRequested=!1,this.macroTaskHandle>-1&&(this.clearTimeout(this.macroTaskHandle),this.macroTaskHandle=-1)}flushMacroTask(){this.macroTaskHandle=-1,this.macroTaskRequested===!0&&(this.macroTaskRequested=!1,this.taskQueue.flush())}}let Mu=class{get isEmpty(){return this._pendingAsyncCount===0&&this._processing.length===0&&this._pending.length===0&&this._delayed.length===0}get _hasNoMoreFiniteWork(){return this._pendingAsyncCount===0&&this._processing.every(bl)&&this._pending.every(bl)&&this._delayed.every(bl)}constructor(e,t,n){this.platform=e,this.$request=t,this.$cancel=n,this._suspenderTask=void 0,this._pendingAsyncCount=0,this._processing=[],this._pending=[],this._delayed=[],this._flushRequested=!1,this._yieldPromise=void 0,this._lastRequest=0,this._lastFlush=0,this._requestFlush=()=>{this._tracer.enabled&&this._tracer.enter(this,"requestFlush"),this._flushRequested||(this._flushRequested=!0,this._lastRequest=this._now(),this.$request()),this._tracer.enabled&&this._tracer.leave(this,"requestFlush")},this._now=e.performanceNow,this._tracer=new IT(e.console)}flush(e=this._now()){if(this._tracer.enabled&&this._tracer.enter(this,"flush"),this._flushRequested=!1,this._lastFlush=e,this._suspenderTask===void 0){let t;if(this._pending.length>0&&(this._processing.push(...this._pending),this._pending.length=0),this._delayed.length>0)for(let i=0;i<this._delayed.length;++i)t=this._delayed[i],t.queueTime<=e&&(this._processing.push(t),this._delayed.splice(i--,1));let n;for(;this._processing.length>0;)if((n=this._processing.shift()).run(),n.status===Ma)if(n.suspend===!0){this._suspenderTask=n,this._requestFlush(),this._tracer.enabled&&this._tracer.leave(this,"flush early async");return}else++this._pendingAsyncCount;if(this._pending.length>0&&(this._processing.push(...this._pending),this._pending.length=0),this._delayed.length>0)for(let i=0;i<this._delayed.length;++i)t=this._delayed[i],t.queueTime<=e&&(this._processing.push(t),this._delayed.splice(i--,1));if((this._processing.length>0||this._delayed.length>0||this._pendingAsyncCount>0)&&this._requestFlush(),this._yieldPromise!==void 0&&this._hasNoMoreFiniteWork){const i=this._yieldPromise;this._yieldPromise=void 0,i.resolve()}}else this._requestFlush();this._tracer.enabled&&this._tracer.leave(this,"flush full")}cancel(){this._tracer.enabled&&this._tracer.enter(this,"cancel"),this._flushRequested&&(this.$cancel(),this._flushRequested=!1),this._tracer.enabled&&this._tracer.leave(this,"cancel")}async yield(){this._tracer.enabled&&this._tracer.enter(this,"yield"),this.isEmpty?this._tracer.enabled&&this._tracer.leave(this,"yield empty"):(this._yieldPromise===void 0&&(this._tracer.enabled&&this._tracer.trace(this,"yield - creating promise"),this._yieldPromise=Qm()),await this._yieldPromise,this._tracer.enabled&&this._tracer.leave(this,"yield task"))}queueTask(e,t){this._tracer.enabled&&this._tracer.enter(this,"queueTask");const{delay:n,preempt:i,persistent:r,suspend:o}={...kT,...t};if(i){if(n>0)throw RT();if(r)throw PT()}this._processing.length===0&&this._requestFlush();const a=this._now(),c=new TT(this._tracer,this,a,a+n,i,r,o,e);return i?this._processing[this._processing.length]=c:n===0?this._pending[this._pending.length]=c:this._delayed[this._delayed.length]=c,this._tracer.enabled&&this._tracer.leave(this,"queueTask"),c}remove(e){this._tracer.enabled&&this._tracer.enter(this,"remove");let t=this._processing.indexOf(e);if(t>-1){this._processing.splice(t,1),this._tracer.enabled&&this._tracer.leave(this,"remove processing");return}if(t=this._pending.indexOf(e),t>-1){this._pending.splice(t,1),this._tracer.enabled&&this._tracer.leave(this,"remove pending");return}if(t=this._delayed.indexOf(e),t>-1){this._delayed.splice(t,1),this._tracer.enabled&&this._tracer.leave(this,"remove delayed");return}throw this._tracer.enabled&&this._tracer.leave(this,"remove error"),Ns(`Task #${e.id} could not be found`)}_resetPersistentTask(e){this._tracer.enabled&&this._tracer.enter(this,"resetPersistentTask"),e.reset(this._now()),e.createdTime===e.queueTime?this._pending[this._pending.length]=e:this._delayed[this._delayed.length]=e,this._tracer.enabled&&this._tracer.leave(this,"resetPersistentTask")}_completeAsyncTask(e){var t;if(this._tracer.enabled&&this._tracer.enter(this,"completeAsyncTask"),e.suspend===!0){if(this._suspenderTask!==e)throw this._tracer.enabled&&this._tracer.leave(this,"completeAsyncTask error"),Ns(`Async task completion mismatch: suspenderTask=${(t=this._suspenderTask)==null?void 0:t.id}, task=${e.id}`);this._suspenderTask=void 0}else--this._pendingAsyncCount;if(this._yieldPromise!==void 0&&this._hasNoMoreFiniteWork){const n=this._yieldPromise;this._yieldPromise=void 0,n.resolve()}this.isEmpty&&this.cancel(),this._tracer.enabled&&this._tracer.leave(this,"completeAsyncTask")}};class _h extends Error{constructor(e){super("Task was canceled."),this.task=e}}let AT=0;class TT{get result(){const e=this._result;if(e===void 0)switch(this._status){case io:{const t=this._result=Qm();return this._resolve=t.resolve,this._reject=t.reject,t}case Ma:throw Ns("Trying to await task from within task will cause a deadlock.");case yl:return this._result=Promise.resolve();case ua:return this._result=Promise.reject(new _h(this))}return e}get status(){return this._status}constructor(e,t,n,i,r,o,a,c){this.taskQueue=t,this.createdTime=n,this.queueTime=i,this.preempt=r,this.persistent=o,this.suspend=a,this.callback=c,this.id=++AT,this._resolve=void 0,this._reject=void 0,this._result=void 0,this._status=io,this._tracer=e}run(e=this.taskQueue.platform.performanceNow()){if(this._tracer.enabled&&this._tracer.enter(this,"run"),this._status!==io)throw this._tracer.enabled&&this._tracer.leave(this,"run error"),Ns(`Cannot run task in ${this._status} state`);const{persistent:t,taskQueue:n,callback:i,_resolve:r,_reject:o,createdTime:a}=this;let c;this._status=Ma;try{c=i(e-a),c instanceof Promise?c.then(l=>{this.persistent?n._resetPersistentTask(this):(t?this._status=ua:this._status=yl,this.dispose()),n._completeAsyncTask(this),this._tracer.enabled&&this._tracer.leave(this,"run async then"),r!==void 0&&r(l)}).catch(l=>{if(this.persistent||this.dispose(),n._completeAsyncTask(this),this._tracer.enabled&&this._tracer.leave(this,"run async catch"),o!==void 0)o(l);else throw l}):(this.persistent?n._resetPersistentTask(this):(t?this._status=ua:this._status=yl,this.dispose()),this._tracer.enabled&&this._tracer.leave(this,"run sync success"),r!==void 0&&r(c))}catch(l){if(this.persistent||this.dispose(),this._tracer.enabled&&this._tracer.leave(this,"run sync error"),o!==void 0)o(l);else throw l}}cancel(){if(this._tracer.enabled&&this._tracer.enter(this,"cancel"),this._status===io){const e=this.taskQueue,t=this._reject;return e.remove(this),e.isEmpty&&e.cancel(),this._status=ua,this.dispose(),t!==void 0&&t(new _h(this)),this._tracer.enabled&&this._tracer.leave(this,"cancel true =pending"),!0}else if(this._status===Ma&&this.persistent)return this.persistent=!1,this._tracer.enabled&&this._tracer.leave(this,"cancel true =running+persistent"),!0;return this._tracer.enabled&&this._tracer.leave(this,"cancel false"),!1}reset(e){this._tracer.enabled&&this._tracer.enter(this,"reset");const t=this.queueTime-this.createdTime;this.createdTime=e,this.queueTime=e+t,this._status=io,this._resolve=void 0,this._reject=void 0,this._result=void 0,this._tracer.enabled&&this._tracer.leave(this,"reset")}dispose(){this._tracer.enabled&&this._tracer.trace(this,"dispose"),this.callback=void 0,this._resolve=void 0,this._reject=void 0,this._result=void 0}}class IT{constructor(e){this.console=e,this.enabled=!1,this.depth=0}enter(e,t){this.log(`${"  ".repeat(this.depth++)}> `,e,t)}leave(e,t){this.log(`${"  ".repeat(--this.depth)}< `,e,t)}trace(e,t){this.log(`${"  ".repeat(this.depth)}- `,e,t)}log(e,t,n){if(t instanceof Mu){const i=t._processing.length,r=t._pending.length,o=t._delayed.length,a=t._flushRequested,c=!!t._suspenderTask,l=`processing=${i} pending=${r} delayed=${o} flushReq=${a} susTask=${c}`;this.console.log(`${e}[Q.${n}] ${l}`)}else{const i=t.id,r=Math.round(t.createdTime*10)/10,o=Math.round(t.queueTime*10)/10,a=t.preempt,c=t.persistent,l=t.suspend,h=t._status,u=`id=${i} created=${r} queue=${o} preempt=${a} persistent=${c} status=${h} suspend=${l}`;this.console.log(`${e}[T.${n}] ${u}`)}}}const kT={delay:0,preempt:!1,persistent:!1,suspend:!1};let Gm,Wm;const ET=(s,e)=>{Gm=s,Wm=e},Qm=()=>{const s=new Promise(ET);return s.resolve=Gm,s.reject=Wm,s},bl=s=>s.persistent,RT=()=>Ns("AUR1006: Invalid arguments: preempt cannot be combined with a greater-than-zero delay"),PT=()=>Ns("AUR1007: Invalid arguments: preempt cannot be combined with persistent"),Ns=s=>new Error(s);class Ui extends Nu{static getOrCreate(e,t={}){let n=Ui._lookup.get(e);return n===void 0&&Ui._lookup.set(e,n=new Ui(e,t)),n}static set(e,t){Ui._lookup.set(e,t)}get domWriteQueue(){return this.console.log("[DEV:aurelia] platform.domQueue is deprecated, please use platform.domQueue instead."),this.domQueue}get domReadQueue(){return this.console.log("[DEV:aurelia] platform.domReadQueue has been removed, please use platform.domQueue instead."),this.domQueue}constructor(e,t={}){super(e,t);const n=i=>()=>{throw new Error(`The PLATFORM did not receive a valid reference to the global function '${i}'.`)};"Node Element HTMLElement CustomEvent CSSStyleSheet ShadowRoot MutationObserver window document customElements".split(" ").forEach(i=>this[i]=i in t?t[i]:e[i]),"fetch requestAnimationFrame cancelAnimationFrame".split(" ").forEach(i=>{var r;return this[i]=i in t?t[i]:((r=e[i])==null?void 0:r.bind(e))??n(i)}),this.domQueue=(()=>{let i=!1,r=-1;const o=()=>{i=!0,r===-1&&(r=this.requestAnimationFrame(c))},a=()=>{i=!1,r>-1&&(this.cancelAnimationFrame(r),r=-1)},c=()=>{r=-1,i===!0&&(i=!1,l.flush())},l=new Mu(this,o,a);return l})()}}Ui._lookup=new WeakMap;const ta=Object,qi=String,Ym=ta.prototype,Cs=Ym.hasOwnProperty,ei=ta.freeze,Jm=ta.assign,Xm=ta.getOwnPropertyNames,xu=ta.keys,np=be(),bh=(s,e,t)=>{if(np[e]===!0)return!0;if(!ue(e))return!1;const n=e.slice(0,5);return np[e]=n==="aria-"||n==="data-"||t.isStandardSvgAttribute(s,e)},Wa=s=>{throw s},Qa=Reflect.defineProperty,gn=(s,e,t)=>(Qa(s,e,{enumerable:!1,configurable:!0,writable:!0,value:t}),t),Zm=(s,e,t)=>s.addSignalListener(e,t),ev=(s,e,t)=>s.removeSignalListener(e,t),OT="Interpolation",NT="IsIterator",MT="IsFunction",qn="IsProperty",ip="pending",wl="running",$u=mu.Observer,Zi=mu.Node,ti=mu.Layout,N=(s,...e)=>new Error(`AUR${qi(s).padStart(4,"0")}: ${$T(s,...e)}`),xT={99:"Method {{0}} not implemented",101:'Ast eval error: binding behavior "{{0}}" could not be found. Did you forget to register it as a dependency?',102:'Ast eval error: binding behavior "{{0}}" already applied.',103:'Ast eval error: value converter "{{0}}" could not be found. Did you forget to register it as a dependency?',105:"Ast eval error: unable to find $host context. Did you forget [au-slot] attribute?",106:'Ast eval error: invalid assignment. "$host" is a reserved keyword.',107:"Ast eval error: expression is not a function.",109:'Ast eval error: unknown unary operator: "{{0}}"',108:'Ast eval error: unknown binary operator: "{{0}}"',110:"Ast eval error: left-hand side of tagged template expression is not a function.",111:'Ast eval error: expected "{{0}}" to be a function',112:"Ast eval error: cannot use non-object value for destructuring assignment.",113:"Ast eval error: infinite loop detected. Increment operators should only be used in event handlers.",151:"No binding behavior definition found for type {{0:name}}",152:"No value converter definition found for type {{0:name}}",153:'Element "{{0}}" has already been registered.',154:'Attribute "{{0}}" has already been registered.',155:"Value converter {{0}} has already been registered.",156:"Binding behavior {{0}} has already been registered.",157:"Binding command {{0}} has already been registered.",203:"Trying to retrieve a property or build a scope from a null/undefined scope",204:"Trying to create a scope with null/undefined binding context",227:"@bindable is not supported for properties that uses a symbol for name. Use a string for the property name instead.",228:"@bindable cannot be used as a class decorator when no configuration object is supplied.",229:"@bindable cannot be used as a class decorator when no property name is supplied in the configuration object.",500:"There is no cached controller for the provided ViewModel: {{0}}",501:"Invalid combination: cannot combine the containerless custom element option with Shadow DOM.",502:"Trying to activate a disposed controller: {{0}}.",503:"Controller at {{0}} is in an unexpected state: {{1}} during activation.",504:"Synthetic view at {{0}} is being activated with null/undefined scope.",505:"Controller at {{0}} is in an unexpected state: {{1}} during deactivation.",506:"Invalid callback for @watch decorator: {{0}}",507:"Observer for bindable property {{0}} does not support coercion.",508:"Observer for property {{0}} does not support change handler.",759:"No attribute definition found for type {{0:name}}",760:"No element definition found for type {{0:name}}",761:"Cannot create a custom element definition with only a name and no type: {{0}}",762:"Trying to retrieve a custom element controller from a node, but the provided node <{{0:nodeName}} /> is not a custom element or containerless host.",763:"Trying to retrieve a custom element controller from a node, but the provided node <{{0:nodeName}} /> is not a custom element or containerless host.",764:"Trying to retrieve a custom element controller from a node. But the provided node <{{0:nodeName}} /> does not appear to be part of an Aurelia app DOM tree, or it was added to the DOM in a way that Aurelia cannot properly resolve its position in the component tree.",765:"Trying to retrieve a custom element controller from a node. But the provided node <{{0:nodeName}} /> does not appear to be part of an Aurelia app DOM tree, or it was added to the DOM in a way that Aurelia cannot properly resolve its position in the component tree.",766:"Invalid @processContent hook. Expected the hook to be a function (when defined in a class, it needs to be a static function) but got a {{0:typeof}}.",652:"Aurelia is unable to observe property {{0}}. Register observation mapping with .useConfig().",653:"Mapping for property {{0}} of <{{1}} /> already exists",654:"Array values can only be bound to a multi-select.",714:'Template compilation error: primary already exists on element/attribute "{{0}}"',719:"Attribute {{0}} has been already registered for {{1:element}}",767:"Aurelia.root was accessed without a valid root.",768:"An instance of Aurelia is already registered with the container or an ancestor of it.",769:"Failed to initialize the platform object. The host element's ownerDocument does not have a defaultView, did you create the host from a DOMParser and forget to call adoptNode()?",770:"Aurelia.start() was called without a composition root",771:"The aurelia instance must be fully stopped before it can be disposed",750:"view.ref is not supported. If you are migrating from v1, this can be understood as the controller.",751:`Attempted to reference "{{0}}", but it was not found amongst the target's API.`,752:"Element {{0:.res}} is not registered in {{1:name}}.",753:"Attribute {{0:.res}} is not registered in {{1:name}}.",754:"Attribute {{0:.res}} is not registered in {{1:name}}.",755:"Cannot resolve ViewFactory before the provider was prepared.",756:"Cannot resolve ViewFactory without a (valid) name.",757:"AUR0757: The compiled template is not aligned with the render instructions. There are {{0}} targets and {{1}} instructions.",772:"Invalid @watch decorator config. Expected an expression or a fn but received null/undefined.",773:'Invalid @watch decorator change handler config.Method "{{0}}" not found in class {{1}}',774:"Invalid @watch decorator usage: decorated target {{0}} is not a class method.",775:'Invalid command "{{0}}" usage with [repeat]',776:'Invalid [repeat] usage, found extraneous target "{{0}}"',777:"Unsupported: [repeat] cannot iterate over {{0:toString}}",778:"Unsupported: [repeat] cannot count {{0:toString}}",814:"[repeat] encountered an error: number of views != number of items {{0:join(!=)}}",779:"Invalid portal insertion position: {{0}}",801:'"& self" binding behavior only supports listener binding via trigger/capture command.',802:`"& updateTrigger" invalid usage. This binding behavior requires at least one event name argument: eg <input value.bind="firstName & updateTrigger:'blur'">`,803:'"& updateTrigger" invalid usage. This binding behavior can only be applied to two-way/ from-view bindings.',805:'Invalid scope behavior "{{0}}" on <au-compose />. Only "scoped" or "auto" allowed.',806:`<au-compose /> couldn't find a custom element with name "{{0}}", did you forget to register it locally or globally?`,807:"Composition has already been activated/deactivated. Id: {{0:controller}}",808:"Composition has already been deactivated.",810:"Invalid [else] usage, it should follow an [if]",811:"Invalid portal strict target query, empty query.",812:"Invalid portal strict target resolution, target not found.",813:'Invalid [pending]/[then]/[catch] usage. The parent [promise].resolve not found; only "*[promise.resolve] > *[pending|then|catch]" relation is supported.',815:'Invalid [case/default-case] usage. The parent [switch] not found; only "*[switch] > *[case|default-case]" relation is supported.',816:"Invalid [default-case] usage. Multiple 'default-case's are not allowed.",817:'"& signal" binding behavior can only be used with bindings that have a "handleChange" method',818:`"& signal" invalid usage. At least one signal name must be passed to the signal behavior, e.g. "expr & signal:'my-signal'"`,819:"Spreading to bindables onto non custom element",820:"Invalid spread target {{0}}",9999:"No scope context for spread binding.",9998:"Spread binding does not support spreading custom attributes/template controllers. Did you build the spread instruction manually?",9997:"Marker is malformed. This likely happens when a compiled template has been modified. Did you accidentally modified some compiled template? You can modify template before compilation with compiling Template compiler hook.",9996:"Invalid usage, a rate limit has already been applied. Did you have both throttle and debounce on the same binding?",9995:"The binding already has a target subscriber.",9994:`"& attr" can be only used on property binding. It's used on {{0:ctor}}`,9993:'"& updateTrigger" binding behavior only works with the default implementation of Aurelia HTML observation. Implement your own node observation + updateTrigger',9992:'"& updateTrigger" uses node observer to observe, but it does not know how to use events to observe property <{{0:target@property}} />',9991:"Invalid @children usage. @children decorator can only be used on a field",9990:"Invalid @slotted usage. @slotted decorator can only be used on a field",9989:"Invalid query selector. Only selectors with alpha-numeric characters, or $all are allowed. Got {{0}} instead."},$T=(s,...e)=>{var n;let t=xT[s];for(let i=0;i<e.length;++i){const r=new RegExp(`{{${i}(:.*)?}}`,"g");let o=r.exec(t);for(;o!=null;){const a=(n=o[1])==null?void 0:n.slice(1);let c=e[i];if(c!=null)switch(a){case"nodeName":c=c.nodeName.toLowerCase();break;case"name":c=c.name;break;case"typeof":c=typeof c;break;case"ctor":c=c.constructor.name;break;case"controller":c=c.controller.name;break;case"target@property":c=`${c.target}@${c.targetProperty}`;break;case"toString":c=Object.prototype.toString.call(c);break;case"join(!=)":c=c.join("!=");break;case"bindingCommandHelp":c=LT(c);break;case"element":c=c==="*"?"all elements":`<${c} />`;break;default:a!=null&&a.startsWith(".")?c=qi(c[a.slice(1)]):c=qi(c)}t=t.slice(0,o.index)+c+t.slice(r.lastIndex),o=r.exec(t)}}return t};function LT(s){switch(s){case"delegate":return`
The ".delegate" binding command has been removed in v2. Binding command ".trigger" should be used instead. If you are migrating v1 application, install compat package to add back the ".delegate" binding command for ease of migration.`;case"call":return`
The ".call" binding command has been removed in v2. If you want to pass a callback that preserves the context of the function call, you can use lambda instead. Refer to lambda expression doc for more details.`;default:return""}}class rt{constructor(e,t,n,i){this.parent=e,this.bindingContext=t,this.overrideContext=n,this.isBoundary=i}static getContext(e,t,n){if(e==null)throw N(203);let i=e.overrideContext,r=e;if(n>0){for(;n>0;)if(n--,r=r.parent,r==null)return;return i=r.overrideContext,t in i?i:r.bindingContext}for(;r!=null&&!r.isBoundary&&!(t in r.overrideContext)&&!(t in r.bindingContext);)r=r.parent;return r==null?e.bindingContext:(i=r.overrideContext,t in i?i:r.bindingContext)}static create(e,t,n){if(e==null)throw N(204);return new rt(null,e,t??new rp,n??!1)}static fromParent(e,t){if(e==null)throw N(203);return new rt(e,t,new rp,!1)}}class sp{constructor(e,t){e!==void 0&&(this[e]=t)}}class rp{}const{astAssign:Nr,astEvaluate:$e,astBind:es,astUnbind:ts}=(()=>{const s="AccessThis",e="AccessBoundary",t="AccessGlobal",n="AccessScope",i="ArrayLiteral",r="ObjectLiteral",o="PrimitiveLiteral",a="Template",c="Unary",l="CallScope",h="CallMember",u="CallFunction",d="CallGlobal",f="AccessMember",p="AccessKeyed",m="TaggedTemplate",g="Binary",v="Conditional",S="Assign",R="ArrowFunction",C="ValueConverter",I="BindingBehavior",$="ArrayBindingPattern",x="ObjectBindingPattern",F="BindingIdentifier",D="ForOfStatement",V="Interpolation",ce="ArrayDestructuring",qe="ObjectDestructuring",Ne="DestructuringAssignmentLeaf",Me="Custom",Ge=rt.getContext;function P(b,E,y,T){var Nt;switch(b.$kind){case s:{let w=E.overrideContext,O=E,ee=b.ancestor;for(;ee--&&w;)O=O.parent,w=(O==null?void 0:O.overrideContext)??null;return ee<1&&O?O.bindingContext:void 0}case e:{let w=E;for(;w!=null&&!w.isBoundary;)w=w.parent;return w?w.bindingContext:void 0}case n:{const w=Ge(E,b.name,b.ancestor);T!==null&&T.observe(w,b.name);const O=w[b.name];if(O==null&&b.name==="$host")throw N(105);return y!=null&&y.strict?y!=null&&y.boundFn&&pe(O)?O.bind(w):O:O==null?"":y!=null&&y.boundFn&&pe(O)?O.bind(w):O}case t:return globalThis[b.name];case d:{const w=globalThis[b.name];if(pe(w))return w(...b.args.map(O=>P(O,E,y,T)));if(!(y!=null&&y.strictFnCall)&&w==null)return;throw N(107)}case i:return b.elements.map(w=>P(w,E,y,T));case r:{const w={};for(let O=0;O<b.keys.length;++O)w[b.keys[O]]=P(b.values[O],E,y,T);return w}case o:return b.value;case a:{let w=b.cooked[0];for(let O=0;O<b.expressions.length;++O)w+=String(P(b.expressions[O],E,y,T)),w+=b.cooked[O+1];return w}case c:{const w=P(b.expression,E,y,T);switch(b.operation){case"void":return;case"typeof":return typeof w;case"!":return!w;case"-":return-w;case"+":return+w;case"--":if(T!=null)throw N(113);return Ce(b.expression,E,y,w-1)+b.pos;case"++":if(T!=null)throw N(113);return Ce(b.expression,E,y,w+1)-b.pos;default:throw N(109,b.operation)}}case l:{const w=b.args.map(Z=>P(Z,E,y,T)),O=Ge(E,b.name,b.ancestor),ee=Se(y==null?void 0:y.strictFnCall,O,b.name);return ee?ee.apply(O,w):void 0}case h:{const w=P(b.object,E,y,T),O=b.args.map(ke=>P(ke,E,y,T)),ee=Se(y==null?void 0:y.strictFnCall,w,b.name);let Z;return ee&&(Z=ee.apply(w,O),ze(w)&&rn.includes(b.name)&&(T==null||T.observeCollection(w))),Z}case u:{const w=P(b.func,E,y,T);if(pe(w))return w(...b.args.map(O=>P(O,E,y,T)));if(!(y!=null&&y.strictFnCall)&&w==null)return;throw N(107)}case R:return(...O)=>{const ee=b.args,Z=b.rest,ke=ee.length-1,tt=ee.reduce((te,on,At)=>(Z&&At===ke?te[on.name]=O.slice(At):te[on.name]=O[At],te),{}),Cn=rt.fromParent(E,tt);return P(b.body,Cn,y,T)};case f:{const w=P(b.object,E,y,T);let O;return y!=null&&y.strict?w==null?void 0:(T!==null&&!b.accessGlobal&&T.observe(w,b.name),O=w[b.name],y!=null&&y.boundFn&&pe(O)?O.bind(w):O):(T!==null&&hr(w)&&!b.accessGlobal&&T.observe(w,b.name),w?(O=w[b.name],y!=null&&y.boundFn&&pe(O)?O.bind(w):O):"")}case p:{const w=P(b.object,E,y,T),O=P(b.key,E,y,T);return hr(w)?(T!==null&&!b.accessGlobal&&T.observe(w,O),w[O]):w==null?void 0:w[O]}case m:{const w=b.expressions.map(ee=>P(ee,E,y,T)),O=P(b.func,E,y,T);if(!pe(O))throw N(110);return O(b.cooked,...w)}case g:{const w=b.left,O=b.right;switch(b.operation){case"&&":return P(w,E,y,T)&&P(O,E,y,T);case"||":return P(w,E,y,T)||P(O,E,y,T);case"??":return P(w,E,y,T)??P(O,E,y,T);case"==":return P(w,E,y,T)==P(O,E,y,T);case"===":return P(w,E,y,T)===P(O,E,y,T);case"!=":return P(w,E,y,T)!=P(O,E,y,T);case"!==":return P(w,E,y,T)!==P(O,E,y,T);case"instanceof":{const ee=P(O,E,y,T);return pe(ee)?P(w,E,y,T)instanceof ee:!1}case"in":{const ee=P(O,E,y,T);return hr(ee)?P(w,E,y,T)in ee:!1}case"+":{const ee=P(w,E,y,T),Z=P(O,E,y,T);if(y!=null&&y.strict)return ee+Z;if(!ee||!Z){if(St(ee)||St(Z))return(ee||0)+(Z||0);if(ut(ee)||ut(Z))return(ee||"")+(Z||"")}return ee+Z}case"-":return P(w,E,y,T)-P(O,E,y,T);case"*":return P(w,E,y,T)*P(O,E,y,T);case"/":return P(w,E,y,T)/P(O,E,y,T);case"%":return P(w,E,y,T)%P(O,E,y,T);case"<":return P(w,E,y,T)<P(O,E,y,T);case">":return P(w,E,y,T)>P(O,E,y,T);case"<=":return P(w,E,y,T)<=P(O,E,y,T);case">=":return P(w,E,y,T)>=P(O,E,y,T);default:throw N(108,b.operation)}}case v:return P(b.condition,E,y,T)?P(b.yes,E,y,T):P(b.no,E,y,T);case S:{let w=P(b.value,E,y,T);if(b.op!=="="){if(T!=null)throw N(113);const O=P(b.target,E,y,T);switch(b.op){case"/=":w=O/w;break;case"*=":w=O*w;break;case"+=":w=O+w;break;case"-=":w=O-w;break;default:throw N(108,b.op)}}return Ce(b.target,E,y,w)}case C:{const w=(Nt=y==null?void 0:y.getConverter)==null?void 0:Nt.call(y,b.name);if(w==null)throw N(103,b.name);return"toView"in w?w.toView(P(b.expression,E,y,T),...b.args.map(O=>P(O,E,y,T))):P(b.expression,E,y,T)}case I:return P(b.expression,E,y,T);case F:return b.name;case D:return P(b.iterable,E,y,T);case V:if(b.isMulti){let w=b.parts[0],O=0;for(;O<b.expressions.length;++O)w+=qi(P(b.expressions[O],E,y,T)),w+=b.parts[O+1];return w}else return`${b.parts[0]}${P(b.firstExpression,E,y,T)}${b.parts[1]}`;case Ne:return P(b.target,E,y,T);case ce:return b.list.map(w=>P(w,E,y,T));case $:case x:case qe:default:return;case Me:return b.evaluate(E,y,T)}}function Ce(b,E,y,T){var Nt;switch(b.$kind){case n:{if(b.name==="$host")throw N(106);const w=Ge(E,b.name,b.ancestor);return w[b.name]=T}case f:{const w=P(b.object,E,y,null);return hr(w)?b.name==="length"&&ze(w)&&!isNaN(T)?w.splice(T):w[b.name]=T:Ce(b.object,E,y,{[b.name]:T}),T}case p:{const w=P(b.object,E,y,null),O=P(b.key,E,y,null);if(ze(w)){if(O==="length"&&!isNaN(T))return w.splice(T),T;if(xo(O))return w.splice(O,1,T),T}return w[O]=T}case S:return Ce(b.value,E,y,T),Ce(b.target,E,y,T);case C:{const w=(Nt=y==null?void 0:y.getConverter)==null?void 0:Nt.call(y,b.name);if(w==null)throw N(103,b.name);return"fromView"in w&&(T=w.fromView(T,...b.args.map(O=>P(O,E,y,null)))),Ce(b.expression,E,y,T)}case I:return Ce(b.expression,E,y,T);case ce:case qe:{const w=b.list,O=w.length;let ee,Z;for(ee=0;ee<O;ee++)switch(Z=w[ee],Z.$kind){case Ne:Ce(Z,E,y,T);break;case ce:case qe:{if(typeof T!="object"||T===null)throw N(112);let ke=P(Z.source,rt.create(T),y,null);ke===void 0&&Z.initializer&&(ke=P(Z.initializer,E,y,null)),Ce(Z,E,y,ke);break}}break}case Ne:{if(b instanceof Kg){if(T==null)return;if(typeof T!="object")throw N(112);let w=P(b.source,rt.create(T),y,null);w===void 0&&b.initializer&&(w=P(b.initializer,E,y,null)),Ce(b.target,E,y,w)}else{if(T==null)return;if(typeof T!="object")throw N(112);const w=b.indexOrProperties;let O;if(xo(w)){if(!Array.isArray(T))throw N(112);O=T.slice(w)}else O=Object.entries(T).reduce((ee,[Z,ke])=>(w.includes(Z)||(ee[Z]=ke),ee),{});Ce(b.target,E,y,O)}break}case Me:return b.assign(E,y,T);default:return}}function ct(b,E,y){var T,Nt,w,O,ee;switch(b.$kind){case I:{const Z=b.name,ke=b.key,tt=(T=y.getBehavior)==null?void 0:T.call(y,Z);if(tt==null)throw N(101,Z);if(y[ke]===void 0)y[ke]=tt,(Nt=tt.bind)==null||Nt.call(tt,E,y,...b.args.map(Cn=>P(Cn,E,y,null)));else throw N(102,Z);ct(b.expression,E,y);return}case C:{const Z=b.name,ke=(w=y.getConverter)==null?void 0:w.call(y,Z);if(ke==null)throw N(103,Z);const tt=ke.signals;if(tt!=null){const Cn=(O=y.getSignaler)==null?void 0:O.call(y),te=tt.length;let on=0;for(;on<te;++on)Cn==null||Cn.addSignalListener(tt[on],y)}ct(b.expression,E,y);return}case D:{ct(b.iterable,E,y);break}case Me:(ee=b.bind)==null||ee.call(b,E,y)}}function j(b,E,y){var T,Nt,w,O,ee;switch(b.$kind){case I:{const Z=b.key,ke=y;ke[Z]!==void 0&&((Nt=(T=ke[Z]).unbind)==null||Nt.call(T,E,y),ke[Z]=void 0),j(b.expression,E,y);break}case C:{const Z=(w=y.getConverter)==null?void 0:w.call(y,b.name);if((Z==null?void 0:Z.signals)===void 0)return;const ke=(O=y.getSignaler)==null?void 0:O.call(y);let tt=0;for(;tt<Z.signals.length;++tt)ke==null||ke.removeSignalListener(Z.signals[tt],y);j(b.expression,E,y);break}case D:{j(b.iterable,E,y);break}case Me:(ee=b.unbind)==null||ee.call(b,E,y)}}const Se=(b,E,y)=>{const T=E==null?null:E[y];if(pe(T))return T;if(!b&&T==null)return null;throw N(111,y)},St=b=>{switch(typeof b){case"number":case"bigint":return!0;default:return!1}},ut=b=>{switch(typeof b){case"string":return!0;case"object":return b instanceof Date;default:return!1}},rn="at map filter includes indexOf lastIndexOf findIndex find flat flatMap join reduce reduceRight slice every some sort".split(" ");return{astEvaluate:P,astAssign:Ce,astBind:ct,astUnbind:j}})();const{default:Lu,oneTime:$c,toView:Fe,fromView:Ti,twoWay:tv}=Wr,wt=$t.get,Lc=$t.has,bn=$t.define,{annotation:DT}=cu,Pi=DT.keyFor;function BT(s,e){let t;function n(i,r){var l;let o;switch(r.kind){case"getter":case"field":{const h=r.name;if(typeof h!="string")throw N(227);o=h;break}case"class":if(t==null)throw N(228);if(typeof t=="string")o=t;else{const h=t.name;if(!h)throw N(229);if(typeof h!="string")throw N(227);o=h}break}const a=t==null||typeof t=="string"?{name:o}:t,c=(l=r.metadata)[Hi]??(l[Hi]=be());c[o]=di.create(o,a)}if(arguments.length>1){t={},n(s,e);return}else if(ue(s))return t=s,n;return t=s===void 0?{}:s,n}const Hi=Pi("bindables"),Ut=ei({name:Hi,keyFrom:s=>`${Hi}:${s}`,from(...s){const e={},t=Array.isArray;function n(o){e[o]=di.create(o)}function i(o,a){e[o]=a instanceof di?a:di.create(o,a===!0?{}:a)}function r(o){t(o)?o.forEach(a=>ue(a)?n(a):i(a.name,a)):o instanceof di?e[o.name]=o:o!==void 0&&xu(o).forEach(a=>i(a,o[a]))}return s.forEach(r),e},getAll(s){const e=[],t=jw(s);let n=t.length,i;for(;--n>=0;){i=t[n];const r=wt(Hi,i);r!=null&&e.push(...Object.values(r))}return e},_add(s,e){let t=wt(Hi,e);t==null&&bn(t=be(),e,Hi),t[s.name]=s}});class di{constructor(e,t,n,i,r,o){this.attribute=e,this.callback=t,this.mode=n,this.primary=i,this.name=r,this.set=o}static create(e,t={}){const n=t.mode??Fe;return new di(t.attribute??Ag(e),t.callback??`${e}Changed`,ue(n)?Wr[n]??Lu:n,t.primary??!1,t.name??e,t.set??HT(t))}}const wh={key:Pi("coercer"),define(s,e){bn(s[e].bind(s),s,wh.key)},for(s){return wt(wh.key,s)}};function HT(s={}){const e=s.type??null;if(e==null)return gi;let t;switch(e){case Number:case Boolean:case String:case BigInt:t=e;break;default:{const n=e.coerce;t=typeof n=="function"?n.bind(e):wh.for(e)??gi;break}}return t===gi?t:UT(t,s.nullable)}function UT(s,e){return function(t,n){return n!=null&&n.enableCoercion?(e??!((n==null?void 0:n.coerceNullish)??!1))&&t==null?t:s(t,n):t}}const ye=sn.createInterface,ni=Ci.singleton,Gi=Ci.aliasTo,Du=Ci.instance,Oe=(s,e,t)=>s.registerResolver(e,t),FT="custom-element",KT="custom-attribute",Wi=(s,e,t,n="__au_static_resource__")=>{var r;let i=wt(n,s);return i==null&&((r=s.$au)==null?void 0:r.type)===e&&(i=t(s.$au,s),bn(i,s,n)),i};class So{constructor(e,t,n,i){this.Type=e,this.name=t,this.aliases=n,this.key=i}static create(e,t){let n,i;return ue(e)?(n=e,i={name:n}):(n=e.name,i=e),new So(t,Bi(op(t,"name"),n),We(op(t,"aliases"),i.aliases,t.aliases),nv.keyFrom(n))}register(e,t){const n=this.Type,i=typeof t=="string"?Ao(t):this.key,r=this.aliases;e.has(i,!1)?console.warn(`[DEV:aurelia] ${N(156,this.name)}`):e.register(e.has(n,!1)?null:ni(n,n),Gi(n,i),...r.map(o=>Gi(n,Ao(o))))}}const Zt="binding-behavior",sr=ki(Zt),op=(s,e)=>wt(Pi(e),s),Ao=s=>`${sr}:${s}`,nv=ei({name:sr,keyFrom:Ao,isType(s){var e;return pe(s)&&(Lc(sr,s)||((e=s.$au)==null?void 0:e.type)===Zt)},define(s,e){const t=So.create(s,e),n=t.Type;return bn(t,n,sr,xn),n},getDefinition(s){const e=wt(sr,s)??Wi(s,Zt,So.create);if(e===void 0)throw N(151,s);return e},find(s,e){const t=s.find(Zt,e);return t==null?null:wt(sr,t)??Wi(t,Zt,So.create)??null},get(s,e){try{return s.get(Pr(Ao(e)))}catch(t){throw console.error("[DEV:aurelia] Cannot retrieve binding behavior with name",e),t}return s.get(Pr(Ao(e)))}}),Cl=new Map,Dc=s=>({type:Zt,name:s});class Bc{bind(e,t){Cl.set(t,t.mode),t.mode=this.mode}unbind(e,t){t.mode=Cl.get(t),Cl.delete(t)}}class iv extends Bc{get mode(){return $c}}iv.$au=Dc("oneTime");class sv extends Bc{get mode(){return Fe}}sv.$au=Dc("toView");class rv extends Bc{get mode(){return Ti}}rv.$au=Dc("fromView");class ov extends Bc{get mode(){return tv}}ov.$au=Dc("twoWay");const Sl=new WeakMap,VT=200;class av{constructor(){this._platform=k(Vr)}bind(e,t,n,i){var a;const r={type:"debounce",delay:n??VT,now:this._platform.performanceNow,queue:this._platform.taskQueue,signals:ue(i)?[i]:i??ie},o=(a=t.limit)==null?void 0:a.call(t,r);o==null?console.warn(`Binding ${t.constructor.name} does not support debounce rate limiting`):Sl.set(t,o)}unbind(e,t){var n;(n=Sl.get(t))==null||n.dispose(),Sl.delete(t)}}av.$au={type:Zt,name:"debounce"};const Bu=ye("ISignaler",s=>s.singleton(jT));class jT{constructor(){this.signals=be()}dispatchSignal(e){const t=this.signals[e];if(t===void 0)return;let n;for(n of t.keys())n.handleChange(void 0,void 0)}addSignalListener(e,t){var n;((n=this.signals)[e]??(n[e]=new Set)).add(t)}removeSignalListener(e,t){var n;(n=this.signals[e])==null||n.delete(t)}}class cv{constructor(){this._lookup=new Map,this._signaler=k(Bu)}bind(e,t,...n){if(!("handleChange"in t))throw N(817);if(n.length===0)throw N(818);this._lookup.set(t,n);let i;for(i of n)Zm(this._signaler,i,t)}unbind(e,t){const n=this._lookup.get(t);this._lookup.delete(t);let i;for(i of n)ev(this._signaler,i,t)}}cv.$au={type:Zt,name:"signal"};const Al=new WeakMap,zT=200;class lv{constructor(){({performanceNow:this._now,taskQueue:this._taskQueue}=k(Vr))}bind(e,t,n,i){var a;const r={type:"throttle",delay:n??zT,now:this._now,queue:this._taskQueue,signals:ue(i)?[i]:i??ie},o=(a=t.limit)==null?void 0:a.call(t,r);o==null?console.warn(`Binding ${t.constructor.name} does not support debounce rate limiting`):Al.set(t,o)}unbind(e,t){var n;(n=Al.get(t))==null||n.dispose(),Al.delete(t)}}lv.$au={type:Zt,name:"throttle"};const Ch=ye("IAppTask");class ap{constructor(e,t,n){this.c=void 0,this.slot=e,this.k=t,this.cb=n}register(e){return this.c=e.register(Du(Ch,this))}run(){const e=this.k,t=this.cb;return e===null?t():t(this.c.get(e))}}const Tl=ei({creating:cs("creating"),hydrating:cs("hydrating"),hydrated:cs("hydrated"),activating:cs("activating"),activated:cs("activated"),deactivating:cs("deactivating"),deactivated:cs("deactivated")});function cs(s){function e(t,n){return pe(n)?new ap(s,t,n):new ap(s,null,t)}return e}const _t=Vr,Sh=(()=>{const s=new WeakMap;return ei({add(e,t){let n=s.get(e);n==null&&s.set(e,n=[]),n.push(t)},getDefinitions(e){return s.get(e)??ie}})})();class Ms{get type(){return KT}constructor(e,t,n,i,r,o,a,c,l,h,u){this.Type=e,this.name=t,this.aliases=n,this.key=i,this.defaultBindingMode=r,this.isTemplateController=o,this.bindables=a,this.noMultiBindings=c,this.watches=l,this.dependencies=h,this.containerStrategy=u}static create(e,t){let n,i;ue(e)?(n=e,i={name:n}):(n=e.name,i=e);const r=Bi(ai(t,"defaultBindingMode"),i.defaultBindingMode,t.defaultBindingMode,Fe);for(const o of Object.values(Ut.from(i.bindables)))Ut._add(o,t);return new Ms(t,Bi(ai(t,"name"),n),We(ai(t,"aliases"),i.aliases,t.aliases),Tr(n),ue(r)?Wr[r]??Lu:r,Bi(ai(t,"isTemplateController"),i.isTemplateController,t.isTemplateController,!1),Ut.from(...Ut.getAll(t),ai(t,"bindables"),t.bindables,i.bindables),Bi(ai(t,"noMultiBindings"),i.noMultiBindings,t.noMultiBindings,!1),We(Sh.getDefinitions(t),t.watches),We(ai(t,"dependencies"),i.dependencies,t.dependencies),Bi(ai(t,"containerStrategy"),i.containerStrategy,t.containerStrategy,"reuse"))}register(e,t){const n=this.Type,i=typeof t=="string"?Tr(t):this.key,r=this.aliases;e.has(i,!1)?(Ms.warnDuplicate&&e.get(ji).warn(N(154,this.name)),console.warn(`[DEV:aurelia] ${N(154,this.name)}`)):e.register(e.has(n,!1)?null:ni(n,n),Gi(n,i),...r.map(o=>Gi(n,Tr(o))))}toString(){return`au:ca:${this.name}`}}Ms.warnDuplicate=!0;const Ct="custom-attribute",Mr=ki(Ct),Tr=s=>`${Mr}:${s}`,ai=(s,e)=>wt(Pi(e),s),qT=s=>{var e;return pe(s)&&(Lc(Mr,s)||((e=s.$au)==null?void 0:e.type)===Ct)},hv=(s,e)=>yr(s,Tr(e))??void 0,Hu=(s,e)=>{const t=Ms.create(s,e),n=t.Type;return bn(t,n,Mr,xn),n},Uu=s=>{const e=wt(Mr,s)??Wi(s,Ct,Ms.create);if(e===void 0)throw N(759,s);return e},GT=(s,e)=>{let t="",n="";if(ue(e))t=Tr(e),n=e;else{const r=Uu(e);t=r.key,n=r.name}let i=s;for(;i!==null;){const r=yr(i,t);if(r!=null&&r.is(n))return r;i=Xa(i)}return null},Oi=ei({name:Mr,keyFrom:Tr,isType:qT,for:hv,closest:GT,define:Hu,getDefinition:Uu,annotate(s,e,t){bn(t,s,Pi(e))},getAnnotation:ai,find(s,e){const t=s.find(Ct,e);return t===null?null:wt(Mr,t)??Wi(t,Ct,Ms.create)??null}}),Xs=ye("ILifecycleHooks");class WT{constructor(e,t){this.definition=e,this.instance=t}}class Fu{constructor(e,t){this.Type=e,this.propertyNames=t}static create(e,t){const n=new Set;let i=t.prototype;for(;i!==Ym;){for(const r of Xm(i))r!=="constructor"&&!r.startsWith("_")&&n.add(r);i=Object.getPrototypeOf(i)}return new Fu(t,n)}}const cp=(()=>{const s=new WeakMap,e=new WeakMap;return ei({define(t,n){const i=Fu.create(t,n),r=i.Type;return e.set(r,i),{register(o){ni(Xs,r).register(o)}}},resolve(t){let n=s.get(t);if(n===void 0){s.set(t,n=new QT);const i=t.root,r=i===t?t.getAll(Xs):t.has(Xs,!1)?i.getAll(Xs).concat(t.getAll(Xs)):i.getAll(Xs);let o,a,c,l,h;for(o of r){a=e.get(o.constructor),c=new WT(a,o);for(l of a.propertyNames)h=n[l],h===void 0?n[l]=[c]:h.push(c)}}return n}})})();class QT{}class To{constructor(e,t,n,i){this.Type=e,this.name=t,this.aliases=n,this.key=i}static create(e,t){let n,i;return ue(e)?(n=e,i={name:n}):(n=e.name,i=e),new To(t,Bi(Ah(t,"name"),n),We(Ah(t,"aliases"),i.aliases,t.aliases),uv.keyFrom(n))}register(e,t){const n=this.Type,i=typeof t=="string"?Io(t):this.key,r=this.aliases;e.has(i,!1)?console.warn(`[DEV:aurelia] ${N(155,this.name)}`):e.register(e.has(n,!1)?null:ni(n,n),Gi(n,i),...r.map(o=>Gi(n,Io(o))))}}const fr="value-converter",rr=ki(fr),Ah=(s,e)=>wt(Pi(e),s),Io=s=>`${rr}:${s}`,uv=ei({name:rr,keyFrom:Io,isType(s){var e;return pe(s)&&(Lc(rr,s)||((e=s.$au)==null?void 0:e.type)===fr)},define(s,e){const t=To.create(s,e),n=t.Type;return bn(t,n,rr,xn),n},getDefinition(s){const e=wt(rr,s)??Wi(s,fr,To.create);if(e===void 0)throw N(152,s);return e},annotate(s,e,t){bn(t,s,Pi(e))},getAnnotation:Ah,find(s,e){const t=s.find(fr,e);return t==null?null:wt(rr,t)??Wi(t,fr,To.create)??null},get(s,e){try{return s.get(Pr(Io(e)))}catch(t){throw console.error("[DEV:aurelia] Cannot retrieve value converter with name",e),t}return s.get(Pr(Io(e)))}});class YT{constructor(e,t){this._value=void 0,this.b=e,this._flushQueue=t}flush(){this.b.updateSource(this._value)}handleChange(e,t){const n=this.b;e!==$e(n.ast,n._scope,n,null)&&(this._value=e,this._flushQueue.add(this))}}const js=(()=>{function s(e){this._scope=e}return e=>{gn(e.prototype,"useScope",s)}})(),Ni=(()=>{const s=new WeakMap,e=new WeakMap;function t(o){return this.l.get(o)}function n(){return this.l.root.get(Bu)}function i(o){let a=s.get(this);return a==null&&s.set(this,a=new lp),a[o]??(a[o]=uv.get(this.l,o))}function r(o){let a=e.get(this);return a==null&&e.set(this,a=new lp),a[o]??(a[o]=nv.get(this.l,o))}return(o,a=!0)=>c=>{const l=c.prototype;o!=null&&Qa(l,"strict",{enumerable:!0,get:function(){return o}}),Qa(l,"strictFnCall",{enumerable:!0,get:function(){return a}}),gn(l,"get",t),gn(l,"getSignaler",n),gn(l,"getConverter",i),gn(l,"getBehavior",r)}})();class lp{}const JT=ye("IFlushQueue",s=>s.singleton(XT));class XT{constructor(){this._flushing=!1,this._items=new Set}get count(){return this._items.size}add(e){if(this._items.add(e),!this._flushing){this._flushing=!0;try{this._items.forEach(ZT)}finally{this._flushing=!1}}}clear(){this._items.clear(),this._flushing=!1}}const ZT=function(s,e,t){t.delete(s),s.flush()},zs=(()=>{const s=new WeakSet,e=(n,i,r)=>{let o,a,c,l=!1;const h=n.queue,u=()=>i(c),d=p=>{c=p,r.isBound?(a=o,o=h.queueTask(u,{delay:n.delay}),a==null||a.cancel()):u()},f=d.dispose=()=>{a==null||a.cancel(),o==null||o.cancel(),a=o=void 0};return d.flush=()=>{l=(o==null?void 0:o.status)===ip,f(),l&&u()},d},t=(n,i,r)=>{let o,a,c=0,l=0,h,u=!1;const d=n.queue,f=()=>n.now(),p=()=>i(h),m=v=>{h=v,r.isBound?(l=f()-c,a=o,l>n.delay?(c=f(),p()):o=d.queueTask(()=>{c=f(),p()},{delay:n.delay-l}),a==null||a.cancel()):p()},g=m.dispose=()=>{a==null||a.cancel(),o==null||o.cancel(),a=o=void 0};return m.flush=()=>{u=(o==null?void 0:o.status)===ip,g(),u&&p()},m};return(n,i)=>{gn(n.prototype,"limit",function(r){if(s.has(this))throw N(9996);s.add(this);const o=i(this,r),a=r.signals,c=a.length>0?this.get(Bu):null,l=this[o],h=(...f)=>l.call(this,...f),u=r.type==="debounce"?e(r,h,this):t(r,h,this),d=c?{handleChange:u.flush}:null;return this[o]=u,c&&a.forEach(f=>Zm(c,f,d)),{dispose:()=>{c&&a.forEach(f=>ev(c,f,d)),s.delete(this),u.dispose(),delete this[o]}}})}})(),ns=((s=new WeakSet)=>e=>function(){s.has(this)||(s.add(this),e.call(this))})(),eI={preempt:!0};class vs{constructor(e,t,n,i,r,o,a,c,l){this.targetAttribute=a,this.targetProperty=c,this.mode=l,this.isBound=!1,this._scope=void 0,this._task=null,this._value=void 0,this.boundFn=!1,this.l=t,this.ast=r,this._controller=e,this.target=o,this.oL=n,this._taskQueue=i}updateTarget(e){const t=this.target,n=this.targetAttribute,i=this.targetProperty;switch(n){case"class":t.classList.toggle(i,!!e);break;case"style":{let r="",o=qi(e);ue(o)&&o.includes("!important")&&(r="important",o=o.replace("!important","")),t.style.setProperty(i,o,r);break}default:e==null?t.removeAttribute(n):t.setAttribute(n,qi(e))}}handleChange(){if(!this.isBound)return;let e;this.obs.version++;const t=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null);this.obs.clear(),t!==this._value&&(this._value=t,this._controller.state!==Kt?(e=this._task,this._task=this._taskQueue.queueTask(()=>{this._task=null,this.updateTarget(t)},eI),e==null||e.cancel()):this.updateTarget(t))}handleCollectionChange(){this.handleChange()}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,es(this.ast,e,this),this.mode&(Fe|$c)&&this.updateTarget(this._value=$e(this.ast,e,this,(this.mode&Fe)>0?this:null)),this.isBound=!0}unbind(){var e;this.isBound&&(this.isBound=!1,ts(this.ast,this._scope,this),this._scope=void 0,this._value=void 0,(e=this._task)==null||e.cancel(),this._task=null,this.obs.clearAll())}}vs.mix=ns(()=>{js(vs),zs(vs,()=>"updateTarget"),Jn(vs,null),Ni(!0)(vs)});const tI={preempt:!0};class nI{constructor(e,t,n,i,r,o,a,c){this.ast=r,this.target=o,this.targetProperty=a,this.mode=c,this.isBound=!1,this._scope=void 0,this._task=null,this._controller=e,this.oL=n,this._taskQueue=i,this._targetObserver=n.getAccessor(o,a);const l=r.expressions,h=this.partBindings=Array(l.length),u=l.length;let d=0;for(;u>d;++d)h[d]=new ys(l[d],o,a,t,n,this)}_handlePartChange(){this.updateTarget()}updateTarget(){const e=this.partBindings,t=this.ast.parts,n=e.length;let i="",r=0;if(n===1)i=t[0]+e[0]._value+t[1];else for(i=t[0];n>r;++r)i+=e[r]._value+t[r+1];const o=this._targetObserver,a=this._controller.state!==Kt&&(o.type&ti)>0;let c;a?(c=this._task,this._task=this._taskQueue.queueTask(()=>{this._task=null,o.setValue(i,this.target,this.targetProperty)},tI),c==null||c.cancel(),c=null):o.setValue(i,this.target,this.targetProperty)}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e;const t=this.partBindings,n=t.length;let i=0;for(;n>i;++i)t[i].bind(e);this.updateTarget(),this.isBound=!0}unbind(){var i;if(!this.isBound)return;this.isBound=!1,this._scope=void 0;const e=this.partBindings,t=e.length;let n=0;for(;t>n;++n)e[n].unbind();(i=this._task)==null||i.cancel(),this._task=null}useAccessor(e){this._targetObserver=e}}class ys{constructor(e,t,n,i,r,o){this.ast=e,this.target=t,this.targetProperty=n,this.owner=o,this.mode=Fe,this.task=null,this.isBound=!1,this._value="",this.boundFn=!1,this.l=i,this.oL=r}updateTarget(){this.owner._handlePartChange()}handleChange(){if(!this.isBound)return;this.obs.version++;const e=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null);this.obs.clear(),e!=this._value&&(this._value=e,ze(e)&&this.observeCollection(e),this.updateTarget())}handleCollectionChange(){this.updateTarget()}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,es(this.ast,e,this),this._value=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null),ze(this._value)&&this.observeCollection(this._value),this.isBound=!0}unbind(){this.isBound&&(this.isBound=!1,ts(this.ast,this._scope,this),this._scope=void 0,this.obs.clearAll())}}ys.mix=ns(()=>{js(ys),zs(ys,()=>"updateTarget"),Jn(ys,null),Ni(!0)(ys)});const iI={preempt:!0};class _s{constructor(e,t,n,i,r,o,a){this.p=r,this.ast=o,this.target=a,this.isBound=!1,this.mode=Fe,this._task=null,this._value="",this._needsRemoveNode=!1,this.boundFn=!1,this.strict=!0,this.l=t,this._controller=e,this.oL=n,this._taskQueue=i}updateTarget(e){var i,r;const t=this.target,n=this._value;this._value=e,this._needsRemoveNode&&((i=n.parentNode)==null||i.removeChild(n),this._needsRemoveNode=!1),e instanceof this.p.Node&&((r=t.parentNode)==null||r.insertBefore(e,t),e="",this._needsRemoveNode=!0),t.textContent=qi(e??"")}handleChange(){var n;if(!this.isBound)return;this.obs.version++;const e=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null);if(this.obs.clear(),e===this._value){(n=this._task)==null||n.cancel(),this._task=null;return}this._controller.state!==Kt?this._queueUpdate(e):this.updateTarget(e)}handleCollectionChange(){if(!this.isBound)return;this.obs.version++;const e=this._value=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null);this.obs.clear(),ze(e)&&this.observeCollection(e),this._controller.state!==Kt?this._queueUpdate(e):this.updateTarget(e)}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,es(this.ast,e,this);const t=this._value=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null);ze(t)&&this.observeCollection(t),this.updateTarget(t),this.isBound=!0}unbind(){var e,t;this.isBound&&(this.isBound=!1,ts(this.ast,this._scope,this),this._needsRemoveNode&&((e=this._value.parentNode)==null||e.removeChild(this._value)),this._scope=void 0,this.obs.clearAll(),(t=this._task)==null||t.cancel(),this._task=null)}_queueUpdate(e){const t=this._task;this._task=this._taskQueue.queueTask(()=>{this._task=null,this.updateTarget(e)},iI),t==null||t.cancel()}}_s.mix=ns(()=>{js(_s),zs(_s,()=>"updateTarget"),Jn(_s,null),Ni(void 0,!1)(_s)});class bs{constructor(e,t,n,i,r=!1){this.ast=n,this.targetProperty=i,this.isBound=!1,this._scope=void 0,this.target=null,this.boundFn=!1,this.l=e,this.oL=t,this._toBindingContext=r}updateTarget(){this.target[this.targetProperty]=this._value}handleChange(){this.isBound&&(this.obs.version++,this._value=$e(this.ast,this._scope,this,this),this.obs.clear(),this.updateTarget())}handleCollectionChange(){this.handleChange()}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,this.target=this._toBindingContext?e.bindingContext:e.overrideContext,es(this.ast,e,this),this._value=$e(this.ast,this._scope,this,this),this.updateTarget(),this.isBound=!0}unbind(){this.isBound&&(this.isBound=!1,ts(this.ast,this._scope,this),this._scope=void 0,this.obs.clearAll())}}bs.mix=ns(()=>{js(bs),zs(bs,()=>"updateTarget"),Jn(bs,null),Ni(!0)(bs)});class Et{constructor(e,t,n,i,r,o,a,c){this.ast=r,this.target=o,this.targetProperty=a,this.mode=c,this.isBound=!1,this._scope=void 0,this._targetObserver=void 0,this._task=null,this._targetSubscriber=null,this.boundFn=!1,this.l=t,this._controller=e,this._taskQueue=i,this.oL=n}updateTarget(e){this._targetObserver.setValue(e,this.target,this.targetProperty)}updateSource(e){Nr(this.ast,this._scope,this,e)}handleChange(){if(!this.isBound)return;this.obs.version++;const e=$e(this.ast,this._scope,this,(this.mode&Fe)>0?this:null);this.obs.clear(),this._controller.state!==Kt&&(this._targetObserver.type&ti)>0?(so=this._task,this._task=this._taskQueue.queueTask(()=>{this.updateTarget(e),this._task=null},sI),so==null||so.cancel(),so=null):this.updateTarget(e)}handleCollectionChange(){this.handleChange()}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,es(this.ast,e,this);const t=this.oL,n=this.mode;let i=this._targetObserver;i||(n&Ti?i=t.getObserver(this.target,this.targetProperty):i=t.getAccessor(this.target,this.targetProperty),this._targetObserver=i);const r=(n&Fe)>0;n&(Fe|$c)&&this.updateTarget($e(this.ast,this._scope,this,r?this:null)),n&Ti&&(i.subscribe(this._targetSubscriber??(this._targetSubscriber=new YT(this,this.l.get(JT)))),r||this.updateSource(i.getValue(this.target,this.targetProperty))),this.isBound=!0}unbind(){var e;this.isBound&&(this.isBound=!1,ts(this.ast,this._scope,this),this._scope=void 0,this._targetSubscriber&&(this._targetObserver.unsubscribe(this._targetSubscriber),this._targetSubscriber=null),(e=this._task)==null||e.cancel(),this._task=null,this.obs.clearAll())}useTargetObserver(e){var t;(t=this._targetObserver)==null||t.unsubscribe(this),(this._targetObserver=e).subscribe(this)}useTargetSubscriber(e){if(this._targetSubscriber!=null)throw N(9995);this._targetSubscriber=e}}Et.mix=ns(()=>{js(Et),zs(Et,s=>s.mode&Ti?"updateSource":"updateTarget"),Jn(Et,null),Ni(!0,!1)(Et)});let so=null;const sI={preempt:!0};class Th{constructor(e,t,n){this.ast=t,this.target=n,this.isBound=!1,this._scope=void 0,this.l=e}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,es(this.ast,e,this),Nr(this.ast,this._scope,this,this.target),this.isBound=!0}unbind(){this.isBound&&(this.isBound=!1,$e(this.ast,this._scope,this,null)===this.target&&Nr(this.ast,this._scope,this,null),ts(this.ast,this._scope,this),this._scope=void 0)}}Th.mix=ns(()=>{Ni(!1)(Th)});class rI{constructor(e,t=!1){this.prevent=e,this.capture=t}}class pr{constructor(e,t,n,i,r,o){this.ast=t,this.target=n,this.targetEvent=i,this.isBound=!1,this.self=!1,this.boundFn=!0,this._modifiedEventHandler=null,this.l=e,this._options=r,this._modifiedEventHandler=o}callSource(e){const t=this._scope.overrideContext;t.$event=e;let n=$e(this.ast,this._scope,this,null);return delete t.$event,pe(n)&&(n=n(e)),n!==!0&&this._options.prevent&&e.preventDefault(),n}handleEvent(e){var t;this.self&&this.target!==e.composedPath()[0]||((t=this._modifiedEventHandler)==null?void 0:t.call(this,e))!==!1&&this.callSource(e)}bind(e){if(this.isBound){if(this._scope===e)return;this.unbind()}this._scope=e,es(this.ast,e,this),this.target.addEventListener(this.targetEvent,this,this._options),this.isBound=!0}unbind(){this.isBound&&(this.isBound=!1,ts(this.ast,this._scope,this),this._scope=void 0,this.target.removeEventListener(this.targetEvent,this,this._options))}}pr.mix=ns(function(){js(pr),zs(pr,()=>"callSource"),Ni(!0,!0)(pr)});const Hc=ye("IEventModifier"),dv=ye("IKeyMapping",s=>s.instance({meta:ei(["ctrl","alt","shift","meta"]),keys:{escape:"Escape",enter:"Enter",space:"Space",tab:"tab",...Array.from({length:25}).reduce((e,t,n)=>{let i=String.fromCharCode(n+65);return e[n+65]=i,i=String.fromCharCode(n+97),e[n+97]=e[i]=i,e},{})}}));class Ku{constructor(){this.type=["click","mousedown","mousemove","mouseup","dblclick","contextmenu"],this._mapping=k(dv),this._mouseButtons=["left","middle","right"]}static register(e){e.register(ni(Hc,Ku))}getHandler(e){const t=e.split(/[:+.]/);return n=>{let i=!1,r=!1,o;for(o of t){switch(o){case"prevent":i=!0;continue;case"stop":r=!0;continue;case"left":case"middle":case"right":if(n.button!==this._mouseButtons.indexOf(o))return!1;continue}if(this._mapping.meta.includes(o)&&n[`${o}Key`]!==!0)return!1;console.warn(`Modifier '${o}' is not supported for mouse events.`)}return i&&n.preventDefault(),r&&n.stopPropagation(),!0}}}class Vu{constructor(){this._mapping=k(dv),this.type=["keydown","keyup"]}static register(e){e.register(ni(Hc,Vu))}getHandler(e){const t=e.split(/[:+.]/);return n=>{let i=!1,r=!1,o;for(o of t){switch(o){case"prevent":i=!0;continue;case"stop":r=!0;continue}if(this._mapping.meta.includes(o)){if(n[`${o}Key`]!==!0)return!1;continue}if(this._mapping.keys[o]!==n.key)return!1;console.warn(`Modifier '${o}' is not supported for keyboard event with key "${n.key}".`)}return i&&n.preventDefault(),r&&n.stopPropagation(),!0}}}class ju{constructor(){this.type=["$ALL"]}static register(e){e.register(ni(Hc,ju))}getHandler(e){const t=e.split(/[:+.]/);return n=>{let i=!1,r=!1,o;for(o of t){switch(o){case"prevent":i=!0;continue;case"stop":r=!0;continue}console.warn(`Modifier '${o}' is not supported for event "${n.type}".`)}return i&&n.preventDefault(),r&&n.stopPropagation(),!0}}}const fv=ye("IEventModifierHandler",s=>s.instance({getHandler:()=>(console.warn("No event modifier handler registered"),null)}));class zu{constructor(){this._reg=k(lu(Hc)).reduce((e,t)=>((ze(t.type)?t.type:[t.type]).forEach(i=>e[i]=t),e),{})}static register(e){e.register(ni(fv,zu))}getHandler(e,t){var n;return ue(t)?((n=this._reg[e]??this._reg.$ALL)==null?void 0:n.getHandler(t))??null:null}}const oI={register(s){s.register(zu,Ku,Vu,ju)}},Gt=ye("IViewFactory");class Uc{constructor(e,t){this.isCaching=!1,this._cache=null,this._cacheSize=-1,this.name=t.name,this.container=e,this.def=t}setCacheSize(e,t){e&&(e==="*"?e=Uc.maxCacheSize:ue(e)&&(e=parseInt(e,10)),(this._cacheSize===-1||!t)&&(this._cacheSize=e)),this._cacheSize>0?this._cache=[]:this._cache=null,this.isCaching=this._cacheSize>0}canReturnToCache(e){return this._cache!=null&&this._cache.length<this._cacheSize}tryReturnToCache(e){return this.canReturnToCache(e)?(this._cache.push(e),!0):!1}create(e){const t=this._cache;let n;return t!=null&&t.length>0?(n=t.pop(),n):(n=Rt.$view(this,e),n)}}Uc.maxCacheSize=65535;const aI=(()=>{const s=(e,t)=>e.document.createComment(t);return e=>{const t=s(e,"au-end");return t.$start=s(e,"au-start"),t}})(),da=(s,e,t)=>{if(s===null)return;const n=t.length;let i=0;for(;n>i;)s.insertBefore(t[i],e),++i},pv=(s,e)=>new s.ownerDocument.defaultView.MutationObserver(e),cI=s=>s.nodeType===1,gv="default",lI="au-slot",mv=ye("IAuSlotsInfo");class vv{constructor(e){this.projectedSlots=e}}const hI=ye("IAuSlotWatcher");class Fc{static create(e,t,n,i,r,o,a,c){const l=[],h=i.renderers,u=f=>{let p=f,m=e;for(;m!=null&&p>0;)m=m.parent,--p;if(m==null)throw N(9999);return m},d=f=>{var S;const p=u(f),m=new Fc(p),g=r.compileSpread(p.controller.definition,((S=p.instruction)==null?void 0:S.captures)??ie,p.controller.container,t,n);let v;for(v of g)switch(v.type){case Ye.spreadTransferedBinding:d(f+1);break;case Ye.spreadElementProp:h[v.instruction.type].render(m,Ts(t),v.instruction,o,a,c);break;default:h[v.type].render(m,t,v,o,a,c)}l.push(m)};return d(0),l}get container(){return this.locator}get definition(){return this.$controller.definition}get state(){return this.$controller.state}constructor(e){this.isBound=!1,this._innerBindings=[],this.locator=(this.$controller=(this._hydrationContext=e).controller).container}get(e){return this.locator.get(e)}bind(e){if(this.isBound)return;this.isBound=!0;const t=this.scope=this._hydrationContext.controller.scope.parent??void 0;if(t==null)throw N(9999);this._innerBindings.forEach(n=>n.bind(t))}unbind(){this._innerBindings.forEach(e=>e.unbind()),this.isBound=!1}addBinding(e){this._innerBindings.push(e)}addChild(e){if(e.vmKind!==ms)throw N(9998);this.$controller.addChild(e)}}class On{constructor(e,t,n,i,r,o,a){this.target=t,this.targetKeys=n,this.ast=i,this.isBound=!1,this._scope=void 0,this.boundFn=!1,this._bindingCache={},this._scopeCache=new WeakMap,this._controller=e,this.oL=r,this.l=o,this._taskQueue=a}updateTarget(){this.obs.version++;const e=$e(this.ast,this._scope,this,this);this.obs.clear(),this._createBindings(e,!0)}handleChange(){this.isBound&&this.updateTarget()}handleCollectionChange(){this.isBound&&this.updateTarget()}bind(e){if(this.isBound){if(e===this._scope)return;this.unbind()}this.isBound=!0,this._scope=e,es(this.ast,e,this);const t=$e(this.ast,e,this,this);this._createBindings(t,!1)}unbind(){if(!this.isBound)return;this.isBound=!1,ts(this.ast,this._scope,this),this._scope=void 0;let e;for(e in this._bindingCache)this._bindingCache[e].unbind()}_createBindings(e,t){var o,a;let n;if(!hr(e)){console.warn(`[DEV:aurelia] $bindable spread is given a non object for properties: "${this.targetKeys.join(", ")}" of ${this.target.constructor.name}`);for(n in this._bindingCache)(o=this._bindingCache[n])==null||o.unbind();return}let i,r=this._scopeCache.get(e);r==null&&this._scopeCache.set(e,r=rt.fromParent(this._scope,e));for(n of this.targetKeys)i=this._bindingCache[n],n in e?(i==null&&(i=this._bindingCache[n]=new Et(this._controller,this.l,this.oL,this._taskQueue,(a=On._astCache)[n]??(a[n]=new bo(n,0)),this.target,n,Wr.toView)),i.bind(r)):t&&(i==null||i.unbind())}}On.mix=ns(()=>{js(On),zs(On,()=>"updateTarget"),Jn(On,null),Ni(!0,!1)(On)});On._astCache={};const hp=(s,e,t,n)=>{s.addEventListener(e,t,n)},up=(s,e,t,n)=>{s.removeEventListener(e,t,n)},qu=s=>{let e;const t=s.prototype;gn(t,"subscribe",function(n){var i;if(this.subs.add(n)&&this.subs.count===1){for(e of this._config.events)hp(this._el,e,this);this._listened=!0,(i=this._start)==null||i.call(this)}}),gn(t,"unsubscribe",function(n){var i;if(this.subs.remove(n)&&this.subs.count===0){for(e of this._config.events)up(this._el,e,this);this._listened=!1,(i=this._stop)==null||i.call(this)}}),gn(t,"useConfig",function(n){if(this._config=n,this._listened){for(e of this._config.events)up(this._el,e,this);for(e of this._config.events)hp(this._el,e,this)}})},Kc=s=>{gn(s.prototype,"subscribe",gi),gn(s.prototype,"unsubscribe",gi)};class Vc{get doNotCache(){return!0}constructor(e,t={}){this.obj=e,this.mapping=t,this.type=Zi|ti,this._value="",this._nameIndex={},this._version=0}getValue(){return this._value}setValue(e){e!==this._value&&(this._value=e,this._flushChanges())}_flushChanges(){const e=this._nameIndex,t=++this._version,n=this.obj.classList,i=yv(this._value),r=i.length;let o=0,a;if(r>0)for(;o<r;o++)a=i[o],a=this.mapping[a]||a,a.length!==0&&(e[a]=this._version,n.add(a));if(t!==1)for(a in e)a=this.mapping[a]||a,e[a]!==t&&n.remove(a)}}Kc(Vc);function yv(s){if(ue(s))return dp(s);if(typeof s!="object")return ie;if(ze(s)){const n=s.length;if(n>0){const i=[];let r=0;for(;n>r;++r)i.push(...yv(s[r]));return i}else return ie}const e=[];let t;for(t in s)s[t]&&(t.includes(" ")?e.push(...dp(t)):e.push(t));return e}function dp(s){const e=s.match(/\S+/g);return e===null?ie:e}const _v=s=>({$isResolver:!0,resolve(e,t){return t.get(xs).controller.container.get(dC(s))}}),bv=ye("IRenderer");function at(s,e){var n;const t=s[n=Symbol.metadata]??(s[n]=Object.create(null));return t[Qn]={register(i){ni(bv,s).register(i)}},s}function Gn(s,e,t){return ue(e)?s.parse(e,t):e}function jc(s){return s.viewModel!=null?s.viewModel:s}function uI(s,e){if(e==="element")return s;switch(e){case"controller":return Ts(s);case"view":throw N(750);case"component":return Ts(s).viewModel;default:{const t=hv(s,e);if(t!==void 0)return t.viewModel;const n=Ts(s,{name:e});if(n===void 0)throw N(751,e);return n.viewModel}}}const dI=at(class{constructor(){this.target=Ye.setProperty}render(e,t,n){var r;const i=jc(t);((r=i.$observers)==null?void 0:r[n.to])!==void 0?i.$observers[n.to].setValue(n.value):i[n.to]=n.value}}),fI=at(class{constructor(){this._rendering=k(qs),this.target=Ye.hydrateElement}render(e,t,n,i,r,o){let a,c,l;const h=n.res,u=n.projections,d=e.container;switch(typeof h){case"string":if(a=oe.find(d,h),a==null)throw N(752,n,e);break;default:a=h}const p=n.containerless||a.containerless?Bo(t):null,m=$I(i,e,t,n,p,u==null?void 0:new vv(xu(u)));c=m.invoke(a.Type),l=Rt.$el(m,c,t,n,a,p),Tt(t,a.key,l);const g=this._rendering.renderers,v=n.props,S=v.length;let R=0,C;for(;S>R;)C=v[R],g[C.type].render(e,l,C,i,r,o),++R;e.addChild(l)}}),pI=at(class{constructor(){this._rendering=k(qs),this.target=Ye.hydrateAttribute}render(e,t,n,i,r,o){let a=e.container,c;switch(typeof n.res){case"string":if(c=Oi.find(a,n.res),c==null)throw N(753,n,e);break;default:c=n.res}const l=Tv(i,c,e,t,n,void 0,void 0),h=Rt.$attr(l.ctn,l.vm,t,c);Tt(t,c.key,h);const u=this._rendering.renderers,d=n.props,f=d.length;let p=0,m;for(;f>p;)m=d[p],u[m.type].render(e,h,m,i,r,o),++p;e.addChild(h)}}),gI=at(class{constructor(){this._rendering=k(qs),this.target=Ye.hydrateTemplateController}render(e,t,n,i,r,o){var S,R;let a=e.container,c;switch(typeof n.res){case"string":if(c=Oi.find(a,n.res),c==null)throw N(754,n,e);break;default:c=n.res}const l=this._rendering.getViewFactory(n.def,c.containerStrategy==="new"?a.createChild({inheritParentResources:!0}):a),h=Bo(t),u=Tv(i,c,e,t,n,l,h),d=Rt.$attr(u.ctn,u.vm,t,c);Tt(h,c.key,d),(R=(S=u.vm).link)==null||R.call(S,e,d,t,n);const f=this._rendering.renderers,p=n.props,m=p.length;let g=0,v;for(;m>g;)v=p[g],f[v.type].render(e,d,v,i,r,o),++g;e.addChild(d)}}),mI=at(class{constructor(){this.target=Ye.hydrateLetElement,bs.mix()}render(e,t,n,i,r,o){t.remove();const a=n.instructions,c=n.toBindingContext,l=e.container,h=a.length;let u,d,f=0;for(;h>f;)u=a[f],d=Gn(r,u.from,qn),e.addBinding(new bs(l,o,d,u.to,c)),++f}}),vI=at(class{constructor(){this.target=Ye.refBinding}render(e,t,n,i,r){e.addBinding(new Th(e.container,Gn(r,n.from,qn),uI(t,n.to)))}}),yI=at(class{constructor(){this.target=Ye.interpolation,ys.mix()}render(e,t,n,i,r,o){const a=e.container,c=new nI(e,a,o,i.domQueue,Gn(r,n.from,OT),jc(t),n.to,Fe);if(n.to==="class"&&c.target.nodeType>0){const l=a.get(_v(Ya));c.useAccessor(new Vc(c.target,l))}e.addBinding(c)}}),_I=at(class{constructor(){this.target=Ye.propertyBinding,Et.mix()}render(e,t,n,i,r,o){const a=e.container,c=new Et(e,a,o,i.domQueue,Gn(r,n.from,qn),jc(t),n.to,n.mode);if(n.to==="class"&&c.target.nodeType>0){const l=a.get(_v(Ya));c.useTargetObserver(new Vc(c.target,l))}e.addBinding(c)}}),bI=at(class{constructor(){this.target=Ye.iteratorBinding,Et.mix()}render(e,t,n,i,r,o){e.addBinding(new Et(e,e.container,o,i.domQueue,Gn(r,n.forOf,NT),jc(t),n.to,Fe))}}),wI=at(class{constructor(){this.target=Ye.textBinding,_s.mix()}render(e,t,n,i,r,o){e.addBinding(new _s(e,e.container,o,i.domQueue,i,Gn(r,n.from,qn),t))}}),CI=ye("IListenerBindingOptions",s=>s.instance({prevent:!1})),SI=at(class{constructor(){this.target=Ye.listenerBinding,this._modifierHandler=k(fv),this._defaultOptions=k(CI),pr.mix()}render(e,t,n,i,r){e.addBinding(new pr(e.container,Gn(r,n.from,MT),t,n.to,new rI(this._defaultOptions.prevent,n.capture),this._modifierHandler.getHandler(n.to,n.modifier)))}}),AI=at(class{constructor(){this.target=Ye.setAttribute}render(e,t,n){t.setAttribute(n.to,n.value)}}),TI=at(class{constructor(){this.target=Ye.setClassAttribute}render(e,t,n){MI(t.classList,n.value)}}),II=at(class{constructor(){this.target=Ye.setStyleAttribute}render(e,t,n){t.style.cssText+=n.value}}),kI=["height","width","border-width","padding","padding-left","padding-right","padding-top","padding-right","padding-inline","padding-block","margin","margin-left","margin-right","margin-top","margin-bottom","margin-inline","margin-block","top","right","bottom","left"],EI=at(class{constructor(){this.target=Ye.stylePropertyBinding,Et.mix()}render(e,t,n,i,r,o){if(kI.includes(n.to)){e.addBinding(new RI(e,e.container,o,i.domQueue,Gn(r,n.from,qn),t.style,n.to,Fe));return}e.addBinding(new Et(e,e.container,o,i.domQueue,Gn(r,n.from,qn),t.style,n.to,Fe))}});class RI extends Et{updateTarget(e){return typeof e=="number"&&e>0&&console.warn(`[DEV]: Setting number ${e} as value for style.${this.targetProperty}. Did you meant "${e}px"?`),super.updateTarget(e)}}const PI=at(class{constructor(){this.target=Ye.attributeBinding,vs.mix()}render(e,t,n,i,r,o){const a=e.container,c=a.has(Ya,!1)?a.get(Ya):null;e.addBinding(new vs(e,a,o,i.domQueue,Gn(r,n.from,qn),t,n.attr,c==null?n.to:n.to.split(/\s/g).map(l=>c[l]??l).join(" "),Fe))}}),OI=at(class{constructor(){this._compiler=k(xc),this._rendering=k(qs),this.target=Ye.spreadTransferedBinding}render(e,t,n,i,r,o){Fc.create(e.container.get(xs),t,void 0,this._rendering,this._compiler,i,r,o).forEach(a=>e.addBinding(a))}}),NI=at(class{constructor(){this.target=Ye.spreadValueBinding,On.mix()}render(e,t,n,i,r,o){const a=n.target;if(a==="$bindables")e.addBinding(new On(e,t.viewModel,xu(t.definition.bindables),r.parse(n.from,qn),o,e.container,i.domQueue));else throw N(820,a)}});function MI(s,e){const t=e.length;let n=0;for(let i=0;i<t;++i)e.charCodeAt(i)===32?(i!==n&&s.add(e.slice(n,i)),n=i+1):i+1===t&&s.add(e.slice(n))}const wv="IController",Cv="IInstruction",xI="IRenderLocation",Sv="ISlotsInfo";function $I(s,e,t,n,i,r){const o=e.container.createChild();return qc(o,t,s),Oe(o,na,new Qe(wv,e)),Oe(o,Vs,new Qe(Cv,n)),Oe(o,Ot,i==null?kv:new Iv(i)),Oe(o,Gt,Ev),Oe(o,mv,r==null?Rv:new Qe(Sv,r)),o}class Av{get $isResolver(){return!0}constructor(e){this.f=e}resolve(){const e=this.f;if(e===null)throw N(755);if(!ue(e.name)||e.name.length===0)throw N(756);return e}}function Tv(s,e,t,n,i,r,o,a){const c=t instanceof Rt?t:t.$controller,l=c.container.createChild();return qc(l,n,s),Oe(l,na,new Qe(wv,c)),Oe(l,Vs,new Qe(Cv,i)),Oe(l,Ot,o==null?kv:new Qe(xI,o)),Oe(l,Gt,r==null?Ev:new Av(r)),Oe(l,mv,Rv),{vm:l.invoke(e.Type),ctn:l}}class Iv{get name(){return"IRenderLocation"}get $isResolver(){return!0}constructor(e){this._location=e}resolve(){return this._location}}const kv=new Iv(null),Ev=new Av(null),Rv=new Qe(Sv,new vv(ie)),qs=ye("IRendering",s=>s.singleton(LI));class LI{get renderers(){return this._renderers??(this._renderers=this._ctn.getAll(bv,!1).reduce((e,t)=>{var n;return e[t.target]!==void 0&&console.warn(`[DEV:aurelia] Renderer for target ${t.target} already exists.`),e[n=t.target]??(e[n]=t),e},be()))}constructor(){this._compilationCache=new WeakMap,this._fragmentCache=new WeakMap;const e=this._ctn=k(Ri).root,t=this._platform=e.get(_t);this._exprParser=e.get(Zo),this._observerLocator=e.get(qr),this._marker=t.document.createElement("au-m"),this._empty=new Rl(t,t.document.createDocumentFragment())}compile(e,t){const n=t.get(xc),i=this._compilationCache;let r=i.get(e);return r==null&&i.set(e,r=xt.create(e.needsCompile?n.compile(e,t):e)),r}getViewFactory(e,t){return new Uc(t,xt.getOrCreate(e))}createNodes(e){if(e.enhance===!0)return new Rl(this._platform,this._transformMarker(e.template));let t,n=!1;const i=this._fragmentCache,r=this._platform,o=r.document;if(i.has(e))t=i.get(e);else{const a=e.template;let c;a==null?t=null:a instanceof r.Node?a.nodeName==="TEMPLATE"?(t=a.content,n=!0):(t=o.createDocumentFragment()).appendChild(a.cloneNode(!0)):(c=o.createElement("template"),ue(a)&&(c.innerHTML=a),t=c.content,n=!0),this._transformMarker(t),i.set(e,t)}return t==null?this._empty:new Rl(this._platform,n?o.importNode(t,!0):o.adoptNode(t.cloneNode(!0)))}render(e,t,n,i){const r=n.instructions,o=this.renderers,a=t.length;let c=0,l=0,h=r.length,u,d,f;if(a!==h)throw N(757,a,h);if(a>0)for(;a>c;){for(u=r[c],f=t[c],l=0,h=u.length;h>l;)d=u[l],o[d.type].render(e,f,d,this._platform,this._exprParser,this._observerLocator),++l;++c}if(i!=null&&(u=n.surrogates,(h=u.length)>0))for(l=0;h>l;)d=u[l],o[d.type].render(e,i,d,this._platform,this._exprParser,this._observerLocator),++l}_transformMarker(e){if(e==null)return null;const t=this._platform.document.createTreeWalker(e,128);let n;for(;(n=t.nextNode())!=null;)n.nodeValue==="au*"&&n.parentNode.replaceChild(t.currentNode=this._marker.cloneNode(),n);return e}}const fp=ye("IShadowDOMStyles"),DI=ye("IShadowDOMGlobalStyles",s=>s.instance({applyTo:gi})),{enter:BI,exit:HI}=iA,{wrap:UI,unwrap:FI}=UA;class Pv{get value(){return this._value}constructor(e,t,n,i,r){this.obj=e,this.$get=n,this.useProxy=r,this.isBound=!1,this.running=!1,this._value=void 0,this._callback=i,this.oL=t}handleChange(){this.run()}handleCollectionChange(){this.run()}bind(){this.isBound||(this.compute(),this.isBound=!0)}unbind(){this.isBound&&(this.isBound=!1,this.obs.clearAll())}run(){if(!this.isBound||this.running)return;const e=this.obj,t=this._value,n=this.compute();Es(n,t)||this._callback.call(e,n,t,e)}compute(){this.running=!0,this.obs.version++;try{return BI(this),this._value=FI(this.$get.call(void 0,this.useProxy?UI(this.obj):this.obj,this))}finally{this.obs.clear(),this.running=!1,HI(this)}}}Jn(Pv,null);class Ih{get value(){return this._value}constructor(e,t,n,i,r){this.scope=e,this.l=t,this.oL=n,this.isBound=!1,this.boundFn=!1,this.obj=e.bindingContext,this._expression=i,this._callback=r}handleChange(e){const t=this._expression,n=this.obj,i=this._value;t.$kind==="AccessScope"&&this.obs.count===1||(this.obs.version++,e=$e(t,this.scope,this,this),this.obs.clear()),Es(e,i)||(this._value=e,this._callback.call(n,e,i,n))}bind(){this.isBound||(this.obs.version++,this._value=$e(this._expression,this.scope,this,this),this.obs.clear(),this.isBound=!0)}unbind(){this.isBound&&(this.isBound=!1,this.obs.clearAll(),this._value=void 0)}}Jn(Ih,null),Ni(!0)(Ih);class Rt{get lifecycleHooks(){return this._lifecycleHooks}get isActive(){return(this.state&(Kt|ws))>0&&(this.state&ko)===0}get name(){var e;if(this.parent===null)switch(this.vmKind){case ms:return`[${this.definition.name}]`;case Yt:return this.definition.name;case ft:return this.viewFactory.name}switch(this.vmKind){case ms:return`${this.parent.name}>[${this.definition.name}]`;case Yt:return`${this.parent.name}>${this.definition.name}`;case ft:return this.viewFactory.name===((e=this.parent.definition)==null?void 0:e.name)?`${this.parent.name}[view]`:`${this.parent.name}[view:${this.viewFactory.name}]`}}get viewModel(){return this._vm}set viewModel(e){this._vm=e,this._vmHooks=e==null||this.vmKind===ft?gr.none:new gr(e)}constructor(e,t,n,i,r,o,a){this.container=e,this.vmKind=t,this.definition=n,this.viewFactory=i,this.host=o,this.head=null,this.tail=null,this.next=null,this.parent=null,this.bindings=null,this.children=null,this.hasLockedScope=!1,this.scope=null,this.isBound=!1,this._isBindingDone=!1,this.hostController=null,this.mountTarget=Ov,this.shadowRoot=null,this.nodes=null,this.location=null,this._lifecycleHooks=null,this.state=Il,this._fullyNamed=!1,this.$initiator=null,this.$resolve=void 0,this.$reject=void 0,this.$promise=void 0,this._activatingStack=0,this._detachingStack=0,this._unbindingStack=0,this._vm=r,this._vmHooks=t===ft?gr.none:new gr(r),this.logger=null,this.debug=!1,this.location=a,this._rendering=e.root.get(qs),this.coercion=t===ft?void 0:e.get(jI)}static getCached(e){return xi.get(e)}static getCachedOrThrow(e){const t=Rt.getCached(e);if(t===void 0)throw N(500,e);return t}static $el(e,t,n,i,r=void 0,o=null){if(xi.has(t))return xi.get(t);if(r==null)try{r=Lv(t.constructor)}catch(l){throw console.error(`[DEV:aurelia] Custom element definition not found for creating a controller with host: <${n.nodeName} /> and component ${t.constructor.name||"(Anonymous) class"}`),l}Oe(e,r.Type,new Qe(r.key,t,r.Type));const a=new Rt(e,Yt,r,null,t,n,o),c=e.get(Rg(xs));return r.dependencies.length>0&&e.register(...r.dependencies),Oe(e,xs,new Qe("IHydrationContext",new Nv(a,i,c))),xi.set(t,a),(i==null||i.hydrate!==!1)&&a._hydrateCustomElement(i,c),a}static $attr(e,t,n,i){if(xi.has(t))return xi.get(t);i=i??Uu(t.constructor),Oe(e,i.Type,new Qe(i.key,t,i.Type));const r=new Rt(e,ms,i,null,t,n,null);return i.dependencies.length>0&&e.register(...i.dependencies),xi.set(t,r),r._hydrateCustomAttribute(),r}static $view(e,t=void 0){const n=new Rt(e.container,ft,null,e,null,null,null);return n.parent=t??null,n._hydrateSynthetic(),n}_hydrateCustomElement(e,t){this.logger=this.container.get(ji).root,this.debug=this.logger.config.level<=vC.debug,this.debug&&(this.logger=this.logger.scopeTo(this.name));const n=this.container,i=this._vm,r=this.definition;this.scope=rt.create(i,null,!0),r.watches.length>0&&mp(this,n,r,i),pp(this,r,i),this._lifecycleHooks=cp.resolve(n),n.register(r.Type),r.injectable!==null&&Oe(n,r.injectable,new Qe("definition.injectable",i)),(e==null||e.hydrate!==!1)&&(this._hydrate(),this._hydrateChildren())}_hydrate(){this._lifecycleHooks.hydrating!=null&&this._lifecycleHooks.hydrating.forEach(YI,this),this._vmHooks._hydrating&&(this.debug&&this.logger.trace("invoking hydrating() hook"),this._vm.hydrating(this));const e=this.definition,t=this._compiledDef=this._rendering.compile(e,this.container),n=t.shadowOptions,i=t.hasSlots,r=t.containerless;let o=this.host,a=this.location;if((this.hostController=Ts(o,VI))!==null&&(o=this.host=this.container.root.get(_t).document.createElement(e.name),r&&a==null&&(a=this.location=Bo(o))),Tt(o,ht,this),Tt(o,e.key,this),n!==null||i){if(a!=null)throw N(501);Tt(this.shadowRoot=o.attachShadow(n??GI),ht,this),Tt(this.shadowRoot,e.key,this),this.mountTarget=ps}else a!=null?(Tt(a,ht,this),Tt(a,e.key,this),this.mountTarget=gs):this.mountTarget=fs;this._vm.$controller=this,this.nodes=this._rendering.createNodes(t),this._lifecycleHooks.hydrated!==void 0&&this._lifecycleHooks.hydrated.forEach(JI,this),this._vmHooks._hydrated&&(this.debug&&this.logger.trace("invoking hydrated() hook"),this._vm.hydrated(this))}_hydrateChildren(){this._rendering.render(this,this.nodes.findTargets(),this._compiledDef,this.host),this._lifecycleHooks.created!==void 0&&this._lifecycleHooks.created.forEach(vp,this),this._vmHooks._created&&(this.debug&&this.logger.trace("invoking created() hook"),this._vm.created(this))}_hydrateCustomAttribute(){const e=this.definition,t=this._vm;e.watches.length>0&&mp(this,this.container,e,t),pp(this,e,t),t.$controller=this,this._lifecycleHooks=cp.resolve(this.container),this._lifecycleHooks.created!==void 0&&this._lifecycleHooks.created.forEach(vp,this),this._vmHooks._created&&(this.debug&&this.logger.trace("invoking created() hook"),this._vm.created(this))}_hydrateSynthetic(){this._compiledDef=this._rendering.compile(this.viewFactory.def,this.container),this._rendering.render(this,(this.nodes=this._rendering.createNodes(this._compiledDef)).findTargets(),this._compiledDef,void 0)}activate(e,t,n){switch(this.state){case Il:case mr:if(!(t===null||t.isActive))return;this.state=Kt;break;case ws:return;case Di:throw N(502,this.name);default:throw N(503,this.name,WI(this.state))}switch(this.parent=t,this.debug&&!this._fullyNamed&&(this._fullyNamed=!0,(this.logger??(this.logger=this.container.get(ji).root.scopeTo(this.name))).trace("activate()")),this.vmKind){case Yt:this.scope.parent=n??null;break;case ms:this.scope=n??null;break;case ft:if(n==null)throw N(504,this.name);this.hasLockedScope||(this.scope=n);break}this.$initiator=e,this._enterActivating();let i;return this.vmKind!==ft&&this._lifecycleHooks.binding!=null&&(this.debug&&this.logger.trace("lifecycleHooks.binding()"),i=Je(...this._lifecycleHooks.binding.map(XI,this))),this._vmHooks._binding&&(this.debug&&this.logger.trace("binding()"),i=Je(i,this._vm.binding(this.$initiator,this.parent))),Ve(i)?(this._ensurePromise(),i.then(()=>{this._isBindingDone=!0,this.state!==Kt?this._leaveActivating():this.bind()}).catch(r=>{this._reject(r)}),this.$promise):(this._isBindingDone=!0,this.bind(),this.$promise)}bind(){this.debug&&this.logger.trace("bind()");let e=0,t=0,n;if(this.bindings!==null)for(e=0,t=this.bindings.length;t>e;)this.bindings[e].bind(this.scope),++e;if(this.vmKind!==ft&&this._lifecycleHooks.bound!=null&&(this.debug&&this.logger.trace("lifecycleHooks.bound()"),n=Je(...this._lifecycleHooks.bound.map(ZI,this))),this._vmHooks._bound&&(this.debug&&this.logger.trace("bound()"),n=Je(n,this._vm.bound(this.$initiator,this.parent))),Ve(n)){this._ensurePromise(),n.then(()=>{this.isBound=!0,this.state!==Kt?this._leaveActivating():this._attach()}).catch(i=>{this._reject(i)});return}this.isBound=!0,this._attach()}_append(...e){switch(this.mountTarget){case fs:this.host.append(...e);break;case ps:this.shadowRoot.append(...e);break;case gs:{let t=0;for(;t<e.length;++t)this.location.parentNode.insertBefore(e[t],this.location);break}}}_attach(){if(this.debug&&this.logger.trace("attach()"),this.hostController!==null)switch(this.mountTarget){case fs:case ps:this.hostController._append(this.host);break;case gs:this.hostController._append(this.location.$start,this.location);break}switch(this.mountTarget){case fs:this.nodes.appendTo(this.host,this.definition!=null&&this.definition.enhance);break;case ps:{const n=this.container;(n.has(fp,!1)?n.get(fp):n.get(DI)).applyTo(this.shadowRoot),this.nodes.appendTo(this.shadowRoot);break}case gs:this.nodes.insertBefore(this.location);break}let e=0,t;if(this.vmKind!==ft&&this._lifecycleHooks.attaching!=null&&(this.debug&&this.logger.trace("lifecycleHooks.attaching()"),t=Je(...this._lifecycleHooks.attaching.map(ek,this))),this._vmHooks._attaching&&(this.debug&&this.logger.trace("attaching()"),t=Je(t,this._vm.attaching(this.$initiator,this.parent))),Ve(t)&&(this._ensurePromise(),this._enterActivating(),t.then(()=>{this._leaveActivating()}).catch(n=>{this._reject(n)})),this.children!==null)for(;e<this.children.length;++e)this.children[e].activate(this.$initiator,this,this.scope);this._leaveActivating()}deactivate(e,t){var o;let n;switch(this.state&~vr){case ws:this.state=ko;break;case Kt:this.state=ko,n=(o=this.$promise)==null?void 0:o.catch(a=>{this.logger.warn("The activation error will be ignored, as the controller is already scheduled for deactivation. The activation was rejected with: %s",a)});break;case Il:case mr:case Di:case mr|Di:return;default:throw N(505,this.name,this.state)}this.debug&&this.logger.trace("deactivate()"),this.$initiator=e,e===this&&this._enterDetaching();let i=0,r;if(this.children!==null)for(i=0;i<this.children.length;++i)this.children[i].deactivate(e,this);return X(n,()=>{if(this.isBound&&(this.vmKind!==ft&&this._lifecycleHooks.detaching!=null&&(this.debug&&this.logger.trace("lifecycleHooks.detaching()"),r=Je(...this._lifecycleHooks.detaching.map(nk,this))),this._vmHooks._detaching&&(this.debug&&this.logger.trace("detaching()"),r=Je(r,this._vm.detaching(this.$initiator,this.parent)))),Ve(r)&&(this._ensurePromise(),e._enterDetaching(),r.then(()=>{e._leaveDetaching()}).catch(a=>{e._reject(a)})),e.head===null?e.head=this:e.tail.next=this,e.tail=this,e===this)return this._leaveDetaching(),this.$promise})}removeNodes(){switch(this.vmKind){case Yt:case ft:this.nodes.remove(),this.nodes.unlink()}if(this.hostController!==null)switch(this.mountTarget){case fs:case ps:this.host.remove();break;case gs:this.location.$start.remove(),this.location.remove();break}}unbind(){this.debug&&this.logger.trace("unbind()");let e=0;if(this.bindings!==null)for(;e<this.bindings.length;++e)this.bindings[e].unbind();switch(this.parent=null,this.vmKind){case ms:this.scope=null;break;case ft:this.hasLockedScope||(this.scope=null),(this.state&vr)===vr&&!this.viewFactory.tryReturnToCache(this)&&this.$initiator===this&&this.dispose();break;case Yt:this.scope.parent=null;break}this.state=mr,this.$initiator=null,this._resolve()}_ensurePromise(){this.$promise===void 0&&(this.$promise=new Promise((e,t)=>{this.$resolve=e,this.$reject=t}),this.$initiator!==this&&this.parent._ensurePromise())}_resolve(){this.$promise!==void 0&&(kl=this.$resolve,this.$resolve=this.$reject=this.$promise=void 0,kl(),kl=void 0)}_reject(e){this.$promise!==void 0&&(El=this.$reject,this.$resolve=this.$reject=this.$promise=void 0,El(e),El=void 0),this.$initiator!==this&&this.parent._reject(e)}_enterActivating(){++this._activatingStack,this.$initiator!==this&&this.parent._enterActivating()}_leaveActivating(){if(this.state!==Kt){--this._activatingStack,this._resolve(),this.$initiator!==this&&this.parent._leaveActivating();return}if(--this._activatingStack===0){if(this.vmKind!==ft&&this._lifecycleHooks.attached!=null&&(ls=Je(...this._lifecycleHooks.attached.map(tk,this))),this._vmHooks._attached&&(this.debug&&this.logger.trace("attached()"),ls=Je(ls,this._vm.attached(this.$initiator))),Ve(ls)){this._ensurePromise(),ls.then(()=>{this.state=ws,this._resolve(),this.$initiator!==this&&this.parent._leaveActivating()}).catch(e=>{this._reject(e)}),ls=void 0;return}ls=void 0,this.state=ws,this._resolve()}this.$initiator!==this&&this.parent._leaveActivating()}_enterDetaching(){++this._detachingStack}_leaveDetaching(){if(--this._detachingStack===0){this.debug&&this.logger.trace("detach()"),this._enterUnbinding(),this.removeNodes();let e=this.$initiator.head,t;for(;e!==null;)e!==this&&(e.debug&&e.logger.trace("detach()"),e.removeNodes()),e._isBindingDone&&(e.vmKind!==ft&&e._lifecycleHooks.unbinding!=null&&(t=Je(...e._lifecycleHooks.unbinding.map(ik,e))),e._vmHooks._unbinding&&(e.debug&&e.logger.trace("unbinding()"),t=Je(t,e.viewModel.unbinding(e.$initiator,e.parent)))),Ve(t)&&(this._ensurePromise(),this._enterUnbinding(),t.then(()=>{this._leaveUnbinding()}).catch(n=>{this._reject(n)})),t=void 0,e=e.next;this._leaveUnbinding()}}_enterUnbinding(){++this._unbindingStack}_leaveUnbinding(){if(--this._unbindingStack===0){this.debug&&this.logger.trace("unbind()");let e=this.$initiator.head,t=null;for(;e!==null;)e!==this&&(e._isBindingDone=!1,e.isBound=!1,e.unbind()),t=e.next,e.next=null,e=t;this.head=this.tail=null,this._isBindingDone=!1,this.isBound=!1,this.unbind()}}addBinding(e){this.bindings===null?this.bindings=[e]:this.bindings[this.bindings.length]=e}addChild(e){this.children===null?this.children=[e]:this.children[this.children.length]=e}is(e){switch(this.vmKind){case ms:case Yt:return this.definition.name===e;case ft:return this.viewFactory.name===e}}lockScope(e){this.scope=e,this.hasLockedScope=!0}setHost(e){return this.vmKind===Yt&&(Tt(e,ht,this),Tt(e,this.definition.key,this)),this.host=e,this.mountTarget=fs,this}setShadowRoot(e){return this.vmKind===Yt&&(Tt(e,ht,this),Tt(e,this.definition.key,this)),this.shadowRoot=e,this.mountTarget=ps,this}setLocation(e){return this.vmKind===Yt&&(Tt(e,ht,this),Tt(e,this.definition.key,this)),this.location=e,this.mountTarget=gs,this}release(){this.state|=vr}dispose(){this.debug&&this.logger.trace("dispose()"),(this.state&Di)!==Di&&(this.state|=Di,this._vmHooks._dispose&&this._vm.dispose(),this.children!==null&&(this.children.forEach(QI),this.children=null),this.hostController=null,this.scope=null,this.nodes=null,this.location=null,this.viewFactory=null,this._vm!==null&&(xi.delete(this._vm),this._vm=null),this._vm=null,this.host=null,this.shadowRoot=null,this.container.disposeResolvers())}accept(e){if(e(this)===!0||this._vmHooks._accept&&this._vm.accept(e)===!0)return!0;if(this.children!==null){const{children:t}=this;for(let n=0,i=t.length;n<i;++n)if(t[n].accept(e)===!0)return!0}}}const xi=new WeakMap,Ov=0,fs=1,ps=2,gs=3,KI=ei({none:Ov,host:fs,shadowRoot:ps,location:gs}),VI={optional:!0},jI=fC(Xg);function pp(s,e,t){var a,c;const n=e.bindables,i=Xm(n),r=i.length,o=s.container.get(qr);if(r>0)for(let l=0;l<r;++l){const h=i[l],u=n[h],d=u.callback,f=o.getObserver(t,h);if(u.set!==gi&&((a=f.useCoercer)==null?void 0:a.call(f,u.set,s.coercion))!==!0)throw N(507,h);if(t[d]!=null||t.propertyChanged!=null){const p=(m,g)=>{var v,S;s.isBound&&((v=t[d])==null||v.call(t,m,g),(S=t.propertyChanged)==null||S.call(t,h,m,g))};if(((c=f.useCallback)==null?void 0:c.call(f,p))!==!0)throw N(508,h)}}}const gp=new Map,zI=s=>{let e=gp.get(s);return e==null&&(e=new bo(s,0),gp.set(s,e)),e};function mp(s,e,t,n){const i=e.get(qr),r=e.get(Zo),o=t.watches,a=s.vmKind===Yt?s.scope:rt.create(n,null,!0),c=o.length;let l,h,u,d=0;for(;c>d;++d){if({expression:l,callback:h}=o[d],h=pe(h)?h:Reflect.get(n,h),!pe(h))throw N(506,h);pe(l)?s.addBinding(new Pv(n,i,l,h,!0)):(u=ue(l)?r.parse(l,qn):zI(l),s.addBinding(new Ih(a,e,i,u,h)))}}function qI(s){return eh(s)&&$v(s.constructor)}class gr{constructor(e){this._define="define"in e,this._hydrating="hydrating"in e,this._hydrated="hydrated"in e,this._created="created"in e,this._binding="binding"in e,this._bound="bound"in e,this._attaching="attaching"in e,this._attached="attached"in e,this._detaching="detaching"in e,this._unbinding="unbinding"in e,this._dispose="dispose"in e,this._accept="accept"in e}}gr.none=new gr({});const GI={mode:"open"},Yt="customElement",ms="customAttribute",ft="synthetic",Il=0,Kt=1,ws=2,ko=4,mr=8,vr=16,Di=32;function WI(s){const e=[];return(s&Kt)===Kt&&e.push("activating"),(s&ws)===ws&&e.push("activated"),(s&ko)===ko&&e.push("deactivating"),(s&mr)===mr&&e.push("deactivated"),(s&vr)===vr&&e.push("released"),(s&Di)===Di&&e.push("disposed"),e.length===0?"none":e.join("|")}const na=ye("IController"),xs=ye("IHydrationContext");class Nv{constructor(e,t,n){this.instruction=t,this.parent=n,this.controller=e}}function QI(s){s.dispose()}function vp(s){s.instance.created(this._vm,this)}function YI(s){s.instance.hydrating(this._vm,this)}function JI(s){s.instance.hydrated(this._vm,this)}function XI(s){return s.instance.binding(this._vm,this.$initiator,this.parent)}function ZI(s){return s.instance.bound(this._vm,this.$initiator,this.parent)}function ek(s){return s.instance.attaching(this._vm,this.$initiator,this.parent)}function tk(s){return s.instance.attached(this._vm,this.$initiator)}function nk(s){return s.instance.detaching(this._vm,this.$initiator,this.parent)}function ik(s){return s.instance.unbinding(this._vm,this.$initiator,this.parent)}let kl,El,ls;class sk{}function yr(s,e){var t;return((t=s.$au)==null?void 0:t[e])??null}function Tt(s,e,t){(s.$au??(s.$au=new sk))[e]=t}const is=ye("INode"),rk=ye("IEventTarget",s=>s.cachedCallback(e=>e.has(Ho,!0)?e.get(Ho).host:e.get(_t).document)),Ot=ye("IRenderLocation"),Ya=ye("ICssClassMapping"),Ja=new WeakMap;function Xa(s){if(Ja.has(s))return Ja.get(s);let e=0,t=s.nextSibling;for(;t!==null;){if(t.nodeType===8)switch(t.textContent){case"au-start":++e;break;case"au-end":if(e--===0)return t}t=t.nextSibling}if(s.parentNode===null&&s.nodeType===11){const n=Ts(s,{optional:!0});if(n==null)return null;if(n.mountTarget===KI.shadowRoot)return Xa(n.host)}return s.parentNode}function ok(s,e){if(s.platform!==void 0&&!(s instanceof s.platform.Node)){const t=s.childNodes;for(let n=0,i=t.length;n<i;++n)Ja.set(t[n],e)}else Ja.set(s,e)}function Bo(s){if(Mv(s))return s;const e=s.ownerDocument.createComment("au-end"),t=e.$start=s.ownerDocument.createComment("au-start"),n=s.parentNode;return n!==null&&(n.replaceChild(e,s),n.insertBefore(t,e)),e}function Mv(s){return s.textContent==="au-end"}class Rl{get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}constructor(e,t){this.platform=e,this.next=void 0,this._isMounted=!1,this._isLinked=!1,this.ref=null;const n=(this.f=t).querySelectorAll("au-m");let i=0,r=n.length,o=this.t=Array(r),a,c;for(;r>i;)c=n[i],a=c.nextSibling,c.remove(),a.nodeType===8&&(c=a,(a=a.nextSibling).$start=c),o[i]=a,++i;const l=t.childNodes,h=this.childNodes=Array(r=l.length);for(i=0;r>i;)h[i]=l[i],++i;this._firstChild=t.firstChild,this._lastChild=t.lastChild}findTargets(){return this.t}insertBefore(e){if(this._isLinked&&this.ref)this.addToLinked();else{const t=e.parentNode;if(this._isMounted){let n=this._firstChild,i;const r=this._lastChild;for(;n!=null&&(i=n.nextSibling,t.insertBefore(n,e),n!==r);)n=i}else this._isMounted=!0,e.parentNode.insertBefore(this.f,e)}}appendTo(e,t=!1){if(this._isMounted){let n=this._firstChild,i;const r=this._lastChild;for(;n!=null&&(i=n.nextSibling,e.appendChild(n),n!==r);)n=i}else this._isMounted=!0,t||e.appendChild(this.f)}remove(){if(this._isMounted){this._isMounted=!1;const e=this.f,t=this._lastChild;let n,i=this._firstChild;for(;i!==null&&(n=i.nextSibling,e.appendChild(i),i!==t);)i=n}}addToLinked(){const e=this.ref,t=e.parentNode;if(this._isMounted){let n=this._firstChild,i;const r=this._lastChild;for(;n!=null&&(i=n.nextSibling,t.insertBefore(n,e),n!==r);)n=i}else this._isMounted=!0,t.insertBefore(this.f,e)}unlink(){this._isLinked=!1,this.next=void 0,this.ref=void 0}link(e){this._isLinked=!0,Mv(e)?this.ref=e:(this.next=e,this._obtainRefNode())}_obtainRefNode(){this.next!==void 0?this.ref=this.next.firstChild:this.ref=void 0}}const zc=ye("IWindow",s=>s.callback(e=>e.get(_t).window)),ak=ye("ILocation",s=>s.callback(e=>e.get(zc).location)),ck=ye("IHistory",s=>s.callback(e=>e.get(zc).history)),qc=(s,e,t=s.get(_t))=>(Oe(s,t.HTMLElement,Oe(s,t.Element,Oe(s,is,new Qe("ElementResolver",e)))),s);function wn(s){return function(e,t){return t.addInitializer(function(){xv(s,this)}),e}}const Pl=new WeakMap;class xt{get type(){return FT}constructor(e,t,n,i,r,o,a,c,l,h,u,d,f,p,m,g,v,S){this.Type=e,this.name=t,this.aliases=n,this.key=i,this.capture=r,this.template=o,this.instructions=a,this.dependencies=c,this.injectable=l,this.needsCompile=h,this.surrogates=u,this.bindables=d,this.containerless=f,this.shadowOptions=p,this.hasSlots=m,this.enhance=g,this.watches=v,this.processContent=S}static create(e,t=null){if(t===null){const i=e;if(ue(i))throw N(761,e);const r=In("name",i,Za);pe(i.Type)?t=i.Type:t=Dv(Sg(r));for(const o of Object.values(Ut.from(i.bindables)))Ut._add(o,t);return new xt(t,r,We(i.aliases),In("key",i,()=>or(r)),ln("capture",i,t,Qt),In("template",i,Wt),We(i.instructions),We(Dt(t,"dependencies"),i.dependencies),In("injectable",i,Wt),In("needsCompile",i,Ol),We(i.surrogates),Ut.from(Dt(t,"bindables"),i.bindables),ln("containerless",i,t,Qt),In("shadowOptions",i,Wt),In("hasSlots",i,Qt),In("enhance",i,Qt),In("watches",i,hk),Tn("processContent",t,Wt))}if(ue(e))return new xt(t,e,We(Dt(t,"aliases"),t.aliases),or(e),Tn("capture",t,Qt),Tn("template",t,Wt),We(Dt(t,"instructions"),t.instructions),We(Dt(t,"dependencies"),t.dependencies),Tn("injectable",t,Wt),Tn("needsCompile",t,Ol),We(Dt(t,"surrogates"),t.surrogates),Ut.from(...Ut.getAll(t),Dt(t,"bindables"),t.bindables),Tn("containerless",t,Qt),Tn("shadowOptions",t,Wt),Tn("hasSlots",t,Qt),Tn("enhance",t,Qt),We(Sh.getDefinitions(t),t.watches),Tn("processContent",t,Wt));const n=In("name",e,Za);for(const i of Object.values(Ut.from(e.bindables)))Ut._add(i,t);return new xt(t,n,We(Dt(t,"aliases"),e.aliases,t.aliases),or(n),ln("capture",e,t,Qt),ln("template",e,t,Wt),We(Dt(t,"instructions"),e.instructions,t.instructions),We(Dt(t,"dependencies"),e.dependencies,t.dependencies),ln("injectable",e,t,Wt),ln("needsCompile",e,t,Ol),We(Dt(t,"surrogates"),e.surrogates,t.surrogates),Ut.from(...Ut.getAll(t),Dt(t,"bindables"),t.bindables,e.bindables),ln("containerless",e,t,Qt),ln("shadowOptions",e,t,Wt),ln("hasSlots",e,t,Qt),ln("enhance",e,t,Qt),We(e.watches,Sh.getDefinitions(t),t.watches),ln("processContent",e,t,Wt))}static getOrCreate(e){if(e instanceof xt)return e;if(Pl.has(e))return Pl.get(e);const t=xt.create(e);return Pl.set(e,t),bn(t,t.Type,ht),t}register(e,t){const n=this.Type,i=typeof t=="string"?or(t):this.key,r=this.aliases;if(e.has(i,!1)){console.warn(N(153,this.name));return}e.register(e.has(n,!1)?null:ni(n,n),Gi(n,i),...r.map(o=>Gi(n,or(o))))}toString(){return`au:ce:${this.name}`}}const lk={name:void 0,searchParents:!1,optional:!1},Wt=()=>null,Qt=()=>!1,Ol=()=>!0,hk=()=>ie,$s="custom-element",ht=ki($s),or=s=>`${ht}:${s}`,Za=(s=>()=>`unnamed-${++s}`)(0),uk=(s,e,t)=>{bn(t,s,Pi(e))},xv=(s,e)=>{const t=xt.create(s,e),n=t.Type;return bn(t,n,ht,xn),n},$v=s=>{var e;return pe(s)&&(Lc(ht,s)||((e=s.$au)==null?void 0:e.type)===$s)},Ts=(s,e=lk)=>{if(e.name===void 0&&e.searchParents!==!0){const n=yr(s,ht);if(n===null){if(e.optional===!0)return null;throw N(762,s)}return n}if(e.name!==void 0){if(e.searchParents!==!0){const r=yr(s,ht);if(r===null)throw N(763,s);return r.is(e.name)?r:void 0}let n=s,i=!1;for(;n!==null;){const r=yr(n,ht);if(r!==null&&(i=!0,r.is(e.name)))return r;n=Xa(n)}if(i)return;throw N(764,s)}let t=s;for(;t!==null;){const n=yr(t,ht);if(n!==null)return n;t=Xa(t)}throw N(765,s)},Dt=(s,e)=>wt(Pi(e),s),Lv=s=>{const e=wt(ht,s)??Wi(s,$s,xt.create);if(e==null)throw N(760,s);return e},dk=()=>{const s={$isInterface:!1,register(){return{$isResolver:!0,resolve(e,t){return t.has(s,!0)?t.get(s):null}}}};return s},Dv=function(){const s={value:"",writable:!1,enumerable:!1,configurable:!0},e={};return function(t,n=e){const i=class{};return s.value=t,Qa(i,"name",s),n!==e&&Jm(i.prototype,n),i}}(),oe=ei({name:ht,keyFrom:or,isType:$v,for:Ts,define:xv,getDefinition:Lv,annotate:uk,getAnnotation:Dt,generateName:Za,createInjectable:dk,generateType:Dv,find(s,e){const t=s.find($s,e);return t==null?null:wt(ht,t)??Wi(t,$s,xt.create)??null}}),Ho=ye("IAppRoot");class yp{get controller(){return this._controller}constructor(e,t,n,i=!1){this.config=e,this.container=t,this._hydratePromise=void 0,this._useOwnAppTasks=i;const r=this.host=e.host;n.prepare(this),Oe(t,rk,new Qe("IEventTarget",r)),qc(t,r,this.platform=this._createPlatform(t,r)),this._hydratePromise=X(this._runAppTasks("creating"),()=>{e.allowActionlessForm||r.addEventListener("submit",d=>{const f=d.target,p=!f.getAttribute("action");f.tagName==="FORM"&&p&&d.preventDefault()},!1);const o=i?t:t.createChild(),a=e.component;let c;pe(a)?c=o.invoke(a):c=e.component;const l={hydrate:!1,projections:null},h=i?xt.create({name:Za(),template:this.host,enhance:!0}):void 0,u=this._controller=Rt.$el(o,c,r,l,h);return u._hydrateCustomElement(l,null),X(this._runAppTasks("hydrating"),()=>(u._hydrate(),X(this._runAppTasks("hydrated"),()=>{u._hydrateChildren(),this._hydratePromise=void 0})))})}activate(){return X(this._hydratePromise,()=>X(this._runAppTasks("activating"),()=>X(this._controller.activate(this._controller,null,void 0),()=>this._runAppTasks("activated"))))}deactivate(){return X(this._runAppTasks("deactivating"),()=>X(this._controller.deactivate(this._controller,null),()=>this._runAppTasks("deactivated")))}_runAppTasks(e){const t=this.container,n=this._useOwnAppTasks&&!t.has(Ch,!1)?[]:t.getAll(Ch);return Je(...n.reduce((i,r)=>(r.slot===e&&i.push(r.run()),i),[]))}_createPlatform(e,t){let n;if(e.has(_t,!1))n=e.get(_t);else{if(t.ownerDocument.defaultView===null)throw N(769);n=new Ui(t.ownerDocument.defaultView),e.register(Du(_t,n))}return n}dispose(){var e;(e=this._controller)==null||e.dispose()}}const _p=ye("IAurelia");let fk=class kh{get isRunning(){return this._isRunning}get isStarting(){return this._isStarting}get isStopping(){return this._isStopping}get root(){if(this._root==null){if(this.next==null)throw N(767);return this.next}return this._root}constructor(e=sn.createContainer()){if(this.container=e,this._isRunning=!1,this._isStarting=!1,this._isStopping=!1,this._root=void 0,this.next=void 0,this._startPromise=void 0,this._stopPromise=void 0,e.has(_p,!0)||e.has(kh,!0))throw N(768);Oe(e,_p,new Qe("IAurelia",this)),Oe(e,kh,new Qe("Aurelia",this)),Oe(e,Ho,this._rootProvider=new Qe("IAppRoot"))}register(...e){return this.container.register(...e),this}app(e){return this.next=new yp(e,this.container,this._rootProvider),this}enhance(e){const t=e.container??this.container.createChild(),n=Oe(t,Ho,new Qe("IAppRoot")),i=new yp({host:e.host,component:e.component},t,n,!0);return X(i.activate(),()=>i)}async waitForIdle(){const e=this.root.platform;await e.domQueue.yield(),await e.taskQueue.yield()}start(e=this.next){if(e==null)throw N(770);return Ve(this._startPromise)?this._startPromise:this._startPromise=X(this.stop(),()=>(Reflect.set(e.host,"$aurelia",this),this._rootProvider.prepare(this._root=e),this._isStarting=!0,X(e.activate(),()=>{this._isRunning=!0,this._isStarting=!1,this._startPromise=void 0,this._dispatchEvent(e,"au-started",e.host)})))}stop(e=!1){if(Ve(this._stopPromise))return this._stopPromise;if(this._isRunning===!0){const t=this._root;return this._isRunning=!1,this._isStopping=!0,this._stopPromise=X(t.deactivate(),()=>{Reflect.deleteProperty(t.host,"$aurelia"),e&&t.dispose(),this._root=void 0,this._rootProvider.dispose(),this._isStopping=!1,this._dispatchEvent(t,"au-stopped",t.host)})}}dispose(){if(this._isRunning||this._isStopping)throw N(771);this.container.dispose()}_dispatchEvent(e,t,n){const i=new e.platform.window.CustomEvent(t,{detail:this,bubbles:!0,cancelable:!0});n.dispatchEvent(i)}};const Bv=ye("ISVGAnalyzer",s=>s.singleton(pk));class pk{isStandardSvgAttribute(e,t){return!1}}class Hv{constructor(){this.fns=[],this._tagAttrMap=be(),this._globalAttrMap=be(),this.svg=k(Bv),this.useMapping({LABEL:{for:"htmlFor"},IMG:{usemap:"useMap"},INPUT:{maxlength:"maxLength",minlength:"minLength",formaction:"formAction",formenctype:"formEncType",formmethod:"formMethod",formnovalidate:"formNoValidate",formtarget:"formTarget",inputmode:"inputMode"},TEXTAREA:{maxlength:"maxLength"},TD:{rowspan:"rowSpan",colspan:"colSpan"},TH:{rowspan:"rowSpan",colspan:"colSpan"}}),this.useGlobalMapping({accesskey:"accessKey",contenteditable:"contentEditable",tabindex:"tabIndex",textcontent:"textContent",innerhtml:"innerHTML",scrolltop:"scrollTop",scrollleft:"scrollLeft",readonly:"readOnly"})}useMapping(e){var o;let t,n,i,r;for(i in e){t=e[i],n=(o=this._tagAttrMap)[i]??(o[i]=be());for(r in t){if(n[r]!==void 0)throw bp(r,i);n[r]=t[r]}}}useGlobalMapping(e){const t=this._globalAttrMap;for(const n in e){if(t[n]!==void 0)throw bp(n,"*");t[n]=e[n]}}useTwoWay(e){this.fns.push(e)}isTwoWay(e,t){return gk(e,t)||this.fns.length>0&&this.fns.some(n=>n(e,t))}map(e,t){var n;return((n=this._tagAttrMap[e.nodeName])==null?void 0:n[t])??this._globalAttrMap[t]??(bh(e,t,this.svg)?t:null)}}Hv.register=Ec(om);function gk(s,e){switch(s.nodeName){case"INPUT":switch(s.type){case"checkbox":case"radio":return e==="checked";default:return e==="value"||e==="files"||e==="value-as-number"||e==="value-as-date"}case"TEXTAREA":case"SELECT":return e==="value";default:switch(e){case"textcontent":case"innerhtml":return s.hasAttribute("contenteditable");case"scrolltop":case"scrollleft":return!0;default:return!1}}}function bp(s,e){return N(719,s,e)}const mk={register(s){s.register(zm,Hv,Uv)}};class vk{constructor(e,t,n){this.attrs=e,this.bindables=t,this.primary=n}}class Uv{constructor(){this._resourceCache=new WeakMap,this._bindableCache=new WeakMap}el(e,t){let n=this._resourceCache.get(e);return n==null&&this._resourceCache.set(e,n=new wp),t in n._element?n._element[t]:n._element[t]=oe.find(e,t)}attr(e,t){let n=this._resourceCache.get(e);return n==null&&this._resourceCache.set(e,n=new wp),t in n._attr?n._attr[t]:n._attr[t]=Oi.find(e,t)}bindables(e){let t=this._bindableCache.get(e);if(t==null){const n=e.bindables,i=be();let r,o,a=!1,c,l;for(o in n){if(r=n[o],l=r.attribute,r.primary===!0){if(a)throw N(714,e);a=!0,c=r}else!a&&c==null&&(c=r);i[l]=di.create(o,r)}r==null&&e.type==="custom-attribute"&&(c=i.value=di.create("value",{mode:e.defaultBindingMode??Lu})),this._bindableCache.set(e,t=new vk(i,n,c??null))}return t}}Uv.register=Ec(qm);class wp{constructor(){this._element=be(),this._attr=be()}}const Nl=be();class Uo{static forNs(e){return Nl[e]??(Nl[e]=new Uo(e))}constructor(e){this.ns=e,this.type=Zi|ti}getValue(e,t){return e.getAttributeNS(this.ns,t)}setValue(e,t,n){e==null?t.removeAttributeNS(this.ns,n):t.setAttributeNS(this.ns,n,e)}}Kc(Uo);class Fv{constructor(){this.type=Zi|ti}getValue(e,t){return e.getAttribute(t)}setValue(e,t,n){e==null?t.removeAttribute(n):t.setAttribute(n,e)}}Kc(Fv);const xa=new Fv;class Is{static _getSelectedOptions(e){const t=[];if(e.length===0)return t;const n=e.length;let i=0,r;for(;n>i;)r=e[i],r.selected&&(t[t.length]=Cs.call(r,"model")?r.model:r.value),++i;return t}static _defaultMatcher(e,t){return e===t}constructor(e,t,n,i){this.type=Zi|$u|ti,this._value=void 0,this._oldValue=void 0,this._hasChanges=!1,this._arrayObserver=void 0,this._nodeObserver=void 0,this._observing=!1,this._listened=!1,this._el=e,this._observerLocator=i,this._config=n}getValue(){return this._observing?this._value:this._el.multiple?Is._getSelectedOptions(this._el.options):this._el.value}setValue(e){this._oldValue=this._value,this._value=e,this._hasChanges=e!==this._oldValue,this._observeArray(e instanceof Array?e:null),this._flushChanges()}_flushChanges(){this._hasChanges&&(this._hasChanges=!1,this.syncOptions())}handleCollectionChange(){this.syncOptions()}syncOptions(){const e=this._value,t=this._el,n=ze(e),i=t.matcher??Is._defaultMatcher,r=t.options;let o=r.length;for(;o-- >0;){const a=r[o],c=Cs.call(a,"model")?a.model:a.value;if(n){a.selected=e.findIndex(l=>!!i(c,l))!==-1;continue}a.selected=!!i(c,e)}}syncValue(){const e=this._el,t=e.options,n=t.length,i=this._value;let r=0;if(e.multiple){if(!(i instanceof Array))return!0;let c;const l=e.matcher||Is._defaultMatcher,h=[];for(;r<n;)c=t[r],c.selected&&h.push(Cs.call(c,"model")?c.model:c.value),++r;let u;for(r=0;r<i.length;)u=i[r],h.findIndex(d=>!!l(u,d))===-1?i.splice(r,1):++r;for(r=0;r<h.length;)u=h[r],i.findIndex(d=>!!l(u,d))===-1&&i.push(u),++r;return!1}let o=null,a;for(;r<n;){if(a=t[r],a.selected){o=Cs.call(a,"model")?a.model:a.value;break}++r}return this._oldValue=this._value,this._value=o,!0}_start(){(this._nodeObserver=pv(this._el,this._handleNodeChange.bind(this))).observe(this._el,{childList:!0,subtree:!0,characterData:!0}),this._observeArray(this._value instanceof Array?this._value:null),this._observing=!0}_stop(){var e;this._nodeObserver.disconnect(),(e=this._arrayObserver)==null||e.unsubscribe(this),this._nodeObserver=this._arrayObserver=void 0,this._observing=!1}_observeArray(e){var t;if((t=this._arrayObserver)==null||t.unsubscribe(this),this._arrayObserver=void 0,e!=null){if(!this._el.multiple)throw N(654);(this._arrayObserver=this._observerLocator.getArrayObserver(e)).subscribe(this)}}handleEvent(){this.syncValue()&&this._flush()}_handleNodeChange(e){this.syncOptions(),this.syncValue()&&this._flush()}_flush(){const e=this._oldValue;this._oldValue=this._value,this.subs.notify(this._value,e)}}qu(Is),_n(Is,null);const yk="--";class Kv{constructor(e){this.obj=e,this.type=Zi|ti,this._value="",this._oldValue="",this.styles={},this.version=0,this._hasChanges=!1}getValue(){return this.obj.style.cssText}setValue(e){this._value=e,this._hasChanges=e!==this._oldValue,this._flushChanges()}_getStyleTuplesFromString(e){const t=[],n=/url\([^)]+$/;let i=0,r="",o,a,c,l;for(;i<e.length;){if(o=e.indexOf(";",i),o===-1&&(o=e.length),r+=e.substring(i,o),i=o+1,n.test(r)){r+=";";continue}a=r.indexOf(":"),c=r.substring(0,a).trim(),l=r.substring(a+1).trim(),t.push([c,l]),r=""}return t}_getStyleTuplesFromObject(e){let t,n;const i=[];for(n in e)if(t=e[n],t!=null){if(ue(t)){if(n.startsWith(yk)){i.push([n,t]);continue}i.push([Ag(n),t]);continue}i.push(...this._getStyleTuples(t))}return i}_getStyleTuplesFromArray(e){const t=e.length;if(t>0){const n=[];let i=0;for(;t>i;++i)n.push(...this._getStyleTuples(e[i]));return n}return ie}_getStyleTuples(e){return ue(e)?this._getStyleTuplesFromString(e):e instanceof Array?this._getStyleTuplesFromArray(e):e instanceof Object?this._getStyleTuplesFromObject(e):ie}_flushChanges(){if(this._hasChanges){this._hasChanges=!1;const e=this._value,t=this.styles,n=this._getStyleTuples(e);let i,r=this.version;this._oldValue=e;let o,a,c,l=0;const h=n.length;for(;l<h;++l)o=n[l],a=o[0],c=o[1],this.setProperty(a,c),t[a]=r;if(this.styles=t,this.version+=1,r===0)return;r-=1;for(i in t)!Cs.call(t,i)||t[i]!==r||this.obj.style.removeProperty(i)}}setProperty(e,t){let n="";t!=null&&pe(t.indexOf)&&t.includes("!important")&&(n="important",t=t.replace("!important","")),this.obj.style.setProperty(e,t,n)}bind(){this._value=this._oldValue=this.obj.style.cssText}}Kc(Kv);class Eh{constructor(e,t,n){this.type=Zi|$u|ti,this._value="",this._oldValue="",this._hasChanges=!1,this._listened=!1,this._el=e,this._key=t,this._config=n}getValue(){return this._value}setValue(e){Es(e,this._value)||(this._oldValue=this._value,this._value=e,this._hasChanges=!0,this._config.readonly||this._flushChanges())}_flushChanges(){this._hasChanges&&(this._hasChanges=!1,this._el[this._key]=this._value??this._config.default,this._flush())}handleEvent(){this._oldValue=this._value,this._value=this._el[this._key],this._oldValue!==this._value&&(this._hasChanges=!1,this._flush())}_start(){this._value=this._oldValue=this._el[this._key]}_flush(){const e=this._oldValue;this._oldValue=this._value,this.subs.notify(this._value,e)}}qu(Eh),_n(Eh,null);const Cp=(()=>{const s="http://www.w3.org/1999/xlink",e="http://www.w3.org/XML/1998/namespace",t="http://www.w3.org/2000/xmlns/";return Jm(be(),{"xlink:actuate":["actuate",s],"xlink:arcrole":["arcrole",s],"xlink:href":["href",s],"xlink:role":["role",s],"xlink:show":["show",s],"xlink:title":["title",s],"xlink:type":["type",s],"xml:lang":["lang",e],"xml:space":["space",e],xmlns:["xmlns",t],"xmlns:xlink":["xlink",t]})})(),Vv=new im;Vv.type=Zi|ti;class Gu{constructor(){this.allowDirtyCheck=!0,this._events=be(),this._globalEvents=be(),this._overrides=be(),this._globalOverrides=be(),this._locator=k(aC),this._platform=k(_t),this._dirtyChecker=k(Cu),this.svg=k(Bv);const e=["change","input"],t={events:e,default:""};this.useConfig({INPUT:{value:t,valueAsNumber:{events:e,default:0},checked:{type:Rh,events:e},files:{events:e,readonly:!0}},SELECT:{value:{type:Is,events:["change"],default:""}},TEXTAREA:{value:t}});const n={events:["change","input","blur","keyup","paste"],default:""},i={events:["scroll"],default:0};this.useConfigGlobal({scrollTop:i,scrollLeft:i,textContent:n,innerHTML:n}),this.overrideAccessorGlobal("css","style","class"),this.overrideAccessor({INPUT:["value","checked","model"],SELECT:["value"],TEXTAREA:["value"]})}handles(e,t){return e instanceof this._platform.Node}useConfig(e,t,n){const i=this._events;let r;if(ue(e))r=i[e]??(i[e]=be()),r[t]==null?r[t]=n:fa(e,t);else for(const o in e){r=i[o]??(i[o]=be());const a=e[o];for(t in a)r[t]==null?r[t]=a[t]:fa(o,t)}}useConfigGlobal(e,t){const n=this._globalEvents;if(typeof e=="object")for(const i in e)n[i]==null?n[i]=e[i]:fa("*",i);else n[e]==null?n[e]=t:fa("*",e)}getAccessor(e,t,n){if(t in this._globalOverrides||t in(this._overrides[e.tagName]??uC))return this.getObserver(e,t,n);switch(t){case"src":case"href":case"role":case"minLength":case"maxLength":case"placeholder":case"size":case"pattern":case"title":case"popovertarget":case"popovertargetaction":return(t==="popovertarget"||t==="popovertargetaction")&&e.nodeName!=="INPUT"&&e.nodeName!=="BUTTON"&&console.warn(`[aurelia] Popover API are only valid on <input> or <button>. Detected ${t} on <${e.nodeName.toLowerCase()}>`),xa;default:{const i=Cp[t];return i!==void 0?Uo.forNs(i[1]):bh(e,t,this.svg)?xa:Vv}}}overrideAccessor(e,t){var i,r;let n;if(ue(e))n=(i=this._overrides)[e]??(i[e]=be()),n[t]=!0;else for(const o in e)for(const a of e[o])n=(r=this._overrides)[o]??(r[o]=be()),n[a]=!0}overrideAccessorGlobal(...e){for(const t of e)this._globalOverrides[t]=!0}getNodeObserverConfig(e,t){var n;return((n=this._events[e.tagName])==null?void 0:n[t])??this._globalEvents[t]}getNodeObserver(e,t,n){var o;const i=((o=this._events[e.tagName])==null?void 0:o[t])??this._globalEvents[t];let r;return i!=null?(r=new(i.type??Eh)(e,t,i,n,this._locator),r.doNotCache||(sm(e)[t]=r),r):null}getObserver(e,t,n){switch(t){case"class":return new Vc(e);case"css":case"style":return new Kv(e)}const i=this.getNodeObserver(e,t,n);if(i!=null)return i;const r=Cp[t];if(r!==void 0)return Uo.forNs(r[1]);if(bh(e,t,this.svg))return xa;if(t in e.constructor.prototype){if(this.allowDirtyCheck)return this._dirtyChecker.createProperty(e,t);throw N(652,t)}else return new Su(e,t)}}Gu.register=Ec(Au);function _k(s,e){if(s instanceof Array)return e.getArrayObserver(s);if(s instanceof Map)return e.getMapObserver(s);if(s instanceof Set)return e.getSetObserver(s)}function fa(s,e){throw N(653,s,e)}function Sp(s,e){return s===e}class Rh{constructor(e,t,n,i){this.type=Zi|$u|ti,this._value=void 0,this._oldValue=void 0,this._collectionObserver=void 0,this._valueObserver=void 0,this._listened=!1,this._el=e,this.oL=i,this._config=n}getValue(){return this._value}setValue(e){const t=this._value;e!==t&&(this._value=e,this._oldValue=t,this._observe(),this._synchronizeElement(),this._flush())}handleCollectionChange(){this._synchronizeElement()}handleChange(e,t){this._synchronizeElement()}_synchronizeElement(){const e=this._value,t=this._el,n=Cs.call(t,"model")?t.model:t.value,i=t.type==="radio",r=t.matcher!==void 0?t.matcher:Sp;if(i)t.checked=!!r(e,n);else if(e===!0)t.checked=!0;else{let o=!1;if(ze(e))o=e.findIndex(a=>!!r(a,n))!==-1;else if(e instanceof Set){for(const a of e)if(r(a,n)){o=!0;break}}else if(e instanceof Map)for(const a of e){const c=a[0],l=a[1];if(r(c,n)&&l===!0){o=!0;break}}t.checked=o}}handleEvent(){let e=this._oldValue=this._value;const t=this._el,n=Cs.call(t,"model")?t.model:t.value,i=t.checked,r=t.matcher!==void 0?t.matcher:Sp;if(t.type==="checkbox"){if(ze(e)){const o=e.findIndex(a=>!!r(a,n));i&&o===-1?e.push(n):!i&&o!==-1&&e.splice(o,1);return}else if(e instanceof Set){const o={};let a=o;for(const c of e)if(r(c,n)===!0){a=c;break}i&&a===o?e.add(n):!i&&a!==o&&e.delete(a);return}else if(e instanceof Map){let o;for(const a of e){const c=a[0];if(r(c,n)===!0){o=c;break}}e.set(o,i);return}e=i}else if(i)e=n;else return;this._value=e,this._flush()}_start(){this._observe()}_stop(){var e,t;(e=this._collectionObserver)==null||e.unsubscribe(this),(t=this._valueObserver)==null||t.unsubscribe(this),this._collectionObserver=this._valueObserver=void 0}_flush(){Ap=this._oldValue,this._oldValue=this._value,this.subs.notify(this._value,Ap)}_observe(){var t,n,i,r,o;const e=this._el;(i=this._valueObserver??(this._valueObserver=((t=e.$observers)==null?void 0:t.model)??((n=e.$observers)==null?void 0:n.value)))==null||i.subscribe(this),(r=this._collectionObserver)==null||r.unsubscribe(this),this._collectionObserver=void 0,e.type==="checkbox"&&((o=this._collectionObserver=_k(this._value,this.oL))==null||o.subscribe(this))}}qu(Rh),_n(Rh,null);let Ap;class jv{bind(e,t){if(!(t instanceof Et))throw N(9994,t);t.useTargetObserver(xa)}}jv.$au={type:Zt,name:"attr"};class zv{bind(e,t){if(!("handleEvent"in t))throw N(801);t.self=!0}unbind(e,t){t.self=!1}}zv.$au={type:Zt,name:"self"};class qv{constructor(){this._observerLocator=k(qr),this._nodeObserverLocator=k(Au)}bind(e,t,...n){if(!(this._nodeObserverLocator instanceof Gu))throw N(9993);if(n.length===0)throw N(802);if(!(t instanceof Et)||!(t.mode&Ti))throw N(803);const i=this._nodeObserverLocator.getNodeObserverConfig(t.target,t.targetProperty);if(i==null)throw N(9992,t);const r=this._nodeObserverLocator.getNodeObserver(t.target,t.targetProperty,this._observerLocator);r.useConfig({readonly:i.readonly,default:i.default,events:n}),t.useTargetObserver(r)}}qv.$au={type:Zt,name:"updateTrigger"};class ec{constructor(){this.elseFactory=void 0,this.elseView=void 0,this.ifView=void 0,this.view=void 0,this.value=!1,this.cache=!0,this.pending=void 0,this._wantsDeactivate=!1,this._swapId=0,this._ifFactory=k(Gt),this._location=k(Ot)}attaching(e,t){return this._swap(this.value)}detaching(e,t){return this._wantsDeactivate=!0,X(this.pending,()=>{var n;this._wantsDeactivate=!1,this.pending=void 0,(n=this.view)==null||n.deactivate(e,this.$controller)})}valueChanged(e,t){if(this.$controller.isActive&&(e=!!e,t=!!t,e!==t))return this._swap(e)}_swap(e){const t=this.view,n=this.$controller,i=this._swapId++,r=()=>!this._wantsDeactivate&&this._swapId===i+1;let o;return X(this.pending,()=>this.pending=X(t==null?void 0:t.deactivate(t,n),()=>{var a;if(r()&&(e?o=this.view=this.ifView=this.cache&&this.ifView!=null?this.ifView:this._ifFactory.create():o=this.view=this.elseView=this.cache&&this.elseView!=null?this.elseView:(a=this.elseFactory)==null?void 0:a.create(),o!=null))return o.setLocation(this._location),X(o.activate(o,n,n.scope),()=>{r()&&(this.pending=void 0)})}))}dispose(){var e,t;(e=this.ifView)==null||e.dispose(),(t=this.elseView)==null||t.dispose(),this.ifView=this.elseView=this.view=void 0}accept(e){var t;if(((t=this.view)==null?void 0:t.accept(e))===!0)return!0}}ec.$au={type:Ct,name:"if",isTemplateController:!0,bindables:{value:!0,cache:{set:s=>s===""||!!s&&s!=="false"}}};class Gv{constructor(){this._factory=k(Gt)}link(e,t,n,i){const r=e.children,o=r[r.length-1];if(o instanceof ec)o.elseFactory=this._factory;else if(o.viewModel instanceof ec)o.viewModel.elseFactory=this._factory;else throw N(810)}}Gv.$au={type:"custom-attribute",name:"else",isTemplateController:!0};function bk(s){s.dispose()}const wk=["BindingBehavior","ValueConverter"];class Wv{constructor(){this.views=[],this._oldViews=[],this.key=null,this._keyMap=new Map,this._scopeMap=new Map,this._observer=void 0,this._observingInnerItems=!1,this._reevaluating=!1,this._innerItemsExpression=null,this._normalizedItems=void 0,this._hasDestructuredLocal=!1,this._location=k(Ot),this._parent=k(na),this._factory=k(Gt),this._resolver=k(Sk);const t=k(Vs).props[0].props[0];if(t!==void 0){const{to:n,value:i,command:r}=t;if(n==="key")if(r===null)this.key=i;else if(r==="bind")this.key=k(Zo).parse(i,qn);else throw N(775,r);else throw N(776,n)}}binding(e,t){const n=this._parent.bindings,i=n.length;let r,o,a=0;for(;i>a;++a)if(r=n[a],r.target===this&&r.targetProperty==="items"){o=this.forOf=r.ast,this._forOfBinding=r;let l=o.iterable;for(;l!=null&&wk.includes(l.$kind);)l=l.expression,this._observingInnerItems=!0;this._innerItemsExpression=l;break}this._refreshCollectionObserver();const c=o.declaration;(this._hasDestructuredLocal=c.$kind==="ArrayDestructuring"||c.$kind==="ObjectDestructuring")||(this.local=$e(c,this.$controller.scope,r,null))}attaching(e,t){return this._normalizeToArray(),this._activateAllViews(e,this._normalizedItems??ie)}detaching(e,t){return this._refreshCollectionObserver(),this._deactivateAllViews(e)}unbinding(e,t){this._scopeMap.clear(),this._keyMap.clear()}itemsChanged(){this.$controller.isActive&&(this._refreshCollectionObserver(),this._normalizeToArray(),this._applyIndexMap(this.items,void 0))}handleCollectionChange(e,t){const n=this.$controller;if(n.isActive){if(this._observingInnerItems){if(this._reevaluating)return;this._reevaluating=!0,this.items=$e(this.forOf.iterable,n.scope,this._forOfBinding,null),this._reevaluating=!1;return}this._normalizeToArray(),this._applyIndexMap(e,t)}}_applyIndexMap(e,t){const n=this.views;this._oldViews=n.slice();const i=n.length,r=this.key,o=r!==null;if(o||t===void 0){const a=this.local,c=this._normalizedItems,l=c.length,h=this.forOf,u=h.declaration,d=this._forOfBinding,f=this._hasDestructuredLocal;t=Os(l);let p=0;if(i===0)for(;p<l;++p)t[p]=-2;else if(l===0)if(f)for(p=0;p<i;++p)t.deletedIndices.push(p),t.deletedItems.push($e(u,n[p].scope,d,null));else for(p=0;p<i;++p)t.deletedIndices.push(p),t.deletedItems.push(n[p].scope.bindingContext[a]);else{const m=Array(i);if(f)for(p=0;p<i;++p)m[p]=$e(u,n[p].scope,d,null);else for(p=0;p<i;++p)m[p]=n[p].scope.bindingContext[a];let g,v,S,R,C=0;const I=i-1,$=l-1,x=new Map,F=new Map,D=this._keyMap,V=this._scopeMap,ce=this.$controller.scope;p=0;e:{for(;;){if(o?(g=m[p],v=c[p],S=Zs(D,r,g,hs(V,g,h,ce,d,a,f),d),R=Zs(D,r,v,hs(V,v,h,ce,d,a,f),d)):(g=S=us(m[p],p),v=R=us(c[p],p)),S!==R){D.set(g,S),D.set(v,R);break}if(++p,p>I||p>$)break e}if(I!==$)break e;for(C=$;;){if(o?(g=m[C],v=c[C],S=Zs(D,r,g,hs(V,g,h,ce,d,a,f),d),R=Zs(D,r,v,hs(V,v,h,ce,d,a,f),d)):(g=S=us(m[p],p),v=R=us(c[p],p)),S!==R){D.set(g,S),D.set(v,R);break}if(--C,p>C)break e}}const qe=p,Ne=p;for(p=Ne;p<=$;++p)D.has(v=o?c[p]:us(c[p],p))?R=D.get(v):(R=o?Zs(D,r,v,hs(V,v,h,ce,d,a,f),d):v,D.set(v,R)),F.set(R,p);for(p=qe;p<=I;++p)D.has(g=o?m[p]:us(m[p],p))?S=D.get(g):S=o?Zs(D,r,g,n[p].scope,d):g,x.set(S,p),F.has(S)?t[F.get(S)]=p:(t.deletedIndices.push(p),t.deletedItems.push(g));for(p=Ne;p<=$;++p)x.has(D.get(o?c[p]:us(c[p],p)))||(t[p]=-2);x.clear(),F.clear()}}if(t===void 0){const a=X(this._deactivateAllViews(null),()=>this._activateAllViews(null,this._normalizedItems??ie));Ve(a)&&a.catch(Wa)}else if(t.deletedIndices.length>0){const a=X(this._deactivateAndRemoveViewsByKey(t),()=>this._createAndActivateAndSortViewsByKey(i,t));Ve(a)&&a.catch(Wa)}else this._createAndActivateAndSortViewsByKey(i,t)}_refreshCollectionObserver(){var o,a;const e=this.$controller.scope;let t=this._innerItems,n=this._observingInnerItems,i;n&&(t=this._innerItems=$e(this._innerItemsExpression,e,this._forOfBinding,null)??null,n=this._observingInnerItems=!Es(this.items,t));const r=this._observer;if(this.$controller.isActive){const c=n?t:this.items;i=this._observer=(a=(o=this._resolver.resolve(c)).getObserver)==null?void 0:a.call(o,c),r!==i&&(r==null||r.unsubscribe(this),i==null||i.subscribe(this))}else r==null||r.unsubscribe(this),this._observer=void 0}_normalizeToArray(){const e=this.items;if(ze(e)){this._normalizedItems=e.slice(0);return}const t=[];this._resolver.resolve(e).iterate(e,(n,i)=>{t[i]=n}),this._normalizedItems=t}_activateAllViews(e,t){let n,i,r,o;const{$controller:a,_factory:c,local:l,_location:h,_scopeMap:u,_forOfBinding:d,forOf:f,_hasDestructuredLocal:p}=this,m=a.scope,g=t.length,v=this.views=Array(g);if(t.forEach((S,R)=>{r=v[R]=c.create().setLocation(h),r.nodes.unlink(),o=hs(u,S,f,m,d,l,p),ga(o.overrideContext,R,g),i=r.activate(e??r,a,o),Ve(i)&&(n??(n=[])).push(i)}),n!==void 0)return n.length===1?n[0]:Promise.all(n)}_deactivateAllViews(e){let t,n,i,r=0;const{views:o,$controller:a}=this,c=o.length;for(;c>r;++r)i=o[r],i.release(),n=i.deactivate(e??i,a),Ve(n)&&(t??(t=[])).push(n);if(t!==void 0)return t.length===1?t[0]:Promise.all(t)}_deactivateAndRemoveViewsByKey(e){let t,n,i;const{$controller:r,views:o}=this,a=e.deletedIndices.slice().sort(kk),c=a.length;let l=0;for(;c>l;++l)i=o[a[l]],i.release(),n=i.deactivate(i,r),Ve(n)&&(t??(t=[])).push(n);for(l=0;c>l;++l)o.splice(a[l]-l,1);if(t!==void 0)return t.length===1?t[0]:Promise.all(t)}_createAndActivateAndSortViewsByKey(e,t){let n,i,r,o,a=0;const{$controller:c,_factory:l,local:h,_normalizedItems:u,_location:d,views:f,_hasDestructuredLocal:p,_forOfBinding:m,_scopeMap:g,_oldViews:v,forOf:S}=this,R=t.length;for(;R>a;++a)t[a]===-2&&(r=l.create(),f.splice(a,0,r));if(f.length!==R)throw N(814,[f.length,R]);const C=c.scope,I=t.length;let $=0;for(a=0;a<t.length;++a)($=t[a])!==-2&&(f[a]=v[$]);const x=Ck(t),F=x.length,D=S.declaration;let V,ce=F-1;for(a=I-1;a>=0;--a)r=f[a],V=f[a+1],r.nodes.link((V==null?void 0:V.nodes)??d),t[a]===-2?(o=hs(g,u[a],S,C,m,h,p),ga(o.overrideContext,a,I),r.setLocation(d),i=r.activate(r,c,o),Ve(i)&&(n??(n=[])).push(i)):ce<0||F===1||a!==x[ce]?(p?Nr(D,r.scope,m,u[a]):r.scope.bindingContext[h]=u[a],ga(r.scope.overrideContext,a,I),r.nodes.insertBefore(r.location)):(p?Nr(D,r.scope,m,u[a]):r.scope.bindingContext[h]=u[a],e!==I&&ga(r.scope.overrideContext,a,I),--ce);if(n!==void 0)return n.length===1?n[0]:Promise.all(n)}dispose(){this.views.forEach(bk),this.views=void 0}accept(e){const{views:t}=this;if(t!==void 0){for(let n=0,i=t.length;n<i;++n)if(t[n].accept(e)===!0)return!0}}}Wv.$au={type:Ct,name:"repeat",isTemplateController:!0,bindables:["items"]};let tc=16,si=new Int32Array(tc),pa=new Int32Array(tc);function Ck(s){const e=s.length;e>tc&&(tc=e,si=new Int32Array(e),pa=new Int32Array(e));let t=0,n=0,i=0,r=0,o=0,a=0,c=0,l=0;for(;r<e;r++)if(n=s[r],n!==-2){if(o=si[t],i=s[o],i!==-2&&i<n){pa[r]=o,si[++t]=r;continue}for(a=0,c=t;a<c;)l=a+c>>1,i=s[si[l]],i!==-2&&i<n?a=l+1:c=l;i=s[si[a]],(n<i||i===-2)&&(a>0&&(pa[r]=si[a-1]),si[a]=r)}r=++t;const h=new Int32Array(r);for(n=si[t-1];t-- >0;)h[t]=n,n=pa[n];for(;r-- >0;)si[r]=0;return h}const ga=(s,e,t)=>{const n=e===0,i=e===t-1,r=e%2===0;s.$index=e,s.$first=n,s.$last=i,s.$middle=!n&&!i,s.$even=r,s.$odd=!r,s.$length=t},Sk=ye("IRepeatableHandlerResolver",s=>s.singleton(Ak));class Ak{constructor(){this._handlers=k(lu(Tk))}resolve(e){if(Tp.handles(e))return Tp;if(Ip.handles(e))return Ip;if(kp.handles(e))return kp;if(Ep.handles(e))return Ep;if(Rp.handles(e))return Rp;const t=this._handlers.find(n=>n.handles(e));return t!==void 0?t:Ik}}const Tk=ye("IRepeatableHandler"),Tp={handles:ze,getObserver:Tu,iterate(s,e){const t=s.length;let n=0;for(;n<t;++n)e(s[n],n,s)}},Ip={handles:Kr,getObserver:Tu,iterate(s,e){let t=0,n;for(n of s.keys())e(n,t++,s)}},kp={handles:Fi,getObserver:Tu,iterate(s,e){let t=0,n;for(n of s.entries())e(n,t++,s)}},Ep={handles:Fw,iterate(s,e){let t=0;for(;t<s;++t)e(t,t,s)}},Rp={handles:s=>s==null,iterate(){}},Ik={handles(s){return!1},iterate(s,e){throw N(777,s)}},Zs=(s,e,t,n,i)=>{let r=s.get(t);return r===void 0&&(typeof e=="string"?r=t[e]:r=$e(e,n,i,null),s.set(t,r)),r},hs=(s,e,t,n,i,r,o)=>{let a=s.get(e);return a===void 0&&(o?Nr(t.declaration,a=rt.fromParent(n,new sp),i,e):a=rt.fromParent(n,new sp(r,e)),s.set(e,a)),a},us=(s,e)=>{const t=typeof s;switch(t){case"object":if(s!==null)return s;case"string":case"number":case"bigint":case"undefined":case"boolean":return`${e}${t}${s}`;default:return s}},kk=(s,e)=>s-e;class Qv{constructor(){this.view=k(Gt).create().setLocation(k(Ot))}valueChanged(e,t){const n=this.$controller,i=this.view.bindings;let r,o=0,a=0;if(n.isActive&&i!=null)for(r=rt.fromParent(n.scope,e===void 0?{}:e),a=i.length;a>o;++o)i[o].bind(r)}attaching(e,t){const{$controller:n,value:i}=this,r=rt.fromParent(n.scope,i===void 0?{}:i);return this.view.activate(e,n,r)}detaching(e,t){return this.view.deactivate(e,this.$controller)}dispose(){this.view.dispose(),this.view=void 0}accept(e){var t;if(((t=this.view)==null?void 0:t.accept(e))===!0)return!0}}Qv.$au={type:Ct,name:"with",isTemplateController:!0,bindables:["value"]};class Wu{constructor(){this.cases=[],this.activeCases=[],this.promise=void 0,this._factory=k(Gt),this._location=k(Ot)}link(e,t,n,i){this.view=this._factory.create(this.$controller).setLocation(this._location)}attaching(e,t){const n=this.view,i=this.$controller;return this.queue(()=>n.activate(e,i,i.scope)),this.queue(()=>this.swap(e,this.value)),this.promise}detaching(e,t){return this.queue(()=>this.view.deactivate(e,this.$controller)),this.promise}dispose(){var e;(e=this.view)==null||e.dispose(),this.view=void 0}valueChanged(e,t){this.$controller.isActive&&this.queue(()=>this.swap(null,this.value))}caseChanged(e){this.queue(()=>this._handleCaseChange(e))}_handleCaseChange(e){const t=e.isMatch(this.value),n=this.activeCases,i=n.length;if(!t)return i>0&&n[0].id===e.id?this._clearActiveCases(null):void 0;if(i>0&&n[0].id<e.id)return;const r=[];let o=e.fallThrough;if(!o)r.push(e);else{const a=this.cases,c=a.indexOf(e);for(let l=c,h=a.length;l<h&&o;l++){const u=a[l];r.push(u),o=u.fallThrough}}return X(this._clearActiveCases(null,r),()=>(this.activeCases=r,this._activateCases(null)))}swap(e,t){const n=[];let i=!1;for(const o of this.cases)if((i||o.isMatch(t))&&(n.push(o),i=o.fallThrough),n.length>0&&!i)break;const r=this.defaultCase;return n.length===0&&r!==void 0&&n.push(r),X(this.activeCases.length>0?this._clearActiveCases(e,n):void 0,()=>{if(this.activeCases=n,n.length!==0)return this._activateCases(e)})}_activateCases(e){const t=this.$controller;if(!t.isActive)return;const n=this.activeCases,i=n.length;if(i===0)return;const r=t.scope;return i===1?n[0].activate(e,r):Je(...n.map(o=>o.activate(e,r)))}_clearActiveCases(e,t=[]){const n=this.activeCases,i=n.length;if(i!==0){if(i===1){const r=n[0];return t.includes(r)?void 0:(n.length=0,r.deactivate(e))}return X(Je(...n.reduce((r,o)=>(t.includes(o)||r.push(o.deactivate(e)),r),[])),()=>{n.length=0})}}queue(e){const t=this.promise;let n;n=this.promise=X(X(t,e),()=>{this.promise===n&&(this.promise=void 0)})}accept(e){if(this.$controller.accept(e)===!0||this.activeCases.some(t=>t.accept(e)))return!0}}Wu.$au={type:Ct,name:"switch",isTemplateController:!0,bindables:["value"]};let Ek=0;const Yv=["value",{name:"fallThrough",mode:$c,set(s){switch(s){case"true":return!0;case"false":return!1;default:return!!s}}}];class Qu{constructor(){this.id=++Ek,this.fallThrough=!1,this.view=void 0,this._factory=k(Gt),this._locator=k(qr),this._location=k(Ot),this._logger=k(ji).scopeTo(`${this.constructor.name}-#${this.id}`)}link(e,t,n,i){const r=e.parent,o=r==null?void 0:r.viewModel;if(o instanceof Wu)this.$switch=o,this.linkToSwitch(o);else throw N(815)}detaching(e,t){return this.deactivate(e)}isMatch(e){this._logger.debug("isMatch()");const t=this.value;return ze(t)?(this._observer===void 0&&(this._observer=this._observeCollection(t)),t.includes(e)):t===e}valueChanged(e,t){var n;ze(e)?((n=this._observer)==null||n.unsubscribe(this),this._observer=this._observeCollection(e)):this._observer!==void 0&&this._observer.unsubscribe(this),this.$switch.caseChanged(this)}handleCollectionChange(){this.$switch.caseChanged(this)}activate(e,t){let n=this.view;if(n===void 0&&(n=this.view=this._factory.create().setLocation(this._location)),!n.isActive)return n.activate(e??n,this.$controller,t)}deactivate(e){const t=this.view;if(!(t===void 0||!t.isActive))return t.deactivate(e??t,this.$controller)}dispose(){var e,t;(e=this._observer)==null||e.unsubscribe(this),(t=this.view)==null||t.dispose(),this.view=void 0}linkToSwitch(e){e.cases.push(this)}_observeCollection(e){const t=this._locator.getArrayObserver(e);return t.subscribe(this),t}accept(e){var t;return this.$controller.accept(e)===!0?!0:(t=this.view)==null?void 0:t.accept(e)}}Hu({name:"case",bindables:Yv,isTemplateController:!0},Qu);class Jv extends Qu{linkToSwitch(e){if(e.defaultCase!==void 0)throw N(816);e.defaultCase=this}}Hu({name:"default-case",bindables:Yv,isTemplateController:!0},Jv);var Xv,Zv,ey;class Yu{constructor(){this.preSettledTask=null,this.postSettledTask=null,this._factory=k(Gt),this._location=k(Ot),this._platform=k(_t),this.logger=k(ji).scopeTo("promise.resolve")}link(e,t,n,i){this.view=this._factory.create(this.$controller).setLocation(this._location)}attaching(e,t){const n=this.view,i=this.$controller;return X(n.activate(e,i,this.viewScope=rt.fromParent(i.scope,{})),()=>this.swap(e))}valueChanged(e,t){this.$controller.isActive&&this.swap(null)}swap(e){var h,u;const t=this.value;if(!Ve(t)){this.logger.warn(`The value '${qi(t)}' is not a promise. No change will be done.`);return}const n=this._platform.domQueue,i=this.fulfilled,r=this.rejected,o=this.pending,a=this.viewScope;let c;const l=()=>{Je(c=(this.preSettledTask=n.queueTask(()=>Je(i==null?void 0:i.deactivate(e),r==null?void 0:r.deactivate(e),o==null?void 0:o.activate(e,a)))).result.catch(d=>{if(!(d instanceof _h))throw d}),t.then(d=>{if(this.value!==t)return;const f=()=>{this.postSettlePromise=(this.postSettledTask=n.queueTask(()=>Je(o==null?void 0:o.deactivate(e),r==null?void 0:r.deactivate(e),i==null?void 0:i.activate(e,a,d)))).result};this.preSettledTask.status===wl?c.then(f):(this.preSettledTask.cancel(),f())},d=>{if(this.value!==t)return;const f=()=>{this.postSettlePromise=(this.postSettledTask=n.queueTask(()=>Je(o==null?void 0:o.deactivate(e),i==null?void 0:i.deactivate(e),r==null?void 0:r.activate(e,a,d)))).result};this.preSettledTask.status===wl?c.then(f):(this.preSettledTask.cancel(),f())}))};((h=this.postSettledTask)==null?void 0:h.status)===wl?this.postSettlePromise.then(l):((u=this.postSettledTask)==null||u.cancel(),l())}detaching(e,t){var n,i;return(n=this.preSettledTask)==null||n.cancel(),(i=this.postSettledTask)==null||i.cancel(),this.preSettledTask=this.postSettledTask=null,this.view.deactivate(e,this.$controller)}dispose(){var e;(e=this.view)==null||e.dispose(),this.view=void 0}}Yu.$au={type:Ct,name:"promise",isTemplateController:!0,bindables:["value"]};class ty{constructor(){this.view=void 0,this._factory=k(Gt),this._location=k(Ot)}link(e,t,n,i){Ju(e).pending=this}activate(e,t){let n=this.view;if(n===void 0&&(n=this.view=this._factory.create().setLocation(this._location)),!n.isActive)return n.activate(n,this.$controller,t)}deactivate(e){const t=this.view;if(!(t===void 0||!t.isActive))return t.deactivate(t,this.$controller)}detaching(e){return this.deactivate(e)}dispose(){var e;(e=this.view)==null||e.dispose(),this.view=void 0}}ty.$au={type:Ct,name:"pending",isTemplateController:!0,bindables:{value:{mode:Fe}}};class ny{constructor(){this.view=void 0,this._factory=k(Gt),this._location=k(Ot)}link(e,t,n,i){Ju(e).fulfilled=this}activate(e,t,n){this.value=n;let i=this.view;if(i===void 0&&(i=this.view=this._factory.create().setLocation(this._location)),!i.isActive)return i.activate(i,this.$controller,t)}deactivate(e){const t=this.view;if(!(t===void 0||!t.isActive))return t.deactivate(t,this.$controller)}detaching(e,t){return this.deactivate(e)}dispose(){var e;(e=this.view)==null||e.dispose(),this.view=void 0}}ny.$au={type:Ct,name:"then",isTemplateController:!0,bindables:{value:{mode:Ti}}};class iy{constructor(){this.view=void 0,this._factory=k(Gt),this._location=k(Ot)}link(e,t,n,i){Ju(e).rejected=this}activate(e,t,n){this.value=n;let i=this.view;if(i===void 0&&(i=this.view=this._factory.create().setLocation(this._location)),!i.isActive)return i.activate(i,this.$controller,t)}deactivate(e){const t=this.view;if(!(t===void 0||!t.isActive))return t.deactivate(t,this.$controller)}detaching(e,t){return this.deactivate(e)}dispose(){var e;(e=this.view)==null||e.dispose(),this.view=void 0}}iy.$au={type:Ct,name:"catch",isTemplateController:!0,bindables:{value:{mode:Ti}}};function Ju(s){const e=s.parent,t=e==null?void 0:e.viewModel;if(t instanceof Yu)return t;throw N(813)}class Ph{"promise.resolve"(e,t){return new qt(e,t,"promise","bind")}}Xv=Symbol.metadata;Ph[Xv]={[Qn]:Xi.create([{pattern:"promise.resolve",symbols:""}],Ph)};class Oh{then(e,t){return new qt(e,t,"then","from-view")}}Zv=Symbol.metadata;Oh[Zv]={[Qn]:Xi.create([{pattern:"then",symbols:""}],Oh)};class Nh{catch(e,t){return new qt(e,t,"catch","from-view")}}ey=Symbol.metadata;Nh[ey]={[Qn]:Xi.create([{pattern:"catch",symbols:""}],Nh)};class sy{constructor(){this._needsApply=!1,this._element=k(is),this._platform=k(_t)}binding(){this.valueChanged()}valueChanged(){this.$controller.isActive?this._apply():this._needsApply=!0}attached(){this._needsApply&&(this._needsApply=!1,this._apply()),this._element.addEventListener("focus",this),this._element.addEventListener("blur",this)}detaching(){const e=this._element;e.removeEventListener("focus",this),e.removeEventListener("blur",this)}handleEvent(e){e.type==="focus"?this.value=!0:this._isElFocused||(this.value=!1)}_apply(){const e=this._element,t=this._isElFocused,n=this.value;n&&!t?e.focus():!n&&t&&e.blur()}get _isElFocused(){return this._element===this._platform.document.activeElement}}sy.$au={type:Ct,name:"focus",bindables:{value:{mode:tv}}};class ry{constructor(){this.position="beforeend",this.strict=!1;const e=k(Gt),t=k(Ot),n=k(_t);this._platform=n,this._resolvedTarget=n.document.createElement("div"),(this.view=e.create()).setLocation(this._targetLocation=aI(n)),ok(this.view.nodes,t)}attaching(e){this.callbackContext==null&&(this.callbackContext=this.$controller.scope.bindingContext);const t=this._resolvedTarget=this._getTarget();return this._moveLocation(t,this.position),this._activating(e,t)}detaching(e){return this._deactivating(e,this._resolvedTarget)}targetChanged(){const{$controller:e}=this;if(!e.isActive)return;const t=this._getTarget();if(this._resolvedTarget===t)return;this._resolvedTarget=t;const n=X(this._deactivating(null,t),()=>(this._moveLocation(t,this.position),this._activating(null,t)));Ve(n)&&n.catch(Wa)}positionChanged(){const{$controller:e,_resolvedTarget:t}=this;if(!e.isActive)return;const n=X(this._deactivating(null,t),()=>(this._moveLocation(t,this.position),this._activating(null,t)));Ve(n)&&n.catch(Wa)}_activating(e,t){const{activating:n,callbackContext:i,view:r}=this;return X(n==null?void 0:n.call(i,t,r),()=>this._activate(e,t))}_activate(e,t){const{$controller:n,view:i}=this;if(e===null)i.nodes.insertBefore(this._targetLocation);else return X(i.activate(e??i,n,n.scope),()=>this._activated(t));return this._activated(t)}_activated(e){const{activated:t,callbackContext:n,view:i}=this;return t==null?void 0:t.call(n,e,i)}_deactivating(e,t){const{deactivating:n,callbackContext:i,view:r}=this;return X(n==null?void 0:n.call(i,t,r),()=>this._deactivate(e,t))}_deactivate(e,t){const{$controller:n,view:i}=this;if(e===null)i.nodes.remove();else return X(i.deactivate(e,n),()=>this._deactivated(t));return this._deactivated(t)}_deactivated(e){const{deactivated:t,callbackContext:n,view:i}=this;return X(t==null?void 0:t.call(n,e,i),()=>this._removeLocation())}_getTarget(){const e=this._platform,t=e.document;let n=this.target,i=this.renderContext;if(n===""){if(this.strict)throw N(811);return t.body}if(ue(n)){let r=t;ue(i)&&(i=t.querySelector(i)),i instanceof e.Node&&(r=i),n=r.querySelector(n)}if(n instanceof e.Node)return n;if(n==null){if(this.strict)throw N(812);return t.body}return n}_removeLocation(){this._targetLocation.remove(),this._targetLocation.$start.remove()}_moveLocation(e,t){const n=this._targetLocation,i=n.$start,r=e.parentNode,o=[i,n];switch(t){case"beforeend":da(e,null,o);break;case"afterbegin":da(e,e.firstChild,o);break;case"beforebegin":da(r,e,o);break;case"afterend":da(r,e.nextSibling,o);break;default:throw N(779,t)}}dispose(){this.view.dispose(),this.view=void 0,this.callbackContext=null}accept(e){var t;if(((t=this.view)==null?void 0:t.accept(e))===!0)return!0}}ry.$au={type:Ct,name:"portal",isTemplateController:!0,bindables:[{name:"target",primary:!0},"position","activated","activating","callbackContext",{name:"renderContext",callback:"targetChanged"},"strict","deactivated","deactivating"]};let Rk;class Gc{constructor(){var u,d,f,p;this._parentScope=null,this._outerScope=null,this._attached=!1,this.expose=null,this.slotchange=null,this._subs=new Set,this._observer=null;const e=k(xs),t=k(Ot),n=k(Vs),i=k(qs),r=this.name=n.data.name,o=(u=n.projections)==null?void 0:u[gv],a=(f=(d=e.instruction)==null?void 0:d.projections)==null?void 0:f[r],c=e.controller.container;let l,h;a==null?(h=c.createChild({inheritParentResources:!0}),l=i.getViewFactory(o??Rk??(Rk=xt.create({name:"au-slot-empty-template",template:"",needsCompile:!1})),h),this._hasProjection=!1):(h=c.createChild(),h.useResources(e.parent.controller.container),Oe(h,xs,new Qe(void 0,e.parent)),l=i.getViewFactory(a,h),this._hasProjection=!0,this._slotwatchers=((p=c.getAll(hI,!1))==null?void 0:p.filter(m=>m.slotName==="*"||m.slotName===r))??ie),this._hasSlotWatcher=(this._slotwatchers??(this._slotwatchers=ie)).length>0,this._hdrContext=e,this.view=l.create().setLocation(this._location=t)}get nodes(){const e=[],t=this._location;let n=t.$start.nextSibling;for(;n!=null&&n!==t;)n.nodeType!==8&&e.push(n),n=n.nextSibling;return e}subscribe(e){this._subs.add(e)}unsubscribe(e){this._subs.delete(e)}binding(e,t){var r;for(this._parentScope=t.scope;t.vmKind==="synthetic"&&((r=t.parent)==null?void 0:r.viewModel)instanceof Gc;)t=t.parent.parent;const n=t.scope.bindingContext;let i;this._hasProjection&&(i=this._hdrContext.controller.scope.parent,(this._outerScope=rt.fromParent(i,i.bindingContext)).overrideContext.$host=this.expose??n)}attaching(e,t){return X(this.view.activate(e,this.$controller,this._hasProjection?this._outerScope:this._parentScope),()=>{this._hasSlotWatcher&&(this._slotwatchers.forEach(n=>n.watch(this)),this._observe(),this._notifySlotChange(),this._attached=!0)})}detaching(e,t){return this._attached=!1,this._unobserve(),this._slotwatchers.forEach(n=>n.unwatch(this)),this.view.deactivate(e,this.$controller)}exposeChanged(e){this._hasProjection&&this._outerScope!=null&&(this._outerScope.overrideContext.$host=e)}dispose(){this.view.dispose(),this.view=void 0}accept(e){var t;if(((t=this.view)==null?void 0:t.accept(e))===!0)return!0}_observe(){if(this._observer!=null)return;const e=this._location,t=e.parentElement;t!=null&&(this._observer=pv(t,n=>{Pk(e,n)&&this._notifySlotChange()})).observe(t,{childList:!0})}_unobserve(){var e;(e=this._observer)==null||e.disconnect(),this._observer=null}_notifySlotChange(){var i;const e=this.nodes,t=new Set(this._subs);let n;this._attached&&((i=this.slotchange)==null||i.call(void 0,this.name,e));for(n of t)n.handleSlotChange(this,e)}}Gc.$au={type:$s,name:"au-slot",template:null,containerless:!0,processContent(s,e,t){t.name=s.getAttribute("name")??gv;let n=s.firstChild,i=null;for(;n!==null;)i=n.nextSibling,cI(n)&&n.hasAttribute(lI)&&(console.warn("[DEV:aurelia] detected [au-slot] attribute on a child node",`of an <au-slot> element: "<${n.nodeName} au-slot>".`,"This element will be ignored and removed"),s.removeChild(n)),n=i},bindables:["expose","slotchange"]};const ma=(s,e)=>s.compareDocumentPosition(e),Pk=(s,e)=>{for(const{addedNodes:t,removedNodes:n,nextSibling:i}of e){let r=0,o=t.length,a;for(;r<o;++r)if(a=t[r],ma(s.$start,a)===4&&ma(s,a)===2)return!0;if(n.length>0&&i!=null&&ma(s.$start,i)===4&&ma(s,i)===2)return!0}};class oy{constructor(){this.scopeBehavior="auto",this._composition=void 0,this.tag=null,this._container=k(Ri),this.parent=k(na),this._host=k(is),this._location=k(Ot),this._platform=k(_t),this._rendering=k(qs),this._instruction=k(Vs),this._contextFactory=k(cC(Nk)),this._compiler=k(xc),this._hydrationContext=k(xs),this._exprParser=k(Zo),this._observerLocator=k(qr)}get composing(){return this._composing}get composition(){return this._composition}attaching(e,t){return this._composing=X(this.queue(new Pp(this.template,this.component,this.model,void 0),e),n=>{this._contextFactory._isCurrent(n)&&(this._composing=void 0)})}detaching(e){const t=this._composition,n=this._composing;return this._contextFactory.invalidate(),this._composition=this._composing=void 0,X(n,()=>t==null?void 0:t.deactivate(e))}propertyChanged(e){var t;if(!(e==="composing"||e==="composition")){if(e==="model"&&this._composition!=null){this._composition.update(this.model);return}if(e==="tag"&&((t=this._composition)==null?void 0:t.controller.vmKind)===Yt){console.warn("[DEV:aurelia] Changing tag name of a custom element composition is ignored.");return}this._composing=X(this._composing,()=>X(this.queue(new Pp(this.template,this.component,this.model,e),void 0),n=>{this._contextFactory._isCurrent(n)&&(this._composing=void 0)}))}}queue(e,t){const n=this._contextFactory,i=this._composition;return X(n.create(e),r=>n._isCurrent(r)?X(this.compose(r),o=>n._isCurrent(r)?X(o.activate(t),()=>n._isCurrent(r)?(this._composition=o,X(i==null?void 0:i.deactivate(t),()=>r)):X(o.controller.deactivate(o.controller,this.$controller),()=>(o.controller.dispose(),r))):(o.controller.dispose(),r)):r)}compose(e){const{_template:t,_component:n,_model:i}=e.change,{_container:r,$controller:o,_location:a,_instruction:c}=this,l=this._getDefinition(this._hydrationContext.controller.container,n),h=r.createChild(),u=this._platform.document.createElement(l==null?this.tag??"div":l.name);a.parentNode.insertBefore(u,a);let d;l==null?d=this.tag==null?Bo(u):null:d=l.containerless?Bo(u):null;const f=()=>{var g;if(u.remove(),d!=null){let v=d.$start.nextSibling,S=null;for(;v!==null&&v!==d;)S=v.nextSibling,v.remove(),v=S;(g=d.$start)==null||g.remove(),d.remove()}},p=this._createComponentInstance(h,typeof n=="string"?l.Type:n,u,d),m=()=>{const g=c.captures??ie;if(l!==null){const v=l.capture,[S,R]=g.reduce((I,$)=>{const x=!($.target in l.bindables)&&(v===!0||pe(v)&&!!v($.target));return I[x?0:1].push($),I},[[],[]]),C=Rt.$el(h,p,u,{projections:c.projections,captures:S},l,d);return this._createSpreadBindings(u,l,R).forEach(I=>C.addBinding(I)),new Np(C,I=>C.activate(I??C,o,o.scope.parent),I=>X(C.deactivate(I??C,o),f),I=>{var $;return($=p.activate)==null?void 0:$.call(p,I)},e)}else{const v=xt.create({name:oe.generateName(),template:t}),S=this._rendering.getViewFactory(v,h),R=Rt.$view(S,o),C=this.scopeBehavior==="auto"?rt.fromParent(this.parent.scope,p):rt.create(p);return R.setHost(u),d==null?this._createSpreadBindings(u,v,g).forEach(I=>R.addBinding(I)):R.setLocation(d),new Np(R,I=>R.activate(I??R,o,C),I=>X(R.deactivate(I??R,o),f),I=>{var $;return($=p.activate)==null?void 0:$.call(p,I)},e)}};return"activate"in p?X(p.activate(i),()=>m()):m()}_createComponentInstance(e,t,n,i){if(t==null)return new Ok;if(typeof t=="object")return t;const r=this._platform;qc(e,n,r),Oe(e,Ot,new Qe("IRenderLocation",i));const o=e.invoke(t);return Oe(e,t,new Qe("au-compose.component",o)),o}_getDefinition(e,t){if(typeof t=="string"){const i=oe.find(e,t);if(i==null)throw N(806,t);return i}const n=pe(t)?t:t==null?void 0:t.constructor;return oe.isType(n,void 0)?oe.getDefinition(n,null):null}_createSpreadBindings(e,t,n){const i=new Nv(this.$controller,{projections:null,captures:n},this._hydrationContext.parent);return Fc.create(i,e,t,this._rendering,this._compiler,this._platform,this._exprParser,this._observerLocator)}}oy.$au={type:$s,name:"au-compose",capture:!0,containerless:!0,bindables:["template","component","model",{name:"scopeBehavior",set:s=>{if(s==="scoped"||s==="auto")return s;throw N(805,s)}},{name:"composing",mode:Ti},{name:"composition",mode:Ti},"tag"]};class Ok{}class Nk{constructor(){this.id=0}_isCurrent(e){return e.id===this.id}create(e){return X(e.load(),t=>new Mk(++this.id,t))}invalidate(){this.id++}}class Pp{constructor(e,t,n,i){this._template=e,this._component=t,this._model=n,this._src=i}load(){return Ve(this._template)||Ve(this._component)?Promise.all([this._template,this._component]).then(([e,t])=>new Op(e,t,this._model,this._src)):new Op(this._template,this._component,this._model,this._src)}}class Op{constructor(e,t,n,i){this._template=e,this._component=t,this._model=n,this._src=i}}class Mk{constructor(e,t){this.id=e,this.change=t}}class Np{constructor(e,t,n,i,r){this.controller=e,this.start=t,this.stop=n,this.update=i,this.context=r,this.state=0}activate(e){if(this.state!==0)throw N(807,this);return this.state=1,this.start(e)}deactivate(e){switch(this.state){case 1:return this.state=-1,this.stop(e);case-1:throw N(808);default:this.state=-1}}}const xk=ye("ISanitizer",s=>s.singleton(class{sanitize(){throw N(99,"sanitize")}}));class ay{constructor(){this._sanitizer=k(xk)}toView(e){return e==null?null:this._sanitizer.sanitize(e)}}ay.$au={type:fr,name:"sanitize"};class cy{constructor(){this.el=k(is),this.p=k(_t),this._isActive=!1,this._task=null,this.$val="",this.$prio="",this.update=()=>{this._task=null,!!this.value!==this._isToggled&&(this._isToggled===this._base?(this._isToggled=!this._base,this.$val=this.el.style.getPropertyValue("display"),this.$prio=this.el.style.getPropertyPriority("display"),this.el.style.setProperty("display","none","important")):(this._isToggled=this._base,this.el.style.setProperty("display",this.$val,this.$prio),this.el.getAttribute("style")===""&&this.el.removeAttribute("style")))};const e=k(Vs);this._isToggled=this._base=e.alias!=="hide"}binding(){this._isActive=!0,this.update()}detaching(){var e;this._isActive=!1,(e=this._task)==null||e.cancel(),this._task=null}valueChanged(){this._isActive&&this._task===null&&(this._task=this.p.domQueue.queueTask(this.update))}}cy.$au={type:Ct,name:"show",bindables:["value"],aliases:["hide"]};const $k=[mk,KA,Gu],Lk=[fh,dh,ph,oI],Dk=[Lm,Nm,xm,Mm,$m,Dm,Vm,Bm,Hm,Km,Fm,Um,jm],Bk=[av,iv,sv,rv,cv,lv,ov,ay,ec,Gv,Wv,Qv,Wu,Qu,Jv,Yu,ty,ny,iy,Ph,Oh,Nh,jv,zv,qv,oy,ry,sy,cy,Gc],Hk=[_I,bI,vI,yI,dI,fI,pI,gI,mI,SI,PI,AI,TI,II,EI,wI,OI,NI],Uk=ly(gi);function ly(s){return{optionsProvider:s,register(e){const t={coercingOptions:{enableCoercion:!1,coerceNullish:!1}};return s(t),e.register(Du(Xg,t.coercingOptions),...$k,...Bk,...Lk,...Dk,...Hk)},customize(e){return ly(e??s)}}}const Fk=Ui.getOrCreate(globalThis);function Kk(){return sn.createContainer().register(Ci.instance(_t,Fk),Uk)}class Eo extends fk{constructor(e=Kk()){super(e)}static app(e){return new Eo().app(e)}static enhance(e){return new Eo().enhance(e)}static register(...e){return new Eo().register(...e)}app(e){if(oe.isType(e)){const t=oe.getDefinition(e);let n=document.querySelector(t.name);return n===null&&(n=document.body),super.app({host:n,component:e})}return super.app(e)}}class Mp{constructor(e,t,n,i){this.name=e,this.isOptional=t,this.isStar=n,this.pattern=i}satisfiesPattern(e){return this.pattern===null?!0:(this.pattern.lastIndex=0,this.pattern.test(e))}}class Vk{constructor(e,t,n){this.path=e,this.caseSensitive=t,this.handler=n}}class jk{get residualEndpoint(){return this._residualEndpoint}set residualEndpoint(e){if(this._residualEndpoint!==null)throw new Error("Residual endpoint is already set");this._residualEndpoint=e}constructor(e,t){this.route=e,this.params=t,this._residualEndpoint=null}equalsOrResidual(e){return e!=null&&this===e||this._residualEndpoint===e}}class zk{constructor(e,t){this.endpoint=e;const n=Object.create(null);for(const i in t){const r=t[i];n[i]=r!=null?decodeURIComponent(r):r}this.params=Object.freeze(n)}}class Xu{constructor(e,t,n,i){var r;this.chars=e,this.states=t,this.skippedStates=n,this.result=i,this.params=null,this.isConstrained=!1,this.satisfiesConstraints=null,this.head=t[t.length-1],this.endpoint=(r=this.head)==null?void 0:r.endpoint}advance(e){const{chars:t,states:n,skippedStates:i,result:r}=this;let o=null,a=0;const c=n[n.length-1];function l(h,u){if(h.isMatch(e)&&(++a===1?o=h:r.add(new Xu(t.concat(e),n.concat(h),u===null?i:i.concat(u),r))),c.segment===null&&h.isOptional&&h.nextStates!==null){if(h.nextStates.length>1)throw nc(`${h.nextStates.length} nextStates`);const d=h.nextStates[0];if(!d.isSeparator)throw nc("Not a separator");if(d.nextStates!==null)for(const f of d.nextStates)l(f,h)}}if(c.isDynamic&&l(c,null),c.nextStates!==null)for(const h of c.nextStates)l(h,null);o!==null&&(n.push(this.head=o),t.push(e),this.isConstrained=this.isConstrained||o.isDynamic&&o.segment.isConstrained,o.endpoint!==null&&(this.endpoint=o.endpoint)),a===0&&r.remove(this)}_finalize(){function e(t,n){const i=n.nextStates;if(i!==null){if(i.length===1&&i[0].segment===null)e(t,i[0]);else for(const r of i)if(r.isOptional&&r.endpoint!==null){if(t.push(r),r.nextStates!==null)for(const o of r.nextStates)e(t,o);break}}}return e(this.skippedStates,this.head),this.isConstrained?(this._getParams(),this.satisfiesConstraints):!0}_getParams(){var r;let e=this.params;if(e!=null)return e;const{states:t,chars:n,endpoint:i}=this;e={},this.satisfiesConstraints=!0;for(const o of i.params)e[o.name]=void 0;for(let o=0,a=t.length;o<a;++o){const c=t[o];if(c.isDynamic){const l=c.segment,h=l.name;if(e[h]===void 0?e[h]=n[o]:e[h]+=n[o],!(c.isConstrained&&!Object.is((r=t[o+1])==null?void 0:r.segment,l)))continue;this.satisfiesConstraints=this.satisfiesConstraints&&c.satisfiesConstraint(e[h])}}return this.satisfiesConstraints&&(this.params=e),e}compareTo(e){const t=this.states,n=e.states;for(let c=0,l=0,h=Math.max(t.length,n.length);c<h;++c){let u=t[c];if(u===void 0)return 1;let d=n[l];if(d===void 0)return-1;let f=u.segment,p=d.segment;if(f===null){if(p===null){++l;continue}if((u=t[++c])===void 0)return 1;f=u.segment}else if(p===null){if((d=n[++l])===void 0)return-1;p=d.segment}if(f.kind<p.kind)return 1;if(f.kind>p.kind)return-1;++l}const i=this.skippedStates,r=e.skippedStates,o=i.length,a=r.length;if(o<a)return 1;if(o>a)return-1;for(let c=0;c<o;++c){const l=i[c],h=r[c];if(l.length<h.length)return 1;if(l.length>h.length)return-1}return 0}}function qk(s){return s.head.endpoint!==null}function Gk(s,e){return s.compareTo(e)}class Wk{get isEmpty(){return this.candidates.length===0}constructor(e){this.candidates=[],this.candidates=[new Xu([""],[e],[],this)]}getSolution(){const e=this.candidates.filter(t=>qk(t)&&t._finalize());return e.length===0?null:(e.sort(Gk),e[0])}add(e){this.candidates.push(e)}remove(e){this.candidates.splice(this.candidates.indexOf(e),1)}advance(e){const t=this.candidates.slice();for(const n of t)n.advance(e)}}const er="$$residue",xp=/^:(?<name>[^?\s{}]+)(?:\{\{(?<constraint>.+)\}\})?(?<optional>\?)?$/g;let Qk=class{constructor(){this.rootState=new Zu(null,null,""),this.cache=new Map,this.endpointLookup=new Map}add(e,t=!1){var r,o;let n,i;if(e instanceof Array)for(const a of e)i=this.$add(a,!1),n=i.params,!(!t||(((r=n[n.length-1])==null?void 0:r.isStar)??!1))&&(i.residualEndpoint=this.$add({...a,path:`${a.path}/*${er}`},!0));else i=this.$add(e,!1),n=i.params,t&&!(((o=n[n.length-1])==null?void 0:o.isStar)??!1)&&(i.residualEndpoint=this.$add({...e,path:`${e.path}/*${er}`},!0));this.cache.clear()}$add(e,t){var h;const n=e.path,i=this.endpointLookup;if(i.has(n))throw nc(`Cannot add duplicate path '${n}'.`);const r=new Vk(n,e.caseSensitive===!0,e.handler),o=n===""?[""]:n.split("/").filter(Yk),a=[];let c=this.rootState;for(const u of o)switch(c=c.append(null,"/"),u.charAt(0)){case":":{xp.lastIndex=0;const d=xp.exec(u),{name:f,optional:p}=(d==null?void 0:d.groups)??{},m=p==="?";if(f===er)throw new Error(`Invalid parameter name; usage of the reserved parameter name '${er}' is used.`);const g=(h=d==null?void 0:d.groups)==null?void 0:h.constraint,v=g!=null?new RegExp(g):null;a.push(new Mp(f,m,!1,v)),c=new Xk(f,m,v).appendTo(c);break}case"*":{const d=u.slice(1);let f;if(d===er){if(!t)throw new Error(`Invalid parameter name; usage of the reserved parameter name '${er}' is used.`);f=1}else f=2;a.push(new Mp(d,!0,!0,null)),c=new Zk(d,f).appendTo(c);break}default:{c=new Jk(u,r.caseSensitive).appendTo(c);break}}const l=new jk(r,a);return c.setEndpoint(l),i.set(n,l),l}recognize(e){let t=this.cache.get(e);return t===void 0&&this.cache.set(e,t=this.$recognize(e)),t}$recognize(e){e=decodeURI(e),e.startsWith("/")||(e=`/${e}`),e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1));const t=new Wk(this.rootState);for(let o=0,a=e.length;o<a;++o){const c=e.charAt(o);if(t.advance(c),t.isEmpty)return null}const n=t.getSolution();if(n===null)return null;const{endpoint:i}=n,r=n._getParams();return new zk(i,r)}getEndpoint(e){return this.endpointLookup.get(e)??null}};class Zu{constructor(e,t,n){switch(this.prevState=e,this.segment=t,this.value=n,this.nextStates=null,this.endpoint=null,this.isConstrained=!1,t==null?void 0:t.kind){case 3:this.length=e.length+1,this.isSeparator=!1,this.isDynamic=!0,this.isOptional=t.optional,this.isConstrained=t.isConstrained;break;case 2:case 1:this.length=e.length+1,this.isSeparator=!1,this.isDynamic=!0,this.isOptional=!1;break;case 4:this.length=e.length+1,this.isSeparator=!1,this.isDynamic=!1,this.isOptional=!1;break;case void 0:this.length=e===null?0:e.length,this.isSeparator=!0,this.isDynamic=!1,this.isOptional=!1;break}}append(e,t){let n,i=this.nextStates;return i===null?(n=void 0,i=this.nextStates=[]):e===null?n=i.find(r=>r.value===t):n=i.find(r=>{var o;return(o=r.segment)==null?void 0:o.equals(e)}),n===void 0&&i.push(n=new Zu(this,e,t)),n}setEndpoint(e){if(this.endpoint!==null)throw nc(`Cannot add ambiguous route. The pattern '${e.route.path}' clashes with '${this.endpoint.route.path}'`);this.endpoint=e,this.isOptional&&(this.prevState.setEndpoint(e),this.prevState.isSeparator&&this.prevState.prevState!==null&&this.prevState.prevState.setEndpoint(e))}isMatch(e){const t=this.segment;switch(t==null?void 0:t.kind){case 3:return!this.value.includes(e);case 2:case 1:return!0;case 4:case void 0:return this.value.includes(e)}}satisfiesConstraint(e){return this.isConstrained?this.segment.satisfiesPattern(e):!0}}function Yk(s){return s.length>0}class Jk{get kind(){return 4}constructor(e,t){this.value=e,this.caseSensitive=t}appendTo(e){const{value:t,value:{length:n}}=this;if(this.caseSensitive)for(let i=0;i<n;++i)e=e.append(this,t.charAt(i));else for(let i=0;i<n;++i){const r=t.charAt(i);e=e.append(this,r.toUpperCase()+r.toLowerCase())}return e}equals(e){return e.kind===4&&e.caseSensitive===this.caseSensitive&&e.value===this.value}}class Xk{get kind(){return 3}constructor(e,t,n){if(this.name=e,this.optional=t,this.pattern=n,n===void 0)throw new Error("Pattern is undefined");this.isConstrained=n!==null}appendTo(e){return e=e.append(this,"/"),e}equals(e){return e.kind===3&&e.optional===this.optional&&e.name===this.name}satisfiesPattern(e){return this.pattern===null?!0:(this.pattern.lastIndex=0,this.pattern.test(e))}}class Zk{constructor(e,t){this.name=e,this.kind=t}appendTo(e){return e=e.append(this,""),e}equals(e){return(e.kind===2||e.kind===1)&&e.name===this.name}}const nc=s=>new Error(s);let ed=class{constructor(e,t,n,i={}){this.router=e,this.name=t,this.connectedCE=n,this.options=i,this.contents=[],this.transitionAction="",this.path=null}getContent(){return this.contents[0]}getNextContent(){return this.contents.length>1?this.contents[this.contents.length-1]:null}getTimeContent(e=1/0){return this.getContent()}getNavigationContent(e){return e instanceof Ko&&(e=e.navigation),e instanceof vt?this.contents.find(t=>t.navigation===e)??null:null}get activeContent(){return this.getNextContent()??this.getContent()}get connectedScope(){var e;return(e=this.activeContent)==null?void 0:e.connectedScope}get scope(){return this.connectedScope.scope}get owningScope(){return this.connectedScope.owningScope}get connectedController(){var e;return((e=this.connectedCE)==null?void 0:e.$controller)??null}get isViewport(){return this instanceof Ln}get isViewportScope(){return this instanceof _i}get isEmpty(){return!1}get pathname(){return this.connectedScope.pathname}toString(){throw new Error("Method 'toString' needs to be implemented in all endpoints!")}setNextContent(e,t){throw new Error("Method 'setNextContent' needs to be implemented in all endpoints!")}setConnectedCE(e,t){throw new Error("Method 'setConnectedCE' needs to be implemented in all endpoints!")}transition(e){throw new Error("Method 'transition' needs to be implemented in all endpoints!")}finalizeContentChange(e,t){throw new Error("Method 'finalizeContentChange' needs to be implemented in all endpoints!")}cancelContentChange(e,t=null){throw new Error("Method 'cancelContentChange' needs to be implemented in all endpoints!")}getRoutes(){throw new Error("Method 'getRoutes' needs to be implemented in all endpoints!")}getTitle(e){throw new Error("Method 'getTitle' needs to be implemented in all endpoints!")}removeEndpoint(e,t){return this.contents.forEach(n=>n.delete()),!0}canUnload(e,t){return!0}canLoad(e,t){return!0}unload(e,t){}load(e,t){}};class hy{constructor(e,t,n,i,r=U.create(""),o=vt.create({instruction:"",fullStateInstruction:""})){var a;this.router=e,this.endpoint=t,this.instruction=r,this.navigation=o,this.completed=!1,this.connectedScope=new Qi(e,i,n,this),this.router.rootScope!==null&&(((a=this.endpoint.connectedScope)==null?void 0:a.parent)??this.router.rootScope.scope).addChild(this.connectedScope)}get isActive(){return this.endpoint.activeContent===this}delete(){var e;(e=this.connectedScope.parent)==null||e.removeChild(this.connectedScope)}}class yi{constructor(e=null,t="",n=[],i="",r={}){this.match=e,this.matching=t,this.instructions=n,this.remaining=i,this.params=r}get foundConfiguration(){return this.match!==null}get foundInstructions(){return this.instructions.some(e=>!e.component.none)}get hasRemaining(){return this.instructions.some(e=>e.hasNextScopeInstructions)}}class un{static parse(e,t,n,i){if(!t)return{instructions:[],remaining:""};if(t.startsWith(e.sibling)&&!un.isAdd(e,t))throw new Error(`Instruction parser error: Unnecessary siblings separator ${e.sibling} in beginning of instruction part "${t}".`);const r=[];let o=1e3;for(;t.length&&o;)if(o--,t.startsWith(e.scope)){if(r.length===0)throw new Error(`Instruction parser error: Children without parent in instruction part "(${t}" is not allowed.`);i=!1,t=t.slice(e.scope.length);const a=t.startsWith(e.groupStart);a&&(t=t.slice(e.groupStart.length),n=!0);const{instructions:c,remaining:l}=un.parse(e,t,a,!1);r[r.length-1].nextScopeInstructions=c,t=l}else if(t.startsWith(e.groupStart)){t=t.slice(e.groupStart.length);const{instructions:a,remaining:c}=un.parse(e,t,!0,i);r.push(...a),t=c}else if(t.startsWith(e.groupEnd)){n&&(t=t.slice(e.groupEnd.length));let a=0;const c=t.length;for(;a<c;a++){if(t.slice(a,a+e.sibling.length)===e.sibling)return{instructions:r,remaining:t};if(t.slice(a,a+e.groupEnd.length)!==e.groupEnd){if(r.length>1)throw new Error(`Instruction parser error: Children below scope ${e.groupStart}${e.groupEnd} in instruction part "(${t}" is not allowed.`);t=t.slice(a);break}}if(a>=c)return{instructions:r,remaining:t}}else if(t.startsWith(e.sibling)&&!un.isAdd(e,t)){if(!n)return{instructions:r,remaining:t};t=t.slice(e.sibling.length)}else{const{instruction:a,remaining:c}=un.parseOne(e,t);r.push(a),t=c}return{instructions:r,remaining:t}}static isAdd(e,t){return t===e.add||t.startsWith(`${e.add}${e.viewport}`)}static parseOne(e,t){const n=[e.parameters,e.viewport,e.noScope,e.groupEnd,e.scope,e.sibling];let i,r,o,a=!0,c,l;const h=t,u=[e.add,e.clear];for(const f of u)if(t===f){i=t,t="",n.shift(),n.shift(),c=e.viewport;break}if(i===void 0){for(const f of u)if(t.startsWith(`${f}${e.viewport}`)){i=f,t=t.slice(`${f}${e.viewport}`.length),n.shift(),n.shift(),c=e.viewport;break}}if(i===void 0&&({token:c,pos:l}=un.findNextToken(t,n),i=l!==-1?t.slice(0,l):t,t=l!==-1?t.slice(l+c.length):"",n.shift(),c===e.parameters&&({token:c,pos:l}=un.findNextToken(t,[e.parametersEnd]),r=t.slice(0,l),t=t.slice(l+c.length),{token:c}=un.findNextToken(t,n),t=t.slice(c.length)),n.shift()),c===e.viewport&&({token:c,pos:l}=un.findNextToken(t,n),o=l!==-1?t.slice(0,l):t,t=l!==-1?t.slice(l+c.length):""),n.shift(),c===e.noScope&&(a=!1),(c===e.groupEnd||c===e.scope||c===e.sibling)&&(t=`${c}${t}`),(i??"")==="")throw new Error(`Instruction parser error: No component specified in instruction part "${t}".`);const d=U.create(i,o,r,a);return d.unparsed=h,{instruction:d,remaining:t}}static findNextToken(e,t){const n={};for(const r of t)e.indexOf(r)>-1&&(n[r]=e.indexOf(r));const i=Math.min(...Object.values(n));for(const r in n)if(n[r]===i)return{token:r,pos:i};return{token:"",pos:-1}}}class ic{constructor(e="${componentTitles}${appTitleSeparator}Aurelia",t=" | ",n="top-down",i=" > ",r=!0,o="app-",a){this.appTitle=e,this.appTitleSeparator=t,this.componentTitleOrder=n,this.componentTitleSeparator=i,this.useComponentNames=r,this.componentPrefix=o,this.transformTitle=a}static create(e={}){return e=typeof e=="string"?{appTitle:e}:e,new ic(e.appTitle,e.appTitleSeparator,e.componentTitleOrder,e.componentTitleSeparator,e.useComponentNames,e.componentPrefix,e.transformTitle)}static for(e){return $n.for(e).title}apply(e={}){e=typeof e=="string"?{appTitle:e}:e,this.appTitle=e.appTitle??this.appTitle,this.appTitleSeparator=e.appTitleSeparator??this.appTitleSeparator,this.componentTitleOrder=e.componentTitleOrder??this.componentTitleOrder,this.componentTitleSeparator=e.componentTitleSeparator??this.componentTitleSeparator,this.useComponentNames=e.useComponentNames??this.useComponentNames,this.componentPrefix=e.componentPrefix??this.componentPrefix,this.transformTitle="transformTitle"in e?e.transformTitle:this.transformTitle}}let Mt=class uy{constructor(e="@",t="+",n="/",i="(",r=")",o="!",a="(",c=")",l=",",h="=",u="+",d="-",f="."){this.viewport=e,this.sibling=t,this.scope=n,this.groupStart=i,this.groupEnd=r,this.noScope=o,this.parameters=a,this.parametersEnd=c,this.parameterSeparator=l,this.parameterKeySeparator=h,this.add=u,this.clear=d,this.action=f}static create(e={}){return new uy(e.viewport,e.sibling,e.scope,e.groupStart,e.groupEnd,e.noScope,e.parameters,e.parametersEnd,e.parameterSeparator,e.parameterKeySeparator,e.add,e.clear,e.action)}static for(e){return $n.for(e).separators}apply(e={}){this.viewport=e.viewport??this.viewport,this.sibling=e.sibling??this.sibling,this.scope=e.scope??this.scope,this.groupStart=e.groupStart??this.groupStart,this.groupEnd=e.groupEnd??this.groupEnd,this.noScope=e.noScope??this.noScope,this.parameters=e.parameters??this.parameters,this.parametersEnd=e.parametersEnd??this.parametersEnd,this.parameterSeparator=e.parameterSeparator??this.parameterSeparator,this.parameterKeySeparator=e.parameterKeySeparator??this.parameterKeySeparator,this.add=e.add??this.add,this.clear=e.clear??this.clear,this.action=e.action??this.action}};class sc{constructor(e="active",t="navigating"){this.loadActive=e,this.viewportNavigating=t}static create(e={}){return new sc(e.loadActive,e.viewportNavigating)}static for(e){return $n.for(e).indicators}apply(e={}){this.loadActive=e.loadActive??this.loadActive,this.viewportNavigating=e.viewportNavigating??this.viewportNavigating}}class $n{constructor(e=Mt.create(),t=sc.create(),n=!0,i=null,r=!0,o=0,a=!0,c=!0,l=!1,h=ic.create(),u=["guardedUnload","swapped","completed"],d="attach-next-detach-current",f="",p="abort"){this.separators=e,this.indicators=t,this.useUrlFragmentHash=n,this.basePath=i,this.useHref=r,this.statefulHistoryLength=o,this.useDirectRouting=a,this.useConfiguredRoutes=c,this.completeStateNavigations=l,this.title=h,this.navigationSyncStates=u,this.swapOrder=d,this.fallback=f,this.fallbackAction=p,this.registrationHooks=[]}static create(e={}){return new $n(Mt.create(e.separators),sc.create(e.indicators),e.useUrlFragmentHash,e.basePath,e.useHref,e.statefulHistoryLength,e.useDirectRouting,e.useConfiguredRoutes,e.completeStateNavigations,ic.create(e.title),e.navigationSyncStates,e.swapOrder,e.fallback,e.fallbackAction)}static for(e){return e instanceof kt||(e instanceof Kn?e=e.configuration:e=e.get(oc)),e.options}apply(e){e=e??{},this.separators.apply(e.separators),this.indicators.apply(e.indicators),this.useUrlFragmentHash=e.useUrlFragmentHash??this.useUrlFragmentHash,this.basePath=e.basePath??this.basePath,this.useHref=e.useHref??this.useHref,this.statefulHistoryLength=e.statefulHistoryLength??this.statefulHistoryLength,this.useDirectRouting=e.useDirectRouting??this.useDirectRouting,this.useConfiguredRoutes=e.useConfiguredRoutes??this.useConfiguredRoutes,this.completeStateNavigations=e.completeStateNavigations??this.completeStateNavigations,this.title.apply(e.title),this.navigationSyncStates=e.navigationSyncStates??this.navigationSyncStates,this.swapOrder=e.swapOrder??this.swapOrder,this.fallback=e.fallback??this.fallback,this.fallbackAction=e.fallbackAction??this.fallbackAction,Array.isArray(e.hooks)&&(this.routerConfiguration!==void 0?e.hooks.forEach(t=>this.routerConfiguration.addHook(t.hook,t.options)):this.registrationHooks=e.hooks)}setRouterConfiguration(e){this.routerConfiguration=e,this.registrationHooks.forEach(t=>this.routerConfiguration.addHook(t.hook,t.options)),this.registrationHooks.length=0}}class Ir{constructor(){this.parametersString=null,this.parametersRecord=null,this.parametersList=null,this.parametersType="none"}get none(){return this.parametersType==="none"}static create(e){const t=new Ir;return t.set(e),t}static parse(e,t,n=!1){if(t==null||t.length===0)return[];const i=Mt.for(e),r=i.parameterSeparator,o=i.parameterKeySeparator;if(typeof t=="string"){const c=[],l=t.split(r);for(const h of l){let u,d;[u,d]=h.split(o),d===void 0?(d=n?decodeURIComponent(u):u,u=void 0):n&&(u=decodeURIComponent(u),d=decodeURIComponent(d)),c.push({key:u,value:d})}return c}if(Array.isArray(t))return t.map(c=>({key:void 0,value:c}));const a=Object.keys(t);return a.sort(),a.map(c=>({key:c,value:t[c]}))}get typedParameters(){switch(this.parametersType){case"string":return this.parametersString;case"array":return this.parametersList;case"object":return this.parametersRecord;default:return null}}static stringify(e,t,n=!1){if(!Array.isArray(t)||t.length===0)return"";const i=Mt.for(e);return t.map(r=>{const o=r.key!==void 0&&n?encodeURIComponent(r.key):r.key,a=n?encodeURIComponent(r.value):r.value;return o!==void 0&&o!==a?o+i.parameterKeySeparator+a:a}).join(i.parameterSeparator)}static contains(e,t){return Object.keys(t).every(n=>t[n]===e[n])}parameters(e){return Ir.parse(e,this.typedParameters)}set(e){this.parametersString=null,this.parametersList=null,this.parametersRecord=null,e==null||e===""?(this.parametersType="none",e=null):typeof e=="string"?(this.parametersType="string",this.parametersString=e):Array.isArray(e)?(this.parametersType="array",this.parametersList=e):(this.parametersType="object",this.parametersRecord=e)}get(e,t){if(t===void 0)return this.parameters(e);const n=this.parameters(e).filter(i=>i.key===t).map(i=>i.value);if(n.length!==0)return n.length===1?n[0]:n}addParameters(e){if(this.parametersType==="none")return this.set(e);if(this.parametersType!=="object")throw new Error("Can't add object parameters to existing non-object parameters!");this.set({...this.parametersRecord,...e})}toSpecifiedParameters(e,t){t=t??[];const n=this.parameters(e),i={};for(const o of t){let a=n.findIndex(c=>c.key===o);if(a>=0){const[c]=n.splice(a,1);i[o]=c.value}else if(a=n.findIndex(c=>c.key===void 0),a>=0){const[c]=n.splice(a,1);i[o]=c.value}}for(const o of n.filter(a=>a.key!==void 0))i[o.key]=o.value;let r=t.length;for(const o of n.filter(a=>a.key===void 0))i[r++]=o.value;return i}toSortedParameters(e,t){t=t||[];const n=this.parameters(e),i=[];for(const o of t){let a=n.findIndex(c=>c.key===o);if(a>=0){const c={...n.splice(a,1)[0]};c.key=void 0,i.push(c)}else if(a=n.findIndex(c=>c.key===void 0),a>=0){const c={...n.splice(a,1)[0]};i.push(c)}else i.push({value:void 0})}const r=n.filter(o=>o.key!==void 0);return r.sort((o,a)=>(o.key||"")<(a.key||"")?1:(a.key||"")<(o.key||"")?-1:0),i.push(...r),i.push(...n.filter(o=>o.key===void 0)),i}same(e,t,n){const i=n!==null?n.parameters:[],r=this.toSpecifiedParameters(e,i),o=t.toSpecifiedParameters(e,i);return Object.keys(r).every(a=>r[a]===o[a])&&Object.keys(o).every(a=>o[a]===r[a])}}class me{constructor(){this.name=null,this.type=null,this.instance=null,this.promise=null,this.func=null}static create(e){const t=new me;return t.set(e),t}static isName(e){return typeof e=="string"}static isDefinition(e){return oe.isType(e.Type)}static isType(e){return oe.isType(e)}static isInstance(e){return qI(e)}static isAppelation(e){return me.isName(e)||me.isType(e)||me.isInstance(e)}static getName(e){return me.isName(e)?e:me.isType(e)?oe.getDefinition(e).name:me.getName(e.constructor)}static getType(e){return me.isName(e)?null:me.isType(e)?e:e.constructor}static getInstance(e){return me.isName(e)||me.isType(e)?null:e}set(e){let t=null,n=null,i=null,r=null,o=null;e instanceof Promise?r=e:me.isName(e)?t=me.getName(e):me.isType(e)?(t=this.getNewName(e),n=me.getType(e)):me.isInstance(e)?(t=this.getNewName(me.getType(e)),n=me.getType(e),i=me.getInstance(e)):typeof e=="function"&&(o=e),this.name=t,this.type=n,this.instance=i,this.promise=r,this.func=o}resolve(e){if(this.func!==null&&this.set(this.func(e)),this.promise instanceof Promise)return this.promise.then(t=>{if(me.isAppelation(t)){this.set(t);return}if(t.default!=null){this.set(t.default);return}const n=Object.keys(t).filter(r=>!r.startsWith("__"));if(n.length===0)throw new Error("Failed to load component Type from resolved Promise since no export was specified.");if(n.length>1)throw new Error("Failed to load component Type from resolved Promise since no 'default' export was specified when having multiple exports.");const i=n[0];this.set(t[i])})}get none(){return!this.isName()&&!this.isType()&&!this.isInstance()&&!this.isFunction()&&!this.isPromise()}isName(){return this.name!=null&&this.name!==""&&!this.isType()&&!this.isInstance()}isType(){return this.type!==null&&!this.isInstance()}isInstance(){return this.instance!==null}isPromise(){return this.promise!==null}isFunction(){return this.func!==null}toType(e,t){if(this.resolve(t),this.type!==null)return this.type;if(this.name!==null&&typeof this.name=="string"){if(e===null)throw new Error(`No container available when trying to resolve component '${this.name}'!`);if(e.has(oe.keyFrom(this.name),!0)){const n=e.getResolver(oe.keyFrom(this.name));if(n!==null&&n.getFactory!==void 0){const i=n.getFactory(e);if(i)return i.Type}}}return null}toInstance(e,t,n,i){if(this.resolve(i),this.instance!==null)return this.instance;if(e==null)return null;const r=e.createChild(),o=this.isType()?this.type:r.getResolver(oe.keyFrom(this.name)).getFactory(r).Type,a=r.invoke(o);if(a==null)throw console.warn("Failed to create instance when trying to resolve component",this.name,this.type,"=>",a),new Error(`Failed to create instance when trying to resolve component '${this.name}'!`);const c=Rt.$el(r,a,n,null);return c.parent=t,a}same(e,t=!1){return t?this.type===e.type:this.name===e.name}getNewName(e){return this.name===null?me.getName(e):this.name}}function Xe(s,e){const t=[];let n=s.findIndex(e);for(;n>=0;)t.push(s.splice(n,1)[0]),n=s.findIndex(e);return t}function eE(s,e){Array.isArray(e)||(e=[e]);for(const t of e)s.includes(t)||s.push(t);return s}function Fo(s,e=!1){return s.filter((t,n,i)=>(e||t!=null)&&i.indexOf(t)===n)}class Jt{constructor(){this.isPending=!0,this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this._resolve(e),this.isPending=!1}reject(e){this._reject(e),this.isPending=!1}}class Q{constructor(){this.isDone=!1,this.isCancelled=!1,this.isResolved=!1,this.isRejected=!1,this.isAsync=!1}static run(e,...t){if(t.length===0)return;let n=!1;e===null&&(e=new Pn,n=!0);const i=new Pn(t.shift());return Q.connect(e,i,((e==null?void 0:e.runParallel)??!1)||n),t.length>0&&Q.add(i,!1,...t),n?(Q.process(e),e.result instanceof Promise&&this.runners.set(e.result,e),e.result):i}static runParallel(e,...t){if(((t==null?void 0:t.length)??0)===0)return[];let n=!1;return e===null?(e=new Pn,n=!0):e=Q.connect(e,new Pn,!0),Q.add(e,!0,...t),n&&Q.process(e),e.result instanceof Promise&&this.runners.set(e.result,e),n?e.result??[]:e}static step(e){if(e instanceof Promise)return Q.runners.get(e)}static cancel(e){const t=Q.step(e);t!==void 0&&t.cancel()}static add(e,t,...n){let i=new Pn(n.shift(),t);e!==null&&(i=Q.connect(e,i,t));const r=i;for(;n.length>0;)i=Q.connect(i,new Pn(n.shift(),t),!1);return r}static connect(e,t,n){if(n){const i=e.child;e.child=t,t.parent=e,t.next=i,i!==null&&(i.parent=null,i.previous=t)}else{const i=e.next;e.next=t,t.previous=e,t.next=i,i!==null&&(i.previous=t,i.parent=null)}return t}static process(e){const t=e.root;for(;e!==null&&!e.isDoing&&!e.isDone;)if(t.current=e,e.isParallelParent){e.isDone=!0;let n=e.child;for(;n!==null;)Q.process(n),n=n.next}else{for(e.isDoing=!0,e.value=e.step;e.value instanceof Function&&!e.isCancelled&&!e.isExited&&!e.isDone;)e.value=e.value(e);if(!e.isCancelled)if(e.value instanceof Promise){const n=e.value;Q.ensurePromise(t),((i,r)=>{r.then(o=>{i.value=o,Q.settlePromise(i),i.isDone=!0,i.isDoing=!1;const a=i.nextToDo();a!==null&&!i.isExited?Q.process(a):(i.root.doneAll||i.isExited)&&Q.settlePromise(i.root)}).catch(o=>{throw o})})(e,n)}else e.isDone=!0,e.isDoing=!1,e.isExited?e=null:e=e.nextToDo()}t.isCancelled?Q.settlePromise(t,"reject"):(t.doneAll||t.isExited)&&Q.settlePromise(t)}static ensurePromise(e){return e.finally===null?(e.finally=new Jt,e.promise=e.finally.promise,!0):!1}static settlePromise(e,t="resolve"){var n,i,r;if(((n=e.finally)==null?void 0:n.isPending)??!1)switch(e.promise=null,t){case"resolve":(i=e.finally)==null||i.resolve(e.result);break;case"reject":(r=e.finally)==null||r.reject(e.result);break}}}Q.runners=new WeakMap;Q.roots={};class Pn{constructor(e=void 0,t=!1){this.step=e,this.runParallel=t,this.promise=null,this.previous=null,this.next=null,this.parent=null,this.child=null,this.current=null,this.finally=null,this.isDoing=!1,this.isDone=!1,this.isCancelled=!1,this.isExited=!1,this.exited=null,this.id="-1",this.id=`${Pn.id++}`}get isParallelParent(){var e;return((e=this.child)==null?void 0:e.runParallel)??!1}get result(){var t,n;if(this.promise!==null)return this.promise;if(this.child!==null)if(this.isParallelParent){const i=[];let r=this.child;for(;r!==null;)i.push(r.result),r=r.next;return i}else return this===this.root&&this.exited!==null?this.exited.result:(n=(t=this.child)==null?void 0:t.tail)==null?void 0:n.result;let e=this.value;for(;e instanceof Pn;)e=e.result;return e}get asValue(){return this.result}get previousValue(){var e,t,n,i;return this.runParallel?(n=(t=(e=this.head.parent)==null?void 0:e.parent)==null?void 0:t.previous)==null?void 0:n.result:(i=this.previous)==null?void 0:i.result}get name(){let e=`${this.id}`;return this.runParallel&&(e=`:${e}`),(this.value instanceof Promise||this.promise instanceof Promise)&&(e=`${e}*`),this.finally!==null&&(e=`${e}*`),this.child!==null&&(e=`${e}>`),this.isDone&&(e=`(${e})`),e}get root(){let e=this.head;for(;e.parent!==null;)e=e.parent.head;return e}get head(){let e=this;for(;e.previous!==null;)e=e.previous;return e}get tail(){let e=this;for(;e.next!==null;)e=e.next;return e}get done(){if(!this.isDone)return!1;let e=this.child;for(;e!==null;){if(!e.done)return!1;e=e.next}return!0}get doneAll(){return!(!this.isDone||this.child!==null&&!this.child.doneAll||this.next!==null&&!this.next.doneAll)}cancel(e=!0){var t,n;return e?this.root.cancel(!1):this.isCancelled?!1:(this.isCancelled=!0,(t=this.child)==null||t.cancel(!1),(n=this.next)==null||n.cancel(!1),!0)}exit(e=!0){var t,n;return e?(this.root.exited=this,this.root.exit(!1)):this.isExited?!1:(this.isExited=!0,(t=this.child)==null||t.exit(!1),(n=this.next)==null||n.exit(!1),!0)}nextToDo(){return this.child!==null&&!this.child.isDoing&&!this.child.isDone?this.child:this.runParallel&&!this.head.parent.done?null:this.nextOrUp()}nextOrUp(){let e=this.next;for(;e!==null;){if(!e.isDoing&&!e.isDone)return e;e=e.next}const t=this.head.parent??null;return t===null||!t.done?null:t.nextOrUp()}get path(){var e;return`${((e=this.head.parent)==null?void 0:e.path)??""}/${this.name}`}get tree(){let e="",t=this.head,n=t.parent,i="";for(;n!==null;)i=`${n.path}${i}`,n=n.head.parent;do{if(e+=`${i}/${t.name}
`,t===this)break;t=t.next}while(t!==null);return e}get report(){var t,n;let e=`${this.path}
`;return e+=((t=this.child)==null?void 0:t.report)??"",e+=((n=this.next)==null?void 0:n.report)??"",e}}Pn.id=0;const Ke=(s,...e)=>new Error(`AUR${String(s).padStart(4,"0")}: ${nE(s,...e)}`),tE={99:"Method {{0}} not implemented",2e3:"Router.start() called while the it has already been started.",2001:"Router.stop() has been called while it has not been started",2002:"Router failed to remove endpoint: {{0}}",2003:"Parameter instructions to checkActivate can not be a string ('{{0}}')!",2004:"Router failed to append routing instructions to coordinator",2005:"Router failed to find viewport when updating viewer paths.",2006:"{{0}} remaining instructions after 100 iterations; there is likely an infinite loop.",2007:"Browser navigation has already been started",2008:"Browser navigation has not been started",2009:`Failed to "{{0}}" state, probably due to unserializable data and/or parameters:
Serialization error: {{1}}
Original error: {originalError}`,2010:"Navigator has already been started",2011:"Navigator has not been started",2012:"Invalid route configuration: A component can't be specified in a component route configuration.",2013:"Invalid route configuration: The 'component' and 'instructions' properties can't be specified in a component route configuration.",2014:"Invalid route configuration: expected an object but got null/undefined.",2015:"Invalid route configuration: the 'instructions' property can't be used together with the 'component', 'viewport', 'parameters' or 'children' properties.",2016:"Invalid route configuration: either 'redirectTo' or 'instructions' need to be specified.",2017:`There was an error durating the instantiation of "{{0}}". "{{0}}" did not match any configured route or registered component name - did you forget to add the component "{{0}}" to the dependencies or to register it as a global dependency?
{{1:innerError}}`,2018:`Cannot find an element with the name "{{0}}", did you register it via "dependencies" option or <import> with convention?.
`,2019:"-- placeholder --",2020:"-- placeholder --",2021:"-- placeholder --",2022:"-- placeholder --",2023:"-- placeholder --",2024:"-- placeholder --",2025:"-- placeholder --",2026:"-- placeholder --"},nE=(s,...e)=>{var n;let t=tE[s];for(let i=0;i<e.length;++i){const r=new RegExp(`{{${i}(:.*)?}}`,"g");let o=r.exec(t);for(;o!=null;){const a=(n=o[1])==null?void 0:n.slice(1);let c=e[i];if(c!=null)switch(a){case"nodeName":c=c.nodeName.toLowerCase();break;case"name":c=c.name;break;case"typeof":c=typeof c;break;case"ctor":c=c.constructor.name;break;case"toString":c=Object.prototype.toString.call(c);break;case"join(!=)":c=c.join("!=");break;case"element":c=c==="*"?"all elements":`<${c} />`;break;case"innerError":c=`
Details:
${c}
${c instanceof Error&&c.cause!=null?`${String(c.cause)}
`:""}`;break;default:if(a!=null&&a.startsWith(".")){const l=a.slice(1).split(".");for(let h=0;h<l.length&&c!=null;++h)c=c[l[h]]}}t=t.slice(0,o.index)+String(c)+t.slice(r.lastIndex),o=r.exec(t)}}return t};class pt{constructor(e,t,n,i,r,o,a,c){this.path=e,this.id=t,this.redirectTo=n,this.instructions=i,this.caseSensitive=r,this.title=o,this.reloadBehavior=a,this.data=c}static configure(e,t){const n=pt.create(e,t);return $t.define(n,t,pt.resourceKey),t}static getConfiguration(e){const t=$t.get(pt.resourceKey,e)??{};return Array.isArray(e.parameters)&&(t.parameters=e.parameters),"title"in e&&(t.title=e.title),t instanceof pt?t:pt.create(t,e)}static create(e,t=null){t!==null&&(e=pt.transferTypeToComponent(e,t)),oe.isType(e)?e=pt.getConfiguration(e):t===null&&(e={...e});const n=pt.transferIndividualIntoInstructions(e);pt.validateRouteConfiguration(n);let i=n.path;return Array.isArray(i)&&(i=i.join(",")),new pt(n.path??"",n.id??i??null,n.redirectTo??null,n.instructions??null,n.caseSensitive??!1,n.title??null,n.reloadBehavior??null,n.data??null)}static transferTypeToComponent(e,t){if(oe.isType(e))throw Ke(2012);const n={...e};if("component"in n||"instructions"in n)throw Ke(2013);return"redirectTo"in n||(n.component=t),!("path"in n)&&!("redirectTo"in n)&&(n.path=oe.getDefinition(t).name),n}static transferIndividualIntoInstructions(e){if(e==null)throw Ke(2014);if(e.component!=null||e.viewport!=null||e.parameters!=null||e.children!=null){if(e.instructions!=null)throw Ke(2015);e.instructions=[{component:e.component,viewport:e.viewport,parameters:e.parameters,children:e.children}]}return e}static validateRouteConfiguration(e){if(e.redirectTo===null&&e.instructions===null)throw Ke(2016)}}pt.resourceKey=ki("route");const Ro={name:ki("routes"),isConfigured(s){return $t.has(Ro.name,s)||"routes"in s},configure(s,e){const t=s.map(n=>pt.create(n));return $t.define(t,e,Ro.name),e},getConfiguration(s){const e=s,t=[],n=$t.get(Ro.name,s);return Array.isArray(n)&&t.push(...n),Array.isArray(e.routes)&&t.push(...e.routes),t.map(i=>i instanceof pt?i:pt.create(i))}};class Ml extends hy{}class _i extends ed{constructor(e,t,n,i,r,o=null,a={catches:[],source:null}){super(e,t,n),this.rootComponentType=o,this.options=a,this.instruction=null,this.available=!0,this.sourceItem=null,this.sourceItemIndex=-1,this.remove=!1,this.add=!1,this.contents.push(new Ml(e,this,i,r)),this.catches.length>0&&(this.instruction=U.create(this.catches[0],this.name))}get isEmpty(){return this.instruction===null}get passThroughScope(){return this.rootComponentType===null&&this.catches.length===0}get siblings(){const e=this.connectedScope.parent;return e===null?[this]:e.enabledChildren.filter(t=>t.isViewportScope&&t.endpoint.name===this.name).map(t=>t.endpoint)}get source(){return this.options.source??null}get catches(){let e=this.options.catches??[];return typeof e=="string"&&(e=e.split(",")),e}get default(){if(this.catches.length>0)return this.catches[0]}toString(){var n,i;const e=((n=this.instruction)==null?void 0:n.component.name)??"",t=((i=this.getNextContent())==null?void 0:i.instruction.component.name)??"";return`vs:${this.name}[${e}->${t}]`}setNextContent(e,t){return e.endpoint.set(this),this.remove=e.isClear(this.router)||e.isClearAll(this.router),this.add=e.isAdd(this.router)&&Array.isArray(this.source),this.add&&(e.component.name=null),this.default!==void 0&&e.component.name===null&&(e.component.name=this.default),this.contents.push(new Ml(this.router,this,this.owningScope,this.scope.hasScope,e,t)),"swap"}transition(e){Q.run(null,t=>e.setEndpointStep(this,t.root),()=>e.addEndpointState(this,"guardedUnload"),()=>e.addEndpointState(this,"guardedLoad"),()=>e.addEndpointState(this,"guarded"),()=>e.addEndpointState(this,"loaded"),()=>e.addEndpointState(this,"unloaded"),()=>e.addEndpointState(this,"routed"),()=>e.addEndpointState(this,"swapped"),()=>e.addEndpointState(this,"completed"))}finalizeContentChange(e,t){const n=this.contents.findIndex(o=>o.navigation===e.navigation);let i=this.contents[n];if(this.remove){const o=new Ml(this.router,this,this.owningScope,this.scope.hasScope);this.contents.splice(n,1,o),i.delete(),i=o}i.completed=!0;let r=0;for(let o=0,a=n;o<a&&(this.contents[0].navigation.completed??!1);o++)r++;this.contents.splice(0,r),this.remove&&Array.isArray(this.source)&&this.removeSourceItem()}cancelContentChange(e,t=null){[...new Set(this.scope.children.map(i=>i.endpoint))].forEach(i=>i.cancelContentChange(e,t));const n=this.contents.findIndex(i=>i.navigation===e.navigation);if(!(n<0)&&(this.contents.splice(n,1),this.add)){const i=this.source.indexOf(this.sourceItem);this.source.splice(i,1),this.sourceItem=null}}acceptSegment(e){return!!(e===null&&e===void 0||e.length===0||e===U.clear(this.router)||e===U.add(this.router)||e===this.name||this.catches.length===0||this.catches.includes(e)||this.catches.filter(t=>t.includes("*")).length)}binding(){(this.source||[]).length>0&&this.sourceItem===null&&(this.sourceItem=this.getAvailableSourceItem())}unbinding(){this.sourceItem!==null&&this.source!==null&&Xe(this.source,e=>e===this.sourceItem),this.sourceItem=null}getAvailableSourceItem(){if(this.source===null)return null;const e=this.siblings;for(const t of this.source)if(e.every(n=>n.sourceItem!==t))return t;return null}addSourceItem(){const e={};return this.source.push(e),e}removeSourceItem(){this.sourceItemIndex=this.source.indexOf(this.sourceItem),this.sourceItemIndex>=0&&this.source.splice(this.sourceItemIndex,1)}getRoutes(){const e=[];if(this.rootComponentType!==null){const t=this.rootComponentType.constructor===this.rootComponentType.constructor.constructor?this.rootComponentType:this.rootComponentType.constructor;e.push(...Ro.getConfiguration(t)??[])}return e}}class iE{constructor(e={instruction:"",fullStateInstruction:""}){this.instruction=e.instruction,this.fullStateInstruction=e.fullStateInstruction,this.scope=e.scope,this.index=e.index,this.firstEntry=e.firstEntry,this.path=e.path,this.title=e.title,this.query=e.query,this.fragment=e.fragment,this.parameters=e.parameters,this.data=e.data}toStoredNavigation(){return{instruction:this.instruction,fullStateInstruction:this.fullStateInstruction,scope:this.scope,index:this.index,firstEntry:this.firstEntry,path:this.path,title:this.title,query:this.query,fragment:this.fragment,parameters:this.parameters,data:this.data}}}class dy{constructor(){this.first=!1,this.new=!1,this.refresh=!1,this.forward=!1,this.back=!1,this.replace=!1}}class vt extends iE{constructor(e={instruction:"",fullStateInstruction:""}){super(e),this.navigation=new dy,this.repeating=!1,this.previous=null,this.fromBrowser=!1,this.origin=null,this.replacing=!1,this.refreshing=!1,this.untracked=!1,this.process=null,this.completed=!0,this.fromBrowser=e.fromBrowser??this.fromBrowser,this.origin=e.origin??this.origin,this.replacing=e.replacing??this.replacing,this.refreshing=e.refreshing??this.refreshing,this.untracked=e.untracked??this.untracked,this.historyMovement=e.historyMovement??this.historyMovement,this.process=null,this.timestamp=Date.now()}get useFullStateInstruction(){return(this.navigation.back??!1)||(this.navigation.forward??!1)||(this.navigation.refresh??!1)}static create(e={instruction:"",fullStateInstruction:""}){return new vt(e)}}class td{constructor(){this.map=new Map}set(e,t){const n=this.map.get(e);n instanceof Jt&&n.resolve(t),this.map.set(e,t)}delete(e){const t=this.map.get(e);t instanceof Jt&&t.reject(),this.map.delete(e)}await(e){if(!this.map.has(e)){const n=new Jt;return this.map.set(e,n),n.promise}const t=this.map.get(e);return t instanceof Jt?t.promise:t}has(e){return this.map.has(e)&&!(this.map.get(e)instanceof Jt)}clone(){const e=new td;return e.map=new Map(this.map),e}}class va extends hy{constructor(e,t,n,i,r=U.create(""),o=vt.create({instruction:"",fullStateInstruction:""}),a=null){super(e,t,n,i,r,o),this.router=e,this.instruction=r,this.navigation=o,this.contentStates=new td,this.fromCache=!1,this.fromHistory=!1,this.reload=!1,this.activatedResolve=null,!this.instruction.component.isType()&&(a==null?void 0:a.container)!=null&&(this.instruction.component.type=this.toComponentType(a.container))}get componentInstance(){return this.instruction.component.instance}get reloadBehavior(){var e,t;return this.instruction.route instanceof yi&&((e=this.instruction.route.match)==null?void 0:e.reloadBehavior)!==null?(t=this.instruction.route.match)==null?void 0:t.reloadBehavior:this.instruction.component.instance!==null&&"reloadBehavior"in this.instruction.component.instance&&this.instruction.component.instance.reloadBehavior!==void 0?this.instruction.component.instance.reloadBehavior:"default"}get controller(){var e;return(e=this.instruction.component.instance)==null?void 0:e.$controller}equalComponent(e){return this.instruction.sameComponent(this.router,e.instruction)}equalParameters(e){return this.instruction.sameComponent(this.router,e.instruction,!0)&&(this.navigation.query??"")===(e.navigation.query??"")}isCacheEqual(e){return this.instruction.sameComponent(this.router,e.instruction,!0)}contentController(e){return Rt.$el(e.container.createChild(),this.instruction.component.instance,e.element,null)}createComponent(e,t,n,i){if(!this.contentStates.has("created")){if(!this.fromCache&&!this.fromHistory)try{this.instruction.component.set(this.toComponentInstance(t.container,t.controller,t.element))}catch(r){if(!r.message.startsWith("AUR0009:"))throw r;{const o=this.instruction.component.name;console.warn(Ke(2017,o,r))}if((n??"")!==""){i==="process-children"?this.instruction.parameters.set([this.instruction.component.name]):(this.instruction.parameters.set([this.instruction.unparsed??this.instruction.component.name]),this.instruction.hasNextScopeInstructions&&(e.removeInstructions(this.instruction.nextScopeInstructions),this.instruction.nextScopeInstructions=null)),this.instruction.component.set(n);try{this.instruction.component.set(this.toComponentInstance(t.container,t.controller,t.element))}catch(o){if(!o.message.startsWith("AUR0009:"))throw o;const a=this.instruction.component.name;throw Ke(2017,a,o)}}else{const o=this.instruction.component.name;throw Ke(2017,o)}}this.contentStates.set("created",void 0)}}canLoad(){var o,a,c;if(!this.contentStates.has("created")||this.contentStates.has("checkedLoad")&&!this.reload)return!0;const e=this.instruction.component.instance;if(e==null)return!0;this.contentStates.set("checkedLoad",void 0);const t=(c=(a=(o=this.endpoint.parentViewport)==null?void 0:o.getTimeContent(this.navigation.timestamp))==null?void 0:a.instruction)==null?void 0:c.typeParameters(this.router),n=this.instruction.typeParameters(this.router),i={...this.navigation.parameters,...t,...n},r=this._getLifecycleHooks(e,"canLoad").map(l=>h=>(h==null?void 0:h.previousValue)!=null&&h.previousValue!==!0?(h.exit(),h.previousValue??!1):l(e,i,this.instruction,this.navigation));return e.canLoad!=null&&r.push(l=>((l==null?void 0:l.previousValue)??!0)===!1?!1:e.canLoad(i,this.instruction,this.navigation)),r.length===0?!0:r.length===1?r[0](null):Q.run(null,...r)}canUnload(e){if(this.contentStates.has("checkedUnload")&&!this.reload||(this.contentStates.set("checkedUnload",void 0),!this.contentStates.has("loaded")))return!0;const t=this.instruction.component.instance;e===null&&(e=vt.create({instruction:"",fullStateInstruction:"",previous:this.navigation}));const n=this._getLifecycleHooks(t,"canUnload").map(i=>r=>((r==null?void 0:r.previousValue)??!0)===!1?!1:i(t,this.instruction,e));return t.canUnload!=null&&n.push(i=>{var r;return((i==null?void 0:i.previousValue)??!0)===!1?!1:(r=t.canUnload)==null?void 0:r.call(t,this.instruction,e)}),n.length===0?!0:n.length===1?n[0](null):Q.run(null,...n)}load(e){return Q.run(e,()=>this.contentStates.await("checkedLoad"),()=>{var a,c,l;if(!this.contentStates.has("created")||this.contentStates.has("loaded")&&!this.reload)return;this.reload=!1,this.contentStates.set("loaded",void 0);const t=this.instruction.component.instance,n=(l=(c=(a=this.endpoint.parentViewport)==null?void 0:a.getTimeContent(this.navigation.timestamp))==null?void 0:c.instruction)==null?void 0:l.typeParameters(this.router),i=this.instruction.typeParameters(this.router),r={...this.navigation.parameters,...n,...i},o=this._getLifecycleHooks(t,"loading").map(h=>()=>h(t,r,this.instruction,this.navigation));if(o.push(...this._getLifecycleHooks(t,"load").map(h=>()=>(console.warn(`[Deprecated] Found deprecated hook name "load" in ${this.instruction.component.name}. Please use the new name "loading" instead.`),h(t,r,this.instruction,this.navigation)))),o.length!==0)return typeof t.loading=="function"&&o.push(()=>t.loading(r,this.instruction,this.navigation)),ds(t,"load")&&(console.warn(`[Deprecated] Found deprecated hook name "load" in ${this.instruction.component.name}. Please use the new name "loading" instead.`),o.push(()=>t.load(r,this.instruction,this.navigation))),Q.run(null,...o);if(ds(t,"loading"))return t.loading(r,this.instruction,this.navigation);if(ds(t,"load"))return console.warn(`[Deprecated] Found deprecated hook name "load" in ${this.instruction.component.name}. Please use the new name "loading" instead.`),t.load(r,this.instruction,this.navigation)})}unload(e){if(!this.contentStates.has("loaded"))return;this.contentStates.delete("loaded");const t=this.instruction.component.instance;e===null&&(e=vt.create({instruction:"",fullStateInstruction:"",previous:this.navigation}));const n=this._getLifecycleHooks(t,"unloading").map(i=>()=>i(t,this.instruction,e));if(n.push(...this._getLifecycleHooks(t,"unload").map(i=>()=>(console.warn(`[Deprecated] Found deprecated hook name "unload" in ${this.instruction.component.name}. Please use the new name "unloading" instead.`),i(t,this.instruction,e)))),n.length!==0)return ds(t,"unloading")&&n.push(()=>t.unloading(this.instruction,e)),ds(t,"unload")&&(console.warn(`[Deprecated] Found deprecated hook name "unload" in ${this.instruction.component.name}. Please use the new name "unloading" instead.`),n.push(()=>t.unload(this.instruction,e))),Q.run(null,...n);if(ds(t,"unloading"))return t.unloading(this.instruction,e);if(ds(t,"unload"))return console.warn(`[Deprecated] Found deprecated hook name "unload" in ${this.instruction.component.name}. Please use the new name "unloading" instead.`),t.unload(this.instruction,e)}activateComponent(e,t,n,i,r,o){return Q.run(e,()=>this.contentStates.await("loaded"),()=>this.waitForParent(n),()=>{var a;if(!(this.contentStates.has("activating")||this.contentStates.has("activated")))return this.contentStates.set("activating",void 0),(a=this.controller)==null?void 0:a.activate(t??this.controller,n,void 0)},()=>{this.contentStates.set("activated",void 0)})}deactivateComponent(e,t,n,i,r=!1){if(!(!this.contentStates.has("activated")&&!this.contentStates.has("activating")))return Q.run(e,()=>{var o;if(r&&i.element!==null){const a=Array.from(i.element.getElementsByTagName("*"));for(const c of a)(c.scrollTop>0||c.scrollLeft)&&c.setAttribute("au-element-scroll",`${c.scrollTop},${c.scrollLeft}`)}return this.contentStates.delete("activated"),this.contentStates.delete("activating"),(o=this.controller)==null?void 0:o.deactivate(t??this.controller,n)})}disposeComponent(e,t,n=!1){var i;if(!(!this.contentStates.has("created")||this.instruction.component.instance==null))if(n)t.push(this);else return this.contentStates.delete("created"),(i=this.controller)==null?void 0:i.dispose()}freeContent(e,t,n,i,r=!1){return Q.run(e,()=>this.unload(n),o=>this.deactivateComponent(o,null,t.controller,t,r),()=>this.disposeComponent(t,i,r))}toComponentName(){return this.instruction.component.name}toComponentType(e){return this.instruction.component.none?null:this.instruction.component.toType(e,this.instruction)}toComponentInstance(e,t,n){return this.instruction.component.none?null:this.instruction.component.toInstance(e,t,n,this.instruction)}waitForParent(e){if(e!==null&&!e.isActive)return new Promise(t=>{this.endpoint.activeResolve=t})}_getLifecycleHooks(e,t){return(e.$controller.lifecycleHooks[t]??[]).map(i=>i.instance[t].bind(i.instance))}}function ds(s,e){return typeof s[e]=="function"}class rc{constructor(e=!0,t=[],n="",i="",r="",o=!1,a=!1,c=!1,l=!1,h=!1){this.scope=e,this.usedBy=t,this.fallback=i,this.fallbackAction=r,this.noLink=o,this.noTitle=a,this.stateful=c,this.forceDescription=l,this.noHistory=h,this.default=void 0,this.default=n}static create(e){const t=new rc;return e!==void 0&&t.apply(e),t}apply(e){this.scope=e.scope??this.scope,this.usedBy=(typeof e.usedBy=="string"?e.usedBy.split(",").filter(t=>t.length>0):e.usedBy)??this.usedBy,this.default=e.default??this.default,this.fallback=e.fallback??this.fallback,this.fallbackAction=e.fallbackAction??this.fallbackAction,this.noLink=e.noLink??this.noLink,this.noTitle=e.noTitle??this.noTitle,this.stateful=e.stateful??this.stateful,this.forceDescription=e.forceDescription??this.forceDescription,this.noHistory=e.noHistory??this.noHistory}}class Ln extends ed{constructor(e,t,n,i,r,o){super(e,t,n),this.contents=[],this.forceRemove=!1,this.options=new rc,this.activeResolve=null,this.connectionResolve=null,this.clear=!1,this.coordinators=[],this.previousViewportState=null,this.cache=[],this.historyCache=[],this.contents.push(new va(e,this,i,r)),this.contents[0].completed=!0,o!==void 0&&this.options.apply(o)}getContent(){if(this.contents.length===1)return this.contents[0];let e;for(let t=0,n=this.contents.length;t<n&&(this.contents[t].completed??!1);t++)e=this.contents[t];return e}getNextContent(){if(this.contents.length===1)return null;const e=this.contents.indexOf(this.getContent());return this.contents.length>e?this.contents[e+1]:null}getTimeContent(e){let t=null;for(let n=0,i=this.contents.length;n<i&&!(this.contents[n].navigation.timestamp>e);n++)t=this.contents[n];return t}getNavigationContent(e){return super.getNavigationContent(e)}get parentViewport(){let e=this.connectedScope;for(;(e==null?void 0:e.parent)!=null;)if(e=e.parent,e.endpoint.isViewport)return e.endpoint;return null}get isEmpty(){return this.getContent().componentInstance===null}get doForceRemove(){let e=this.connectedScope;for(;e!==null;){if(e.isViewport&&e.endpoint.forceRemove)return!0;e=e.parent}return!1}isActiveNavigation(e){return this.coordinators[this.coordinators.length-1]===e}toString(){var n,i;const e=((n=this.getContent())==null?void 0:n.instruction.component.name)??"",t=((i=this.getNextContent())==null?void 0:i.instruction.component.name)??"";return`v:${this.name}[${e}->${t}]`}setNextContent(e,t){e.endpoint.set(this),this.clear=e.isClear(this.router);const n=this.getContent(),i=new va(this.router,this,this.owningScope,this.scope.hasScope,this.clear?void 0:e,t,this.connectedCE??null);if(this.contents.push(i),i.fromHistory=i.componentInstance!==null&&t.navigation!=null?!!t.navigation.back||!!t.navigation.forward:!1,this.options.stateful){const r=this.cache.find(o=>i.isCacheEqual(o));r!==void 0?(this.contents.splice(this.contents.indexOf(i),1,r),i.fromCache=!0):this.cache.push(i)}return i.componentInstance!==null&&n.componentInstance===i.componentInstance?(i.delete(),this.contents.splice(this.contents.indexOf(i),1),this.transitionAction="skip"):!n.equalComponent(i)||t.navigation.refresh||n.reloadBehavior==="refresh"?this.transitionAction="swap":n.reloadBehavior==="disallow"?(i.delete(),this.contents.splice(this.contents.indexOf(i),1),this.transitionAction="skip"):n.reloadBehavior==="reload"?(n.reload=!0,i.instruction.component.set(n.componentInstance),i.contentStates=n.contentStates.clone(),i.reload=n.reload,this.transitionAction="reload"):this.options.stateful&&n.equalParameters(i)?(i.delete(),this.contents.splice(this.contents.indexOf(i),1),this.transitionAction="skip"):n.equalParameters(i)?(i.delete(),this.contents.splice(this.contents.indexOf(i),1),this.transitionAction="skip"):this.transitionAction="swap"}setConnectedCE(e,t){var i,r,o,a;t=t??{},this.connectedCE!==e&&(this.previousViewportState={...this},this.clearState(),this.connectedCE=e,this.options.apply(t),(i=this.connectionResolve)==null||i.call(this));const n=(((r=this.scope.parent)==null?void 0:r.endpoint.getRoutes())??[]).filter(c=>(Array.isArray(c.path)?c.path:[c.path]).includes("")).length>0;if(this.getContent().componentInstance===null&&((o=this.getNextContent())==null?void 0:o.componentInstance)==null&&(this.options.default||n)){const c=U.parse(this.router,this.options.default??"");if(c.length===0&&n){const l=(a=this.scope.parent)==null?void 0:a.findInstructions([U.create("")],!1,this.router.configuration.options.useConfiguredRoutes);l!=null&&l.foundConfiguration&&c.push(...l.instructions)}for(const l of c)l.endpoint.set(this),l.scope=this.owningScope,l.default=!0;this.router.load(c,{append:!0}).catch(l=>{throw l})}}remove(e,t){return this.connectedCE===t?Q.run(e,n=>{var i;if(this.getContent().componentInstance!==null)return this.getContent().freeContent(n,this.connectedCE,((i=this.getNextContent())==null?void 0:i.navigation)??null,this.historyCache,this.doForceRemove?!1:this.router.statefulHistory||this.options.stateful)},n=>{if(this.doForceRemove){const i=[];for(const r of this.historyCache)i.push(o=>r.freeContent(o,null,null,this.historyCache,!1));return i.push(()=>{this.historyCache=[]}),Q.run(n,...i)}return!0}):!1}async transition(e){var l,h,u,d;const t=this.router.configuration.options.indicators.viewportNavigating;for(this.coordinators.push(e);this.coordinators[0]!==e;)await this.coordinators[0].waitForSyncState("completed");let n=this.parentViewport;n!==null&&n.transitionAction!=="reload"&&n.transitionAction!=="swap"&&(n=null);const i=[f=>{if(this.isActiveNavigation(e))return this.canUnload(e,f)},f=>{if(this.isActiveNavigation(e)){if((f.previousValue??!0)===!1)e.cancel();else if(this.router.isRestrictedNavigation){const p=this.router.configuration.options;this.getNavigationContent(e).createComponent(e,this.connectedCE,this.options.fallback||p.fallback,this.options.fallbackAction||p.fallbackAction)}}e.addEndpointState(this,"guardedUnload")},()=>e.waitForSyncState("guardedUnload",this),()=>n!==null?e.waitForEndpointState(n,"guardedLoad"):void 0,f=>{if(this.isActiveNavigation(e))return this.canLoad(e,f)},f=>{var p;if(this.isActiveNavigation(e)){let m=f.previousValue??!0;if(typeof m=="boolean"){if(!m){f.cancel(),e.cancel();const g=this.getNavigationContent(e).instruction;e.removeInstructions(g.dynasty),g.nextScopeInstructions=null;return}}else{const g=this.getNavigationContent(e).instruction;if(e.removeInstructions(g.dynasty),g.nextScopeInstructions=null,typeof m=="string"){const v=this.scope,S=this.router.configuration.options;let R=U.parse(this.router,m);const C=(p=v.parent)==null?void 0:p.findInstructions(R,S.useDirectRouting,S.useConfiguredRoutes);(C!=null&&C.foundConfiguration||C!=null&&C.foundInstructions)&&(R=C.instructions);for(const I of R)I.endpoint.set(this),I.scope=v.owningScope;m=R}return Q.run(f,v=>this.cancelContentChange(e,v),v=>(this.router.load(m,{append:e}),v.exit()))}}e.addEndpointState(this,"guardedLoad"),e.addEndpointState(this,"guarded")}],r=[()=>e.waitForSyncState("guarded",this),f=>{if(this.isActiveNavigation(e))return this.unload(e,f)},()=>e.addEndpointState(this,"unloaded"),()=>e.waitForSyncState("unloaded",this),()=>n!==null?e.waitForEndpointState(n,"loaded"):void 0,f=>{if(this.isActiveNavigation(e))return this.load(e,f)},()=>e.addEndpointState(this,"loaded"),()=>e.addEndpointState(this,"routed")],o=[()=>e.waitForSyncState("routed",this),()=>e.waitForEndpointState(this,"routed")];switch(this.router.configuration.options.swapOrder){case"detach-current-attach-next":o.push(f=>{if(this.isActiveNavigation(e))return this.removeContent(f,e)},f=>{if(this.isActiveNavigation(e))return this.addContent(f,e)});break;case"attach-next-detach-current":o.push(f=>{if(this.isActiveNavigation(e))return this.addContent(f,e)},f=>{if(this.isActiveNavigation(e))return this.removeContent(f,e)});break;case"detach-attach-simultaneously":o.push(f=>Q.runParallel(f,p=>{if(this.isActiveNavigation(e))return this.removeContent(p,e)},p=>{if(this.isActiveNavigation(e))return this.addContent(p,e)}));break;case"attach-detach-simultaneously":o.push(f=>Q.runParallel(f,p=>{if(this.isActiveNavigation(e))return this.addContent(p,e)},p=>{if(this.isActiveNavigation(e))return this.removeContent(p,e)}));break}o.push(()=>e.addEndpointState(this,"swapped")),(h=(l=this.connectedCE)==null?void 0:l.setActivity)==null||h.call(l,t,!0),(d=(u=this.connectedCE)==null?void 0:u.setActivity)==null||d.call(u,e.navigation.navigation,!0);const c=Q.run(null,f=>e.setEndpointStep(this,f.root),...i,...r,...o,()=>e.addEndpointState(this,"completed"),()=>e.waitForSyncState("bound"),()=>{var f,p,m,g;(p=(f=this.connectedCE)==null?void 0:f.setActivity)==null||p.call(f,t,!1),(g=(m=this.connectedCE)==null?void 0:m.setActivity)==null||g.call(m,e.navigation.navigation,!1)});c instanceof Promise&&c.catch(f=>{})}canUnload(e,t){return Q.run(t,n=>this.getContent().connectedScope.canUnload(e,n),n=>(n.previousValue??!0)===!1?!1:this.getContent().canUnload(e.navigation))}canLoad(e,t){return this.clear?!0:Q.run(t,()=>this.waitForConnected(),()=>{const n=this.router.configuration.options,i=this.getNavigationContent(e);return i.createComponent(e,this.connectedCE,this.options.fallback||n.fallback,this.options.fallbackAction||n.fallbackAction),i.canLoad()})}load(e,t){if(!this.clear)return this.getNavigationContent(e).load(t)}addContent(e,t){return this.activate(e,null,this.connectedController,t)}removeContent(e,t){if(this.isEmpty)return;const n=this.router.statefulHistory||(this.options.stateful??!1);return Q.run(e,()=>t.addEndpointState(this,"bound"),()=>t.waitForSyncState("bound"),i=>this.deactivate(i,null,this.connectedController),()=>n?this.dispose():void 0)}activate(e,t,n,i){if(this.activeContent.componentInstance!==null)return Q.run(e,()=>this.activeContent.canLoad(),r=>this.activeContent.load(r),r=>this.activeContent.activateComponent(r,t,n,this.connectedCE,()=>i==null?void 0:i.addEndpointState(this,"bound"),i==null?void 0:i.waitForSyncState("bound")))}deactivate(e,t,n){var r;const i=this.getContent();if((i==null?void 0:i.componentInstance)!=null&&!i.reload&&i.componentInstance!==((r=this.getNextContent())==null?void 0:r.componentInstance))return i.deactivateComponent(e,t,n,this.connectedCE,this.router.statefulHistory||this.options.stateful)}unload(e,t){return Q.run(t,n=>this.getContent().connectedScope.unload(e,n),()=>this.getContent().componentInstance!=null?this.getContent().unload(e.navigation??null):void 0)}dispose(){var e;this.getContent().componentInstance!==null&&!this.getContent().reload&&this.getContent().componentInstance!==((e=this.getNextContent())==null?void 0:e.componentInstance)&&this.getContent().disposeComponent(this.connectedCE,this.historyCache,this.router.statefulHistory||this.options.stateful)}finalizeContentChange(e,t){var c,l,h,u;const n=this.contents.findIndex(d=>d.navigation===e.navigation);let i=this.contents[n];const r=this.contents[n-1];if(this.clear){const d=new va(this.router,this,this.owningScope,this.scope.hasScope,void 0,i.navigation);this.contents.splice(n,1,d),i.delete(),i=d}else i.reload=!1;r.delete(),i.completed=!0,this.transitionAction="",i.contentStates.delete("checkedUnload"),i.contentStates.delete("checkedLoad"),this.previousViewportState=null;const o=this.router.configuration.options.indicators.viewportNavigating;(l=(c=this.connectedCE)==null?void 0:c.setActivity)==null||l.call(c,o,!1),(u=(h=this.connectedCE)==null?void 0:h.setActivity)==null||u.call(h,e.navigation.navigation,!1);let a=0;for(let d=0,f=n;d<f&&(this.contents[0].navigation.completed??!1);d++)a++;this.contents.splice(0,a),Xe(this.coordinators,d=>d===e)}cancelContentChange(e,t=null){var a;[...new Set(this.scope.children.map(c=>c.endpoint))].forEach(c=>c.cancelContentChange(e,t));const n=this.contents.findIndex(c=>c.navigation===e.navigation);if(n<0)return;const i=((a=e.getEndpointStep(this))==null?void 0:a.current)??null,r=this.contents[n],o=this.contents[n-1];return r.instruction.cancelled=!0,Q.run(i,c=>r.freeContent(c,this.connectedCE,r.navigation,this.historyCache,this.router.statefulHistory||this.options.stateful),()=>{var l,h,u,d;this.previousViewportState&&Object.assign(this,this.previousViewportState),r==null||r.delete(),r!==null&&this.contents.splice(this.contents.indexOf(r),1),this.transitionAction="",o==null||o.contentStates.delete("checkedUnload"),o==null||o.contentStates.delete("checkedLoad");const c=this.router.configuration.options.indicators.viewportNavigating;(h=(l=this.connectedCE)==null?void 0:l.setActivity)==null||h.call(l,c,!1),(d=(u=this.connectedCE)==null?void 0:u.setActivity)==null||d.call(u,e.navigation.navigation,!1),e.removeEndpoint(this),Xe(this.coordinators,f=>f===e)},()=>{if(i!==t)return i==null?void 0:i.exit()})}wantComponent(e){return this.options.usedBy.includes(e)}acceptComponent(e){if(e==="-"||e===null)return!0;const t=this.options.usedBy;return!!(t.length===0||t.includes(e)||t.filter(n=>n.includes("*")).length)}freeContent(e,t){const n=this.historyCache.find(i=>i.componentInstance===t);if(n!==void 0)return Q.run(e,i=>(this.forceRemove=!0,n.freeContent(i,null,null,this.historyCache,!1)),()=>{this.forceRemove=!1,Xe(this.historyCache,i=>i===n)})}getRoutes(){const e=[];let t=this.getComponentType();return t!=null&&(t=t.constructor===t.constructor.constructor?t:t.constructor,e.push(...Ro.getConfiguration(t)??[])),e}getTitle(e){if(this.options.noTitle)return"";const t=this.getComponentType();if(t===null)return"";let n="";const i=t.title;if(i!==void 0)if(typeof i=="string")n=i;else{const r=this.getComponentInstance();n=i.call(r,r,e)}else if(this.router.configuration.options.title.useComponentNames){let r=this.getContentInstruction().component.name??"";const o=this.router.configuration.options.title.componentPrefix??"";r.startsWith(o)&&(r=r.slice(o.length)),r=r.replace("-"," "),n=r.slice(0,1).toLocaleUpperCase()+r.slice(1)}return n}getComponentType(){let e=this.getContentInstruction().component.type??null;return e===null&&(e=oe.for(this.connectedCE.element).container.componentType),e??null}getComponentInstance(){return this.getContentInstruction().component.instance??null}getContentInstruction(){var e;return((e=this.getNextContent())==null?void 0:e.instruction)??this.getContent().instruction??null}clearState(){this.options=rc.create();const e=this.owningScope,t=this.scope.hasScope;if(this.getContent().delete(),this.contents.shift(),this.contents.length<1)throw new Error("no content!");this.contents.push(new va(this.router,this,e,t)),this.cache=[]}waitForConnected(){if(this.connectedCE===null)return new Promise(e=>{this.connectionResolve=e})}}class ks{constructor(){this.name=null,this.instance=null,this.scope=null}get none(){return this.name===null&&this.instance===null}get endpointType(){return this.instance instanceof Ln?"Viewport":this.instance instanceof _i?"ViewportScope":null}static create(e){const t=new ks;return t.set(e),t}static isName(e){return typeof e=="string"}static isInstance(e){return e instanceof ed}static getName(e){return ks.isName(e)?e:e?e.name:null}static getInstance(e){return ks.isName(e)?null:e}set(e){(e===void 0||e==="")&&(e=null),typeof e=="string"?(this.name=e,this.instance=null):(this.instance=e,e!==null&&(this.name=e.name,this.scope=e.owningScope))}toInstance(e){return this.instance!==null?this.instance:e.getEndpoint(this.endpointType,this.name)}same(e,t){return this.instance!==null&&e.instance!==null?this.instance===e.instance:this.endpointType!==null&&e.endpointType!==null&&this.endpointType===e.endpointType&&(!t||this.scope===e.scope)&&(this.instance!==null?this.instance.name:this.name)===(e.instance!==null?e.instance.name:e.name)}}const $p={excludeEndpoint:!1,endpointContext:!1,fullState:!1};class U{constructor(e,t,n){this.ownsScope=!0,this.nextScopeInstructions=null,this.scope=null,this.scopeModifier="",this.needsEndpointDescribed=!1,this.route=null,this.routeStart=!1,this.default=!1,this.topInstruction=!1,this.unparsed=null,this.cancelled=!1,this.component=me.create(e),this.endpoint=ks.create(t),this.parameters=Ir.create(n)}static create(e,t,n,i=!0,r=null){const o=new U(e,t,n);return o.ownsScope=i,o.nextScopeInstructions=r,o}static createClear(e,t){const n=U.create(U.clear(e),t);return n.scope=t.scope,n}static from(e,t){Array.isArray(t)||(t=[t]);const n=[];for(const i of t)if(typeof i=="string")n.push(...U.parse(e,i));else if(i instanceof U)n.push(i);else if(i instanceof Promise)n.push(U.create(i));else if(me.isAppelation(i))n.push(U.create(i));else if(me.isDefinition(i))n.push(U.create(i.Type));else if("component"in i||"id"in i){const r=i,o=U.create(r.component,r.viewport,r.parameters);o.route=i.id??null,r.children!==void 0&&r.children!==null&&(o.nextScopeInstructions=U.from(e,r.children)),n.push(o)}else if(typeof i=="object"&&i!==null){const r=oe.define(i);n.push(U.create(r))}else n.push(U.create(i));return n}static clear(e){return Mt.for(e).clear}static add(e){return Mt.for(e).add}static parse(e,t){const n=Mt.for(e);let i="";const r=/^[./]+/.exec(t);Array.isArray(r)&&r.length>0&&(i=r[0],t=t.slice(i.length));const o=un.parse(n,t,!0,!0).instructions;for(const a of o)a.scopeModifier=i;return o}static stringify(e,t,n={},i=!1){return typeof n=="boolean"&&(console.warn("[Deprecated] Boolean passed to RoutingInstruction.stringify. Please use the new interface instead: { excludeEndpoint: boolean; endpointContext: boolean; }"),n={excludeEndpoint:n,endpointContext:i}),n={...$p,...n},typeof t=="string"?t:t.map(r=>r.stringify(e,n)).filter(r=>r.length>0).join(Mt.for(e).sibling)}static resolve(e){const t=e.filter(n=>n.isUnresolved).map(n=>n.resolve()).filter(n=>n instanceof Promise);if(t.length>0)return Promise.all(t)}static containsSiblings(e,t){return t===null?!1:t.filter(n=>!n.isClear(e)&&!n.isClearAll(e)).length>1?!0:t.some(n=>U.containsSiblings(e,n.nextScopeInstructions))}static flat(e){const t=[];for(const n of e)t.push(n),n.hasNextScopeInstructions&&t.push(...U.flat(n.nextScopeInstructions));return t}static clone(e,t=!1,n=!1){return e.map(i=>i.clone(t,n))}static contains(e,t,n,i){return n.every(r=>r.isIn(e,t,i))}get viewport(){return this.endpoint.instance instanceof Ln||this.endpoint.endpointType===null?this.endpoint:null}get viewportScope(){return this.endpoint.instance instanceof _i||this.endpoint.endpointType===null?this.endpoint:null}get previous(){var e,t;return(t=(e=this.endpoint.instance)==null?void 0:e.getContent())==null?void 0:t.instruction}isAdd(e){return this.component.name===Mt.for(e).add}isClear(e){return this.component.name===Mt.for(e).clear}isAddAll(e){var t;return this.isAdd(e)&&(((t=this.endpoint.name)==null?void 0:t.length)??0)===0}isClearAll(e){var t;return this.isClear(e)&&(((t=this.endpoint.name)==null?void 0:t.length)??0)===0}get hasNextScopeInstructions(){var e;return(((e=this.nextScopeInstructions)==null?void 0:e.length)??0)>0}get dynasty(){const e=[this];return this.hasNextScopeInstructions&&e.push(...this.nextScopeInstructions.map(t=>t.dynasty).flat()),e}get isUnresolved(){return this.component.isFunction()||this.component.isPromise()}resolve(){return this.component.resolve(this)}typeParameters(e){var t;return this.parameters.toSpecifiedParameters(e,((t=this.component.type)==null?void 0:t.parameters)??[])}sameRoute(e){var i,r;const t=(i=this.route)==null?void 0:i.match,n=(r=e.route)==null?void 0:r.match;return t==null||n==null?!1:typeof t=="string"||typeof n=="string"?t===n:t.id===n.id}sameComponent(e,t,n=!1,i=!1){return n&&!this.sameParameters(e,t,i)?!1:this.component.same(t.component,i)}sameEndpoint(e,t){return this.endpoint.same(e.endpoint,t)}sameParameters(e,t,n=!1){return this.component.same(t.component,n)?this.parameters.same(e,t.parameters,this.component.type):!1}stringify(e,t={},n=!1,i=!1){var u,d;typeof t=="boolean"?(console.warn("[Deprecated] Boolean passed to RoutingInstruction.stringify. Please use the new interface instead: { excludeEndpoint: boolean; endpointContext: boolean; }"),t={excludeEndpoint:t,endpointContext:n}):i=n,t={...$p,...t};const r=Mt.for(e);let o=t.excludeEndpoint,a=!1;if(t.endpointContext){const f=((u=this.viewport)==null?void 0:u.instance)??null;if((f==null?void 0:f.options.noLink)??!1)return"";!this.needsEndpointDescribed&&(!((f==null?void 0:f.options.forceDescription)??!1)||((d=this.viewportScope)==null?void 0:d.instance)!=null)&&(o=!0),(f==null?void 0:f.options.fallback)===this.component.name&&(a=!0),(f==null?void 0:f.options.default)===this.component.name&&(a=!0)}const c=this.nextScopeInstructions;let l=this.scopeModifier;if(this.route instanceof yi&&!this.routeStart)return!i&&Array.isArray(c)?U.stringify(e,c,t):"";const h=this.stringifyShallow(e,o,a,t.fullState);if(l+=h.endsWith(r.scope)?h.slice(0,-r.scope.length):h,!i&&Array.isArray(c)&&c.length>0){const f=U.stringify(e,c,t);f.length>0&&(l+=r.scope,l+=c.length===1?f:`${r.groupStart}${f}${r.groupEnd}`)}return l}clone(e=!1,t=!1,n=!1){const i=U.create(this.component.func??this.component.promise??this.component.type??this.component.name,this.endpoint.name,this.parameters.typedParameters??void 0);return e&&(i.component.set(this.component.instance??this.component.type??this.component.name),i.endpoint.set(this.endpoint.instance??this.endpoint.name)),i.component.name=this.component.name,i.needsEndpointDescribed=this.needsEndpointDescribed,i.route=this.route,i.routeStart=this.routeStart,i.default=this.default,t&&(i.scopeModifier=this.scopeModifier),i.scope=e?this.scope:null,this.hasNextScopeInstructions&&!n&&(i.nextScopeInstructions=U.clone(this.nextScopeInstructions,e,t)),i}isIn(e,t,n){const i=t.filter(r=>{if(this.route!=null||r.route!=null){if(!r.sameRoute(this))return!1}else if(!r.sameComponent(e,this))return!1;const o=r.component.type??this.component.type,a=this.component.type??r.component.type,c=r.parameters.toSpecifiedParameters(e,o==null?void 0:o.parameters),l=this.parameters.toSpecifiedParameters(e,a==null?void 0:a.parameters);return Ir.contains(c,l)?this.endpoint.none||r.sameEndpoint(this,!1):!1});return i.length===0?!1:!!(!n||!this.hasNextScopeInstructions||i.some(r=>U.contains(e,r.nextScopeInstructions??[],this.nextScopeInstructions,n)))}getTitle(e){var t;if(this.route instanceof yi){const n=(t=this.route.match)==null?void 0:t.title;if(n!=null)return this.routeStart?typeof n=="string"?n:n(this,e):""}return this.endpoint.instance.getTitle(e)}toJSON(){return{component:this.component.name??void 0,viewport:this.endpoint.name??void 0,parameters:this.parameters.parametersRecord??void 0,children:this.hasNextScopeInstructions?this.nextScopeInstructions:void 0}}stringifyShallow(e,t=!1,n=!1,i=!1){if(!i&&this.route!=null)return(this.route instanceof yi?this.route.matching:this.route).split("/").map(h=>h.startsWith(":")?this.parameters.get(e,h.slice(1)):h).join("/");const r=Mt.for(e);let o=!n||i?this.component.name??"":"";const a=this.component.type?this.component.type.parameters:null,c=Ir.stringify(e,this.parameters.toSortedParameters(e,a));return c.length>0&&(o+=!n||i?`${r.parameters}${c}${r.parametersEnd}`:c),this.endpoint.name!=null&&(!t||i)&&(o+=`${r.viewport}${this.endpoint.name}`),this.ownsScope||(o+=r.noScope),o||""}}class Ls{constructor(e,t){this.eventName=e,this.navigation=t}static create(e){return new Ls(Ls.eventName,e)}}Ls.eventName="au:router:navigation-navigate";class sE{constructor(){this.lastNavigationIndex=-1,this.navigations=[],this.options={statefulHistoryLength:0},this.isActive=!1,this.uninitializedNavigation=vt.create({instruction:"NAVIGATOR UNINITIALIZED",fullStateInstruction:"",index:0,completed:!0}),this.ea=k(jr),this.container=k(Ri)}start(e){if(this.isActive)throw Ke(2010);this.isActive=!0,this.options={...e}}stop(){if(!this.isActive)throw Ke(2011);this.isActive=!1}navigate(e){e instanceof vt||(e=vt.create(e));const t=new dy;return this.lastNavigationIndex===-1&&(this.loadState(),this.lastNavigationIndex!==-1?t.refresh=!0:(t.first=!0,t.new=!0,this.lastNavigationIndex=0,this.navigations=[vt.create({index:0,instruction:"",fullStateInstruction:""})])),e.index!==void 0&&!(e.replacing??!1)&&!(e.refreshing??!1)?(e.historyMovement=e.index-Math.max(this.lastNavigationIndex,0),e.instruction=this.navigations[e.index]!=null?this.navigations[e.index].fullStateInstruction:e.fullStateInstruction,e.replacing=!0,e.historyMovement>0?t.forward=!0:e.historyMovement<0&&(t.back=!0)):(e.refreshing??!1)||t.refresh?(e=this.navigations[this.lastNavigationIndex],e.replacing=!0,e.refreshing=!0):e.replacing??!1?(t.replace=!0,t.new=!0,e.index=this.lastNavigationIndex):(t.new=!0,e.index=this.lastNavigationIndex+1,this.navigations[e.index]=e),e.navigation=t,e.previous=this.navigations[Math.max(this.lastNavigationIndex,0)],e.process=new Jt,this.lastNavigationIndex=e.index,this.notifySubscribers(e),e.process.promise}async finalize(e,t){if(e.untracked??!1)(e.fromBrowser??!1)&&this.options.store!=null&&await this.options.store.popNavigatorState();else if(e.replacing??!1)(e.historyMovement??0)===0&&(this.navigations[e.previous.index]=e),await this.saveState(e.index,!1);else{const n=e.index;if(t&&(this.navigations=this.navigations.slice(0,n)),this.navigations[n]=e,(this.options.statefulHistoryLength??0)>0){const i=this.navigations.length-(this.options.statefulHistoryLength??0);for(const r of this.navigations.slice(n))(typeof r.instruction!="string"||typeof r.fullStateInstruction!="string")&&await this.serializeNavigation(r,this.navigations.slice(i,n))}await this.saveState(e.index,!(e.fromBrowser??!1))}}async cancel(e){var t;this.options.store!=null&&((t=e.navigation)!=null&&t.new?(e.fromBrowser??!1)&&await this.options.store.popNavigatorState():(e.historyMovement??0)!==0&&await this.options.store.go(-e.historyMovement,!0))}async go(e){let t=this.lastNavigationIndex+e;t=Math.min(t,this.navigations.length-1),await this.options.store.go(e,!0);const n=this.navigations[t];return this.navigate(n)}getState(){const e=this.options.store!=null?{...this.options.store.state}:{},t=(e==null?void 0:e.navigations)??[],n=(e==null?void 0:e.navigationIndex)??-1;return{navigations:t,navigationIndex:n}}loadState(){const{navigations:e,navigationIndex:t}=this.getState();this.navigations=e.map(n=>vt.create(n)),this.lastNavigationIndex=t}async saveState(e,t){var i,r;for(let o=0;o<this.navigations.length;o++)this.navigations[o]=vt.create(this.navigations[o].toStoredNavigation());if((this.options.statefulHistoryLength??0)>0){const o=this.navigations.length-(this.options.statefulHistoryLength??0);for(let a=0;a<o;a++){const c=this.navigations[a];(typeof c.instruction!="string"||typeof c.fullStateInstruction!="string")&&await this.serializeNavigation(c,this.navigations.slice(o))}}if(this.options.store==null)return Promise.resolve();const n={navigations:(this.navigations??[]).map(o=>this.toStoreableNavigation(o)),navigationIndex:e};return t?(r=(i=this.options)==null?void 0:i.store)==null?void 0:r.pushNavigatorState(n):this.options.store.replaceNavigatorState(n)}async refresh(){if(this.lastNavigationIndex===-1)return Promise.reject();const e=this.navigations[this.lastNavigationIndex];return e.replacing=!0,e.refreshing=!0,this.navigate(e)}notifySubscribers(e){this.ea.publish(Ls.eventName,Ls.create(e))}toStoreableNavigation(e){const t=e instanceof vt?e.toStoredNavigation():e;return t.instruction=U.stringify(this.container,t.instruction),t.fullStateInstruction=U.stringify(this.container,t.fullStateInstruction,{endpointContext:!0,fullState:!0}),typeof t.scope!="string"&&(t.scope=null),t}async serializeNavigation(e,t){let n=[];for(const o of t)typeof o.instruction!="string"&&n.push(...U.flat(o.instruction).filter(a=>a.endpoint.instance!==null).map(a=>a.component.instance)),typeof o.fullStateInstruction!="string"&&n.push(...U.flat(o.fullStateInstruction).filter(a=>a.endpoint.instance!==null).map(a=>a.component.instance));n=Fo(n);let i=[];typeof e.fullStateInstruction!="string"&&(i.push(...e.fullStateInstruction),e.fullStateInstruction=U.stringify(this.container,e.fullStateInstruction,{endpointContext:!0,fullState:!0})),typeof e.instruction!="string"&&(i.push(...e.instruction),e.instruction=U.stringify(this.container,e.instruction)),i=i.filter((o,a,c)=>o.component.instance!=null&&c.indexOf(o)===a);const r=[];for(const o of i)await this.freeInstructionComponents(o,n,r)}freeInstructionComponents(e,t,n){var o;const i=e.component.instance,r=((o=e.viewport)==null?void 0:o.instance)??null;if(!(i===null||r===null||n.some(a=>a===i))){if(!t.some(a=>a===i))return Q.run(null,a=>r.freeContent(a,i),()=>{n.push(i)});if(e.hasNextScopeInstructions)for(const a of e.nextScopeInstructions)return this.freeInstructionComponents(a,t,n)}}}const rE=Qk;class oE extends Array{constructor(){super(...arguments),this.currentIndex=-1}next(){return this.length>this.currentIndex+1?this[++this.currentIndex]:(this.currentIndex=-1,null)}removeCurrent(){this.splice(this.currentIndex--,1)}remove(e){Xe(this,t=>t===e)}}class It{static matchEndpoints(e,t,n,i=!1){const r=[],c=e.getOwnedRoutingScopes(1/0).map(u=>u.endpoint).filter(u=>u!==null&&!n.some(d=>u===d.endpoint.instance&&!d.cancelled&&!d.isClear(e.router))),l=new oE(...t.slice());let h=null;for(It.matchKnownEndpoints(e.router,"ViewportScope",l,c,r,!1),i||It.matchKnownEndpoints(e.router,"Viewport",l,c,r,!1),It.matchViewportScopeSegment(e.router,e,l,c,r);(h=l.next())!==null;)h.needsEndpointDescribed=!0;return It.matchViewportConfiguration(l,c,r),i||It.matchSpecifiedViewport(l,c,r,!1),It.matchLastViewport(l,c,r),i&&It.matchSpecifiedViewport(l,c,r,!1),{matchedInstructions:r,remainingInstructions:[...l]}}static matchKnownEndpoints(e,t,n,i,r,o=!1){let a;for(;(a=n.next())!==null;)a.endpoint.instance!==null&&!a.isAdd(e)&&a.endpoint.endpointType===t&&(It.matchEndpoint(a,a.endpoint.instance,o),r.push(a),Xe(i,c=>c===a.endpoint.instance),n.removeCurrent())}static matchViewportScopeSegment(e,t,n,i,r){let o;for(;(o=n.next())!==null;)for(let a of i)if(a instanceof _i&&a.acceptSegment(o.component.name)){if(Array.isArray(a.source)){let c=i.find(l=>l instanceof _i&&l.name===a.name);if(c===void 0||o.isAdd(e)){const l=a.addSourceItem();c=t.getOwnedScopes().filter(h=>h.isViewportScope).map(h=>h.endpoint).find(h=>h.sourceItem===l)}a=c}It.matchEndpoint(o,a,!1),r.push(o),Xe(i,c=>c===o.endpoint.instance),n.removeCurrent();break}}static matchViewportConfiguration(e,t,n){let i;for(;(i=e.next())!==null;)for(const r of t)if(r instanceof Ln&&r!=null&&r.wantComponent(i.component.name)){It.matchEndpoint(i,r,!0),n.push(i),Xe(t,o=>o===i.endpoint.instance),e.removeCurrent();break}}static matchSpecifiedViewport(e,t,n,i){let r;for(;(r=e.next())!==null;){let o=r.endpoint.instance;if(o==null){const a=r.endpoint.name;if(((a==null?void 0:a.length)??0)===0)continue;for(const c of t)if(c instanceof Ln&&a===c.name){o=c;break}}o!=null&&o.acceptComponent(r.component.name)&&(It.matchEndpoint(r,o,i),n.push(r),Xe(t,a=>a===r.endpoint.instance),e.removeCurrent())}}static matchLastViewport(e,t,n){let i;for(;(i=e.next())!==null;){const r=[];for(const o of t)o instanceof Ln&&o.acceptComponent(i.component.name)&&r.push(o);if(r.length===1){const o=r[0];It.matchEndpoint(i,o,!0),n.push(i),Xe(t,a=>a===i.endpoint.instance),e.removeCurrent()}}}static matchEndpoint(e,t,n){e.endpoint.set(t),n&&(e.needsEndpointDescribed=!1),e.hasNextScopeInstructions&&e.nextScopeInstructions.forEach(i=>{i.scope===null&&(i.scope=t instanceof Ln?t.scope:t.scope.scope)})}}class Qi{constructor(e,t,n,i){this.id=++Qi.lastId,this.parent=null,this.children=[],this.router=e,this.hasScope=t,this.owningScope=n??this,this.endpointContent=i}static for(e,t){if(e==null)return{scope:null,instruction:t};if(e instanceof Qi||e instanceof Ln||e instanceof _i)return{scope:e.scope,instruction:t};let n;if("res"in e)n=e;else if("container"in e)n=e.container;else if("$controller"in e)n=e.$controller.container;else{const o=oe.for(e,{searchParents:!0});n=o==null?void 0:o.container}if(n==null)return console.warn("RoutingScope failed to find a container for provided origin",e),{scope:null,instruction:t};const i=n.has(Kn.closestEndpointKey,!0)?n.get(Kn.closestEndpointKey):null;let r=(i==null?void 0:i.scope)??null;if(r===null||t===void 0){const o=t??"";return{scope:r,instruction:o.startsWith("/")?o.slice(1):t}}if(t.startsWith("/"))return{scope:null,instruction:t.slice(1)};for(;t.startsWith(".");)if(t.startsWith("./"))t=t.slice(2);else if(t.startsWith("../"))r=r.parent??r,t=t.slice(3);else break;return{scope:r,instruction:t}}get scope(){return this.hasScope?this:this.owningScope.scope}get endpoint(){return this.endpointContent.endpoint}get isViewport(){return this.endpoint instanceof Ln}get isViewportScope(){return this.endpoint instanceof _i}get type(){return this.isViewport?"Viewport":"ViewportScope"}get enabled(){return this.endpointContent.isActive}get passThroughScope(){return this.isViewportScope&&this.endpoint.passThroughScope}get pathname(){return`${this.owningScope!==this?this.owningScope.pathname:""}/${this.endpoint.name}`}get path(){var i,r;const e=((i=this.parent)==null?void 0:i.path)??"",t=((r=this.routingInstruction)==null?void 0:r.stringify(this.router,{endpointContext:!0},!0))??"",n=this.routingInstruction?Mt.for(this.router).scope:"";return`${e}${t}${n}`}toString(e=!1){return`${this.owningScope!==this?this.owningScope.toString():""}/${this.enabled?"":"("}${this.endpoint.toString()}#${this.id}${this.enabled?"":")"}${e?`
`+this.children.map(t=>t.toString(!0)).join(""):""}`}toStringOwning(e=!1){return`${this.owningScope!==this?this.owningScope.toString():""}/${this.enabled?"":"("}${this.endpoint.toString()}#${this.id}${this.enabled?"":")"}${e?`
`+this.ownedScopes.map(t=>t.toStringOwning(!0)).join(""):""}`}get enabledChildren(){return this.children.filter(e=>e.enabled)}get hoistedChildren(){const e=this.enabledChildren;for(;e.some(t=>t.passThroughScope);)for(const t of e.slice())if(t.passThroughScope){const n=e.indexOf(t);e.splice(n,1,...t.enabledChildren)}return e}get ownedScopes(){return this.getOwnedScopes()}get routingInstruction(){return this.endpoint.isViewportScope?this.endpoint.instruction:this.isViewport?this.endpoint.activeContent.instruction:null}getOwnedScopes(e=!1){const t=this.allScopes(e).filter(n=>n.owningScope===this);for(const n of t.slice())if(n.passThroughScope){const i=t.indexOf(n);t.splice(i,1,...n.getOwnedScopes())}return t}findInstructions(e,t,n){const i=this.router;let r=new yi;if(n&&!U.containsSiblings(i,e)){let o=e.filter(c=>c.isClear(i)||c.isClearAll(i));const a=e.filter(c=>!c.isClear(i)&&!c.isClearAll(i));if(a.length>0)for(const c of a){const l=typeof c.route=="string"?c.route:c.unparsed??U.stringify(i,[c]),h=this.findMatchingRoute(l,c.parameters.parametersRecord??{});if(h.foundConfiguration)r=h,r.instructions=[...o,...r.instructions],o=[];else if(t)r.instructions=[...o,...r.instructions,c],o=[],r.remaining=U.stringify(i,c.nextScopeInstructions??[]);else throw new Error(`No route found for: ${U.stringify(i,e)}!`)}else r.instructions=[...o]}else if(t)r.instructions.push(...e);else throw new Error(`No way to process sibling viewport routes with direct routing disabled: ${U.stringify(i,e)}!`);r.instructions=r.instructions.filter(o=>o.component.name!=="");for(const o of r.instructions)o.scope===null&&(o.scope=this);return r}matchEndpoints(e,t,n=!1){const i=[],r=e.filter(l=>(l.scope??this)===this),o=e.filter(l=>(l.scope??this)!==this),{matchedInstructions:a,remainingInstructions:c}=It.matchEndpoints(this,r,t,n);return i.push(...a),o.push(...c),{matchedInstructions:i,remainingInstructions:o}}addEndpoint(e,t,n,i={}){var o,a;let r=((o=this.getOwnedScopes().find(c=>c.type===e&&c.endpoint.name===t))==null?void 0:o.endpoint)??null;return n!=null&&(r==null?void 0:r.connectedCE)!=null&&r.connectedCE!==n&&(r=((a=this.getOwnedScopes(!0).find(c=>c.type===e&&c.endpoint.name===t&&c.endpoint.connectedCE===n))==null?void 0:a.endpoint)??null),r==null&&(r=e==="Viewport"?new Ln(this.router,t,n,this.scope,!!i.scope,i):new _i(this.router,t,n,this.scope,!0,null,i),this.addChild(r.connectedScope)),n!=null&&r.setConnectedCE(n,i),r}removeEndpoint(e,t,n){return(n??null)!==null||t.removeEndpoint(e,n)?(this.removeChild(t.connectedScope),!0):!1}addChild(e){this.children.some(t=>t===e)||(e.parent!==null&&e.parent.removeChild(e),this.children.push(e),e.parent=this)}removeChild(e){const t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=null)}allScopes(e=!1){const t=e?this.children.slice():this.enabledChildren;for(const n of t.slice())t.push(...n.allScopes(e));return t}reparentRoutingInstructions(){const e=this.hoistedChildren.filter(t=>t.routingInstruction!==null&&t.routingInstruction.component.name);if(!e.length)return null;for(const t of e){const n=t.reparentRoutingInstructions();t.routingInstruction.nextScopeInstructions=n!==null&&n.length>0?n:null}return e.map(t=>t.routingInstruction)}getChildren(e){return this.children.map(n=>n.endpoint.getTimeContent(e)).filter(n=>n!==null).map(n=>n.connectedScope)}getAllRoutingScopes(e){const t=this.getChildren(e);for(const n of t.slice())t.push(...n.getAllRoutingScopes(e));return t}getOwnedRoutingScopes(e){const t=this.getAllRoutingScopes(e).filter(n=>n.owningScope===this);for(const n of t.slice())if(n.passThroughScope){const i=t.indexOf(n);t.splice(i,1,...n.getOwnedRoutingScopes(e))}return Fo(t)}getRoutingInstructions(e){const t=Fo(this.getOwnedRoutingScopes(e).map(i=>i.endpoint)).map(i=>i.getTimeContent(e)).filter(i=>i!==null),n=[];for(const i of t){const r=i.instruction.clone(!0,!1,!1);(r.component.name??"")!==""&&(r.nextScopeInstructions=i.connectedScope.getRoutingInstructions(e),n.push(r))}return n}canUnload(e,t){return Q.run(t,n=>Q.runParallel(n,...this.children.map(i=>i.endpoint!==null?r=>i.endpoint.canUnload(e,r):r=>i.canUnload(e,r))),n=>n.previousValue.every(i=>i??!0))}unload(e,t){return Q.runParallel(t,...this.children.map(n=>n.endpoint!==null?i=>n.endpoint.unload(e,i):i=>n.unload(e,i)))}matchScope(e,t=!1){const n=[];for(const i of e)i.scope===this?n.push(i):t&&i.hasNextScopeInstructions&&n.push(...this.matchScope(i.nextScopeInstructions,t));return n}findMatchingRoute(e,t){let n=new yi;if(this.isViewportScope&&!this.passThroughScope)n=this.findMatchingRouteInRoutes(e,this.endpoint.getRoutes(),t);else if(this.isViewport)n=this.findMatchingRouteInRoutes(e,this.endpoint.getRoutes(),t);else for(const i of this.enabledChildren)if(n=i.findMatchingRoute(e,t),n.foundConfiguration)break;return n.foundConfiguration?n:this.parent!=null?this.parent.findMatchingRoute(e,t):n}findMatchingRouteInRoutes(e,t,n){var c,l;const i=new yi;if(t.length===0)return i;t=t.map(h=>this.ensureProperRoute(h));const r=[];for(const h of t){const u=Array.isArray(h.path)?h.path:[h.path];for(const d of u)r.push({...h,path:d,handler:h}),d!==""&&r.push({...h,path:`${d}/*remainingPath`,handler:h})}(e.startsWith("/")||e.startsWith("+"))&&(e=e.slice(1));const o=t.find(h=>h.id===e);let a={params:{},endpoint:{}};if(o!=null)a.endpoint={route:{handler:o}},e=Array.isArray(o.path)?o.path[0]:o.path,e=e.split("/").map(u=>{if(u.startsWith(":")){const d=u.slice(1).replace(/\?$/,""),f=n[d];return a.params[d]=f,f}else return u}).join("/");else{const h=new rE;h.add(r),a=h.recognize(e)}if(a!=null){i.match=a.endpoint.route.handler,i.matching=e;const h={...a.params};if(h.remainingPath!=null&&(i.remaining=h.remainingPath,Reflect.deleteProperty(h,"remainingPath"),i.matching=i.matching.slice(0,i.matching.indexOf(i.remaining))),i.params=h,((c=i.match)==null?void 0:c.redirectTo)!=null){let u=(l=i.match)==null?void 0:l.redirectTo;return(i.remaining??"").length>0&&(u+=`/${i.remaining}`),this.findMatchingRouteInRoutes(u,t,n)}}if(i.foundConfiguration){i.instructions=U.clone(i.match.instructions,!1,!0);const h=i.instructions.slice();for(;h.length>0;){const d=h.shift();d.parameters.addParameters(i.params),d.route=i,d.hasNextScopeInstructions&&h.unshift(...d.nextScopeInstructions)}i.instructions.length>0&&(i.instructions[0].routeStart=!0);const u=U.parse(this.router,i.remaining);if(u.length>0){let d=i.instructions[0];for(;d.hasNextScopeInstructions;)d=d.nextScopeInstructions[0];d.nextScopeInstructions=u}}return i}ensureProperRoute(e){return e.id===void 0&&(e.id=Array.isArray(e.path)?e.path.join(","):e.path),e.instructions===void 0&&(e.instructions=[{component:e.component,viewport:e.viewport,parameters:e.parameters,children:e.children}]),e.redirectTo===null&&(e.instructions=U.from(this.router,e.instructions)),e}}Qi.lastId=0;class Lp{constructor(e,t,n=0){this.taskQueue=e,this.item=t,this.cost=n,this.done=!1,this.promise=new Promise((i,r)=>{this.resolve=()=>{this.taskQueue.resolve(this,i)},this.reject=o=>{this.taskQueue.reject(this,r,o)}})}async execute(){"execute"in this.item?await this.item.execute(this):await this.item(this)}wait(){return this.promise}}class aE{get isActive(){return this.task!==null}constructor(e){this.callback=e,this.pending=[],this.processing=null,this.allowedExecutionCostWithinTick=null,this.currentExecutionCostInCurrentTick=0,this.platform=null,this.task=null,this.dequeue=t=>{this.processing===null&&(t!==void 0&&(this.currentExecutionCostInCurrentTick=0),this.pending.length!==0&&(this.allowedExecutionCostWithinTick!==null&&t===void 0&&this.currentExecutionCostInCurrentTick+(this.pending[0].cost||0)>this.allowedExecutionCostWithinTick||(this.processing=this.pending.shift()||null,this.processing&&(this.currentExecutionCostInCurrentTick+=this.processing.cost??0,this.callback!==void 0?this.callback(this.processing):this.processing.execute().catch(n=>{throw n})))))}}get length(){return this.pending.length}start(e){this.platform=e.platform,this.allowedExecutionCostWithinTick=e.allowedExecutionCostWithinTick,this.task=this.platform.domQueue.queueTask(this.dequeue,{persistent:!0})}stop(){this.task.cancel(),this.task=null,this.allowedExecutionCostWithinTick=null,this.clear()}enqueue(e,t){const n=Array.isArray(e),i=n?e:[e],r=i.map((a,c)=>Array.isArray(t)?t[c]:t).map(a=>a!==void 0?a:1),o=[];for(const a of i)o.push(a instanceof Lp?a:this.createQueueTask(a,r.shift()));return this.pending.push(...o),this.dequeue(),n?o:o[0]}createQueueTask(e,t){return new Lp(this,e,t)}clear(){this.pending.length=0}resolve(e,t){t(),this.processing=null,this.dequeue()}reject(e,t,n){t(n),this.processing=null,this.dequeue()}}class Dp{constructor(){this.allowedExecutionCostWithinTick=2,this.pendingCalls=new aE,this.isActive=!1,this.options={useUrlFragmentHash:!0},this.forwardedState={eventTask:null,suppressPopstate:!1},this.platform=k(_t),this.window=k(zc),this.history=k(ck),this.location=k(ak),this.ea=k(jr)}start(e){if(this.isActive)throw Ke(2007);this.isActive=!0,e.useUrlFragmentHash!=null&&(this.options.useUrlFragmentHash=e.useUrlFragmentHash),this.pendingCalls.start({platform:this.platform,allowedExecutionCostWithinTick:this.allowedExecutionCostWithinTick}),this.window.addEventListener("popstate",this)}stop(){if(!this.isActive)throw Ke(2008);this.window.removeEventListener("popstate",this),this.pendingCalls.stop(),this.options={useUrlFragmentHash:!0},this.isActive=!1}get length(){return this.history.length}get state(){return this.history.state}get viewerState(){const{pathname:e,search:t,hash:n}=this.location,i=this.options.useUrlFragmentHash??!1?n.slice(1):`${e}${t}`,r=this.options.useUrlFragmentHash??!1?n.slice(1).includes("#")?n.slice(n.slice(1).indexOf("#",1)):"":n.slice(1);return new cE(e,t.slice(1),r,i)}async go(e,t=!1){const n=this.pendingCalls.createQueueTask(i=>i.resolve(),1);return this.pendingCalls.enqueue([i=>{const r=n,o=t;this.forwardState({eventTask:r,suppressPopstate:o}),i.resolve()},i=>{const r=this.history,o=e;r.go(o),i.resolve()}],[0,1]),n.wait()}async pushNavigatorState(e){const{title:t,path:n}=e.navigations[e.navigationIndex],i=this.options.useUrlFragmentHash?"#/":"";return this.pendingCalls.enqueue(r=>{const o=this.history,a=e,c=t||"",l=`${i}${n}`;try{o.pushState(a,c,l),this.setTitle(c)}catch(h){const u=this.tryCleanState(a,"push",h);o.pushState(u,c,l),this.setTitle(c)}r.resolve()},1).wait()}async replaceNavigatorState(e,t,n){const i=e.navigations[e.navigationIndex];t??(t=i.title),n??(n=i.path);const r=this.options.useUrlFragmentHash?"#/":"";return this.pendingCalls.enqueue(o=>{const a=this.history,c=e,l=t||"",h=`${r}${n}`;try{a.replaceState(c,l,h),this.setTitle(l)}catch(u){const d=this.tryCleanState(c,"replace",u);a.replaceState(d,l,h),this.setTitle(l)}o.resolve()},1).wait()}async popNavigatorState(){const e=this.pendingCalls.createQueueTask(t=>t.resolve(),1);return this.pendingCalls.enqueue(async t=>{const n=e;await this.popState(n),t.resolve()},1),e.wait()}setTitle(e){this.window.document.title=e}handleEvent(e){this.handlePopStateEvent(e)}handlePopStateEvent(e){const{eventTask:t,suppressPopstate:n}=this.forwardedState;this.forwardedState={eventTask:null,suppressPopstate:!1},this.pendingCalls.enqueue(async i=>{n||this.notifySubscribers(e),t!==null&&await t.execute(),i.resolve()},1)}notifySubscribers(e){this.ea.publish(Ds.eventName,Ds.create(this.viewerState,e,this.history.state))}async popState(e){var i;await this.go(-1,!0);const t=this.history.state,n=(i=t==null?void 0:t.navigations)==null?void 0:i[(t==null?void 0:t.navigationIndex)??0];n!=null&&!n.firstEntry&&(await this.go(-1,!0),await this.pushNavigatorState(t)),await e.execute()}forwardState(e){this.forwardedState=e}tryCleanState(e,t,n){try{return JSON.parse(JSON.stringify(e))}catch(i){throw Ke(2009,t,i,n)}}}class cE{constructor(e,t,n,i){this.path=e,this.query=t,this.hash=n,this.instruction=i}}class Ds{constructor(e,t,n,i){this.eventName=e,this.viewerState=t,this.event=n,this.state=i}static create(e,t,n){return new Ds(Ds.eventName,e,t,n)}}Ds.eventName="au:router:navigation-state-change";class lE{constructor(e){this.endpoint=e,this.running=!1,this.states=new Map,this.checkedStates=[],this.syncingState=null,this.syncPromise=null,this.step=null}hasReachedState(e){return this.states.has(e)&&this.states.get(e)===null}}class Ko{constructor(e,t){this.router=e,this.navigation=t,this.instructions=[],this.matchedInstructions=[],this.processedInstructions=[],this.changedEndpoints=[],this.running=!1,this.completed=!1,this.cancelled=!1,this.hasAllEndpoints=!1,this.appendedInstructions=[],this.closed=!1,this.entities=[],this.syncStates=new Map,this.checkedSyncStates=new Set}static create(e,t,n){const i=new Ko(e,t);return n.syncStates.forEach(r=>i.addSyncState(r)),i}appendInstructions(e){this.instructions.push(...e),this.manageDefaults()}removeInstructions(e){this.instructions=this.instructions.filter(t=>!e.includes(t)),this.matchedInstructions=this.matchedInstructions.filter(t=>!e.includes(t))}manageDefaults(){const e=this.router;this.instructions=[...this.instructions.filter(n=>!n.default),...this.instructions.filter(n=>n.default)],this.instructions.forEach(n=>{var i;n.scope==null&&(n.scope=this.navigation.scope??((i=this.router.rootScope)==null?void 0:i.scope)??null)});const t=this.instructions.filter(n=>!n.isClear(e));for(;t.length>0;){const n=t.shift(),i=this.processedInstructions.some(a=>!a.isClear(e)&&!a.cancelled&&a.sameEndpoint(n,!0)),r=this.matchedInstructions.find(a=>!a.isClear(e)&&a.sameEndpoint(n,!0)),o=this.instructions.find(a=>!a.isClear(e)&&a.sameEndpoint(n,!0)&&a!==n);if(n.default&&(i||r!==void 0&&!r.default||o!==void 0&&!o.default)){Xe(this.instructions,a=>a===n);continue}if(r!==void 0){Xe(this.matchedInstructions,a=>a===r);continue}o!==void 0&&Xe(this.instructions,a=>a===o)}}async processInstructions(){const e=[];let t=100;for(;this.instructions.length>0;){if(!t--)throw console.error("processInstructions endless loop",this.navigation,this.instructions),new Error("Endless loop");this.instructions=[...this.instructions.filter(i=>!i.default),...this.instructions.filter(i=>i.default)];const n=this.instructions[0].scope;if(n==null)throw new Error("No scope for instruction");e.push(...await this.processInstructionsForScope(n))}return e}async processInstructionsForScope(e){var c,l;const t=this.router,n=t.configuration.options,i=this.getClearAllEndpoints(e),r=this.getInstructionsForScope(e).filter(h=>!(h.route instanceof pt));if(r.length>0){const h=e.findInstructions(r,n.useDirectRouting,n.useConfiguredRoutes);if(r.some(u=>!u.component.none||u.route!=null)&&!h.foundConfiguration&&!h.foundInstructions)throw this.createUnknownRouteError(r);this.instructions.splice(this.instructions.indexOf(r[0]),r.length,...h.instructions)}const o=U.resolve(this.getInstructionsForScope(e));o instanceof Promise&&await o;for(const h of this.getInstructionsForScope(e).filter(u=>u.isAddAll(t)))h.endpoint.set(h.scope.endpoint.name),h.scope=h.scope.owningScope;let a=100;do{this.matchEndpoints(e),a--||t.unresolvedInstructionsError(this.navigation,this.instructions);const h=[],u=this.matchedInstructions.map(g=>g.endpoint.instance);this.matchedInstructions.push(...i.filter(g=>!u.includes(g)).map(g=>U.createClear(t,g)));const d=await zt.invokeBeforeNavigation(this.matchedInstructions,this.navigation);if(d===!1)return t.cancelNavigation(this.navigation,this),[];d!==!0&&d!==this.matchedInstructions&&(this.matchedInstructions=d);for(const g of this.matchedInstructions){const v=g.endpoint.instance;if(v!==null){const S=v.setNextContent(g,this.navigation);S!=="skip"&&(h.push(v),this.addEndpoint(v));const R=[v];if(S==="swap"&&R.push(...v.getContent().connectedScope.allScopes(!0).map(C=>C.endpoint)),Xe(i,C=>R.includes(C)),Xe(this.matchedInstructions,C=>C!==g&&C.isClear(t)&&R.includes(C.endpoint.instance)),!g.isClear(t)&&((l=(c=g.scope)==null?void 0:c.parent)!=null&&l.isViewportScope)&&(Xe(i,C=>C===g.scope.parent.endpoint),Xe(this.matchedInstructions,C=>C!==g&&C.isClear(t)&&C.endpoint.instance===g.scope.parent.endpoint)),g.hasNextScopeInstructions){if(this.instructions.push(...g.nextScopeInstructions),S!=="skip")for(const C of g.nextScopeInstructions)C.scope=v.scope,C.endpoint.instance=null}else i.push(...g.endpoint.instance.scope.children.map(C=>C.endpoint))}}const f=this.matchedInstructions.filter(g=>{var v;return((v=g.endpoint.instance)==null?void 0:v.transitionAction)==="skip"}),p=f.filter(g=>g.hasNextScopeInstructions);if((f.length===0||p.length===0)&&(t.isRestrictedNavigation||this.finalEndpoint(),this.run(),this.hasAllEndpoints)){const g=this.waitForSyncState("guardedUnload");g instanceof Promise&&await g}if(this.cancelled)return t.cancelNavigation(this.navigation,this),[];if(eE(this.changedEndpoints,h),this.processedInstructions.push(...this.matchedInstructions.splice(0)),!t.isRestrictedNavigation&&(this.matchedInstructions.length>0||this.instructions.length>0)&&this.running){const g=this.waitForSyncState("swapped");g instanceof Promise&&await g}this.instructions.push(...i.map(g=>U.createClear(t,g)));const m=U.resolve(this.matchedInstructions);m instanceof Promise&&await m,this.changedEndpoints=this.changedEndpoints.filter(g=>{var v;return!(((v=[...this.processedInstructions].reverse().find(S=>S.endpoint.instance===g))==null?void 0:v.cancelled)??!1)})}while(this.matchedInstructions.length>0||this.getInstructionsForScope(e).length>0);return this.changedEndpoints}getInstructionsForScope(e){this.manageDefaults();const t=this.instructions.filter(n=>n.scope===e&&!n.default);return t.length>0?t:this.instructions.filter(n=>n.scope===e)}ensureClearStateInstruction(e){const t=this.router;if(!this.instructions.some(n=>n.scope===e&&n.isClearAll(t))){const n=U.create(U.clear(t));n.scope=e,this.instructions.unshift(n)}}matchEndpoints(e,t=!1){const n=this.getInstructionsForScope(e),i=It.matchEndpoints(e,n,[...this.processedInstructions,...this.matchedInstructions],t).matchedInstructions;this.matchedInstructions.push(...i),this.instructions=this.instructions.filter(r=>!i.includes(r))}run(){if(!this.running){this.running=!0;for(const e of this.entities)e.running||(e.running=!0,e.endpoint.transition(this))}}addSyncState(e){const t=new Jt;this.syncStates.set(e,t)}addEndpoint(e){const t=new lE(e);return this.entities.push(t),this.recheckSyncStates(),this.running&&t.endpoint.transition(this),t}removeEndpoint(e){const t=this.entities.map(r=>r.endpoint),n=[e];let i=[e];for(;i.length>0;)i=t.filter(r=>(r==null?void 0:r.parentViewport)!=null&&i.includes(r.parentViewport)),n.push(...i);for(const r of n){const o=this.entities.find(a=>a.endpoint===r);o!==void 0&&Xe(this.entities,a=>a===o)}this.checkSyncState()}setEndpointStep(e,t){let n=this.entities.find(i=>i.endpoint===e);n===void 0&&(n=this.addEndpoint(e)),n.step=t}getEndpointStep(e){const t=this.entities.find(n=>n.endpoint===e);return(t==null?void 0:t.step)??null}addEndpointState(e,t){let n=this.entities.find(r=>r.endpoint===e);n===void 0&&(n=this.addEndpoint(e));const i=n.states.get(t);i instanceof Jt&&i.resolve(),n.states.set(t,null),this.checkSyncState(t)}waitForSyncState(e,t=null){if(this.entities.length===0)return;const n=this.syncStates.get(e);if(n!==void 0){if(t!==null){const i=this.entities.find(r=>r.endpoint===t);if((i==null?void 0:i.syncPromise)===null&&n.isPending)return i.syncingState=e,i.syncPromise=new Jt,i.checkedStates.push(e),this.checkedSyncStates.add(e),Promise.resolve().then(()=>{this.checkSyncState(e)}).catch(r=>{throw r}),i.syncPromise.promise}return n.isPending?n.promise:void 0}}waitForEndpointState(e,t){if(!this.syncStates.has(t))return;let n=this.entities.find(r=>r.endpoint===e);if(n==null&&(n=this.addEndpoint(e)),n.hasReachedState(t))return;let i=n.states.get(t);return i==null&&(i=new Jt,n.states.set(t,i)),i.promise}finalEndpoint(){this.hasAllEndpoints=!0,this.syncStates.forEach((e,t)=>this.checkSyncState(t))}finalize(){this.entities.forEach(e=>e.endpoint.finalizeContentChange(this,null)),this.completed=!0,this.navigation.completed=!0,this.syncStates.clear()}cancel(){this.cancelled=!0,this.instructions=[],this.matchedInstructions=[],this.entities.forEach(e=>{const t=e.endpoint.cancelContentChange(this);t instanceof Promise&&t.catch(n=>{throw n})}),this.router.navigator.cancel(this.navigation).then(()=>{var e;(e=this.navigation.process)==null||e.resolve(!1)}).catch(e=>{throw e}),this.completed=!0,this.navigation.completed=!0,[...this.syncStates.values()].forEach(e=>{e.isPending&&e.resolve()}),this.syncStates.clear()}checkSyncState(e){var n;if(e===void 0){this.syncStates.forEach((i,r)=>this.checkSyncState(r));return}const t=this.syncStates.get(e);if(t!==void 0&&this.hasAllEndpoints&&t.isPending&&this.entities.every(i=>i.hasReachedState(e))&&(!this.checkedSyncStates.has(e)||this.entities.every(i=>i.checkedStates.includes(e)))){for(const i of this.entities)i.syncingState===e&&((n=i.syncPromise)==null||n.resolve(),i.syncPromise=null,i.syncingState=null);t.resolve()}}recheckSyncStates(){this.syncStates.forEach((e,t)=>{!e.isPending&&!this.entities.every(n=>n.hasReachedState(t))&&this.addSyncState(t)})}getClearAllEndpoints(e){const t=this.router;let n=[];return this.instructions.some(i=>(i.scope??e)===e&&i.isClearAll(t))&&(n=e.enabledChildren.filter(i=>!i.endpoint.isEmpty).map(i=>i.endpoint),this.instructions=this.instructions.filter(i=>!((i.scope??e)===e&&i.isClearAll(t)))),n}createUnknownRouteError(e){const t=this.router.configuration.options,n=U.stringify(this.router,e);return e[0].route!=null?t.useConfiguredRoutes?new Error(`No matching configured route found for '${n}'.`):new Error(`Can not match '${n}' since the router is configured to not use configured routes.`):t.useConfiguredRoutes&&t.useDirectRouting?new Error(`No matching configured route or component found for '${n}'.`):t.useConfiguredRoutes?new Error(`No matching configured route found for '${n}'.`):new Error(`No matching route/component found for '${n}'.`)}}class zt{constructor(e,t,n){this.hook=e,this.id=n,this.type="beforeNavigation",this.includeTargets=[],this.excludeTargets=[],t.type!==void 0&&(this.type=t.type);for(const i of t.include??[])this.includeTargets.push(new Bp(i));for(const i of t.exclude??[])this.excludeTargets.push(new Bp(i))}static add(e,t){const n=new zt(e,t??{},++this.lastIdentity);return this.hooks[n.type].push(n),this.lastIdentity}static remove(e){for(const t in this.hooks)if(Object.prototype.hasOwnProperty.call(this.hooks,t)){const n=this.hooks[t].findIndex(i=>i.id===e);n>=0&&this.hooks[t].splice(n,1)}}static removeAll(){for(const e in this.hooks)this.hooks[e]=[]}static async invokeBeforeNavigation(e,t){return this.invoke("beforeNavigation",t,e)}static async invokeTransformFromUrl(e,t){return this.invoke("transformFromUrl",t,e)}static async invokeTransformToUrl(e,t){return this.invoke("transformToUrl",t,e)}static async invokeTransformTitle(e,t){return this.invoke("transformTitle",t,e)}static async invoke(e,t,n){let i=n;for(const r of this.hooks[e])if(!r.wantsMatch||r.matches(n))if(i=await r.invoke(t,n),typeof i=="boolean"){if(!i)return!1}else n=i;return i}get wantsMatch(){return this.includeTargets.length>0||this.excludeTargets.length>0}matches(e){return!(this.includeTargets.length&&!this.includeTargets.some(t=>t.matches(e))||this.excludeTargets.length&&this.excludeTargets.some(t=>t.matches(e)))}invoke(e,t){return this.hook(t,e)}}zt.hooks={beforeNavigation:[],transformFromUrl:[],transformToUrl:[],transformTitle:[]};zt.lastIdentity=0;class Bp{constructor(e){if(this.componentType=null,this.componentName=null,this.viewport=null,this.viewportName=null,typeof e=="string")this.componentName=e;else if(me.isType(e))this.componentType=e,this.componentName=me.getName(e);else{const t=e;t.component!=null&&(this.componentType=me.isType(t.component)?me.getType(t.component):null,this.componentName=me.getName(t.component)),t.viewport!=null&&(this.viewport=ks.isInstance(t.viewport)?t.viewport:null,this.viewportName=ks.getName(t.viewport))}}matches(e){const t=e.slice();t.length||t.push(U.create(""));for(const n of t)if(this.componentName!==null&&this.componentName===n.component.name||this.componentType!==null&&this.componentType===n.component.type||this.viewportName!==null&&this.viewportName===n.endpoint.name||this.viewport!==null&&this.viewport===n.endpoint.instance)return!0;return!1}}class _r{static async getTitle(e,t,n){let i=await zt.invokeTransformTitle(e,t);if(typeof i!="string"){const r=_r.stringifyTitles(i,t,n);i=n.appTitle,i=i.replace(/\${componentTitles}/g,r),i=i.replace(/\${appTitleSeparator}/g,r!==""?n.appTitleSeparator:"")}return i=await zt.invokeTransformTitle(i,t),i}static stringifyTitles(e,t,n){return e.map(r=>_r.stringifyTitle(r,t,n)).filter(r=>((r==null?void 0:r.length)??0)>0).join(" + ")}static stringifyTitle(e,t,n){const i=e.nextScopeInstructions;let r=_r.resolveTitle(e,t,n);if(Array.isArray(i)&&i.length>0){let o=_r.stringifyTitles(i,t,n);o.length>0&&(i.length!==1&&(o=`[ ${o} ]`),r.length>0?r=n.componentTitleOrder==="top-down"?r+n.componentTitleSeparator+o:o+n.componentTitleSeparator+r:r=o)}return r}static resolveTitle(e,t,n){let i=e.getTitle(t);return n.transformTitle!=null&&(i=n.transformTitle(i,e,t)),i}}const bi=sn.createInterface("IRouter",s=>s.singleton(Kn));class Kn{constructor(){this.rootScope=null,this.activeComponents=[],this.appendedInstructions=[],this.isActive=!1,this.coordinators=[],this.loadedFirst=!1,this._isProcessingNav=!1,this._logger=k(ji),this.container=k(Ri),this.ea=k(jr),this.navigator=k(sE),this.viewer=k(Dp),this.store=k(Dp),this.configuration=k(oc),this.handleNavigatorNavigateEvent=e=>{this._doHandleNavigatorNavigateEvent(e)},this.handleNavigatorStateChangeEvent=e=>{var t;if(((t=e.state)==null?void 0:t.navigationIndex)!=null){const n=vt.create(e.state.navigations[e.state.navigationIndex]);n.instruction=e.viewerState.instruction,n.fromBrowser=!0,this.navigator.navigate(n).catch(i=>{throw i})}else this.load(e.viewerState.instruction,{fromBrowser:!0}).catch(n=>{throw n})},this.processNavigation=async e=>{this.loadedFirst=!0;const t=this.configuration.options,n=Ko.create(this,e,{syncStates:this.configuration.options.navigationSyncStates});this.coordinators.push(n),n.appendInstructions(this.appendedInstructions.splice(0)),this.ea.publish(jo.eventName,jo.create(e));let i=typeof e.instruction=="string"&&!e.useFullStateInstruction?await zt.invokeTransformFromUrl(e.instruction,n.navigation):e.useFullStateInstruction?e.fullStateInstruction:e.instruction;const r=t.basePath;return r!==null&&typeof i=="string"&&i.startsWith(r)&&!t.useUrlFragmentHash&&(i=i.slice(r.length)),i==="/"&&(i=""),typeof i=="string"&&(i===""?(i=[new U("")],i[0].default=!0):i==="-"?(i=[new U("-"),new U("")],i[1].default=!0):i=U.parse(this,i)),e.scope??(e.scope=this.rootScope.scope),n.appendInstructions(i),t.completeStateNavigations&&Fo(i,!1).map(o=>o.scope).forEach(o=>n.ensureClearStateInstruction(o)),await n.processInstructions(),Q.run(null,()=>(n.closed=!0,n.finalEndpoint(),n.waitForSyncState("completed")),()=>(n.finalize(),this.updateNavigation(e)),()=>{e.navigation.new&&!e.navigation.first&&!e.repeating&&n.changedEndpoints.every(o=>o.options.noHistory)&&(e.untracked=!0)},async()=>{var o;for(;this.coordinators.length>0&&this.coordinators[0].completed;){const a=this.coordinators.shift();await this.navigator.finalize(a.navigation,!1),this.ea.publish(qo.eventName,qo.create(a.navigation)),this.ea.publish(pn.eventName,pn.create(a.navigation)),(o=a.navigation.process)==null||o.resolve(!0)}})}}get isNavigating(){return this.coordinators.length>0}get hasOpenNavigation(){return this.coordinators.filter(e=>!e.closed).length>0}get isRestrictedNavigation(){const e=this.configuration.options.navigationSyncStates;return e.includes("guardedLoad")||e.includes("unloaded")||e.includes("loaded")||e.includes("guarded")||e.includes("routed")}get statefulHistory(){return this.configuration.options.statefulHistoryLength!==void 0&&this.configuration.options.statefulHistoryLength>0}start(){if(this.isActive)throw Ke(2e3);this.isActive=!0;const e=this.container.get(Ho);this.rootScope=new _i(this,"rootScope",e.controller.viewModel,null,!0,e.config.component);const t=this.configuration.options;if(t.basePath===null){const n=new URL(e.host.baseURI);t.basePath=n.pathname}t.basePath.endsWith("/")&&(t.basePath=t.basePath.slice(0,-1)),this.navigator.start({store:this.store,viewer:this.viewer,statefulHistoryLength:this.configuration.options.statefulHistoryLength}),this._navigatorStateChangeEventSubscription=this.ea.subscribe(Ds.eventName,this.handleNavigatorStateChangeEvent),this._navigatorNavigateEventSubscription=this.ea.subscribe(Ls.eventName,this.handleNavigatorNavigateEvent),this.viewer.start({useUrlFragmentHash:this.configuration.options.useUrlFragmentHash}),this.ea.publish(xr.eventName,xr.create())}stop(){if(!this.isActive)throw Ke(2001);this.ea.publish(Vo.eventName,Vo.create()),this.navigator.stop(),this.viewer.stop(),this._navigatorStateChangeEventSubscription.dispose(),this._navigatorNavigateEventSubscription.dispose()}async initialLoad(){const{instruction:e,hash:t}=this.viewer.viewerState,n=this.load(e,{fragment:t,replacing:!0,fromBrowser:!1});return this.loadedFirst=!0,n}async _doHandleNavigatorNavigateEvent(e){var t,n;if(this._isProcessingNav){this._pendingNavigation&&((t=this._pendingNavigation.navigation.process)==null||t.resolve(!1)),this._pendingNavigation=e;return}this._isProcessingNav=!0;try{await this.processNavigation(e.navigation)}catch(i){(n=e.navigation.process)==null||n.reject(i)}finally{this._isProcessingNav=!1}if(this._pendingNavigation){const i=this._pendingNavigation;this._pendingNavigation=void 0,await this._doHandleNavigatorNavigateEvent(i)}}get isProcessingNav(){return this._isProcessingNav||this._pendingNavigation!=null}getEndpoint(e,t){return this.allEndpoints(e).find(n=>n.name===t)??null}allEndpoints(e,t=!1){return this.rootScope.scope.allScopes(t).filter(n=>e===null||n.type===e).map(n=>n.endpoint)}addEndpoint(e,...t){throw Ke(99,"addEndPoint")}connectEndpoint(e,t,n,i,r){const o=n.container,c=(o.has(Kn.closestEndpointKey,!0)?o.get(Kn.closestEndpointKey):this.rootScope).connectedScope;return e===null&&(e=c.addEndpoint(t,i,n,r),Ci.instance(Kn.closestEndpointKey,e).register(o)),e}disconnectEndpoint(e,t,n){if(!t.connectedScope.parent.removeEndpoint(e,t,n))throw Ke(2002,t.name)}async load(e,t){t=t??{},e=this.extractFragment(e,t),e=this.extractQuery(e,t);let n=null;({instructions:e,scope:n}=this.applyLoadOptions(e,t));const i=t.append??!1;if(i!==!1){if(i instanceof Ko){if(!i.closed)return e=U.from(this,e),this.appendInstructions(e,n,i),Promise.resolve()}else if(!this.loadedFirst||this.hasOpenNavigation)return e=U.from(this,e),this.appendInstructions(e,n),Promise.resolve()}const r=vt.create({instruction:e,fullStateInstruction:"",scope:n,title:t.title,data:t.data,query:t.query,fragment:t.fragment,parameters:t.parameters,replacing:(t.replacing??!1)||t.replace,repeating:(t.append??!1)!==!1,fromBrowser:t.fromBrowser??!1,origin:t.origin,completed:!1});return this.navigator.navigate(r)}applyLoadOptions(e,t,n=!0){t=t??{},"origin"in t&&!("context"in t)&&(t.context=t.origin);const{scope:i,instruction:r}=Qi.for(t.context??null,typeof e=="string"?e:void 0);if(typeof e=="string")if(n)e=r;else{e=U.from(this,r);for(const o of e)o.scope===null&&(o.scope=i)}else{e=U.from(this,e);for(const o of e)o.scope===null&&(o.scope=i)}return{instructions:e,scope:i}}refresh(){return this.navigator.refresh()}back(){return this.navigator.go(-1)}forward(){return this.navigator.go(1)}go(e){return this.navigator.go(e)}checkActive(e,t){if(typeof e=="string")throw Ke(2003,e);t=t??{},{instructions:e}=this.applyLoadOptions(e,t),e.forEach(i=>i.scope??(i.scope=this.rootScope.scope));const n=Fo(e.map(i=>i.scope));for(const i of n){const r=i.matchScope(e,!1),o=i.matchScope(this.activeComponents,!0);if(!U.contains(this,o,r,!0))return!1}return!0}unresolvedInstructionsError(e,t){throw this.ea.publish(Go.eventName,Go.create(e)),this.ea.publish(pn.eventName,pn.create(e)),hE(t,this._logger)}cancelNavigation(e,t){t.cancel(),this.ea.publish(zo.eventName,zo.create(e)),this.ea.publish(pn.eventName,pn.create(e))}appendInstructions(e,t=null,n=null){t===null&&(t=this.rootScope.scope);for(const i of e)i.scope===null&&(i.scope=t);if(n===null){for(let i=this.coordinators.length-1;i>=0;i--)if(!this.coordinators[i].closed){n=this.coordinators[i];break}}if(n===null)if(!this.loadedFirst)this.appendedInstructions.push(...e);else throw Ke(2004);n==null||n.appendInstructions(e)}async updateNavigation(e){var h,u,d;this.rootScope.scope.reparentRoutingInstructions();const t=this.rootScope.scope.getRoutingInstructions(e.timestamp);let{matchedInstructions:n}=this.rootScope.scope.matchEndpoints(t,[],!0),i=100;for(;n.length>0;){if(i--===0)throw Ke(2005);n=n.map(f=>{const{matchedInstructions:p}=f.endpoint.instance.scope.matchEndpoints(f.nextScopeInstructions??[],[],!0);return p}).flat()}e.timestamp>=(((h=this.activeNavigation)==null?void 0:h.timestamp)??0)&&(this.activeNavigation=e,this.activeComponents=t);let r=await zt.invokeTransformToUrl(t,e);if(typeof r!="string"&&(r=U.stringify(this,r,{endpointContext:!0})),r=await zt.invokeTransformToUrl(r,e),e.query==null&&e.parameters!=null){const f=new URLSearchParams;for(let[p,m]of Object.entries(e.parameters)){p=encodeURIComponent(p),Array.isArray(m)||(m=[m]);for(const g of m)f.append(p,encodeURIComponent(g))}e.query=f.toString()}let o=`${this.configuration.options.basePath}/`;(o===null||r!==""&&r[0]==="/"||this.configuration.options.useUrlFragmentHash)&&(o="");const a=(((u=e.query)==null?void 0:u.length)??0)>0?"?"+e.query:"",c=(((d=e.fragment)==null?void 0:d.length)??0)>0?"#"+e.fragment:"";e.path=o+r+a+c;const l=e.path.slice(o.length);if(e.fullStateInstruction=U.clear(this)+(l.length>0?Mt.for(this).sibling:"")+l,(e.title??null)===null){const f=await _r.getTitle(t,e,this.configuration.options.title);f!==null&&(e.title=f)}return Promise.resolve()}extractFragment(e,t){if(typeof e=="string"&&t.fragment==null){const[n,i]=e.split("#");e=n,t.fragment=i}return e}extractQuery(e,t){if(typeof e=="string"&&t.query==null){const[n,i]=e.split("?");e=n,t.query=i}return typeof t.parameters=="string"&&t.query==null&&(t.query=t.parameters,t.parameters=void 0),typeof t.query=="string"&&t.query.length>0&&(t.parameters??(t.parameters={}),new URLSearchParams(t.query).forEach((i,r)=>{r=decodeURIComponent(r),i=decodeURIComponent(i),r in t.parameters?(Array.isArray(t.parameters[r])||(t.parameters[r]=[t.parameters[r]]),t.parameters[r].push(i)):t.parameters[r]=i})),e}}Kn.closestEndpointKey=cu.annotation.keyFor("closest-endpoint");function hE(s,e){const t=Ke(2006,s.length);return t.remainingInstructions=s,e.warn(t,t.remainingInstructions),console.log(t,t.remainingInstructions),t}class fy{constructor(e){this.eventName=e}}class xr extends fy{static create(){return new xr(this.eventName)}}xr.eventName="au:router:router-start";class Vo extends fy{static create(){return new Vo(this.eventName)}}Vo.eventName="au:router:router-stop";class ia{constructor(e,t){this.eventName=e,this.navigation=t}}class jo extends ia{static create(e){return new jo(this.eventName,e)}}jo.eventName="au:router:navigation-start";class pn extends ia{static create(e){return new pn(this.eventName,e)}}pn.eventName="au:router:navigation-end";class zo extends ia{static create(e){return new zo(this.eventName,e)}}zo.eventName="au:router:navigation-cancel";class qo extends ia{static create(e){return new qo(this.eventName,e)}}qo.eventName="au:router:navigation-complete";class Go extends ia{static create(e){return new Go(this.eventName,e)}}Go.eventName="au:router:navigation-error";const py=sn.createInterface("ILinkHandler",s=>s.singleton(uE));class uE{constructor(){this.window=k(zc),this.router=k(bi)}handleEvent(e){this.handleClick(e)}handleClick(e){if(e.button!==0||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const t=e.currentTarget;if(t.hasAttribute("external"))return;const n=t.getAttribute("target")??"";if(n.length>0&&n!==this.window.name&&n!=="_self")return;const i=Oi.for(t,"load"),r=i!==void 0?i.viewModel.value:null,o=this.router.configuration.options.useHref&&t.hasAttribute("href")?t.getAttribute("href"):null;if((r===null||r.length===0)&&(o===null||o.length===0))return;e.preventDefault();let a=r??o??"";typeof a=="string"&&a.startsWith("#")&&(a=a.slice(1),a.startsWith("/")||(a=`/${a}`)),this.router.load(a,{origin:t}).catch(c=>{throw c})}}function kn(s,e,t,n,i=!1){if(i)return e==="";if(t)return e;const r=n.getAttribute(s)??"";return r.length>0?r:e}function Hp(s,e){if(!s.isActive)return new Promise(t=>{const n=e.subscribe(xr.eventName,()=>{t(),n.dispose()})})}function gy(s,e,t,n){var a,c;let i=(c=(a=Oi.for(t,"considered-active"))==null?void 0:a.viewModel)==null?void 0:c.value;i===void 0&&(i=n);const r=s.applyLoadOptions(i,{context:e}),o=U.from(s,r.instructions);for(const l of o)l.scope===null&&(l.scope=r.scope);return o}function my(s){let e=s.parentElement;for(;e!=null;){if(e.tagName==="AU-VIEWPORT"){e=null;break}if(e.hasAttribute("load-active"))break;e=e.parentElement}return e??(e=s),e}const nd=Wr.toView,vy=oe.createInjectable();class yy{constructor(){this.name="default",this.usedBy="",this.default="",this.fallback="",this.fallbackAction="",this.noScope=!1,this.noLink=!1,this.noTitle=!1,this.noHistory=!1,this.stateful=!1,this.endpoint=null,this.pendingChildren=[],this.pendingPromise=null,this.isBound=!1,this.router=k(bi),this.element=k(is),this.container=k(Ri),this.ea=k(jr),this.parentViewport=k(vy),this.instruction=k(Vs)}hydrated(e){this.controller=e,this.instruction.props.filter(n=>n.to==="default").length>0&&this.parentViewport!=null&&(this.parentViewport.pendingChildren.push(this),this.parentViewport.pendingPromise===null&&(this.parentViewport.pendingPromise=new Jt)),Q.run(null,()=>Hp(this.router,this.ea),()=>{this.router.isRestrictedNavigation&&this.connect()})}binding(e,t){return this.isBound=!0,Q.run(null,()=>Hp(this.router,this.ea),()=>{this.router.isRestrictedNavigation||this.connect()},()=>{var n;((n=this.endpoint)==null?void 0:n.activeResolve)!=null&&(this.endpoint.activeResolve(),this.endpoint.activeResolve=null)},()=>{var n;if(this.endpoint!==null&&this.endpoint.getNextContent()===null)return(n=this.endpoint.activate(null,e,this.controller,void 0))==null?void 0:n.asValue})}detaching(e,t){if(this.endpoint!==null)return this.isBound=!1,this.endpoint.deactivate(null,e,t)}unbinding(e,t){if(this.endpoint!==null)return this.disconnect(null)}dispose(){var e;(e=this.endpoint)==null||e.dispose(),this.endpoint=null}connect(){const{isBound:e,element:t}=this,n=kn("name",this.name,e,t),i={};i.scope=!kn("no-scope",this.noScope,!1,t,!0),i.usedBy=kn("used-by",this.usedBy,e,t),i.default=kn("default",this.default,e,t),i.fallback=kn("fallback",this.fallback,e,t),i.fallbackAction=kn("fallback-action",this.fallbackAction,e,t),i.noLink=kn("no-link",this.noLink,e,t,!0),i.noTitle=kn("no-title",this.noTitle,e,t,!0),i.noHistory=kn("no-history",this.noHistory,e,t,!0),i.stateful=kn("stateful",this.stateful,e,t,!0),Object.keys(i).forEach(o=>{i[o]===void 0&&delete i[o]}),this.endpoint=this.router.connectEndpoint(this.endpoint,"Viewport",this,n,i);const r=this.parentViewport;r!=null&&(Xe(r.pendingChildren,o=>o===this),r.pendingChildren.length===0&&r.pendingPromise!==null&&(r.pendingPromise.resolve(),r.pendingPromise=null))}disconnect(e){this.endpoint!==null&&this.router.disconnectEndpoint(e,this.endpoint,this)}setActivity(e,t){const n=this.router.configuration.options.indicators.viewportNavigating;if(typeof e=="string")this.element.classList.toggle(e,t);else for(const i in e)this.element.classList.toggle(`${n}-${i}`,t&&e[i])}}oe.define({name:"au-viewport",injectable:vy,bindables:["name","usedBy","default","fallback","fallbackAction","noScope","noLink","noTitle","noHistory","stateful"]},yy);const _y=oe.createInjectable();class by{constructor(){this.name="default",this.catches="",this.collection=!1,this.source=null,this.viewportScope=null,this.isBound=!1,this.router=k(bi),this.element=k(is),this.container=k(Ri),this.parent=k(_y),this.parentController=k(na)}hydrated(e){this.controller=e}bound(e,t){this.isBound=!0,this.$controller.scope=this.parentController.scope,this.connect(),this.viewportScope!==null&&this.viewportScope.binding()}unbinding(e,t){return this.viewportScope!==null&&this.viewportScope.unbinding(),Promise.resolve()}connect(){if(this.router.rootScope===null)return;const e=this.getAttribute("name",this.name),t={};let n=this.getAttribute("catches",this.catches);n!==void 0&&(t.catches=n),n=this.getAttribute("collection",this.collection,!0),n!==void 0&&(t.collection=n),t.source=this.source??null,this.viewportScope=this.router.connectEndpoint(this.viewportScope,"ViewportScope",this,e,t)}disconnect(){this.viewportScope&&this.router.disconnectEndpoint(null,this.viewportScope,this),this.viewportScope=null}getAttribute(e,t,n=!1){if(this.isBound)return t;if(this.element.hasAttribute(e)){if(n)return!0;if(t=this.element.getAttribute(e),t.length>0)return t}}}oe.define({name:"au-viewport-scope",template:"<template></template>",containerless:!1,injectable:_y,bindables:["name","catches","collection","source"]},by);class id{constructor(){this._separateProperties=!1,this.hasHref=null,this.element=k(is),this.router=k(bi),this.linkHandler=k(py),this.ea=k(jr),this.activeClass=this.router.configuration.options.indicators.loadActive,this.navigationEndHandler=e=>{this.updateActive()}}binding(){this.value==null&&(this._separateProperties=!0),this.element.addEventListener("click",this.linkHandler),this.updateValue(),this.updateActive(),this.routerNavigationSubscription=this.ea.subscribe(pn.eventName,this.navigationEndHandler)}unbinding(){this.element.removeEventListener("click",this.linkHandler),this.routerNavigationSubscription.dispose()}valueChanged(e){this.updateValue(),this.updateActive()}updateValue(){if(this._separateProperties&&(this.value={component:this.component,parameters:this.parameters,viewport:this.viewport,id:this.id}),this.hasHref===null&&(this.hasHref=this.element.hasAttribute("href")),!this.hasHref){let e=this.value;if(typeof e!="string"){const r=U.from(this.router,e).shift(),o=this._findRoute(e);o.foundConfiguration&&(r.route=o.matching),e=U.stringify(this.router,[r])}const{scope:t,instruction:n}=Qi.for(this.element,e);e=`${(t==null?void 0:t.path)??""}${n??""}`,this.router.configuration.options.useUrlFragmentHash&&!e.startsWith("#")&&(e=`#/${e}`),this.element.setAttribute("href",e)}}async updateActive(){const e=Oi.for(this.element,"load").parent,t=typeof this.value=="string"?{id:this.value,path:this.value}:this.value,n=this._findRoute(t),i=n.foundConfiguration?n.instructions:gy(this.router,e,this.element,this.value);my(this.element).classList.toggle(this.activeClass,this.router.checkActive(i,{context:e}))}_findRoute(e){if(typeof e=="string")return new yi;const t=Qi.for(this.element).scope??this.router.rootScope.scope;if(e.id!=null)return t.findMatchingRoute(e.id,e.parameters??{});const n=e.path;return n!=null?t.findMatchingRoute(n,e.parameters??{}):new yi}}Oi.define({name:"load",bindables:{value:{mode:nd},component:{},parameters:{},viewport:{},id:{}}},id);class wy{constructor(){this.element=k(is),this.router=k(bi),this.linkHandler=k(py),this.ea=k(jr),this.activeClass=this.router.configuration.options.indicators.loadActive,this.navigationEndHandler=e=>{this.updateActive()}}binding(){this.router.configuration.options.useHref&&!this.hasLoad()&&!this.element.hasAttribute("external")&&(this.element.addEventListener("click",this.linkHandler),this.routerNavigationSubscription=this.ea.subscribe(pn.eventName,this.navigationEndHandler)),this.updateValue(),this.updateActive()}unbinding(){var e;this.element.removeEventListener("click",this.linkHandler),(e=this.routerNavigationSubscription)==null||e.dispose()}valueChanged(){this.updateValue(),this.updateActive()}updateValue(){this.element.setAttribute("href",this.value)}updateActive(){if(this.router.configuration.options.useHref&&!this.hasLoad()&&!this.element.hasAttribute("external")){const e=Oi.for(this.element,"href").parent,t=gy(this.router,e,this.element,this.value);my(this.element).classList.toggle(this.activeClass,this.router.checkActive(t,{context:e}))}}hasLoad(){const t=this.$controller.parent.children;return(t==null?void 0:t.some(n=>n.vmKind==="customAttribute"&&n.viewModel instanceof id))??!1}}wy.$au={type:"custom-attribute",name:"href",noMultiBindings:!0,bindables:{value:{mode:nd}}};class Cy{}Oi.define({name:"considered-active",bindables:{value:{mode:nd}}},Cy);const oc=sn.createInterface("IRouterConfiguration",s=>s.singleton(kt)),dE=bi,fE=[dE],pE=[yy,by,id,wy,Cy];class kt{static register(e){const t=e.get(oc);return t.options=kt.options,t.options.setRouterConfiguration(t),kt.options=$n.create(),e.register(...fE,...pE,Tl.activating(bi,kt.configurationCall),Tl.activated(bi,n=>n.initialLoad()),Tl.deactivated(bi,n=>n.stop()))}static customize(e){return e===void 0?(kt.options=$n.create(),kt.configurationCall=t=>{t.start()}):e instanceof Function?kt.configurationCall=e:(kt.options=$n.create(),kt.options.apply(e)),kt}static createContainer(){return this.register(sn.createContainer())}static for(e){return e instanceof Kn?e.configuration:e.get(oc)}apply(e,t=!1){t&&(this.options=$n.create()),this.options.apply(e)}addHook(e,t){return zt.add(e,t)}removeHook(e){return zt.remove(e)}removeAllHooks(){return zt.removeAll()}}kt.options=$n.create();kt.configurationCall=s=>{s.start()};const Sy="about-page",Mh=`<h1>The about page.</h1>
`,Ay=[],Ty={};let xl;function gE(s){xl||(xl=oe.define({name:Sy,template:Mh,dependencies:Ay,bindables:Ty})),s.register(xl)}const mE=Object.freeze(Object.defineProperty({__proto__:null,bindables:Ty,default:Mh,dependencies:Ay,name:Sy,register:gE,template:Mh},Symbol.toStringTag,{value:"Module"})),Iy="missing-page",xh="<h3>Ouch! Couldn't find '${missingComponent}'!</h3>\n",ky=[],Ey={};let $l;function vE(s){$l||($l=oe.define({name:Iy,template:xh,dependencies:ky,bindables:Ey})),s.register($l)}const yE=Object.freeze(Object.defineProperty({__proto__:null,bindables:Ey,default:xh,dependencies:ky,name:Iy,register:vE,template:xh},Symbol.toStringTag,{value:"Module"}));var _E=Object.create,sd=Object.defineProperty,bE=Object.getOwnPropertyDescriptor,wE=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),Ry=s=>{throw TypeError(s)},CE=(s,e,t)=>e in s?sd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,SE=(s,e)=>sd(s,"name",{value:e,configurable:!0}),AE=s=>[,,,_E(null)],TE=["class","method","getter","setter","accessor","field","value","get","set"],Py=s=>s!==void 0&&typeof s!="function"?Ry("Function expected"):s,IE=(s,e,t,n,i)=>({kind:TE[s],name:e,metadata:n,addInitializer:r=>t._?Ry("Already initialized"):i.push(Py(r||null))}),kE=(s,e)=>CE(e,wE("metadata"),s[3]),EE=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},RE=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&bE(i,t));SE(i,t);for(var p=n.length-1;p>=0;p--)c=IE(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Py(o)&&(i=o);return kE(s,i),f&&sd(i,t,f),h?l^4?r:f:i},Oy,rd;Oy=[wn(yE)];class Wo{constructor(){G(this,"missingComponent")}loading(e){this.missingComponent=e.id}}G(Wo,"parameters",["id"]);rd=AE();Wo=RE(rd,0,"MissingPage",Oy,Wo);EE(rd,1,Wo);const PE=Object.freeze(Object.defineProperty({__proto__:null,get MissingPage(){return Wo}},Symbol.toStringTag,{value:"Module"})),Ny="settings-page",$h=`<div>
  <input id="backgroundimage" name="BackgroundImage" type="file" change.trigger="test($event)" accept="image/*" title=" ">
  <label for="backgroundimage">Background image <i class="bi bi-file-earmark-image"></i>: \${settings.styles.backgroundImageName}</label>
</div>

<div>
  <input id="backgroundcolor" name="BackgroundColor" type="color" value.bind="settings.bacgroundColor">
  <label for="backgroundcolor">Background color:</label>
</div>

<div class="btn-tool" click.trigger="onInputSave()">
  <i class="bi bi-floppy"></i>
  Save
</div>
`,My=[],xy={};let Ll;function OE(s){Ll||(Ll=oe.define({name:Ny,template:$h,dependencies:My,bindables:xy})),s.register(Ll)}const NE=Object.freeze(Object.defineProperty({__proto__:null,bindables:xy,default:$h,dependencies:My,name:Ny,register:OE,template:$h},Symbol.toStringTag,{value:"Module"}));class ve{}G(ve,"EmailRead","email:read"),G(ve,"EmailClose","email:unselect"),G(ve,"EmailNew","email:new"),G(ve,"EmailPinAdd","email:pin:add"),G(ve,"EmailPinRemove","email:pin:remove"),G(ve,"AccountSelect","account:select"),G(ve,"AccountsRefresh","accounts:refresh"),G(ve,"SettingsStyle","settings:style");var ME=Object.create,od=Object.defineProperty,xE=Object.getOwnPropertyDescriptor,$E=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),$y=s=>{throw TypeError(s)},LE=(s,e,t)=>e in s?od(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,DE=(s,e)=>od(s,"name",{value:e,configurable:!0}),BE=s=>[,,,ME(null)],HE=["class","method","getter","setter","accessor","field","value","get","set"],Ly=s=>s!==void 0&&typeof s!="function"?$y("Function expected"):s,UE=(s,e,t,n,i)=>({kind:HE[s],name:e,metadata:n,addInitializer:r=>t._?$y("Already initialized"):i.push(Ly(r||null))}),FE=(s,e)=>LE(e,$E("metadata"),s[3]),KE=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},VE=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&xE(i,t));DE(i,t);for(var p=n.length-1;p>=0;p--)c=UE(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Ly(o)&&(i=o);return FE(s,i),f&&od(i,t,f),h?l^4?r:f:i},Dy,ad;class jE{constructor(){G(this,"backgroundColor","black");G(this,"backgroundImageName","");G(this,"backgroundImage","");G(this,"backgroundBlur",10)}}class zE{}let ro;const Up="settings:styles",Fp="settings:accounts";Dy=[nn(Yn)];class Bs{constructor(e){G(this,"styles",new jE);G(this,"accounts",new zE);this.ea=e;const t=indexedDB.open("imageDB",1);t.onupgradeneeded=n=>{ro=t.result,ro.createObjectStore("images",{keyPath:"id"}),this.load()},t.onsuccess=n=>{ro=t.result,this.load()},t.onerror=n=>{}}load(){let e=localStorage.getItem(Up);if(!e)return;let t=JSON.parse(e);Object.assign(this.styles,t),this.loadBackground(),e=localStorage.getItem(Fp),e&&(t=JSON.parse(e),Object.assign(this.accounts,t))}save(){let{backgroundImage:e,...t}=this.styles;localStorage.setItem(Fp,JSON.stringify(this.accounts)),localStorage.setItem(Up,JSON.stringify(t)),this.saveBackground()}loadBackground(){const n=ro.transaction(["images"],"readonly").objectStore("images").get("backgroundImage");n.onsuccess=i=>{this.styles.backgroundImage=n.result.image,this.ea.publish(ve.SettingsStyle)},n.onerror=function(i){console.error("Error loading image:","")}}saveBackground(){const t=ro.transaction(["images"],"readwrite").objectStore("images"),n={id:"backgroundImage",image:this.styles.backgroundImage},i=t.put(n);i.onsuccess=function(){},i.onerror=function(r){console.error("Error storing image:","")}}}ad=BE();Bs=VE(ad,0,"SettingsService",Dy,Bs);KE(ad,1,Bs);var qE=Object.create,cd=Object.defineProperty,GE=Object.getOwnPropertyDescriptor,WE=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),By=s=>{throw TypeError(s)},QE=(s,e,t)=>e in s?cd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,YE=(s,e)=>cd(s,"name",{value:e,configurable:!0}),JE=s=>[,,,qE(null)],XE=["class","method","getter","setter","accessor","field","value","get","set"],Hy=s=>s!==void 0&&typeof s!="function"?By("Function expected"):s,ZE=(s,e,t,n,i)=>({kind:XE[s],name:e,metadata:n,addInitializer:r=>t._?By("Already initialized"):i.push(Hy(r||null))}),e0=(s,e)=>QE(e,WE("metadata"),s[3]),t0=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},n0=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&GE(i,t));YE(i,t);for(var p=n.length-1;p>=0;p--)c=ZE(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Hy(o)&&(i=o);return e0(s,i),f&&cd(i,t,f),h?l^4?r:f:i},Uy,ld;Uy=[wn(NE),nn(Yn,Bs)];class ac{constructor(e,t){this.ea=e,this.settings=t}onInputBackgroundColor(e){this.settings.styles.backgroundColor=e}onInputBackgroundImage(e){console.log("new bg img: "+e),this.settings.styles.backgroundImage=e}onInputSave(){this.settings.save()}test(e){console.log(e);let t=e.target;if(t.files&&t.files.length>0){let n=t.files[0];this.settings.styles.backgroundImageName=n.name;const i=new FileReader;i.onload=r=>{var o;this.settings.styles.backgroundImage=(o=r.target)==null?void 0:o.result,this.ea.publish(ve.SettingsStyle),this.onInputSave()},i.readAsDataURL(n)}}}ld=JE();ac=n0(ld,0,"SettingsPage",Uy,ac);t0(ld,1,ac);const i0=Object.freeze(Object.defineProperty({__proto__:null,get SettingsPage(){return ac}},Symbol.toStringTag,{value:"Module"})),Fy="email-list-item",Lh=`<button class="mail \${styleClass}" click.trigger="onClick()">
  <div class="author">\${nameOrAddress}</div>
  <div class="subtitle">
    <div class="subject">\${title}</div>
    <!-- <div class="subject">\${mail.bodyPreview}</div> -->
    <div class="date">\${date}</div>
  </div>

  <div class="options">
    <div if.bind="isFlagged" class="btn-icon" click.trigger="onClickFlag(false)"><i class="bi bi-flag-fill"></i></div>
    <div else class="btn-icon" click.trigger="onClickFlag(true)"><i class="bi bi-flag"></i></div>

    <div if.bind="isPinned" class="btn-icon" click.trigger="onClickPin(false)"><i class="bi bi-pin-angle-fill"></i></div>
    <div else class="btn-icon" click.trigger="onClickPin(true)"><i class="bi bi-pin-angle"></i></div>

    <div class="btn-icon" click.trigger="onClickDelete()"><i class="bi bi-trash"></i></div>
  </div>

</button>
`,Ky=[],Vy={};let Dl;function s0(s){Dl||(Dl=oe.define({name:Fy,template:Lh,dependencies:Ky,bindables:Vy})),s.register(Dl)}const r0=Object.freeze(Object.defineProperty({__proto__:null,bindables:Vy,default:Lh,dependencies:Ky,name:Fy,register:s0,template:Lh},Symbol.toStringTag,{value:"Module"}));var o0=Object.create,hd=Object.defineProperty,a0=Object.getOwnPropertyDescriptor,c0=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),sa=s=>{throw TypeError(s)},jy=(s,e,t)=>e in s?hd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Kp=(s,e)=>hd(s,"name",{value:e,configurable:!0}),l0=s=>[,,,o0(null)],zy=["class","method","getter","setter","accessor","field","value","get","set"],ho=s=>s!==void 0&&typeof s!="function"?sa("Function expected"):s,h0=(s,e,t,n,i)=>({kind:zy[s],name:e,metadata:n,addInitializer:r=>t._?sa("Already initialized"):i.push(ho(r||null))}),u0=(s,e)=>jy(e,c0("metadata"),s[3]),Dh=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)e&1?r[i].call(t):n=r[i].call(t,n);return n},qy=(s,e,t,n,i,r)=>{var o,a,c,l,h,u=e&7,d=!!(e&8),f=!!(e&16),p=u>3?s.length+1:u?d?1:2:0,m=zy[u+5],g=u>3&&(s[p-1]=[]),v=s[p]||(s[p]=[]),S=u&&(!f&&!d&&(i=i.prototype),u<5&&(u>3||!f)&&a0(u<4?i:{get[t](){return Vp(this,r)},set[t](C){return jp(this,r,C)}},t));u?f&&u<4&&Kp(r,(u>2?"set ":u>1?"get ":"")+t):Kp(i,t);for(var R=n.length-1;R>=0;R--)l=h0(u,t,c={},s[3],v),u&&(l.static=d,l.private=f,h=l.access={has:f?C=>d0(i,C):C=>t in C},u^3&&(h.get=f?C=>(u^1?Vp:f0)(C,i,u^4?r:S.get):C=>C[t]),u>2&&(h.set=f?(C,I)=>jp(C,i,I,u^4?r:S.set):(C,I)=>C[t]=I)),a=(0,n[R])(u?u<4?f?r:S[m]:u>4?void 0:{get:S.get,set:S.set}:i,l),c._=1,u^4||a===void 0?ho(a)&&(u>4?g.unshift(a):u?f?r=a:S[m]=a:i=a):typeof a!="object"||a===null?sa("Object expected"):(ho(o=a.get)&&(S.get=o),ho(o=a.set)&&(S.set=o),ho(o=a.init)&&g.unshift(o));return u||u0(s,i),S&&hd(i,t,S),f?u^4?r:S:i},oo=(s,e,t)=>jy(s,typeof e!="symbol"?e+"":e,t),ud=(s,e,t)=>e.has(s)||sa("Cannot "+t),d0=(s,e)=>Object(e)!==e?sa('Cannot use the "in" operator on this value'):s.has(e),Vp=(s,e,t)=>(ud(s,e,"read from private field"),t?t.call(s):e.get(s)),jp=(s,e,t,n)=>(ud(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),f0=(s,e,t)=>(ud(s,e,"access private method"),t),Gy,Wy,$r;const Qy={day:"numeric",month:"short",year:"numeric"},Yy={weekday:"long",day:"2-digit"},Jy={weekday:"short",hour:"2-digit",minute:"2-digit",hour12:!0},Xy={hour:"2-digit",minute:"2-digit",hour12:!0},Bl=24*60*60*1e3;Wy=[wn(r0),nn(Yn)],Gy=[BT];class Qo{constructor(e){this.ea=e,oo(this,"mail",Dh($r,8,this)),Dh($r,11,this),oo(this,"isReading",!1),oo(this,"closeListener"),oo(this,"isPinned",!1),oo(this,"isFlagged",!1)}attached(){var e,t;this.mail&&(this.isPinned=(e=Object.getOwnPropertyDescriptor(this.mail,"isPinned"))==null?void 0:e.value,this.isFlagged=(t=Object.getOwnPropertyDescriptor(this.mail,"isFlagged"))==null?void 0:t.value)}get styleClass(){var e;return this.isReading?"selected":(e=this.mail)!=null&&e.isRead?"normal":"unread"}get nameOrAddress(){var t,n,i,r,o,a;let e=(i=(n=(t=this.mail)==null?void 0:t.from)==null?void 0:n.emailAddress)==null?void 0:i.name;return e||(e=(a=(o=(r=this.mail)==null?void 0:r.from)==null?void 0:o.emailAddress)==null?void 0:a.address),e}get title(){var e;return(e=this.mail)==null?void 0:e.subject}get date(){var i;let e=new Date;var t=new Date((i=this.mail)==null?void 0:i.sentDateTime);let n=e.getTime()-t.getTime();return n<1*Bl?t.toLocaleString(void 0,Xy):n<2*Bl?t.toLocaleString(void 0,Jy):n<7*Bl?t.toLocaleString(void 0,Yy):t.toLocaleString(void 0,Qy)}onClick(){this.isReading=!this.isReading,this.isReading?(this.ea.publish(ve.EmailClose),this.ea.publish(ve.EmailRead,this.mail),this.closeListener=this.ea.subscribe(ve.EmailClose,()=>{var e;this.isReading=!1,(e=this.closeListener)==null||e.dispose(),this.closeListener=void 0})):this.ea.publish(ve.EmailRead,void 0)}onClickPin(e){this.isPinned=e,Object.defineProperty(this.mail,"isPinned",{value:e}),this.isPinned?this.ea.publish(ve.EmailPinAdd,this.mail):this.ea.publish(ve.EmailPinRemove,this.mail)}onClickFlag(e){this.isFlagged=e,Object.defineProperty(this.mail,"isFlagged",{value:e})}onClickDelete(){}}$r=l0();qy($r,5,"mail",Gy,Qo);Qo=qy($r,0,"EmailListItem",Wy,Qo);Dh($r,1,Qo);const p0=Object.freeze(Object.defineProperty({__proto__:null,get EmailListItem(){return Qo},fullDateFormat:Qy,todayDateFormat:Xy,weekDateFormat:Yy,yesterdayDateFormat:Jy},Symbol.toStringTag,{value:"Module"})),Zy="email-list",Bh=`

<!-- Header -->
<div class="email_list_header">
  <div class="divleft">
    <button class="btn btn-primary" id="btnNewMessage" click.trigger="onClickNewMessage()">Nouveau message</button>
    <input class="" type="search" placeholder="Search" id="inputSearch" value.bind="inputSearchValue" keyup.trigger="onInputSearchType()">
    <button class="btn btn-outline-success" type="submit" id="btnSearch" click.trigger="onClickSearch()"><i class="bi bi-search"></i></button>
  </div>

  <div class="divright">
    <label id="checkSelectAll">
      <input type="checkbox" class="filled-in" />
      <span>Select all</span>
    </label>
    <button class="btn btn-primary" id="refresh" click.trigger="onClickRefresh()">
      <i class="bi bi-arrow-repeat"></i>
    </button>
  </div>
</div>

<!-- Email list -->
<div class="list-group" id="list-tab" role="tablist">
  <div if.bind="inputSearchValue">
    <email-list-item repeat.for="mail of filteredMails" mail.bind="mail"></email-list-item>
  </div>
  <div else>
    <div if.bind="pinnedMails.length > 0">
      <div class="timeframe">Pinned</div>
      <email-list-item repeat.for="mail of pinnedMails" mail.bind="mail"></email-list-item>
    </div>
    <div if.bind="todaysMails.length > 0">
      <div class="timeframe">\${thisDayHeader}</div>
      <email-list-item repeat.for="mail of todaysMails" mail.bind="mail"></email-list-item>
    </div>
    <div if.bind="yesterdaysMails.length > 0">
      <div class="timeframe">\${thisYesterdayHeader}</div>
      <email-list-item repeat.for="mail of yesterdaysMails" mail.bind="mail"></email-list-item>
    </div>
    <div if.bind="weeksMails.length > 0">
      <div class="timeframe">\${thisWeekHeader}</div>
      <email-list-item repeat.for="mail of weeksMails" mail.bind="mail"></email-list-item>
    </div>
    <div if.bind="monthMails.length > 0">
      <div class="timeframe">\${thisMonthHeader}</div>
      <email-list-item repeat.for="mail of monthMails" mail.bind="mail"></email-list-item>
    </div>
    <div if.bind="laterMails.length > 0">
      <div class="timeframe">\${thisLaterHeader}</div>
      <email-list-item repeat.for="mail of laterMails" mail.bind="mail"></email-list-item>
    </div>
  </div>
</div>

<!-- Pagination -->
<div class="d-flex justify-content-center pages" style="width: 100%;">
  <button class="btn btn-primary wave-teal">Prev</button>
  <button class="btn btn-primary wave-teal">1</button>
  <button class="btn btn-primary wave-teal">2</button>
  <button class="btn btn-primary wave-teal">3</button>
  <button class="btn btn-primary wave-teal" click.trigger="onClickNext()">Next</button>
</div>
`,e_=[p0],t_={};let Hl;function g0(s){Hl||(Hl=oe.define({name:Zy,template:Bh,dependencies:e_,bindables:t_})),s.register(Hl)}const m0=Object.freeze(Object.defineProperty({__proto__:null,bindables:t_,default:Bh,dependencies:e_,name:Zy,register:g0,template:Bh},Symbol.toStringTag,{value:"Module"}));/*! @azure/msal-common v14.14.2 2024-08-28 */const A={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},ya={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Qr=[A.OPENID_SCOPE,A.PROFILE_SCOPE,A.OFFLINE_ACCESS_SCOPE],zp=[...Qr,A.EMAIL_SCOPE],Dn={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},nt={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Vi={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},_a={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},it={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},qp={PLAIN:"plain",S256:"S256"},ra={QUERY:"query",FRAGMENT:"fragment"},v0={...ra,FORM_POST:"form_post"},n_={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},ba={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},yt={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},W={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},dd="appmetadata",y0="client_info",Po="1",cc={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Bt={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},lt={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},we={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Oo={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},Gp={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Wp={username:"username",password:"password"},wa={httpSuccess:200,httpBadRequest:400},tr={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},Ul={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Li={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},_0={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},b0=300;/*! @azure/msal-common v14.14.2 2024-08-28 */const fd="unexpected_error",w0="post_request_failed";/*! @azure/msal-common v14.14.2 2024-08-28 */const Qp={[fd]:"Unexpected error in authentication.",[w0]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class Le extends Error{constructor(e,t,n){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,Le.prototype),this.errorCode=e||A.EMPTY_STRING,this.errorMessage=t||A.EMPTY_STRING,this.subError=n||A.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function i_(s,e){return new Le(s,e?`${Qp[s]} ${e}`:Qp[s])}/*! @azure/msal-common v14.14.2 2024-08-28 */const pd="client_info_decoding_error",s_="client_info_empty_error",gd="token_parsing_error",r_="null_or_empty_token",li="endpoints_resolution_error",o_="network_error",a_="openid_config_error",c_="hash_not_deserialized",Lr="invalid_state",l_="state_mismatch",lc="state_not_found",h_="nonce_mismatch",md="auth_time_not_found",u_="max_age_transpired",C0="multiple_matching_tokens",S0="multiple_matching_accounts",d_="multiple_matching_appMetadata",f_="request_cannot_be_made",p_="cannot_remove_empty_scope",g_="cannot_append_scopeset",Hh="empty_input_scopeset",A0="device_code_polling_cancelled",T0="device_code_expired",I0="device_code_unknown_error",vd="no_account_in_silent_request",m_="invalid_cache_record",yd="invalid_cache_environment",Uh="no_account_found",Fh="no_crypto_object",Kh="unexpected_credential_type",k0="invalid_assertion",E0="invalid_client_credential",fi="token_refresh_required",R0="user_timeout_reached",v_="token_claims_cnf_required_for_signedjwt",y_="authorization_code_missing_from_server_response",__="binding_key_not_removed",b_="end_session_endpoint_not_supported",_d="key_id_missing",P0="no_network_connectivity",O0="user_canceled",N0="missing_tenant_id_error",ne="method_not_implemented",M0="nested_app_auth_bridge_disabled";/*! @azure/msal-common v14.14.2 2024-08-28 */const Yp={[pd]:"The client info could not be parsed/decoded correctly",[s_]:"The client info was empty",[gd]:"Token cannot be parsed",[r_]:"The token is null or empty",[li]:"Endpoints cannot be resolved",[o_]:"Network request failed",[a_]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[c_]:"The hash parameters could not be deserialized",[Lr]:"State was not the expected format",[l_]:"State mismatch error",[lc]:"State not found",[h_]:"Nonce mismatch error",[md]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[u_]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[C0]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[S0]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[d_]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[f_]:"Token request cannot be made without authorization code or refresh token.",[p_]:"Cannot remove null or empty scope from ScopeSet",[g_]:"Cannot append ScopeSet",[Hh]:"Empty input ScopeSet cannot be processed",[A0]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[T0]:"Device code is expired.",[I0]:"Device code stopped polling for unknown reasons.",[vd]:"Please pass an account object, silent flow is not supported without account information",[m_]:"Cache record object was null or undefined.",[yd]:"Invalid environment when attempting to create cache entry",[Uh]:"No account found in cache for given key.",[Fh]:"No crypto object detected.",[Kh]:"Unexpected credential type.",[k0]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[E0]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[fi]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[R0]:"User defined timeout for device code polling reached",[v_]:"Cannot generate a POP jwt if the token_claims are not populated",[y_]:"Server response does not contain an authorization code to proceed",[__]:"Could not remove the credential's binding key from storage.",[b_]:"The provided authority does not support logout",[_d]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[P0]:"No network connectivity. Check your internet connection.",[O0]:"User cancelled the flow.",[N0]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[ne]:"This method has not been implemented",[M0]:"The nested app auth bridge is disabled"};class Wc extends Le{constructor(e,t){super(e,t?`${Yp[e]}: ${t}`:Yp[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Wc.prototype)}}function M(s,e){return new Wc(s,e)}/*! @azure/msal-common v14.14.2 2024-08-28 */function Gs(s,e){const t=x0(s);try{const n=e(t);return JSON.parse(n)}catch{throw M(gd)}}function x0(s){if(!s)throw M(r_);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(s);if(!t||t.length<4)throw M(gd);return t[2]}function w_(s,e){if(e===0||Date.now()-3e5>s+e)throw M(u_)}/*! @azure/msal-common v14.14.2 2024-08-28 */const dn={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v14.14.2 2024-08-28 */function $0(s){return s.hasOwnProperty("authorization_endpoint")&&s.hasOwnProperty("token_endpoint")&&s.hasOwnProperty("issuer")&&s.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v14.14.2 2024-08-28 */const C_="redirect_uri_empty",L0="claims_request_parsing_error",S_="authority_uri_insecure",uo="url_parse_error",A_="empty_url_error",T_="empty_input_scopes_error",I_="invalid_prompt_value",bd="invalid_claims",k_="token_request_empty",E_="logout_request_empty",R_="invalid_code_challenge_method",wd="pkce_params_missing",Cd="invalid_cloud_discovery_metadata",P_="invalid_authority_metadata",O_="untrusted_authority",Qc="missing_ssh_jwk",N_="missing_ssh_kid",D0="missing_nonce_authentication_header",B0="invalid_authentication_header",M_="cannot_set_OIDCOptions",x_="cannot_allow_native_broker",$_="authority_mismatch";/*! @azure/msal-common v14.14.2 2024-08-28 */const H0={[C_]:"A redirect URI is required for all calls, and none has been set.",[L0]:"Could not parse the given claims request object.",[S_]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[uo]:"URL could not be parsed into appropriate segments.",[A_]:"URL was empty or null.",[T_]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[I_]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[bd]:"Given claims parameter must be a stringified JSON object.",[k_]:"Token request was empty and not found in cache.",[E_]:"The logout request was null or undefined.",[R_]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[wd]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Cd]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[P_]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[O_]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Qc]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[N_]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[D0]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[B0]:"Invalid authentication header provided",[M_]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[x_]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[$_]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class Sd extends Le{constructor(e){super(e,H0[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Sd.prototype)}}function Te(s){return new Sd(s)}/*! @azure/msal-common v14.14.2 2024-08-28 */class vn{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),i=r=>decodeURIComponent(r.replace(/\+/g," "));return n.forEach(r=>{if(r.trim()){const[o,a]=r.split(/=(.+)/g,2);o&&a&&(t[i(o)]=i(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v14.14.2 2024-08-28 */function L_(s){return s.startsWith("#/")?s.substring(2):s.startsWith("#")||s.startsWith("?")?s.substring(1):s}function hc(s){if(!s||s.indexOf("=")<0)return null;try{const e=L_(s),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw M(c_)}return null}/*! @azure/msal-common v14.14.2 2024-08-28 */class he{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Te(A_);e.includes("#")||(this._urlString=he.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return vn.endsWith(t,"?")?t=t.slice(0,-1):vn.endsWith(t,"?/")&&(t=t.slice(0,-2)),vn.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw Te(uo)}if(!e.HostNameAndPort||!e.PathSegments)throw Te(uo);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw Te(S_)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return he.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===Vi.COMMON||n[0]===Vi.ORGANIZATIONS)&&(n[0]=e),he.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Te(uo);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=n.AbsolutePath.split("/");return i=i.filter(r=>r&&r.length>0),n.PathSegments=i,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw Te(uo);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===A.FORWARD_SLASH){const i=new he(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new he(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!hc(e)}}/*! @azure/msal-common v14.14.2 2024-08-28 */const D_={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},Jp=D_.endpointMetadata,Ad=D_.instanceDiscoveryMetadata,B_=new Set;Ad.metadata.forEach(s=>{s.aliases.forEach(e=>{B_.add(e)})});function U0(s,e){var i;let t;const n=s.canonicalAuthority;if(n){const r=new he(n).getUrlComponents().HostNameAndPort;t=Xp(r,(i=s.cloudDiscoveryMetadata)==null?void 0:i.metadata,Bt.CONFIG,e)||Xp(r,Ad.metadata,Bt.HARDCODED_VALUES,e)||s.knownAuthorities}return t||[]}function Xp(s,e,t,n){if(n==null||n.trace(`getAliasesFromMetadata called with source: ${t}`),s&&e){const i=uc(e,s);if(i)return n==null||n.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;n==null||n.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function F0(s){return uc(Ad.metadata,s)}function uc(s,e){for(let t=0;t<s.length;t++){const n=s[t];if(n.aliases.includes(e))return n}return null}/*! @azure/msal-common v14.14.2 2024-08-28 */const wi={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v14.14.2 2024-08-28 */const Td={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v14.14.2 2024-08-28 */function K0(s){return s.hasOwnProperty("tenant_discovery_endpoint")&&s.hasOwnProperty("metadata")}/*! @azure/msal-common v14.14.2 2024-08-28 */function V0(s){return s.hasOwnProperty("error")&&s.hasOwnProperty("error_description")}/*! @azure/msal-common v14.14.2 2024-08-28 */const _={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},j0={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v14.14.2 2024-08-28 */const Ws=(s,e,t,n,i)=>(...r)=>{t.trace(`Executing function ${e}`);const o=n==null?void 0:n.startMeasurement(e,i);if(i){const a=e+"CallCount";n==null||n.incrementFields({[a]:1},i)}try{const a=s(...r);return o==null||o.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},a),a}},L=(s,e,t,n,i)=>(...r)=>{t.trace(`Executing function ${e}`);const o=n==null?void 0:n.startMeasurement(e,i);if(i){const a=e+"CallCount";n==null||n.incrementFields({[a]:1},i)}return n==null||n.setPreQueueTime(e,i),s(...r).then(a=>(t.trace(`Returning result from ${e}`),o==null||o.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},a),a})};/*! @azure/msal-common v14.14.2 2024-08-28 */class Yc{constructor(e,t,n,i){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=i}async detectRegion(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(_.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=tr.ENVIRONMENT_VARIABLE;else{const r=Yc.IMDS_OPTIONS;try{const o=await L(this.getRegionFromIMDS.bind(this),_.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(A.IMDS_VERSION,r);if(o.status===wa.httpSuccess&&(n=o.body,t.region_source=tr.IMDS),o.status===wa.httpBadRequest){const a=await L(this.getCurrentVersion.bind(this),_.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(r);if(!a)return t.region_source=tr.FAILED_AUTO_DETECTION,null;const c=await L(this.getRegionFromIMDS.bind(this),_.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,r);c.status===wa.httpSuccess&&(n=c.body,t.region_source=tr.IMDS)}}catch{return t.region_source=tr.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=tr.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(_.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${A.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,A.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(_.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const n=await this.networkInterface.sendGetRequestAsync(`${A.IMDS_ENDPOINT}?format=json`,e);return n.status===wa.httpBadRequest&&n.body&&n.body["newest-versions"]&&n.body["newest-versions"].length>0?n.body["newest-versions"][0]:null}catch{return null}}}Yc.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v14.14.2 2024-08-28 */function Wn(){return Math.round(new Date().getTime()/1e3)}function Vh(s,e){const t=Number(s)||0;return Wn()+e>t}function z0(s){return Number(s)>Wn()}/*! @azure/msal-common v14.14.2 2024-08-28 */function br(s){return[q0(s),G0(s),W0(s),Q0(s),Y0(s)].join(yt.CACHE_KEY_SEPARATOR).toLowerCase()}function Jc(s,e,t,n,i){return{credentialType:W.ID_TOKEN,homeAccountId:s,environment:e,clientId:n,secret:t,realm:i}}function Xc(s,e,t,n,i,r,o,a,c,l,h,u,d,f,p){var g,v;const m={homeAccountId:s,credentialType:W.ACCESS_TOKEN,secret:t,cachedAt:Wn().toString(),expiresOn:o.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:n,realm:i,target:r,tokenType:h||we.BEARER};if(u&&(m.userAssertionHash=u),l&&(m.refreshOn=l.toString()),f&&(m.requestedClaims=f,m.requestedClaimsHash=p),((g=m.tokenType)==null?void 0:g.toLowerCase())!==we.BEARER.toLowerCase())switch(m.credentialType=W.ACCESS_TOKEN_WITH_AUTH_SCHEME,m.tokenType){case we.POP:const S=Gs(t,c);if(!((v=S==null?void 0:S.cnf)!=null&&v.kid))throw M(v_);m.keyId=S.cnf.kid;break;case we.SSH:m.keyId=d}return m}function H_(s,e,t,n,i,r,o){const a={credentialType:W.REFRESH_TOKEN,homeAccountId:s,environment:e,clientId:n,secret:t};return r&&(a.userAssertionHash=r),i&&(a.familyId=i),o&&(a.expiresOn=o.toString()),a}function Id(s){return s.hasOwnProperty("homeAccountId")&&s.hasOwnProperty("environment")&&s.hasOwnProperty("credentialType")&&s.hasOwnProperty("clientId")&&s.hasOwnProperty("secret")}function Zp(s){return s?Id(s)&&s.hasOwnProperty("realm")&&s.hasOwnProperty("target")&&(s.credentialType===W.ACCESS_TOKEN||s.credentialType===W.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function eg(s){return s?Id(s)&&s.hasOwnProperty("realm")&&s.credentialType===W.ID_TOKEN:!1}function tg(s){return s?Id(s)&&s.credentialType===W.REFRESH_TOKEN:!1}function q0(s){return[s.homeAccountId,s.environment].join(yt.CACHE_KEY_SEPARATOR).toLowerCase()}function G0(s){const e=s.credentialType===W.REFRESH_TOKEN&&s.familyId||s.clientId;return[s.credentialType,e,s.realm||""].join(yt.CACHE_KEY_SEPARATOR).toLowerCase()}function W0(s){return(s.target||"").toLowerCase()}function Q0(s){return(s.requestedClaimsHash||"").toLowerCase()}function Y0(s){return s.tokenType&&s.tokenType.toLowerCase()!==we.BEARER.toLowerCase()?s.tokenType.toLowerCase():""}function J0(s,e){const t=s.indexOf(lt.CACHE_KEY)===0;let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function X0(s,e){let t=!1;s&&(t=s.indexOf(Oo.THROTTLING_PREFIX)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function Z0({environment:s,clientId:e}){return[dd,s,e].join(yt.CACHE_KEY_SEPARATOR).toLowerCase()}function eR(s,e){return e?s.indexOf(dd)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function tR(s,e){return e?s.indexOf(cc.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function ng(){return Wn()+cc.REFRESH_TIME_SECONDS}function Ca(s,e,t){s.authorization_endpoint=e.authorization_endpoint,s.token_endpoint=e.token_endpoint,s.end_session_endpoint=e.end_session_endpoint,s.issuer=e.issuer,s.endpointsFromNetwork=t,s.jwks_uri=e.jwks_uri}function Fl(s,e,t){s.aliases=e.aliases,s.preferred_cache=e.preferred_cache,s.preferred_network=e.preferred_network,s.aliasesFromNetwork=t}function ig(s){return s.expiresAt<=Wn()}/*! @azure/msal-common v14.14.2 2024-08-28 */class gt{constructor(e,t,n,i,r,o,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=r,this.performanceClient=a,this.correlationId=o,this.managedIdentity=c||!1,this.regionDiscovery=new Yc(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(A.CIAM_AUTH_URL))return dn.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case A.ADFS:return dn.Adfs;case A.DSTS:return dn.Dsts}return dn.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new he(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw M(li)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw M(li)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw M(li)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw M(b_);return this.replacePath(this.metadata.end_session_endpoint)}else throw M(li)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw M(li)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw M(li)}canReplaceTenant(e){return e.PathSegments.length===1&&!gt.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===dn.Default&&this.protocolMode===wi.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new he(this.metadata.canonical_authority).getUrlComponents(),r=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let l=r[c];if(c===0&&this.canReplaceTenant(i)){const h=new he(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==h&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${h}`),l=h)}a!==l&&(t=t.replace(`/${l}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===dn.Adfs||this.protocolMode!==wi.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var i,r;(i=this.performanceClient)==null||i.addQueueMeasurement(_.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await L(this.updateCloudDiscoveryMetadata.bind(this),_.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await L(this.updateEndpointMetadata.bind(this),_.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),(r=this.performanceClient)==null||r.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:ng(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Bt.CACHE&&(n==null?void 0:n.source)!==Bt.CACHE&&(e.expiresAt=ng(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){var i,r,o;(i=this.performanceClient)==null||i.addQueueMeasurement(_.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Bt.HARDCODED_VALUES&&(r=this.authorityOptions.azureRegionConfiguration)!=null&&r.azureRegion&&t.metadata){const a=await L(this.updateMetadataWithRegionalInformation.bind(this),_.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Ca(e,a,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await L(this.getEndpointMetadataFromNetwork.bind(this),_.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&(n=await L(this.updateMetadataWithRegionalInformation.bind(this),_.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),Ca(e,n,!0),Bt.NETWORK;throw M(a_,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Ca(e,t,!1),{source:Bt.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return Ca(e,i,!1),{source:Bt.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=ig(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Bt.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new he(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw Te(P_)}return null}async getEndpointMetadataFromNetwork(){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(_.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const i=await this.networkInterface.sendGetRequestAsync(t,e);return $0(i.body)?i.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(i){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${i}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Jp?Jp[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var n,i,r;(n=this.performanceClient)==null||n.addQueueMeasurement(_.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.azureRegion;if(t){if(t!==A.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=Ul.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,gt.replaceWithRegionalInformation(e,t);const o=await L(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),_.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((r=this.authorityOptions.azureRegionConfiguration)==null?void 0:r.environmentRegion,this.regionDiscoveryMetadata);if(o)return this.regionDiscoveryMetadata.region_outcome=Ul.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=o,gt.replaceWithRegionalInformation(e,o);this.regionDiscoveryMetadata.region_outcome=Ul.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(_.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await L(this.getCloudDiscoveryMetadataFromNetwork.bind(this),_.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return Fl(e,n,!0),Bt.NETWORK;throw Te(O_)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||A.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||A.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||A.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Fl(e,t,!1),Bt.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=F0(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Fl(e,i,!1),Bt.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=ig(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),Bt.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===dn.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),gt.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=uc(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Te(Cd)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),gt.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(_.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${A.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const r=await this.networkInterface.sendGetRequestAsync(e,t);let o,a;if(K0(r.body))o=r.body,a=o.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${o.tenant_discovery_endpoint}`);else if(V0(r.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${r.status}`),o=r.body,o.error===A.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${o.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${o.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=uc(a,this.hostnameAndPort)}catch(r){if(r instanceof Le)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${r.errorCode}
Error Description: ${r.errorMessage}`);else{const o=r;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${o.name}
Error Description: ${o.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=gt.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&he.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==Td.None){const i=t.tenant?t.tenant:A.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${i}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return A.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw M(li)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return B_.has(e)}static isPublicCloudAuthority(e){return A.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const i=new he(e);i.validateAsUri();const r=i.getUrlComponents();let o=`${t}.${r.HostNameAndPort}`;this.isPublicCloudAuthority(r.HostNameAndPort)&&(o=`${t}.${A.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const a=he.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:o}).urlString;return n?`${a}?${n}`:a}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=gt.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=gt.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=gt.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const i=new he(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(A.CIAM_AUTH_URL)){const r=i.HostNameAndPort.split(".")[0];t=`${t}${r}${A.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}gt.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Vi.COMMON,Vi.CONSUMERS,Vi.ORGANIZATIONS]);function nR(s){var i;const n=(i=new he(s).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:i.toLowerCase();switch(n){case Vi.COMMON:case Vi.ORGANIZATIONS:case Vi.CONSUMERS:return;default:return n}}function U_(s){return s.endsWith(A.FORWARD_SLASH)?s:`${s}${A.FORWARD_SLASH}`}function iR(s){const e=s.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw Te(Cd)}return{canonicalAuthority:s.authority?U_(s.authority):void 0,knownAuthorities:s.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v14.14.2 2024-08-28 */async function F_(s,e,t,n,i,r,o){o==null||o.addQueueMeasurement(_.AuthorityFactoryCreateDiscoveredInstance,r);const a=gt.transformCIAMAuthority(U_(s)),c=new gt(a,e,t,n,i,r,o);try{return await L(c.resolveEndpointsAsync.bind(c),_.AuthorityResolveEndpointsAsync,i,o,r)(),c}catch{throw M(li)}}/*! @azure/msal-common v14.14.2 2024-08-28 */async function K_(s,e,t){return typeof s=="string"?s:s({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v14.14.2 2024-08-28 */const Dr="client_id",sR="redirect_uri",sg="response_type",rR="response_mode",oR="grant_type",aR="claims",cR="scope",lR="refresh_token",hR="state",uR="nonce",dR="prompt",fR="code",pR="code_challenge",gR="code_challenge_method",mR="code_verifier",vR="client-request-id",yR="x-client-SKU",_R="x-client-VER",bR="x-client-OS",wR="x-client-CPU",CR="x-client-current-telemetry",SR="x-client-last-telemetry",AR="x-ms-lib-capability",TR="x-app-name",IR="x-app-ver",kR="post_logout_redirect_uri",ER="id_token_hint",RR="device_code",PR="client_secret",OR="client_assertion",NR="client_assertion_type",rg="token_type",og="req_cnf",MR="assertion",xR="requested_token_use",ag="return_spa_code",$R="nativebroker",LR="logout_hint",DR="sid",BR="login_hint",HR="domain_hint",UR="x-client-xtra-sku";/*! @azure/msal-common v14.14.2 2024-08-28 */const dc={createNewGuid:()=>{throw M(ne)},base64Decode:()=>{throw M(ne)},base64Encode:()=>{throw M(ne)},base64UrlEncode:()=>{throw M(ne)},encodeKid:()=>{throw M(ne)},async getPublicKeyThumbprint(){throw M(ne)},async removeTokenBindingKey(){throw M(ne)},async clearKeystore(){throw M(ne)},async signJwt(){throw M(ne)},async hashString(){throw M(ne)}};/*! @azure/msal-common v14.14.2 2024-08-28 */var Ee;(function(s){s[s.Error=0]="Error",s[s.Warning=1]="Warning",s[s.Info=2]="Info",s[s.Verbose=3]="Verbose",s[s.Trace=4]="Trace"})(Ee||(Ee={}));class Hs{constructor(e,t,n){this.level=Ee.Info;const i=()=>{},r=e||Hs.createDefaultLoggerOptions();this.localCallback=r.loggerCallback||i,this.piiLoggingEnabled=r.piiLoggingEnabled||!1,this.level=typeof r.logLevel=="number"?r.logLevel:Ee.Info,this.correlationId=r.correlationId||A.EMPTY_STRING,this.packageName=t||A.EMPTY_STRING,this.packageVersion=n||A.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Ee.Info}}clone(e,t,n){return new Hs({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const r=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${Ee[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,r,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:Ee.Error,containsPii:!1,correlationId:t||A.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:Ee.Error,containsPii:!0,correlationId:t||A.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:Ee.Warning,containsPii:!1,correlationId:t||A.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:Ee.Warning,containsPii:!0,correlationId:t||A.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:Ee.Info,containsPii:!1,correlationId:t||A.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:Ee.Info,containsPii:!0,correlationId:t||A.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:Ee.Verbose,containsPii:!1,correlationId:t||A.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:Ee.Verbose,containsPii:!0,correlationId:t||A.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:Ee.Trace,containsPii:!1,correlationId:t||A.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:Ee.Trace,containsPii:!0,correlationId:t||A.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v14.14.2 2024-08-28 */const V_="@azure/msal-common",kd="14.14.2";/*! @azure/msal-common v14.14.2 2024-08-28 */class je{constructor(e){const t=e?vn.trimArrayEntries([...e]):[],n=t?vn.removeEmptyStringsFromArray(t):[];this.validateInputScopes(n),this.scopes=new Set,n.forEach(i=>this.scopes.add(i))}static fromString(e){const n=(e||A.EMPTY_STRING).split(" ");return new je(n)}static createSearchScopes(e){const t=new je(e);return t.containsOnlyOIDCScopes()?t.removeScope(A.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw Te(T_)}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new je(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return zp.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw M(g_)}}removeScope(e){if(!e)throw M(p_);this.scopes.delete(e.trim())}removeOIDCScopes(){zp.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw M(Hh);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw M(Hh);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),i=this.getScopeCount();return t.size<i+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):A.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v14.14.2 2024-08-28 */function fc(s,e){if(!s)throw M(s_);try{const t=e(s);return JSON.parse(t)}catch{throw M(pd)}}function wr(s){if(!s)throw M(pd);const e=s.split(yt.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?A.EMPTY_STRING:e[1]}}/*! @azure/msal-common v14.14.2 2024-08-28 */function pc(s,e){return!!s&&!!e&&s===e.split(".")[1]}function Ed(s,e,t,n){if(n){const{oid:i,sub:r,tid:o,name:a,tfp:c,acr:l}=n,h=o||c||l||"";return{tenantId:h,localAccountId:i||r||"",name:a,isHomeTenant:pc(h,s)}}else return{tenantId:t,localAccountId:e,isHomeTenant:pc(t,s)}}function Rd(s,e,t,n){let i=s;if(e){const{isHomeTenant:r,...o}=e;i={...s,...o}}if(t){const{isHomeTenant:r,...o}=Ed(s.homeAccountId,s.localAccountId,s.tenantId,t);return i={...i,...o,idTokenClaims:t,idToken:n},i}return i}/*! @azure/msal-common v14.14.2 2024-08-28 */function j_(s){return s&&(s.tid||s.tfp||s.acr)||null}/*! @azure/msal-common v14.14.2 2024-08-28 */class et{generateAccountId(){return[this.homeAccountId,this.environment].join(yt.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return et.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(yt.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){var l,h,u,d,f,p;const i=new et;t.authorityType===dn.Adfs?i.authorityType=ba.ADFS_ACCOUNT_TYPE:t.protocolMode===wi.AAD?i.authorityType=ba.MSSTS_ACCOUNT_TYPE:i.authorityType=ba.GENERIC_ACCOUNT_TYPE;let r;e.clientInfo&&n&&(r=fc(e.clientInfo,n)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const o=e.environment||t&&t.getPreferredCache();if(!o)throw M(yd);i.environment=o,i.realm=(r==null?void 0:r.utid)||j_(e.idTokenClaims)||"",i.localAccountId=(r==null?void 0:r.uid)||((l=e.idTokenClaims)==null?void 0:l.oid)||((h=e.idTokenClaims)==null?void 0:h.sub)||"";const a=((u=e.idTokenClaims)==null?void 0:u.preferred_username)||((d=e.idTokenClaims)==null?void 0:d.upn),c=(f=e.idTokenClaims)!=null&&f.emails?e.idTokenClaims.emails[0]:null;if(i.username=a||c||"",i.name=((p=e.idTokenClaims)==null?void 0:p.name)||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const m=Ed(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[m]}return i}static createFromAccountInfo(e,t,n){var r;const i=new et;return i.authorityType=e.authorityType||ba.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=n,i.tenantProfiles=Array.from(((r=e.tenantProfiles)==null?void 0:r.values())||[]),i}static generateHomeAccountId(e,t,n,i,r){if(!(t===dn.Adfs||t===dn.Dsts)){if(e)try{const o=fc(e,i.base64Decode);if(o.uid&&o.utid)return`${o.uid}.${o.utid}`}catch{}n.warning("No client info in response")}return(r==null?void 0:r.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let i=!0;if(n){const r=e.idTokenClaims||{},o=t.idTokenClaims||{};i=r.iat===o.iat&&r.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v14.14.2 2024-08-28 */const z_="cache_quota_exceeded",Pd="cache_error_unknown";/*! @azure/msal-common v14.14.2 2024-08-28 */const Kl={[z_]:"Exceeded cache storage capacity.",[Pd]:"Unexpected error occurred when using cache storage."};class kr extends Error{constructor(e,t){const n=t||(Kl[e]?Kl[e]:Kl[Pd]);super(`${e}: ${n}`),Object.setPrototypeOf(this,kr.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}/*! @azure/msal-common v14.14.2 2024-08-28 */class Br{constructor(e,t,n,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(V_,kd),this.staticAuthorityOptions=i}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(i=>i.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(n=>this.getTenantProfilesFromAccountEntity(n,t==null?void 0:t.tenantId,t))}getTenantedAccountInfoByFilter(e,t,n,i){let r=null,o;if(i&&!this.tenantProfileMatchesFilter(n,i))return null;const a=this.getIdToken(e,t,n.tenantId);return a&&(o=Gs(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(o,i))?null:(r=Rd(e,n,o,a==null?void 0:a.secret),r)}getTenantProfilesFromAccountEntity(e,t,n){const i=e.getAccountInfo();let r=i.tenantProfiles||new Map;const o=this.getTokenKeys();if(t){const c=r.get(t);if(c)r=new Map([[t,c]]);else return[]}const a=[];return r.forEach(c=>{const l=this.getTenantedAccountInfoByFilter(i,o,c,n);l&&a.push(l)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n){var i,r,o,a;if(!e)throw M(m_);try{e.account&&this.setAccount(e.account),e.idToken&&(t==null?void 0:t.idToken)!==!1&&this.setIdTokenCredential(e.idToken),e.accessToken&&(t==null?void 0:t.accessToken)!==!1&&await this.saveAccessToken(e.accessToken),e.refreshToken&&(t==null?void 0:t.refreshToken)!==!1&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(c){throw(i=this.commonLogger)==null||i.error("CacheManager.saveCacheRecord: failed"),c instanceof Error?((r=this.commonLogger)==null||r.errorPii(`CacheManager.saveCacheRecord: ${c.message}`,n),c.name==="QuotaExceededError"||c.name==="NS_ERROR_DOM_QUOTA_REACHED"||c.message.includes("exceeded the quota")?((o=this.commonLogger)==null||o.error("CacheManager.saveCacheRecord: exceeded storage quota",n),new kr(z_)):new kr(c.name,c.message)):((a=this.commonLogger)==null||a.errorPii(`CacheManager.saveCacheRecord: ${c}`,n),new kr(Pd))}}async saveAccessToken(e){const t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},n=this.getTokenKeys(),i=je.fromString(e.target),r=[];n.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,t,!1))return;const a=this.getAccessTokenCredential(o);a&&this.credentialMatchesFilter(a,t)&&je.fromString(a.target).intersectingScopeSets(i)&&r.push(this.removeAccessToken(o))}),await Promise.all(r),this.setAccessTokenCredential(e)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),n=[];return t.forEach(i=>{var c;if(!this.isAccountKey(i,e.homeAccountId))return;const r=this.getAccount(i,this.commonLogger);if(!r||e.homeAccountId&&!this.matchHomeAccountId(r,e.homeAccountId)||e.username&&!this.matchUsername(r.username,e.username)||e.environment&&!this.matchEnvironment(r,e.environment)||e.realm&&!this.matchRealm(r,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(r,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(r,e.authorityType))return;const o={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},a=(c=r.tenantProfiles)==null?void 0:c.filter(l=>this.tenantProfileMatchesFilter(l,o));a&&a.length===0||n.push(r)}),n}isAccountKey(e,t,n){return!(e.split(yt.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(yt.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(W.ID_TOKEN.toLowerCase())===-1&&t.indexOf(W.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(W.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(W.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(W.REFRESH_TOKEN.toLowerCase())>-1){const n=`${W.REFRESH_TOKEN}${yt.CACHE_KEY_SEPARATOR}${this.clientId}${yt.CACHE_KEY_SEPARATOR}`,i=`${W.REFRESH_TOKEN}${yt.CACHE_KEY_SEPARATOR}${Po}${yt.CACHE_KEY_SEPARATOR}`;if(t.indexOf(n.toLowerCase())===-1&&t.indexOf(i.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===W.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===we.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const r=this.getAppMetadata(i);r&&(e.environment&&!this.matchEnvironment(r,e.environment)||e.clientId&&!this.matchClientId(r,e.clientId)||(n[i]=r))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const r=this.getAuthorityMetadata(i);r&&r.aliases.indexOf(e)!==-1&&(n=r)}),n}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(n=>{t.push(this.removeAccount(n))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),n=e.generateAccountId(),i=[];t.idToken.forEach(r=>{r.indexOf(n)===0&&this.removeIdToken(r)}),t.accessToken.forEach(r=>{r.indexOf(n)===0&&i.push(this.removeAccessToken(r))}),t.refreshToken.forEach(r=>{r.indexOf(n)===0&&this.removeRefreshToken(r)}),await Promise.all(i)}updateOutdatedCachedAccount(e,t,n){var i;if(t&&t.isSingleTenant()){(i=this.commonLogger)==null||i.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const r=this.getAccountKeys().filter(h=>h.startsWith(t.homeAccountId)),o=[];r.forEach(h=>{const u=this.getCachedAccountEntity(h);u&&o.push(u)});const a=o.find(h=>pc(h.realm,h.homeAccountId))||o[0];a.tenantProfiles=o.map(h=>({tenantId:h.realm,localAccountId:h.localAccountId,name:h.name,isHomeTenant:pc(h.realm,h.homeAccountId)}));const c=Br.toObject(new et,{...a}),l=c.generateAccountKey();return r.forEach(h=>{h!==l&&this.removeOutdatedAccount(e)}),this.setAccount(c),n==null||n.verbose("Updated an outdated account entity in the cache"),c}return t}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===W.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===we.POP){const i=t.keyId;if(i)try{await this.cryptoImpl.removeTokenBindingKey(i)}catch{throw M(__)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=et.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,n,i,r){this.commonLogger.trace("CacheManager - getIdToken called");const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:W.ID_TOKEN,clientId:this.clientId,realm:n},a=this.getIdTokensByFilter(o,t),c=a.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let l=a;if(!n){const h=new Map;a.forEach((d,f)=>{d.realm===e.tenantId&&h.set(f,d)});const u=h.size;if(u<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(u===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;l=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),l.forEach((h,u)=>{this.removeIdToken(u)}),i&&r&&i.addFields({multiMatchedID:a.size},r),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){const n=t&&t.idToken||this.getTokenKeys().idToken,i=new Map;return n.forEach(r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...e}))return;const o=this.getIdTokenCredential(r);o&&this.credentialMatchesFilter(o,e)&&i.set(r,o)}),i}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,n,i,r,o){this.commonLogger.trace("CacheManager - getAccessToken called");const a=je.createSearchScopes(t.scopes),c=t.authenticationScheme||we.BEARER,l=c&&c.toLowerCase()!==we.BEARER.toLowerCase()?W.ACCESS_TOKEN_WITH_AUTH_SCHEME:W.ACCESS_TOKEN,h={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:i||e.tenantId,target:a,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},u=n&&n.accessToken||this.getTokenKeys().accessToken,d=[];u.forEach(p=>{if(this.accessTokenKeyMatchesFilter(p,h,!0)){const m=this.getAccessTokenCredential(p);m&&this.credentialMatchesFilter(m,h)&&d.push(m)}});const f=d.length;return f<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):f>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),d.forEach(p=>{this.removeAccessToken(br(p))}),r&&o&&r.addFields({multiMatchedAT:d.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),d[0])}accessTokenKeyMatchesFilter(e,t,n){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const r=t.target.asArray();for(let o=0;o<r.length;o++){if(n&&!i.includes(r[o].toLowerCase()))return!1;if(!n&&i.includes(r[o].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),n=[];return t.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;const r=this.getAccessTokenCredential(i);r&&this.credentialMatchesFilter(r,e)&&n.push(r)}),n}getRefreshToken(e,t,n,i,r){this.commonLogger.trace("CacheManager - getRefreshToken called");const o=t?Po:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:W.REFRESH_TOKEN,clientId:this.clientId,familyId:o},c=n&&n.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(u=>{if(this.refreshTokenKeyMatchesFilter(u,a)){const d=this.getRefreshTokenCredential(u);d&&this.credentialMatchesFilter(d,a)&&l.push(d)}});const h=l.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&i&&r&&i.addFields({multiMatchedRT:h},r),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),i=Object.keys(n).map(o=>n[o]),r=i.length;if(r<1)return null;if(r>1)throw M(d_);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===Po)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var n;return t.toLowerCase()===((n=e.name)==null?void 0:n.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=U0(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var n;return((n=e.realm)==null?void 0:n.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==W.ACCESS_TOKEN&&e.credentialType!==W.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:je.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(dd)!==-1}isAuthorityMetadata(e){return e.indexOf(cc.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${cc.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class FR extends Br{setAccount(){throw M(ne)}getAccount(){throw M(ne)}getCachedAccountEntity(){throw M(ne)}setIdTokenCredential(){throw M(ne)}getIdTokenCredential(){throw M(ne)}setAccessTokenCredential(){throw M(ne)}getAccessTokenCredential(){throw M(ne)}setRefreshTokenCredential(){throw M(ne)}getRefreshTokenCredential(){throw M(ne)}setAppMetadata(){throw M(ne)}getAppMetadata(){throw M(ne)}setServerTelemetry(){throw M(ne)}getServerTelemetry(){throw M(ne)}setAuthorityMetadata(){throw M(ne)}getAuthorityMetadata(){throw M(ne)}getAuthorityMetadataKeys(){throw M(ne)}setThrottlingCache(){throw M(ne)}getThrottlingCache(){throw M(ne)}removeItem(){throw M(ne)}getKeys(){throw M(ne)}getAccountKeys(){throw M(ne)}getTokenKeys(){throw M(ne)}async clear(){throw M(ne)}updateCredentialCacheKey(){throw M(ne)}removeOutdatedAccount(){throw M(ne)}}/*! @azure/msal-common v14.14.2 2024-08-28 */const q_={tokenRenewalOffsetSeconds:b0,preventCorsPreflight:!1},KR={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Ee.Info,correlationId:A.EMPTY_STRING},VR={claimsBasedCachingEnabled:!1},jR={async sendGetRequestAsync(){throw M(ne)},async sendPostRequestAsync(){throw M(ne)}},zR={sku:A.SKU,version:kd,cpu:A.EMPTY_STRING,os:A.EMPTY_STRING},qR={clientSecret:A.EMPTY_STRING,clientAssertion:void 0},GR={azureCloudInstance:Td.None,tenant:`${A.DEFAULT_COMMON_TENANT}`},WR={application:{appName:"",appVersion:""}};function QR({authOptions:s,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:i,networkInterface:r,cryptoInterface:o,clientCredentials:a,libraryInfo:c,telemetry:l,serverTelemetryManager:h,persistencePlugin:u,serializableCache:d}){const f={...KR,...t};return{authOptions:YR(s),systemOptions:{...q_,...e},loggerOptions:f,cacheOptions:{...VR,...n},storageInterface:i||new FR(s.clientId,dc,new Hs(f)),networkInterface:r||jR,cryptoInterface:o||dc,clientCredentials:a||qR,libraryInfo:{...zR,...c},telemetry:{...WR,...l},serverTelemetryManager:h||null,persistencePlugin:u||null,serializableCache:d||null}}function YR(s){return{clientCapabilities:[],azureCloudOptions:GR,skipAuthorityMetadataCache:!1,...s}}function jh(s){return s.authOptions.authority.options.protocolMode===wi.OIDC}/*! @azure/msal-common v14.14.2 2024-08-28 */class Yi extends Le{constructor(e,t,n,i,r){super(e,t,n),this.name="ServerError",this.errorNo=i,this.status=r,Object.setPrototypeOf(this,Yi.prototype)}}/*! @azure/msal-common v14.14.2 2024-08-28 */class Nn{static generateThrottlingStorageKey(e){return`${Oo.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var r;const n=Nn.generateThrottlingStorageKey(t),i=e.getThrottlingCache(n);if(i){if(i.throttleTime<Date.now()){e.removeItem(n);return}throw new Yi(((r=i.errorCodes)==null?void 0:r.join(" "))||A.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,n){if(Nn.checkResponseStatus(n)||Nn.checkResponseForRetryAfter(n)){const i={throttleTime:Nn.calculateThrottleTime(parseInt(n.headers[Dn.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(Nn.generateThrottlingStorageKey(t),i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Dn.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||Oo.DEFAULT_THROTTLE_TIME_SECONDS),n+Oo.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,n,i){const r={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:i,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},o=this.generateThrottlingStorageKey(r);e.removeItem(o)}}/*! @azure/msal-common v14.14.2 2024-08-28 */class JR{constructor(e,t){this.networkClient=e,this.cacheManager=t}async sendPostRequest(e,t,n){Nn.preProcess(this.cacheManager,e);let i;try{i=await this.networkClient.sendPostRequestAsync(t,n)}catch(r){throw r instanceof Le?r:M(o_)}return Nn.postProcess(this.cacheManager,e,i),i}}/*! @azure/msal-common v14.14.2 2024-08-28 */const jt={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v14.14.2 2024-08-28 */class ar{static validateRedirectUri(e){if(!e)throw Te(C_)}static validatePrompt(e){const t=[];for(const n in it)t.push(it[n]);if(t.indexOf(e)<0)throw Te(I_)}static validateClaims(e){try{JSON.parse(e)}catch{throw Te(bd)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw Te(wd);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([qp.PLAIN,qp.S256].indexOf(e)<0)throw Te(R_)}}/*! @azure/msal-common v14.14.2 2024-08-28 */class No{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(sg,encodeURIComponent(A.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(sg,encodeURIComponent(`${A.TOKEN_RESPONSE_TYPE} ${A.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(rR,encodeURIComponent(e||v0.QUERY))}addNativeBroker(){this.parameters.set($R,encodeURIComponent("1"))}addScopes(e,t=!0,n=Qr){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const i=t?[...e||[],...n]:e||[],r=new je(i);this.parameters.set(cR,encodeURIComponent(r.printScopes()))}addClientId(e){this.parameters.set(Dr,encodeURIComponent(e))}addRedirectUri(e){ar.validateRedirectUri(e),this.parameters.set(sR,encodeURIComponent(e))}addPostLogoutRedirectUri(e){ar.validateRedirectUri(e),this.parameters.set(kR,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(ER,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(HR,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(BR,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(Dn.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(Dn.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(DR,encodeURIComponent(e))}addClaims(e,t){const n=this.addClientCapabilitiesToClaims(e,t);ar.validateClaims(n),this.parameters.set(aR,encodeURIComponent(n))}addCorrelationId(e){this.parameters.set(vR,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(yR,e.sku),this.parameters.set(_R,e.version),e.os&&this.parameters.set(bR,e.os),e.cpu&&this.parameters.set(wR,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(TR,e.appName),e!=null&&e.appVersion&&this.parameters.set(IR,e.appVersion)}addPrompt(e){ar.validatePrompt(e),this.parameters.set(`${dR}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(hR,encodeURIComponent(e))}addNonce(e){this.parameters.set(uR,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(ar.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(pR,encodeURIComponent(e)),this.parameters.set(gR,encodeURIComponent(t));else throw Te(wd)}addAuthorizationCode(e){this.parameters.set(fR,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(RR,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(lR,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(mR,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(PR,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(OR,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(NR,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(MR,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(xR,encodeURIComponent(e))}addGrantType(e){this.parameters.set(oR,encodeURIComponent(e))}addClientInfo(){this.parameters.set(y0,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,n])=>{!this.parameters.has(t)&&n&&this.parameters.set(t,n)})}addClientCapabilitiesToClaims(e,t){let n;if(!e)n={};else try{n=JSON.parse(e)}catch{throw Te(bd)}return t&&t.length>0&&(n.hasOwnProperty(_a.ACCESS_TOKEN)||(n[_a.ACCESS_TOKEN]={}),n[_a.ACCESS_TOKEN][_a.XMS_CC]={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set(Wp.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(Wp.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(rg,we.POP),this.parameters.set(og,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(rg,we.SSH),this.parameters.set(og,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(CR,e.generateCurrentRequestHeaderValue()),this.parameters.set(SR,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(AR,Oo.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(LR,encodeURIComponent(e))}createQueryString(){const e=new Array;return this.parameters.forEach((t,n)=>{e.push(`${n}=${t}`)}),e.join("&")}}/*! @azure/msal-common v14.14.2 2024-08-28 */class Od{constructor(e,t){this.config=QR(e),this.logger=new Hs(this.config.loggerOptions,V_,kd),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new JR(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Dn.CONTENT_TYPE]=A.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case jt.HOME_ACCOUNT_ID:try{const n=wr(e.credential);t[Dn.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case jt.UPN:t[Dn.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,n,i,r,o){var c,l,h,u;o&&((c=this.performanceClient)==null||c.addQueueMeasurement(o,r));const a=await this.networkManager.sendPostRequest(i,e,{body:t,headers:n});return(u=this.performanceClient)==null||u.addFields({refreshTokenSize:((l=a.body.refresh_token)==null?void 0:l.length)||0,httpVerToken:((h=a.headers)==null?void 0:h[Dn.X_MS_HTTP_VERSION])||""},r),this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async updateAuthority(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(_.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,i=await F_(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new No;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}}/*! @azure/msal-common v14.14.2 2024-08-28 */const gc="no_tokens_found",G_="native_account_unavailable",Nd="refresh_token_expired",XR="interaction_required",ZR="consent_required",eP="login_required",Zc="bad_token";/*! @azure/msal-common v14.14.2 2024-08-28 */const cg=[XR,ZR,eP,Zc],tP=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],nP={[gc]:"No refresh token found in the cache. Please sign-in.",[G_]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Nd]:"Refresh token has expired.",[Zc]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class tn extends Le{constructor(e,t,n,i,r,o,a,c){super(e,t,n),Object.setPrototypeOf(this,tn.prototype),this.timestamp=i||A.EMPTY_STRING,this.traceId=r||A.EMPTY_STRING,this.correlationId=o||A.EMPTY_STRING,this.claims=a||A.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function lg(s,e,t){const n=!!s&&cg.indexOf(s)>-1,i=!!t&&tP.indexOf(t)>-1,r=!!e&&cg.some(o=>e.indexOf(o)>-1);return n||r||i}function zh(s){return new tn(s,nP[s])}/*! @azure/msal-common v14.14.2 2024-08-28 */class yn{static setRequestState(e,t,n){const i=yn.generateLibraryState(e,n);return t?`${i}${A.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw M(Fh);const n={id:e.createNewGuid()};t&&(n.meta=t);const i=JSON.stringify(n);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw M(Fh);if(!t)throw M(Lr);try{const n=t.split(A.RESOURCE_DELIM),i=n[0],r=n.length>1?n.slice(1).join(A.RESOURCE_DELIM):A.EMPTY_STRING,o=e.base64Decode(i),a=JSON.parse(o);return{userRequestState:r||A.EMPTY_STRING,libraryState:a}}catch{throw M(Lr)}}}/*! @azure/msal-common v14.14.2 2024-08-28 */const iP={SW:"sw",UHW:"uhw"};class Hr{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(_.PopTokenGenerateCnf,e.correlationId);const n=await L(this.generateKid.bind(this),_.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:i}}async generateKid(e){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(_.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:iP.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,i){const{resourceRequestMethod:r,resourceRequestUri:o,shrClaims:a,shrNonce:c,shrOptions:l}=n,h=o?new he(o):void 0,u=h==null?void 0:h.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Wn(),m:r==null?void 0:r.toUpperCase(),u:u==null?void 0:u.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:u==null?void 0:u.AbsolutePath,q:u!=null&&u.QueryString?[[],u.QueryString]:void 0,client_claims:a||void 0,...i},t,l,n.correlationId)}}/*! @azure/msal-common v14.14.2 2024-08-28 */class sP{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v14.14.2 2024-08-28 */function rP(s){var n,i;const e="code=",t=(n=s.error_uri)==null?void 0:n.lastIndexOf(e);return t&&t>=0?(i=s.error_uri)==null?void 0:i.substring(t+e.length):void 0}class Us{constructor(e,t,n,i,r,o,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=i,this.serializableCache=r,this.persistencePlugin=o,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?M(lc,"Cached State"):M(lc,"Server State");let n,i;try{n=decodeURIComponent(e.state)}catch{throw M(Lr,e.state)}try{i=decodeURIComponent(t)}catch{throw M(Lr,e.state)}if(n!==i)throw M(l_);if(e.error||e.error_description||e.suberror){const r=rP(e);throw lg(e.error,e.error_description,e.suberror)?new tn(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",r):new Yi(e.error||"",e.error_description,e.suberror,r)}}validateTokenResponse(e,t){var n;if(e.error||e.error_description||e.suberror){const i=`Error(s): ${e.error_codes||A.NOT_AVAILABLE} - Timestamp: ${e.timestamp||A.NOT_AVAILABLE} - Description: ${e.error_description||A.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||A.NOT_AVAILABLE} - Trace ID: ${e.trace_id||A.NOT_AVAILABLE}`,r=(n=e.error_codes)!=null&&n.length?e.error_codes[0]:void 0,o=new Yi(e.error,i,e.suberror,r,e.status);if(t&&e.status&&e.status>=ya.SERVER_ERROR_RANGE_START&&e.status<=ya.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${o}`);return}else if(t&&e.status&&e.status>=ya.CLIENT_ERROR_RANGE_START&&e.status<=ya.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${o}`);return}throw lg(e.error,e.error_description,e.suberror)?new tn(e.error,e.error_description,e.suberror,e.timestamp||A.EMPTY_STRING,e.trace_id||A.EMPTY_STRING,e.correlation_id||A.EMPTY_STRING,e.claims||A.EMPTY_STRING,r):o}}async handleServerTokenResponse(e,t,n,i,r,o,a,c,l){var p;(p=this.performanceClient)==null||p.addQueueMeasurement(_.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=Gs(e.id_token||A.EMPTY_STRING,this.cryptoObj.base64Decode),r&&r.nonce&&h.nonce!==r.nonce)throw M(h_);if(i.maxAge||i.maxAge===0){const m=h.auth_time;if(!m)throw M(md);w_(m,i.maxAge)}}this.homeAccountIdentifier=et.generateHomeAccountId(e.client_info||A.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let u;r&&r.state&&(u=yn.parseRequestState(this.cryptoObj,r.state)),e.key_id=e.key_id||i.sshKid||void 0;const d=this.generateCacheRecord(e,t,n,i,h,o,r);let f;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),f=new sP(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(f)),a&&!c&&d.account){const m=d.account.generateAccountKey();if(!this.cacheStorage.getAccount(m,this.logger))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await Us.generateAuthenticationResult(this.cryptoObj,t,d,!1,i,h,u,void 0,l)}await this.cacheStorage.saveCacheRecord(d,i.storeInCache,i.correlationId)}finally{this.persistencePlugin&&this.serializableCache&&f&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(f))}return Us.generateAuthenticationResult(this.cryptoObj,t,d,!1,i,h,u,e,l)}generateCacheRecord(e,t,n,i,r,o,a){const c=t.getPreferredCache();if(!c)throw M(yd);const l=j_(r);let h,u;e.id_token&&r&&(h=Jc(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),u=Md(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,r,e.client_info,c,l,a,void 0,this.logger));let d=null;if(e.access_token){const m=e.scope?je.fromString(e.scope):new je(i.scopes||[]),g=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,v=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,S=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,R=n+g,C=R+v,I=S&&S>0?n+S:void 0;d=Xc(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",m.printScopes(),R,C,this.cryptoObj.base64Decode,I,e.token_type,o,e.key_id,i.claims,i.requestedClaimsHash)}let f=null;if(e.refresh_token){let m;if(e.refresh_token_expires_in){const g=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;m=n+g}f=H_(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,o,m)}let p=null;return e.foci&&(p={clientId:this.clientId,environment:c,familyId:e.foci}),{account:u,idToken:h,accessToken:d,refreshToken:f,appMetadata:p}}static async generateAuthenticationResult(e,t,n,i,r,o,a,c,l){var R,C,I,$,x;let h=A.EMPTY_STRING,u=[],d=null,f,p,m=A.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===we.POP&&!r.popKid){const F=new Hr(e),{secret:D,keyId:V}=n.accessToken;if(!V)throw M(_d);h=await F.signPopToken(D,V,r)}else h=n.accessToken.secret;u=je.fromString(n.accessToken.target).asArray(),d=new Date(Number(n.accessToken.expiresOn)*1e3),f=new Date(Number(n.accessToken.extendedExpiresOn)*1e3),n.accessToken.refreshOn&&(p=new Date(Number(n.accessToken.refreshOn)*1e3))}n.appMetadata&&(m=n.appMetadata.familyId===Po?Po:"");const g=(o==null?void 0:o.oid)||(o==null?void 0:o.sub)||"",v=(o==null?void 0:o.tid)||"";c!=null&&c.spa_accountid&&n.account&&(n.account.nativeAccountId=c==null?void 0:c.spa_accountid);const S=n.account?Rd(n.account.getAccountInfo(),void 0,o,(R=n.idToken)==null?void 0:R.secret):null;return{authority:t.canonicalAuthority,uniqueId:g,tenantId:v,scopes:u,account:S,idToken:((C=n==null?void 0:n.idToken)==null?void 0:C.secret)||"",idTokenClaims:o||{},accessToken:h,fromCache:i,expiresOn:d,extExpiresOn:f,refreshOn:p,correlationId:r.correlationId,requestId:l||A.EMPTY_STRING,familyId:m,tokenType:((I=n.accessToken)==null?void 0:I.tokenType)||A.EMPTY_STRING,state:a?a.userRequestState:A.EMPTY_STRING,cloudGraphHostName:(($=n.account)==null?void 0:$.cloudGraphHostName)||A.EMPTY_STRING,msGraphHost:((x=n.account)==null?void 0:x.msGraphHost)||A.EMPTY_STRING,code:c==null?void 0:c.spa_code,fromNativeBroker:!1}}}function Md(s,e,t,n,i,r,o,a,c,l,h){h==null||h.verbose("setCachedAccount called");const d=s.getAccountKeys().find(v=>v.startsWith(t));let f=null;d&&(f=s.getAccount(d,h));const p=f||et.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:r,environment:o,cloudGraphHostName:c==null?void 0:c.cloud_graph_host_name,msGraphHost:c==null?void 0:c.msgraph_host,nativeAccountId:l},e,n),m=p.tenantProfiles||[],g=a||p.realm;if(g&&!m.find(v=>v.tenantId===g)){const v=Ed(t,p.localAccountId,g,i);m.push(v)}return p.tenantProfiles=m,p}/*! @azure/msal-common v14.14.2 2024-08-28 */class W_ extends Od{constructor(e,t){var n;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(n=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:n.defaultScopes}async getAuthCodeUrl(e){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(_.GetAuthCodeUrl,e.correlationId);const t=await L(this.createAuthCodeUrlQueryString.bind(this),_.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return he.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var a,c;if((a=this.performanceClient)==null||a.addQueueMeasurement(_.AuthClientAcquireToken,e.correlationId),!e.code)throw M(f_);const n=Wn(),i=await L(this.executeTokenRequest.bind(this),_.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),r=(c=i.headers)==null?void 0:c[Dn.X_MS_REQUEST_ID],o=new Us(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return o.validateTokenResponse(i.body),L(o.handleServerTokenResponse.bind(o),_.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,n,e,t,void 0,void 0,void 0,r)}handleFragmentResponse(e,t){if(new Us(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw M(y_);return e}getLogoutUri(e){if(!e)throw Te(E_);const t=this.createLogoutUrlQueryString(e);return he.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var l,h;(l=this.performanceClient)==null||l.addQueueMeasurement(_.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),i=he.appendQueryString(e.tokenEndpoint,n),r=await L(this.createTokenRequestBody.bind(this),_.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let o;if(t.clientInfo)try{const u=fc(t.clientInfo,this.cryptoUtils.base64Decode);o={credential:`${u.uid}${yt.CLIENT_INFO_SEPARATOR}${u.utid}`,type:jt.HOME_ACCOUNT_ID}}catch(u){this.logger.verbose("Could not parse client info for CCS Header: "+u)}const a=this.createTokenRequestHeaders(o||t.ccsCredential),c={clientId:((h=t.tokenBodyParameters)==null?void 0:h.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return L(this.executePostToTokenEndpoint.bind(this),_.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,r,a,c,t.correlationId,_.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,o;(r=this.performanceClient)==null||r.addQueueMeasurement(_.AuthClientCreateTokenRequestBody,e.correlationId);const t=new No;if(t.addClientId(((o=e.tokenBodyParameters)==null?void 0:o[Dr])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):ar.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!jh(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await K_(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(a.assertionType)}if(t.addGrantType(n_.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===we.POP){const a=new Hr(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await L(a.generateCnf.bind(a),_.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(c)}else if(e.authenticationScheme===we.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw Te(Qc);const n=e.correlationId||this.config.cryptoInterface.createNewGuid();t.addCorrelationId(n),(!vn.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let i;if(e.clientInfo)try{const a=fc(e.clientInfo,this.cryptoUtils.base64Decode);i={credential:`${a.uid}${yt.CLIENT_INFO_SEPARATOR}${a.utid}`,type:jt.HOME_ACCOUNT_ID}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else i=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&i)switch(i.type){case jt.HOME_ACCOUNT_ID:try{const a=wr(i.credential);t.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case jt.UPN:t.addCcsUpn(i.credential);break}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[ag])&&t.addExtraQueryParameters({[ag]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var r,o;(r=this.performanceClient)==null||r.addQueueMeasurement(_.AuthClientCreateQueryString,e.correlationId);const t=new No;t.addClientId(((o=e.extraQueryParameters)==null?void 0:o[Dr])||this.config.authOptions.clientId);const n=[...e.scopes||[],...e.extraScopesToConsent||[]];t.addScopes(n,!0,this.oidcDefaultScopes),t.addRedirectUri(e.redirectUri);const i=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(i),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),jh(this.config)||t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==it.SELECT_ACCOUNT)if(e.sid&&e.prompt===it.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){const a=this.extractAccountSid(e.account);let c=this.extractLoginHint(e.account);if(c&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(c);try{const l=wr(e.account.homeAccountId);t.addCcsOid(l)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===it.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(a);try{const l=wr(e.account.homeAccountId);t.addCcsOid(l)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{const l=wr(e.account.homeAccountId);t.addCcsOid(l)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker&&(t.addNativeBroker(),e.authenticationScheme===we.POP)){const a=new Hr(this.cryptoUtils);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await L(a.generateCnf.bind(a),_.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(c)}return t.createQueryString()}createLogoutUrlQueryString(e){const t=new No;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v14.14.2 2024-08-28 */const oP=300;class qh extends Od{constructor(e,t){super(e,t)}async acquireToken(e){var o,a;(o=this.performanceClient)==null||o.addQueueMeasurement(_.RefreshTokenClientAcquireToken,e.correlationId);const t=Wn(),n=await L(this.executeTokenRequest.bind(this),_.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=(a=n.headers)==null?void 0:a[Dn.X_MS_REQUEST_ID],r=new Us(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return r.validateTokenResponse(n.body),L(r.handleServerTokenResponse.bind(r),_.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){var n;if(!e)throw Te(k_);if((n=this.performanceClient)==null||n.addQueueMeasurement(_.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw M(vd);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await L(this.acquireTokenWithCachedRefreshToken.bind(this),_.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(i){const r=i instanceof tn&&i.errorCode===gc,o=i instanceof Yi&&i.errorCode===Gp.INVALID_GRANT_ERROR&&i.subError===Gp.CLIENT_MISMATCH_ERROR;if(r||o)return L(this.acquireTokenWithCachedRefreshToken.bind(this),_.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw i}return L(this.acquireTokenWithCachedRefreshToken.bind(this),_.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(_.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=Ws(this.cacheManager.getRefreshToken.bind(this.cacheManager),_.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!n)throw zh(gc);if(n.expiresOn&&Vh(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||oP))throw zh(Nd);const i={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||we.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:jt.HOME_ACCOUNT_ID}};try{return await L(this.acquireToken.bind(this),_.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(o){if(o instanceof tn&&o.subError===Zc){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const a=br(n);this.cacheManager.removeRefreshToken(a)}throw o}}async executeTokenRequest(e,t){var c,l;(c=this.performanceClient)==null||c.addQueueMeasurement(_.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),i=he.appendQueryString(t.tokenEndpoint,n),r=await L(this.createTokenRequestBody.bind(this),_.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),o=this.createTokenRequestHeaders(e.ccsCredential),a={clientId:((l=e.tokenBodyParameters)==null?void 0:l.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return L(this.executePostToTokenEndpoint.bind(this),_.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,r,o,a,e.correlationId,_.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var i,r,o;(i=this.performanceClient)==null||i.addQueueMeasurement(_.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,n=new No;if(n.addClientId(((r=e.tokenBodyParameters)==null?void 0:r[Dr])||this.config.authOptions.clientId),e.redirectUri&&n.addRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,(o=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:o.defaultScopes),n.addGrantType(n_.REFRESH_TOKEN_GRANT),n.addClientInfo(),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addThrottling(),this.serverTelemetryManager&&!jh(this.config)&&n.addServerTelemetry(this.serverTelemetryManager),n.addCorrelationId(t),n.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&n.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;n.addClientAssertion(await K_(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(a.assertionType)}if(e.authenticationScheme===we.POP){const a=new Hr(this.cryptoUtils,this.performanceClient);let c;e.popKid?c=this.cryptoUtils.encodeKid(e.popKid):c=(await L(a.generateCnf.bind(a),_.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(c)}else if(e.authenticationScheme===we.SSH)if(e.sshJwk)n.addSshJwk(e.sshJwk);else throw Te(Qc);if((!vn.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case jt.HOME_ACCOUNT_ID:try{const a=wr(e.ccsCredential.credential);n.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case jt.UPN:n.addCcsUpn(e.ccsCredential.credential);break}return e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),n.createQueryString()}}/*! @azure/msal-common v14.14.2 2024-08-28 */class aP extends Od{constructor(e,t){super(e,t)}async acquireToken(e){var t;try{const[n,i]=await this.acquireCachedToken({...e,scopes:(t=e.scopes)!=null&&t.length?e.scopes:[...Qr]});return i===Li.PROACTIVELY_REFRESHED&&(this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new qh(this.config,this.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),n}catch(n){if(n instanceof Wc&&n.errorCode===fi)return new qh(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw n}}async acquireCachedToken(e){var c;(c=this.performanceClient)==null||c.addQueueMeasurement(_.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Li.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!vn.isEmptyObj(e.claims))throw this.setCacheOutcome(Li.FORCE_REFRESH_OR_CLAIMS,e.correlationId),M(fi);if(!e.account)throw M(vd);const n=e.account.tenantId||nR(e.authority),i=this.cacheManager.getTokenKeys(),r=this.cacheManager.getAccessToken(e.account,e,i,n,this.performanceClient,e.correlationId);if(r){if(z0(r.cachedAt)||Vh(r.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Li.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),M(fi);r.refreshOn&&Vh(r.refreshOn,0)&&(t=Li.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Li.NO_CACHED_ACCESS_TOKEN,e.correlationId),M(fi);const o=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:r,idToken:this.cacheManager.getIdToken(e.account,i,n,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(o)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await L(this.generateResultFromCacheRecord.bind(this),_.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){var n,i;(n=this.serverTelemetryManager)==null||n.setCacheOutcome(e),(i=this.performanceClient)==null||i.addFields({cacheOutcome:e},t),e!==Li.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(_.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let n;if(e.idToken&&(n=Gs(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const r=n==null?void 0:n.auth_time;if(!r)throw M(md);w_(r,t.maxAge)}return Us.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}/*! @azure/msal-common v14.14.2 2024-08-28 */const cP={sendGetRequestAsync:()=>Promise.reject(M(ne)),sendPostRequestAsync:()=>Promise.reject(M(ne))};/*! @azure/msal-common v14.14.2 2024-08-28 */const Q_="missing_kid_error",Y_="missing_alg_error";/*! @azure/msal-common v14.14.2 2024-08-28 */const lP={[Q_]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Y_]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class xd extends Le{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,xd.prototype)}}function hg(s){return new xd(s,lP[s])}/*! @azure/msal-common v14.14.2 2024-08-28 */class $d{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw hg(Q_);if(!e.alg)throw hg(Y_);const t=new $d({typ:e.typ||_0.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v14.14.2 2024-08-28 */const ug=",",J_="|";function hP(s){const{skus:e,libraryName:t,libraryVersion:n,extensionName:i,extensionVersion:r}=s,o=new Map([[0,[t,n]],[2,[i,r]]]);let a=[];if(e!=null&&e.length){if(a=e.split(ug),a.length<4)return e}else a=Array.from({length:4},()=>J_);return o.forEach((c,l)=>{var h,u;c.length===2&&((h=c[0])!=null&&h.length)&&((u=c[1])!=null&&u.length)&&uP({skuArr:a,index:l,skuName:c[0],skuVersion:c[1]})}),a.join(ug)}function uP(s){const{skuArr:e,index:t,skuName:n,skuVersion:i}=s;t>=e.length||(e[t]=[n,i].join(J_))}class Yo{constructor(e,t){this.cacheOutcome=Li.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||A.EMPTY_STRING,this.wrapperVer=e.wrapperVer||A.EMPTY_STRING,this.telemetryCacheKey=lt.CACHE_KEY+yt.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${lt.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n!=null&&n.length&&t.push(`broker_error=${n}`);const i=t.join(lt.VALUE_SEPARATOR),r=this.getRegionDiscoveryFields(),o=[e,r].join(lt.VALUE_SEPARATOR);return[lt.SCHEMA_VERSION,o,i].join(lt.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Yo.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(lt.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(lt.VALUE_SEPARATOR),r=e.errors.length,o=t<r?lt.OVERFLOW_TRUE:lt.OVERFLOW_FALSE,a=[r,o].join(lt.VALUE_SEPARATOR);return[lt.SCHEMA_VERSION,e.cacheHits,n,i,a].join(lt.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=lt.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Le?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(lt.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Yo.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i)}}static maxErrorsToSend(e){let t,n=0,i=0;const r=e.errors.length;for(t=0;t<r;t++){const o=e.failedRequests[2*t]||A.EMPTY_STRING,a=e.failedRequests[2*t+1]||A.EMPTY_STRING,c=e.errors[t]||A.EMPTY_STRING;if(i+=o.toString().length+a.toString().length+c.length+3,i<lt.MAX_LAST_HEADER_BYTES)n+=1;else break}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||A.EMPTY_STRING),e.push(this.regionSource||A.EMPTY_STRING),e.push(this.regionOutcome||A.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return hP(e)}}/*! @azure/msal-common v14.14.2 2024-08-28 */class dg{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class dP{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:j0.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new dg}}startPerformanceMeasurement(){return new dg}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v3.22.0 2024-08-28 */const Ld="pkce_not_created",X_="crypto_nonexistent",el="empty_navigate_uri",Z_="hash_empty_error",Dd="no_state_in_hash",eb="hash_does_not_contain_known_properties",tb="unable_to_parse_state",nb="state_interaction_type_mismatch",ib="interaction_in_progress",sb="popup_window_error",rb="empty_window_error",Fs="user_cancelled",fP="monitor_popup_timeout",ob="monitor_window_timeout",ab="redirect_in_iframe",cb="block_iframe_reload",lb="block_nested_popups",pP="iframe_closed_prematurely",tl="silent_logout_unsupported",hb="no_account_error",gP="silent_prompt_value_error",ub="no_token_request_cache_error",db="unable_to_parse_token_request_cache_error",Bd="no_cached_authority_error",mP="auth_request_not_set_error",vP="invalid_cache_type",Hd="non_browser_environment",cr="database_not_open",mc="no_network_connectivity",fb="post_request_failed",pb="get_request_failed",Gh="failed_to_parse_response",gb="unable_to_load_token",Ud="crypto_key_not_found",mb="auth_code_required",vb="auth_code_or_nativeAccountId_required",yb="spa_code_and_nativeAccountId_present",Fd="database_unavailable",_b="unable_to_acquire_token_from_native_platform",bb="native_handshake_timeout",wb="native_extension_not_installed",oa="native_connection_not_established",Cb="uninitialized_public_client_application",Sb="native_prompt_not_supported",Ab="invalid_base64_string",Tb="invalid_pop_token_request";/*! @azure/msal-browser v3.22.0 2024-08-28 */const ri="For more visit: aka.ms/msaljs/browser-errors",yP={[Ld]:"The PKCE code challenge and verifier could not be generated.",[X_]:"The crypto object or function is not available.",[el]:"Navigation URI is empty. Please check stack trace for more info.",[Z_]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${ri}`,[Dd]:"Hash does not contain state. Please verify that the request originated from msal.",[eb]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${ri}`,[tb]:"Unable to parse state. Please verify that the request originated from msal.",[nb]:"Hash contains state but the interaction type does not match the caller.",[ib]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${ri}`,[sb]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[rb]:"window.open returned null or undefined window object.",[Fs]:"User cancelled the flow.",[fP]:`Token acquisition in popup failed due to timeout.  ${ri}`,[ob]:`Token acquisition in iframe failed due to timeout.  ${ri}`,[ab]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[cb]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${ri}`,[lb]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[pP]:"The iframe being monitored was closed prematurely.",[tl]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[hb]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[gP]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[ub]:"No token request found in cache.",[db]:"The cached token request could not be parsed.",[Bd]:"No cached authority found.",[mP]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[vP]:"Invalid cache type",[Hd]:"Login and token requests are not supported in non-browser environments.",[cr]:"Database is not open!",[mc]:"No network connectivity. Check your internet connection.",[fb]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[pb]:"Network request failed. Please check the network trace to determine root cause.",[Gh]:"Failed to parse network response. Check network trace.",[gb]:"Error loading token to cache.",[Ud]:"Cryptographic Key or Keypair not found in browser storage.",[mb]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[vb]:"An authorization code or nativeAccountId must be provided to this flow.",[yb]:"Request cannot contain both spa code and native account id.",[Fd]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[_b]:`Unable to acquire token from native platform.  ${ri}`,[bb]:"Timed out while attempting to establish connection to browser extension",[wb]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[oa]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${ri}`,[Cb]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${ri}`,[Sb]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Ab]:"Invalid base64 encoded string.",[Tb]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true."};class aa extends Le{constructor(e){super(e,yP[e]),Object.setPrototypeOf(this,aa.prototype),this.name="BrowserAuthError"}}function K(s){return new aa(s)}/*! @azure/msal-browser v3.22.0 2024-08-28 */const Vt={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Cr={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},Ss={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Ze={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},fg={GET:"GET",POST:"POST"},_e={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},$i={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Sa={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},Pe={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var z;(function(s){s.Redirect="redirect",s.Popup="popup",s.Silent="silent",s.None="none"})(z||(z={}));const pg={scopes:Qr},Ib="jwk",Wh="msal.db",_P=1,bP=`${Wh}.keys`,Ht={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},wP=[Ht.Default,Ht.Skip,Ht.RefreshTokenAndNetwork],CP="msal.browser.log.level",SP="msal.browser.log.pii";/*! @azure/msal-browser v3.22.0 2024-08-28 */function Aa(s){return encodeURIComponent(Kd(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function nl(s){return kb(s).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Kd(s){return kb(new TextEncoder().encode(s))}function kb(s){const e=Array.from(s,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v3.22.0 2024-08-28 */const AP="RSASSA-PKCS1-v1_5",Eb="SHA-256",TP=2048,IP=new Uint8Array([1,0,1]),gg="0123456789abcdef",mg=new Uint32Array(1),Vd={name:AP,hash:Eb,modulusLength:TP,publicExponent:IP};function kP(s){if("crypto"in window)s.verbose("BrowserCrypto: modern crypto interface available");else throw s.error("BrowserCrypto: crypto interface is unavailable"),K(X_)}async function Rb(s,e,t){e==null||e.addQueueMeasurement(_.Sha256Digest,t);const i=new TextEncoder().encode(s);return window.crypto.subtle.digest(Eb,i)}function EP(s){return window.crypto.getRandomValues(s)}function Vl(){return window.crypto.getRandomValues(mg),mg[0]}function Ii(){const s=Date.now(),e=Vl()*1024+(Vl()&1023),t=new Uint8Array(16),n=Math.trunc(e/2**30),i=e&2**30-1,r=Vl();t[0]=s/2**40,t[1]=s/2**32,t[2]=s/2**24,t[3]=s/2**16,t[4]=s/2**8,t[5]=s,t[6]=112|n>>>8,t[7]=n,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=r>>>24,t[13]=r>>>16,t[14]=r>>>8,t[15]=r;let o="";for(let a=0;a<t.length;a++)o+=gg.charAt(t[a]>>>4),o+=gg.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(o+="-");return o}async function RP(s,e){return window.crypto.subtle.generateKey(Vd,s,e)}async function jl(s){return window.crypto.subtle.exportKey(Ib,s)}async function PP(s,e,t){return window.crypto.subtle.importKey(Ib,s,Vd,e,t)}async function OP(s,e){return window.crypto.subtle.sign(Vd,s,e)}async function Pb(s){const e=await Rb(s),t=new Uint8Array(e);return nl(t)}/*! @azure/msal-browser v3.22.0 2024-08-28 */const vc="storage_not_supported",Qh="stubbed_public_client_application_called",yc="in_mem_redirect_unavailable";/*! @azure/msal-browser v3.22.0 2024-08-28 */const $a={[vc]:"Given storage configuration option was not supported.",[Qh]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[yc]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};$a[vc],$a[Qh],$a[yc];class jd extends Le{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,jd.prototype)}}function Ob(s){return new jd(s,$a[s])}/*! @azure/msal-browser v3.22.0 2024-08-28 */function NP(s){s.location.hash="",typeof s.history.replaceState=="function"&&s.history.replaceState(null,"",`${s.location.origin}${s.location.pathname}${s.location.search}`)}function MP(s){const e=s.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function zd(){return window.parent!==window}function xP(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${Vt.POPUP_NAME_PREFIX}.`)===0}function pi(){return window.location.href.split("?")[0].split("#")[0]}function $P(){const e=new he(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function LP(){if(he.hashContainsKnownProperties(window.location.hash)&&zd())throw K(cb)}function DP(s){if(zd()&&!s)throw K(ab)}function BP(){if(xP())throw K(lb)}function HP(){if(typeof window>"u")throw K(Hd)}function Nb(s){if(!s)throw K(Cb)}function qd(s){HP(),LP(),BP(),Nb(s)}function vg(s,e){if(qd(s),DP(e.system.allowRedirectInIframe),e.cache.cacheLocation===Ze.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Ob(yc)}function Mb(s){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(s).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}/*! @azure/msal-browser v3.22.0 2024-08-28 */class _c{navigateInternal(e,t){return _c.defaultNavigateWindow(e,t)}navigateExternal(e,t){return _c.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(n=>{setTimeout(()=>{n(!0)},t.timeout)})}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class UP{async sendGetRequestAsync(e,t){let n;try{n=await fetch(e,{method:fg.GET,headers:this.getFetchHeaders(t)})}catch{throw window.navigator.onLine?K(pb):K(mc)}try{return{headers:this.getHeaderDict(n.headers),body:await n.json(),status:n.status}}catch{throw K(Gh)}}async sendPostRequestAsync(e,t){const n=t&&t.body||A.EMPTY_STRING;let i;try{i=await fetch(e,{method:fg.POST,headers:this.getFetchHeaders(t),body:n})}catch{throw window.navigator.onLine?K(fb):K(mc)}try{return{headers:this.getHeaderDict(i.headers),body:await i.json(),status:i.status}}catch{throw K(Gh)}}getFetchHeaders(e){const t=new Headers;if(!(e&&e.headers))return t;const n=e.headers;return Object.keys(n).forEach(i=>{t.append(i,n[i])}),t}getHeaderDict(e){const t={};return e.forEach((n,i)=>{t[i]=n}),t}}/*! @azure/msal-browser v3.22.0 2024-08-28 */const FP=6e4,Yh=1e4,KP=3e4,VP=2e3;function jP({auth:s,cache:e,system:t,telemetry:n},i){const r={clientId:A.EMPTY_STRING,authority:`${A.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:A.EMPTY_STRING,authorityMetadata:A.EMPTY_STRING,redirectUri:A.EMPTY_STRING,postLogoutRedirectUri:A.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:wi.AAD,OIDCOptions:{serverResponseType:ra.FRAGMENT,defaultScopes:[A.OPENID_SCOPE,A.PROFILE_SCOPE,A.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Td.None,tenant:A.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1},o={cacheLocation:Ze.SessionStorage,temporaryCacheLocation:Ze.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Ze.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:Ee.Info,piiLoggingEnabled:!1},l={...{...q_,loggerOptions:a,networkClient:i?new UP:cP,navigationClient:new _c,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||FP,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||Yh,navigateFrameWait:0,redirectNavigationTimeout:KP,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||VP,pollIntervalMilliseconds:Vt.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||a},h={application:{appName:A.EMPTY_STRING,appVersion:A.EMPTY_STRING},client:new dP};if((s==null?void 0:s.protocolMode)!==wi.OIDC&&(s!=null&&s.OIDCOptions)&&new Hs(l.loggerOptions).warning(JSON.stringify(Te(M_))),s!=null&&s.protocolMode&&s.protocolMode!==wi.AAD&&(l!=null&&l.allowNativeBroker))throw Te(x_);return{auth:{...r,...s,OIDCOptions:{...r.OIDCOptions,...s==null?void 0:s.OIDCOptions}},cache:{...o,...e},system:l,telemetry:{...h,...n}}}/*! @azure/msal-browser v3.22.0 2024-08-28 */const zP="@azure/msal-browser",il="3.22.0";/*! @azure/msal-browser v3.22.0 2024-08-28 */class Gd{static loggerCallback(e,t){switch(e){case Ee.Error:console.error(t);return;case Ee.Info:console.info(t);return;case Ee.Verbose:console.debug(t);return;case Ee.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var c;this.browserEnvironment=typeof window<"u",this.config=jP(e,this.browserEnvironment);let t;try{t=window[Ze.SessionStorage]}catch{}const n=t==null?void 0:t.getItem(CP),i=(c=t==null?void 0:t.getItem(SP))==null?void 0:c.toLowerCase(),r=i==="true"?!0:i==="false"?!1:void 0,o={...this.config.system.loggerOptions},a=n&&Object.keys(Ee).includes(n)?Ee[n]:void 0;a&&(o.loggerCallback=Gd.loggerCallback,o.logLevel=a),r!==void 0&&(o.piiLoggingEnabled=r),this.logger=new Hs(o,zP,il),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Ks extends Gd{getModuleName(){return Ks.MODULE_NAME}getId(){return Ks.ID}async initialize(){return this.available=typeof window<"u",this.available}}Ks.MODULE_NAME="";Ks.ID="StandardOperatingContext";/*! @azure/msal-browser v3.22.0 2024-08-28 */function Vn(s){return new TextDecoder().decode(qP(s))}function qP(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw K(Ab)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}/*! @azure/msal-browser v3.22.0 2024-08-28 */class GP{constructor(){this.dbName=Wh,this.version=_P,this.tableName=bP,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",i=>{const r=i;this.db=r.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(K(Fd)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(K(cr));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",a=>{const c=a;this.closeConnection(),t(c.target.result)}),o.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,i)=>{if(!this.db)return i(K(cr));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),n()}),a.addEventListener("error",c=>{this.closeConnection(),i(c)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(K(cr));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",()=>{this.closeConnection(),t()}),o.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(K(cr));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",o=>{const a=o;this.closeConnection(),e(a.target.result)}),r.addEventListener("error",o=>{this.closeConnection(),t(o)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(K(cr));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",a=>{const c=a;this.closeConnection(),t(c.target.result===1)}),o.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(Wh),i=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(i),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),n.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Jh{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class WP{constructor(e){this.inMemoryCache=new Jh,this.indexedDBCache=new GP,this.logger=e}handleDatabaseAccessError(e){if(e instanceof aa&&e.errorCode===Fd)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(n){this.handleDatabaseAccessError(n)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(n){this.handleDatabaseAccessError(n)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(n){this.handleDatabaseAccessError(n)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Ur{constructor(e,t){this.logger=e,kP(e),this.cache=new WP(this.logger),this.performanceClient=t}createNewGuid(){return Ii()}base64Encode(e){return Kd(e)}base64Decode(e){return Vn(e)}base64UrlEncode(e){return Aa(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var h;const t=(h=this.performanceClient)==null?void 0:h.startMeasurement(_.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await RP(Ur.EXTRACTABLE,Ur.POP_KEY_USAGES),i=await jl(n.publicKey),r={e:i.e,kty:i.kty,n:i.n},o=yg(r),a=await this.hashString(o),c=await jl(n.privateKey),l=await PP(c,!1,["sign"]);return await this.cache.setItem(a,{privateKey:l,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,i){var R;const r=(R=this.performanceClient)==null?void 0:R.startMeasurement(_.CryptoOptsSignJwt,i),o=await this.cache.getItem(t);if(!o)throw K(Ud);const a=await jl(o.publicKey),c=yg(a),l=Aa(JSON.stringify({kid:t})),h=$d.getShrHeaderString({...n==null?void 0:n.header,alg:a.alg,kid:l}),u=Aa(h);e.cnf={jwk:JSON.parse(c)};const d=Aa(JSON.stringify(e)),f=`${u}.${d}`,m=new TextEncoder().encode(f),g=await OP(o.privateKey,m),v=nl(new Uint8Array(g)),S=`${f}.${v}`;return r&&r.end({success:!0}),S}async hashString(e){return Pb(e)}}Ur.POP_KEY_USAGES=["sign","verify"];Ur.EXTRACTABLE=!0;function yg(s){return JSON.stringify(s,Object.keys(s).sort())}/*! @azure/msal-browser v3.22.0 2024-08-28 */class _g{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==Ze.LocalStorage&&e!==Ze.SessionStorage||!window[e])throw Ob(vc)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v3.22.0 2024-08-28 */function xb(s,e){if(!e)return null;try{return yn.parseRequestState(s,e).libraryState.meta}catch{throw M(Lr)}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Xh extends Br{constructor(e,t,n,i,r,o){super(e,n,i,r),this.COOKIE_LIFE_MULTIPLIER=24*60*60*1e3,this.cacheConfig=t,this.logger=i,this.internalStorage=new Jh,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=o}setupBrowserStorage(e){switch(e){case Ze.LocalStorage:case Ze.SessionStorage:try{return new _g(e)}catch(t){this.logger.verbose(t);break}}return this.cacheConfig.cacheLocation=Ze.MemoryStorage,new Jh}setupTemporaryCacheStorage(e,t){switch(t){case Ze.LocalStorage:case Ze.SessionStorage:try{return new _g(e||Ze.SessionStorage)}catch(n){return this.logger.verbose(n),this.internalStorage}case Ze.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){const e=`${A.CACHE_PREFIX}.${nt.ID_TOKEN}`,t=`${A.CACHE_PREFIX}.${nt.CLIENT_INFO}`,n=`${A.CACHE_PREFIX}.${nt.ERROR}`,i=`${A.CACHE_PREFIX}.${nt.ERROR_DESC}`,r=this.browserStorage.getItem(e),o=this.browserStorage.getItem(t),a=this.browserStorage.getItem(n),c=this.browserStorage.getItem(i),l=[r,o,a,c];[nt.ID_TOKEN,nt.CLIENT_INFO,nt.ERROR,nt.ERROR_DESC].forEach((u,d)=>{const f=l[d];f&&this.setTemporaryCache(u,f,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem($i.ACCOUNT_KEYS),t=this.getItem(`${$i.TOKEN_KEYS}.${this.clientId}`);if(e&&t){this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");return}this.browserStorage.getKeys().forEach(i=>{if(this.isCredentialKey(i)){const r=this.getItem(i);if(r){const o=this.validateAndParseJson(r);if(o&&o.hasOwnProperty("credentialType"))switch(o.credentialType){case W.ID_TOKEN:if(eg(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${i} found, saving key to token key map`);const a=o,c=this.updateCredentialCacheKey(i,a);this.addTokenKey(c,W.ID_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${i}`);break;case W.ACCESS_TOKEN:case W.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(Zp(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${i} found, saving key to token key map`);const a=o,c=this.updateCredentialCacheKey(i,a);this.addTokenKey(c,W.ACCESS_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${i}`);break;case W.REFRESH_TOKEN:if(tg(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${i} found, saving key to token key map`);const a=o,c=this.updateCredentialCacheKey(i,a);this.addTokenKey(c,W.REFRESH_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${i}`);break}}}if(this.isAccountKey(i)){const r=this.getItem(i);if(r){const o=this.validateAndParseJson(r);o&&et.isAccountEntity(o)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${i} found, saving key to account key map`),this.addAccountKeyToMap(i))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const n=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,n,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const n=this.validateAndParseJson(t);return!n||!et.isAccountEntity(n)?(this.removeAccountKeyFromMap(e),null):Br.toObject(new et,n)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem($i.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();t.indexOf(e)===-1?(t.push(e),this.setItem($i.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.setItem($i.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,W.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,W.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,W.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${$i.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const n=this.getTokenKeys();switch(t){case W.ID_TOKEN:n.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case W.ACCESS_TOKEN:n.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case W.REFRESH_TOKEN:n.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),M(Kh)}this.setItem(`${$i.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const n=this.getTokenKeys();switch(t){case W.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const i=n.idToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case W.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const r=n.accessToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case W.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const o=n.refreshToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),M(Kh)}this.setItem(`${$i.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,W.ID_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!eg(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,W.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=br(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,W.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,W.ACCESS_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!Zp(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,W.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=br(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,W.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,W.REFRESH_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!tg(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,W.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=br(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,W.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!eR(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=Z0(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!J0(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&tR(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Sa.WRAPPER_SKU,e),this.internalStorage.setItem(Sa.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Sa.WRAPPER_SKU)||A.EMPTY_STRING,t=this.internalStorage.getItem(Sa.WRAPPER_VER)||A.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(nt.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const i=this.generateCacheKey(nt.ACTIVE_ACCOUNT),r=this.getItem(i);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const o=this.getAccountInfoFilteredBy({localAccountId:r});return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(o),o):null}const n=this.validateAndParseJson(t);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(nt.ACTIVE_ACCOUNT_FILTERS),n=this.generateCacheKey(nt.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(i)),this.browserStorage.setItem(n,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(n)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!X0(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const r=this.getItemCookie(n);if(r)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),r}const i=this.temporaryCacheStorage.getItem(n);if(!i){if(this.cacheConfig.cacheLocation===Ze.LocalStorage){const r=this.browserStorage.getItem(n);if(r)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),r}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,n){const i=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(i,t))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(A.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(A.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(_.ClearTokensAndKeysWithClaims,t);const n=this.getTokenKeys(),i=[];n.accessToken.forEach(r=>{const o=this.getAccessTokenCredential(r);o!=null&&o.requestedClaimsHash&&r.includes(o.requestedClaimsHash.toLowerCase())&&i.push(this.removeAccessToken(r))}),await Promise.all(i),i.length>0&&this.logger.warning(`${i.length} access tokens with claims in the cache keys have been removed from the cache.`)}setItemCookie(e,t,n){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(n){const r=this.getCookieExpirationTime(n);i+=`expires=${r};`}this.cacheConfig.secureCookies&&(i+="Secure;"),document.cookie=i}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,n=document.cookie.split(";");for(let i=0;i<n.length;i++){let r=n[i];for(;r.charAt(0)===" ";)r=r.substring(1);if(r.indexOf(t)===0)return decodeURIComponent(r.substring(t.length,r.length))}return A.EMPTY_STRING}clearMsalCookies(){const e=`${A.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(n=>{for(;n.charAt(0)===" ";)n=n.substring(1);if(n.indexOf(e)===0){const i=n.split("=")[0];this.clearItemCookie(i)}})}clearItemCookie(e){this.setItemCookie(e,A.EMPTY_STRING,-1)}getCookieExpirationTime(e){const t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):vn.startsWith(e,A.CACHE_PREFIX)||vn.startsWith(e,nt.ADAL_ID_TOKEN)?e:`${A.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=yn.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${_e.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=yn.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${_e.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=yn.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${_e.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const i=this.generateAuthorityKey(n);return this.getTemporaryCache(i)}updateCacheEntries(e,t,n,i,r){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const o=this.generateStateKey(e);this.setTemporaryCache(o,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const c=this.generateAuthorityKey(e);if(this.setTemporaryCache(c,n,!1),r){const l={credential:r.homeAccountId,type:jt.HOME_ACCOUNT_ID};this.setTemporaryCache(_e.CCS_CREDENTIAL,JSON.stringify(l),!0)}else if(i){const l={credential:i,type:jt.UPN};this.setTemporaryCache(_e.CCS_CREDENTIAL,JSON.stringify(l),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(_e.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(_e.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(_e.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(_e.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(_e.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(_e.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||A.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(_e.REQUEST_STATE)===-1)return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const i=xb(this.cryptoImpl,n);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=Kd(JSON.stringify(e));this.setTemporaryCache(_e.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(_e.REQUEST_PARAMS,!0);if(!t)throw K(ub);let n;try{n=JSON.parse(Vn(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),K(db)}if(this.removeTemporaryItem(this.generateCacheKey(_e.REQUEST_PARAMS)),!n.authority){const i=this.generateAuthorityKey(e),r=this.getTemporaryCache(i);if(!r)throw K(Bd);n.authority=r}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(_e.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${A.CACHE_PREFIX}.${_e.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${A.CACHE_PREFIX}.${_e.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw K(ib);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(nt.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(nt.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(nt.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(nt.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const n=t||e;if(n){const i=Gs(n,Vn);if(i.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),i.preferred_username;if(i.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),i.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const n=br(t);if(e!==n){const i=this.getItem(e);if(i)return this.browserStorage.removeItem(e),this.setItem(n,i),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),n;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){var a,c,l;const n=Jc((a=e.account)==null?void 0:a.homeAccountId,(c=e.account)==null?void 0:c.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const r=Xc((l=e.account)==null?void 0:l.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Vn,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),o={idToken:n,accessToken:r};return this.saveCacheRecord(o)}async saveCacheRecord(e,t,n){try{await super.saveCacheRecord(e,t,n)}catch(i){if(i instanceof kr&&this.performanceClient&&n)try{const r=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:r.refreshToken.length,cacheIdCount:r.idToken.length,cacheAtCount:r.accessToken.length},n)}catch{}throw i}}}const QP=(s,e)=>{const t={cacheLocation:Ze.MemoryStorage,temporaryCacheLocation:Ze.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Xh(s,t,dc,e)};/*! @azure/msal-browser v3.22.0 2024-08-28 */function YP(s,e,t,n){return s.verbose("getAllAccounts called"),t?e.getAllAccounts(n):[]}function JP(s,e,t){if(e.trace("getAccount called"),Object.keys(s).length===0)return e.warning("getAccount: No accountFilter provided"),null;const n=t.getAccountInfoFilteredBy(s);return n?(e.verbose("getAccount: Account matching provided filter found, returning"),n):(e.verbose("getAccount: No matching account found, returning null"),null)}function XP(s,e,t){if(e.trace("getAccountByUsername called"),!s)return e.warning("getAccountByUsername: No username provided"),null;const n=t.getAccountInfoFilteredBy({username:s});return n?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${s}`),n):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function ZP(s,e,t){if(e.trace("getAccountByHomeId called"),!s)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const n=t.getAccountInfoFilteredBy({homeAccountId:s});return n?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${s}`),n):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function eO(s,e,t){if(e.trace("getAccountByLocalId called"),!s)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const n=t.getAccountInfoFilteredBy({localAccountId:s});return n?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${s}`),n):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function tO(s,e){e.setActiveAccount(s)}function nO(s){return s.getActiveAccount()}/*! @azure/msal-browser v3.22.0 2024-08-28 */const Y={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v3.22.0 2024-08-28 */class iO{constructor(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}addEventCallback(e){if(typeof window<"u"){const t=Ii();return this.eventCallbacks.set(t,e),this.logger.verbose(`Event callback registered with id: ${t}`),t}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}emitEvent(e,t,n,i){if(typeof window<"u"){const r={eventType:e,interactionType:t||null,payload:n||null,error:i||null,timestamp:Date.now()};this.logger.info(`Emitting event: ${e}`),this.eventCallbacks.forEach((o,a)=>{this.logger.verbose(`Emitting event to callback ${a}: ${e}`),o.apply(null,[r])})}}handleAccountCacheChange(e){var t;try{(t=e.key)!=null&&t.includes(nt.ACTIVE_ACCOUNT_FILTERS)&&this.emitEvent(Y.ACTIVE_ACCOUNT_CHANGED);const n=e.newValue||e.oldValue;if(!n)return;const i=JSON.parse(n);if(typeof i!="object"||!et.isAccountEntity(i))return;const o=Br.toObject(new et,i).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(Y.ACCOUNT_ADDED,void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(Y.ACCOUNT_REMOVED,void 0,o))}catch{return}}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class $b{constructor(e,t,n,i,r,o,a,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=r,this.navigationClient=o,this.nativeMessageHandler=c,this.correlationId=l||Ii(),this.logger=i.clone(Vt.MSAL_SKU,il,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){et.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(et.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||pi();return he.getAbsoluteUrl(t,pi())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Yo(n,this.browserStorage)}async getDiscoveredAuthority(e,t,n){this.performanceClient.addQueueMeasurement(_.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},r=e||this.config.auth.authority,o=gt.generateAuthority(r,t||this.config.auth.azureCloudOptions),a=await L(F_,_.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(o,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(n&&!a.isAlias(n.environment))throw Te($_);return a}}/*! @azure/msal-browser v3.22.0 2024-08-28 */const sO=32;async function rO(s,e,t){s.addQueueMeasurement(_.GeneratePkceCodes,t);const n=Ws(oO,_.GenerateCodeVerifier,e,s,t)(s,e,t),i=await L(aO,_.GenerateCodeChallengeFromVerifier,e,s,t)(n,s,e,t);return{verifier:n,challenge:i}}function oO(s,e,t){try{const n=new Uint8Array(sO);return Ws(EP,_.GetRandomValues,e,s,t)(n),nl(n)}catch{throw K(Ld)}}async function aO(s,e,t,n){e.addQueueMeasurement(_.GenerateCodeChallengeFromVerifier,n);try{const i=await L(Rb,_.Sha256Digest,t,e,n)(s,e,n);return nl(new Uint8Array(i))}catch{throw K(Ld)}}/*! @azure/msal-browser v3.22.0 2024-08-28 */async function Wd(s,e,t,n){t.addQueueMeasurement(_.InitializeBaseRequest,s.correlationId);const i=s.authority||e.auth.authority,r=[...s&&s.scopes||[]],o={...s,correlationId:s.correlationId,authority:i,scopes:r};if(!o.authenticationScheme)o.authenticationScheme=we.BEARER,n.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(o.authenticationScheme===we.SSH){if(!s.sshJwk)throw Te(Qc);if(!s.sshKid)throw Te(N_)}n.verbose(`Authentication Scheme set to "${o.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&s.claims&&!vn.isEmptyObj(s.claims)&&(o.requestedClaimsHash=await Pb(s.claims)),o}async function cO(s,e,t,n,i){n.addQueueMeasurement(_.InitializeSilentRequest,s.correlationId);const r=await L(Wd,_.InitializeBaseRequest,i,n,s.correlationId)(s,t,n,i);return{...s,...r,account:e,forceRefresh:s.forceRefresh||!1}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Yr extends $b{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(_.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await L(rO,_.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),n={...e,redirectUri:e.redirectUri,code:A.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=A.S256_CODE_CHALLENGE_METHOD,n}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||Ii(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=he.getAbsoluteUrl(e.postLogoutRedirectUri,pi())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=he.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,pi())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=he.getAbsoluteUrl(pi(),pi())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e,t,n,i){this.performanceClient.addQueueMeasurement(_.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const r=await L(this.getClientConfiguration.bind(this),_.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,n,i);return new W_(r,this.performanceClient)}async getClientConfiguration(e,t,n,i){this.performanceClient.addQueueMeasurement(_.StandardInteractionClientGetClientConfiguration,this.correlationId);const r=await L(this.getDiscoveredAuthority.bind(this),_.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)(t,n,i),o=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:r,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:o.loggerCallback,piiLoggingEnabled:o.piiLoggingEnabled,logLevel:o.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:Vt.MSAL_SKU,version:il,cpu:A.EMPTY_STRING,os:A.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(_.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const n=this.getRedirectUri(e.redirectUri),i={interactionType:t},r=yn.setRequestState(this.browserCrypto,e&&e.state||A.EMPTY_STRING,i),a={...await L(Wd,_.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:n,state:r,nonce:e.nonce||Ii(),responseMode:this.config.auth.OIDCOptions.serverResponseType},c=e.account||this.browserStorage.getActiveAccount();if(c&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${c.homeAccountId}`,this.correlationId),a.account=c),!a.loginHint&&!c){const l=this.browserStorage.getLegacyLoginHint();l&&(a.loginHint=l)}return a}}/*! @azure/msal-browser v3.22.0 2024-08-28 */const lO="ContentError",Lb="user_switch";/*! @azure/msal-browser v3.22.0 2024-08-28 */const hO="USER_INTERACTION_REQUIRED",uO="USER_CANCEL",dO="NO_NETWORK",fO="PERSISTENT_ERROR",pO="DISABLED",gO="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v3.22.0 2024-08-28 */const mO=-2147186943,vO={[Lb]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Mn extends Le{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Mn.prototype),this.name="NativeAuthError",this.ext=n}}function lr(s){if(s.ext&&s.ext.status&&(s.ext.status===fO||s.ext.status===pO)||s.ext&&s.ext.error&&s.ext.error===mO)return!0;switch(s.errorCode){case lO:return!0;default:return!1}}function Zh(s,e,t){if(t&&t.status)switch(t.status){case gO:return zh(G_);case hO:return new tn(s,e);case uO:return K(Fs);case dO:return K(mc)}return new Mn(s,vO[s]||e,t)}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Db extends Yr{async acquireToken(e){this.performanceClient.addQueueMeasurement(_.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Pe.acquireTokenSilent_silentFlow),n=await L(this.getClientConfiguration.bind(this),_.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(t,e.authority,e.azureCloudOptions,e.account),i=new aP(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const o=(await L(i.acquireCachedToken.bind(i),_.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),o}catch(r){throw r instanceof aa&&r.errorCode===Ud&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),r}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v3.22.0 2024-08-28 */const zl={BROKER_CLIENT_ID:"brk_client_id",BROKER_REDIRECT_URI:"brk_redirect_uri"};class Er extends $b{constructor(e,t,n,i,r,o,a,c,l,h,u,d){var p;super(e,t,n,i,r,o,c,l,d),this.apiId=a,this.accountId=h,this.nativeMessageHandler=l,this.nativeStorageManager=u,this.silentCacheClient=new Db(e,this.nativeStorageManager,n,i,r,o,c,l,d),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const f=this.nativeMessageHandler.getExtensionId()===Cr.PREFERRED_EXTENSION_ID?"chrome":(p=this.nativeMessageHandler.getExtensionId())!=null&&p.length?"unknown":void 0;this.skus=Yo.makeExtraSkuString({libraryName:Vt.MSAL_SKU,libraryVersion:il,extensionName:f,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[UR]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(_.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(_.NativeInteractionClientAcquireToken,e.correlationId),n=Wn();try{const i=await this.initializeNativeRequest(e);try{const l=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),l}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...r}=i,o={method:Ss.GetToken,request:r},a=await this.nativeMessageHandler.sendMessage(o),c=this.validateNativeResponse(a);return await this.handleNativeResponse(c,i,n).then(l=>(t.end({success:!0,isNativeBroker:!0,requestId:l.requestId}),this.serverTelemetryManager.clearNativeBrokerErrorCode(),l)).catch(l=>{throw t.end({success:!1,errorCode:l.errorCode,subErrorCode:l.subError,isNativeBroker:!0}),l})}catch(i){throw i instanceof Mn&&this.serverTelemetryManager.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:je.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),M(Uh);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!n)throw M(Uh);try{const i=this.createSilentCacheRequest(t,n),r=await this.silentCacheClient.acquireToken(i),o={...n,idTokenClaims:r==null?void 0:r.idTokenClaims,idToken:r==null?void 0:r.idToken};return{...r,account:o}}catch(i){throw i}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...n}=e;delete n.onRedirectNavigate;const i=await this.initializeNativeRequest(n),r={method:Ss.GetToken,request:i};try{const c=await this.nativeMessageHandler.sendMessage(r);this.validateNativeResponse(c)}catch(c){if(c instanceof Mn&&(this.serverTelemetryManager.setNativeBrokerErrorCode(c.errorCode),lr(c)))throw c}this.browserStorage.setTemporaryCache(_e.NATIVE_REQUEST,JSON.stringify(i),!0);const o={apiId:Pe.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:i,...r}=n;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(_e.NATIVE_REQUEST));const o={method:Ss.GetToken,request:r},a=Wn();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const c=await this.nativeMessageHandler.sendMessage(o);this.validateNativeResponse(c);const l=this.handleNativeResponse(c,r,a);this.browserStorage.setInteractionInProgress(!1);const h=await l;return this.serverTelemetryManager.clearNativeBrokerErrorCode(),h}catch(c){throw this.browserStorage.setInteractionInProgress(!1),c}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){var h;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=Gs(e.id_token,Vn),r=this.createHomeAccountIdentifier(e,i),o=(h=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:h.homeAccountId;if(r!==o&&e.account.id!==t.accountId)throw Zh(Lb);const a=await this.getDiscoveredAuthority(t.authority),c=Md(this.browserStorage,a,r,Vn,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),l=await this.generateAuthenticationResult(e,t,i,c,a.canonicalAuthority,n);return this.cacheAccount(c),this.cacheNativeTokens(e,t,r,i,e.access_token,l.tenantId,n),l}createHomeAccountIdentifier(e,t){return et.generateHomeAccountId(e.client_info||A.EMPTY_STRING,dn.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?je.fromString(e.scope):je.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===we.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new Hr(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw M(_d);return n.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,n,i,r,o){const a=this.addTelemetryFromNativeResponse(e),c=e.scope?je.fromString(e.scope):je.fromString(t.scope),l=e.account.properties||{},h=l.UID||n.oid||n.sub||A.EMPTY_STRING,u=l.TenantId||n.tid||A.EMPTY_STRING,d=Rd(i.getAccountInfo(),void 0,n,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const f=await this.generatePopAccessToken(e,t),p=t.tokenType===we.POP?we.POP:we.BEARER;return{authority:r,uniqueId:h,tenantId:u,scopes:c.asArray(),account:d,idToken:e.id_token,idTokenClaims:n,accessToken:f,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:new Date(Number(o+e.expires_in)*1e3),tokenType:p,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,n,i,r,o,a){const c=Jc(n,t.authority,e.id_token||"",t.clientId,i.tid||""),l=t.tokenType===we.POP?A.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=a+l,u=this.generateScopes(e,t),d=Xc(n,t.authority,r,t.clientId,i.tid||o,u.printScopes(),h,0,Vn,void 0,t.tokenType,void 0,t.keyId),f={idToken:c,accessToken:d};this.nativeStorageManager.saveCacheRecord(f,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw i_(fd,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority(t,e.azureCloudOptions,e.account);const n=new he(t);n.validateAsUri();const{scopes:i,...r}=e,o=new je(i||[]);o.appendScopes(Qr);const a=()=>{switch(this.apiId){case Pe.ssoSilent:case Pe.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),it.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case it.NONE:case it.CONSENT:case it.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),K(Sb)}},c={...r,accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(c.signPopToken&&e.popKid)throw K(Tb);if(this.handleExtraBrokerParams(c),c.extraParameters=c.extraParameters||{},c.extraParameters.telemetry=Cr.MATS_TELEMETRY,e.authenticationScheme===we.POP){const l={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},h=new Hr(this.browserCrypto);let u;if(c.keyId)u=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:c.keyId})),c.signPopToken=!1;else{const d=await L(h.generateCnf.bind(h),_.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(l,this.logger);u=d.reqCnfString,c.keyId=d.kid,c.signPopToken=!0}c.reqCnf=u}return this.addRequestSKUs(c),c}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty(zl.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(zl.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(Dr)){const t=e.extraParameters[Dr],n=e.redirectUri,i=e.extraParameters[zl.BROKER_REDIRECT_URI];e.extraParameters={child_client_id:t,child_redirect_uri:n},e.redirectUri=i}}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Bn{constructor(e,t,n,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(_.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:Cr.CHANNEL_ID,extensionId:this.extensionId,responseId:Ii(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((n,i)=>{this.resolvers.set(t.responseId,{resolve:n,reject:i})})}static async createProvider(e,t,n){e.trace("NativeMessageHandler - createProvider called.");try{const i=new Bn(e,t,n,Cr.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const r=new Bn(e,t,n);return await r.sendHandshakeRequest(),r}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:Cr.CHANNEL_ID,extensionId:this.extensionId,responseId:Ii(),body:{method:Ss.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(K(bb)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==Cr.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===Ss.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject(K(wb))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const r=t.body.method;if(r===Ss.Response){if(!n)return;const o=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(o)}`),o.status!=="Success")n.reject(Zh(o.code,o.description,o.ext));else if(o.result)o.result.code&&o.result.description?n.reject(Zh(o.result.code,o.result.description,o.result.ext)):n.resolve(o.result);else throw i_(fd,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(r===Ss.HandshakeResponse){if(!i){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(r){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${r}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(r):i&&i.reject(r)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,n,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case we.BEARER:case we.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Qd{constructor(e,t,n,i,r){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=i,this.performanceClient=r}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(_.HandleCodeResponse,t.correlationId);let n;try{n=this.authModule.handleFragmentResponse(e,t.state)}catch(i){throw i instanceof Yi&&i.subError===Fs?K(Fs):i}return L(this.handleCodeResponseFromServer.bind(this),_.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(_.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await L(this.authModule.updateAuthority.bind(this.authModule),_.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const r=this.createCcsCredentials(t);r&&(this.authCodeRequest.ccsCredential=r)}return await L(this.authModule.acquireToken.bind(this.authModule),_.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:jt.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:jt.UPN}:null}}/*! @azure/msal-browser v3.22.0 2024-08-28 */function Bb(s,e,t){const n=hc(s);if(!n)throw L_(s)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${s}`),K(eb)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),K(Z_));return n}function yO(s,e,t){if(!s.state)throw K(Dd);const n=xb(e,s.state);if(!n)throw K(tb);if(n.interactionType!==t)throw K(nb)}/*! @azure/msal-browser v3.22.0 2024-08-28 */class _O extends Yr{constructor(e,t,n,i,r,o,a,c,l,h){super(e,t,n,i,r,o,a,l,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c}acquireToken(e){try{const t=this.generatePopupName(e.scopes||Qr,e.authority||this.config.auth.authority),n=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,n);{this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");const i=this.openSizedPopup("about:blank",t,n);return this.acquireTokenPopupAsync(e,t,n,i)}}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n=this.generateLogoutPopupName(t),i=e&&e.authority,r=e&&e.mainWindowRedirectUri,o=(e==null?void 0:e.popupWindowAttributes)||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,o,i,void 0,r);{this.logger.verbose("asyncPopup set to false, opening popup");const a=this.openSizedPopup("about:blank",n,o);return this.logoutPopupAsync(t,n,o,i,a,r)}}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,n,i){this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(Pe.acquireTokenPopup),o=await L(this.initializeAuthorizationRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,z.Popup);Mb(o.authority);try{const a=await L(this.initializeAuthorizationCodeRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(o),c=await L(this.createAuthCodeClient.bind(this),_.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(r,o.authority,o.azureCloudOptions,o.account),l=Bn.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let h;l&&(h=this.performanceClient.startMeasurement(_.FetchAccountIdWithNativeBroker,e.correlationId));const u=await c.getAuthCodeUrl({...o,nativeBroker:l}),d=new Qd(c,this.browserStorage,a,this.logger,this.performanceClient),f={popup:i,popupName:t,popupWindowAttributes:n},p=this.initiateAuthRequest(u,f);this.eventHandler.emitEvent(Y.POPUP_OPENED,z.Popup,{popupWindow:p},null);const m=await this.monitorPopupForHash(p),g=Ws(Bb,_.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(m,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(Nn.removeThrottle(this.browserStorage,this.config.auth.clientId,a),g.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),h&&h.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw K(oa);const S=new Er(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Pe.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,g.accountId,this.nativeStorage,o.correlationId),{userRequestState:R}=yn.parseRequestState(this.browserCrypto,o.state);return await S.acquireToken({...o,state:R,prompt:void 0})}return await d.handleCodeResponse(g,o)}catch(a){throw i&&i.close(),a instanceof Le&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),a}}async logoutPopupAsync(e,t,n,i,r,o){var c,l;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(Y.LOGOUT_START,z.Popup,e);const a=this.initializeServerTelemetryManager(Pe.logoutPopup);try{await this.clearCacheOnLogout(e.account);const h=await L(this.createAuthCodeClient.bind(this),_.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(a,i,void 0,e.account||void 0);try{h.authority.endSessionEndpoint}catch{if((c=e.account)!=null&&c.homeAccountId&&e.postLogoutRedirectUri&&h.authority.protocolMode===wi.OIDC){if(this.browserStorage.removeAccount((l=e.account)==null?void 0:l.homeAccountId),this.eventHandler.emitEvent(Y.LOGOUT_SUCCESS,z.Popup,e),o){const f={apiId:Pe.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},p=he.getAbsoluteUrl(o,pi());await this.navigationClient.navigateInternal(p,f)}r&&r.close();return}}const u=h.getLogoutUri(e);this.eventHandler.emitEvent(Y.LOGOUT_SUCCESS,z.Popup,e);const d=this.openPopup(u,{popupName:t,popupWindowAttributes:n,popup:r});if(this.eventHandler.emitEvent(Y.POPUP_OPENED,z.Popup,{popupWindow:d},null),await this.monitorPopupForHash(d).catch(()=>{}),o){const f={apiId:Pe.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},p=he.getAbsoluteUrl(o,pi());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${p}`),await this.navigationClient.navigateInternal(p,f)}else this.logger.verbose("No main window navigation requested")}catch(h){throw r&&r.close(),h instanceof Le&&(h.setCorrelationId(this.correlationId),a.cacheFailedRequest(h)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(Y.LOGOUT_FAILURE,z.Popup,null,h),this.eventHandler.emitEvent(Y.LOGOUT_END,z.Popup),h}this.eventHandler.emitEvent(Y.LOGOUT_END,z.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),K(el)}monitorPopupForHash(e){return new Promise((t,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),n(K(Fs));return}let r="";try{r=e.location.href}catch{}if(!r||r==="about:blank")return;clearInterval(i);let o="";const a=this.config.auth.OIDCOptions.serverResponseType;e&&(a===ra.QUERY?o=e.location.search:o=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(o)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!n)throw K(rb);return n.focus&&n.focus(),this.currentWindow=n,window.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),K(sb)}}openSizedPopup(e,t,n){var d,f,p,m;const i=window.screenLeft?window.screenLeft:window.screenX,r=window.screenTop?window.screenTop:window.screenY,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=(d=n.popupSize)==null?void 0:d.width,l=(f=n.popupSize)==null?void 0:f.height,h=(p=n.popupPosition)==null?void 0:p.top,u=(m=n.popupPosition)==null?void 0:m.left;return(!c||c<0||c>o)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=Vt.POPUP_WIDTH),(!l||l<0||l>a)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=Vt.POPUP_HEIGHT),(!h||h<0||h>a)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,a/2-Vt.POPUP_HEIGHT/2+r)),(!u||u<0||u>o)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),u=Math.max(0,o/2-Vt.POPUP_WIDTH/2+i)),window.open(e,t,`width=${c}, height=${l}, top=${h}, left=${u}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(z.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${Vt.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${Vt.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class bg{constructor(e,t,n,i,r){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=i,this.performanceClient=r}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(_e.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(_e.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:Pe.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,n);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,n);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),K(el)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const n=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(n);if(!i)throw M(lc,"Cached State");let r;try{r=this.authModule.handleFragmentResponse(e,i)}catch(l){throw l instanceof Yi&&l.subError===Fs?K(Fs):l}const o=this.browserStorage.generateNonceKey(i),a=this.browserStorage.getTemporaryCache(o);if(this.authCodeRequest.code=r.code,r.cloud_instance_host_name&&await L(this.authModule.updateAuthority.bind(this.authModule),_.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(r.cloud_instance_host_name,this.authCodeRequest.correlationId),r.nonce=a||void 0,r.state=i,r.client_info)this.authCodeRequest.clientInfo=r.client_info;else{const l=this.checkCcsCredentials();l&&(this.authCodeRequest.ccsCredential=l)}const c=await this.authModule.acquireToken(this.authCodeRequest,r);return this.browserStorage.cleanRequestByState(t),c}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(_e.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class bO extends Yr{constructor(e,t,n,i,r,o,a,c,l,h){super(e,t,n,i,r,o,a,l,h),this.nativeStorage=c}async acquireToken(e){const t=await L(this.initializeAuthorizationRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,z.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const n=this.initializeServerTelemetryManager(Pe.acquireTokenRedirect),i=r=>{r.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(Y.RESTORE_FROM_BFCACHE,z.Redirect))};try{const r=await L(this.initializeAuthorizationCodeRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),o=await L(this.createAuthCodeClient.bind(this),_.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(n,t.authority,t.azureCloudOptions,t.account),a=new bg(o,this.browserStorage,r,this.logger,this.performanceClient),c=await o.getAuthCodeUrl({...t,nativeBroker:Bn.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),l=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${l}`),window.addEventListener("pageshow",i),await a.initiateAuthRequest(c,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:l,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(r){throw r instanceof Le&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),window.removeEventListener("pageshow",i),this.browserStorage.cleanRequestByState(t.state),r}}async handleRedirectPromise(e="",t){const n=this.initializeServerTelemetryManager(Pe.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[i,r]=this.getRedirectResponse(e||"");if(!i)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(z.Redirect),t.event.errorCode="no_server_response",null;const o=this.browserStorage.getTemporaryCache(_e.ORIGIN_URI,!0)||A.EMPTY_STRING,a=he.removeHashFromUrl(o),c=he.removeHashFromUrl(window.location.href);if(a===c&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),o.indexOf("#")>-1&&MP(o),await this.handleResponse(i,n);if(this.config.auth.navigateToLoginRequestUrl){if(!zd()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(_e.URL_HASH,r,!0);const l={apiId:Pe.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let h=!0;if(!o||o==="null"){const u=$P();this.browserStorage.setTemporaryCache(_e.ORIGIN_URI,u,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),h=await this.navigationClient.navigateInternal(u,l)}else this.logger.verbose(`Navigating to loginRequestUrl: ${o}`),h=await this.navigationClient.navigateInternal(o,l);if(!h)return await this.handleResponse(i,n)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(i,n);return null}catch(i){throw i instanceof Le&&(i.setCorrelationId(this.correlationId),n.cacheFailedRequest(i)),this.browserStorage.cleanRequestByInteractionType(z.Redirect),i}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===ra.QUERY?t=window.location.search:t=window.location.hash);let n=hc(t);if(n){try{yO(n,this.browserCrypto,z.Redirect)}catch(r){return r instanceof Le&&this.logger.error(`Interaction type validation failed due to ${r.errorCode}: ${r.errorMessage}`),[null,""]}return NP(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const i=this.browserStorage.getTemporaryCache(_e.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(_e.URL_HASH)),i&&(n=hc(i),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,i]):[null,""]}async handleResponse(e,t){const n=e.state;if(!n)throw K(Dd);const i=this.browserStorage.getCachedRequest(n);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw K(oa);const c=new Er(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Pe.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,i.correlationId),{userRequestState:l}=yn.parseRequestState(this.browserCrypto,n);return c.acquireToken({...i,state:l,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(n)})}const r=this.browserStorage.getCachedAuthority(n);if(!r)throw K(Bd);const o=await L(this.createAuthCodeClient.bind(this),_.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(t,r);return Nn.removeThrottle(this.browserStorage,this.config.auth.clientId,i),new bg(o,this.browserStorage,i,this.logger,this.performanceClient).handleCodeResponse(e,n)}async logout(e){var i,r;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(Pe.logout);try{this.eventHandler.emitEvent(Y.LOGOUT_START,z.Redirect,e),await this.clearCacheOnLogout(t.account);const o={apiId:Pe.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await L(this.createAuthCodeClient.bind(this),_.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(n,e&&e.authority,void 0,e&&e.account||void 0);if(a.authority.protocolMode===wi.OIDC)try{a.authority.endSessionEndpoint}catch{if((i=t.account)!=null&&i.homeAccountId){this.browserStorage.removeAccount((r=t.account)==null?void 0:r.homeAccountId),this.eventHandler.emitEvent(Y.LOGOUT_SUCCESS,z.Redirect,t);return}}const c=a.getLogoutUri(t);if(this.eventHandler.emitEvent(Y.LOGOUT_SUCCESS,z.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(c)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(c,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(c,o);return}}catch(o){throw o instanceof Le&&(o.setCorrelationId(this.correlationId),n.cacheFailedRequest(o)),this.eventHandler.emitEvent(Y.LOGOUT_FAILURE,z.Redirect,null,o),this.eventHandler.emitEvent(Y.LOGOUT_END,z.Redirect),o}this.eventHandler.emitEvent(Y.LOGOUT_END,z.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return he.getAbsoluteUrl(t,pi())}}/*! @azure/msal-browser v3.22.0 2024-08-28 */async function wO(s,e,t,n,i){if(e.addQueueMeasurement(_.SilentHandlerInitiateAuthRequest,n),!s)throw t.info("Navigate url is empty"),K(el);return i?L(SO,_.SilentHandlerLoadFrame,t,e,n)(s,i,e,n):Ws(AO,_.SilentHandlerLoadFrameSync,t,e,n)(s)}async function CO(s,e,t,n,i,r,o){return n.addQueueMeasurement(_.SilentHandlerMonitorIframeForHash,r),new Promise((a,c)=>{e<Yh&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Yh}ms). This may result in timeouts.`);const l=window.setTimeout(()=>{window.clearInterval(h),c(K(ob))},e),h=window.setInterval(()=>{let u="";const d=s.contentWindow;try{u=d?d.location.href:""}catch{}if(!u||u==="about:blank")return;let f="";d&&(o===ra.QUERY?f=d.location.search:f=d.location.hash),window.clearTimeout(l),window.clearInterval(h),a(f)},t)}).finally(()=>{Ws(TO,_.RemoveHiddenIframe,i,n,r)(s)})}function SO(s,e,t,n){return t.addQueueMeasurement(_.SilentHandlerLoadFrame,n),new Promise((i,r)=>{const o=Hb();window.setTimeout(()=>{if(!o){r("Unable to load iframe");return}o.src=s,i(o)},e)})}function AO(s){const e=Hb();return e.src=s,e}function Hb(){const s=document.createElement("iframe");return s.className="msalSilentIframe",s.style.visibility="hidden",s.style.position="absolute",s.style.width=s.style.height="0",s.style.border="0",s.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(s),s}function TO(s){document.body===s.parentNode&&document.body.removeChild(s)}/*! @azure/msal-browser v3.22.0 2024-08-28 */class IO extends Yr{constructor(e,t,n,i,r,o,a,c,l,h,u){super(e,t,n,i,r,o,c,h,u),this.apiId=a,this.nativeStorage=l}async acquireToken(e){this.performanceClient.addQueueMeasurement(_.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==it.NONE&&t.prompt!==it.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${it.NONE}`),t.prompt=it.NONE):t.prompt=it.NONE;const n=await L(this.initializeAuthorizationRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,z.Silent);Mb(n.authority);const i=this.initializeServerTelemetryManager(this.apiId);let r;try{return r=await L(this.createAuthCodeClient.bind(this),_.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)(i,n.authority,n.azureCloudOptions,n.account),await L(this.silentTokenHelper.bind(this),_.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(r,n)}catch(o){if(o instanceof Le&&(o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o)),!r||!(o instanceof Le)||o.errorCode!==Vt.INVALID_GRANT_ERROR)throw o;this.performanceClient.addFields({retryError:o.errorCode},this.correlationId);const a=await L(this.initializeAuthorizationRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,z.Silent);return await L(this.silentTokenHelper.bind(this),_.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(r,a)}}logout(){return Promise.reject(K(tl))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(_.SilentIframeClientTokenHelper,n);const i=await L(this.initializeAuthorizationCodeRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,n)(t),r=await L(e.getAuthCodeUrl.bind(e),_.GetAuthCodeUrl,this.logger,this.performanceClient,n)({...t,nativeBroker:Bn.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),o=new Qd(e,this.browserStorage,i,this.logger,this.performanceClient),a=await L(wO,_.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(r,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait),c=this.config.auth.OIDCOptions.serverResponseType,l=await L(CO,_.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,c),h=Ws(Bb,_.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,c,this.logger);if(h.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw K(oa);const u=new Er(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,h.accountId,this.browserStorage,n),{userRequestState:d}=yn.parseRequestState(this.browserCrypto,t.state);return L(u.acquireToken.bind(u),_.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,n)({...t,state:d,prompt:t.prompt||it.NONE})}return L(o.handleCodeResponse.bind(o),_.HandleCodeResponse,this.logger,this.performanceClient,n)(h,t)}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class kO extends Yr{async acquireToken(e){this.performanceClient.addQueueMeasurement(_.SilentRefreshClientAcquireToken,e.correlationId);const t=await L(Wd,_.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(Pe.acquireTokenSilent_silentFlow),r=await this.createRefreshTokenClient(i,n.authority,n.azureCloudOptions,n.account);return L(r.acquireTokenByRefreshToken.bind(r),_.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(o=>{throw o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o),o})}logout(){return Promise.reject(K(tl))}async createRefreshTokenClient(e,t,n,i){const r=await L(this.getClientConfiguration.bind(this),_.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,n,i);return new qh(r,this.performanceClient)}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class EO{constructor(e,t,n,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=i}loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw K(Hd);const i=t.id_token?Gs(t.id_token,Vn):void 0,r={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.authority?new gt(gt.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,r,this.logger,e.correlationId||Ii()):void 0,a=this.loadAccount(e,n.clientInfo||t.client_info||"",i,o),c=this.loadIdToken(t,a.homeAccountId,a.environment,a.realm),l=this.loadAccessToken(e,t,a.homeAccountId,a.environment,a.realm,n),h=this.loadRefreshToken(t,a.homeAccountId,a.environment);return this.generateAuthenticationResult(e,{account:a,idToken:c,accessToken:l,refreshToken:h},i,o)}loadAccount(e,t,n,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const c=et.createFromAccountInfo(e.account);return this.storage.setAccount(c),c}else if(!i||!t&&!n)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),K(gb);const r=et.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,n),o=n==null?void 0:n.tid,a=Md(this.storage,i,r,Vn,n,t,i.hostnameAndPort,o,void 0,void 0,this.logger);return this.storage.setAccount(a),a}loadIdToken(e,t,n,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const r=Jc(t,n,e.id_token,this.config.auth.clientId,i);return this.storage.setIdTokenCredential(r),r}loadAccessToken(e,t,n,i,r,o){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const a=t.scope?je.fromString(t.scope):new je(e.scopes),c=o.expiresOn||t.expires_in+new Date().getTime()/1e3,l=o.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,h=Xc(n,i,t.access_token,this.config.auth.clientId,r,a.printScopes(),c,l,Vn);return this.storage.setAccessTokenCredential(h),h}loadRefreshToken(e,t,n){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=H_(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(i),i}generateAuthenticationResult(e,t,n,i){var h,u,d;let r="",o=[],a=null,c;t!=null&&t.accessToken&&(r=t.accessToken.secret,o=je.fromString(t.accessToken.target).asArray(),a=new Date(Number(t.accessToken.expiresOn)*1e3),c=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const l=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:o,account:l.getAccountInfo(),idToken:((h=t.idToken)==null?void 0:h.secret)||"",idTokenClaims:n||{},accessToken:r,fromCache:!0,expiresOn:a,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:((u=t.refreshToken)==null?void 0:u.familyId)||"",tokenType:((d=t==null?void 0:t.accessToken)==null?void 0:d.tokenType)||"",state:e.state||"",cloudGraphHostName:l.cloudGraphHostName||"",msGraphHost:l.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class RO extends W_{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v3.22.0 2024-08-28 */class PO extends Yr{constructor(e,t,n,i,r,o,a,c,l,h){super(e,t,n,i,r,o,c,l,h),this.apiId=a}async acquireToken(e){if(!e.code)throw K(mb);const t=await L(this.initializeAuthorizationRequest.bind(this),_.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,z.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},r=await L(this.getClientConfiguration.bind(this),_.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)(n,t.authority,t.azureCloudOptions,t.account),o=new RO(r);this.logger.verbose("Auth code client created");const a=new Qd(o,this.browserStorage,i,this.logger,this.performanceClient);return await L(a.handleCodeResponseFromServer.bind(a),_.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof Le&&(i.setCorrelationId(this.correlationId),n.cacheFailedRequest(i)),i}}logout(){return Promise.reject(K(tl))}}/*! @azure/msal-browser v3.22.0 2024-08-28 */function En(s){const e=s==null?void 0:s.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function Ta(s,e){try{qd(s)}catch(t){throw e.end({success:!1},t),t}}class sl{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Ur(this.logger,this.performanceClient):dc,this.eventHandler=new iO(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new Xh(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,iR(this.config.auth),this.performanceClient):QP(this.config.auth.clientId,this.logger);const t={cacheLocation:Ze.MemoryStorage,temporaryCacheLocation:Ze.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Xh(this.config.auth.clientId,t,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new EO(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new sl(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}const t=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),n=this.config.system.allowNativeBroker,i=this.performanceClient.startMeasurement(_.InitializeClientApplication,t);if(this.eventHandler.emitEvent(Y.INITIALIZE_START),n)try{this.nativeExtensionProvider=await Bn.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(r){this.logger.verbose(r)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await L(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),_.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.initialized=!0,this.eventHandler.emitEvent(Y.INITIALIZE_END),i.end({allowNativeBroker:n,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Nb(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return typeof n>"u"?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),n=this.browserStorage.getCachedNativeRequest(),i=n&&Bn.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,r=i?n==null?void 0:n.correlationId:this.browserStorage.getTemporaryCache(_e.CORRELATION_ID,!0)||"",o=this.performanceClient.startMeasurement(_.AcquireTokenRedirect,r);this.eventHandler.emitEvent(Y.HANDLE_REDIRECT_START,z.Redirect);let a;if(i&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const c=new Er(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Pe.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,n.accountId,this.nativeInternalStorage,n.correlationId);a=L(c.handleRedirectPromise.bind(c),_.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,o.event.correlationId)(this.performanceClient,o.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const c=this.createRedirectClient(r);a=L(c.handleRedirectPromise.bind(c),_.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,o.event.correlationId)(e,o)}return a.then(c=>(c?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(Y.LOGIN_SUCCESS,z.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_SUCCESS,z.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),o.end({success:!0,accountType:En(c.account)})):o.event.errorCode?o.end({success:!1}):o.discard(),this.eventHandler.emitEvent(Y.HANDLE_REDIRECT_END,z.Redirect),c)).catch(c=>{const l=c;throw t.length>0?this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_FAILURE,z.Redirect,null,l):this.eventHandler.emitEvent(Y.LOGIN_FAILURE,z.Redirect,null,l),this.eventHandler.emitEvent(Y.HANDLE_REDIRECT_END,z.Redirect),o.end({success:!1},l),c})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const n=this.performanceClient.startMeasurement(_.AcquireTokenPreRedirect,t);n.add({accountType:En(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=o=>{const a=typeof i=="function"?i(o):void 0;return a!==!1?n.end({success:!0}):n.discard(),a};else{const o=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=a=>{const c=typeof o=="function"?o(a):void 0;return c!==!1?n.end({success:!0}):n.discard(),c}}const r=this.getAllAccounts().length>0;try{vg(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),r?this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_START,z.Redirect,e):this.eventHandler.emitEvent(Y.LOGIN_START,z.Redirect,e);let o;return this.nativeExtensionProvider&&this.canUseNative(e)?o=new Er(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Pe.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(c=>{if(c instanceof Mn&&lr(c))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(c instanceof tn)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),c}):o=this.createRedirectClient(t).acquireToken(e),await o}catch(o){throw n.end({success:!1},o),r?this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_FAILURE,z.Redirect,null,o):this.eventHandler.emitEvent(Y.LOGIN_FAILURE,z.Redirect,null,o),o}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(_.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId,accountType:En(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Ta(this.initialized,n),this.browserStorage.setInteractionInProgress(!0)}catch(o){return Promise.reject(o)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_START,z.Popup,e):this.eventHandler.emitEvent(Y.LOGIN_START,z.Popup,e);let r;return this.canUseNative(e)?r=this.acquireTokenNative({...e,correlationId:t},Pe.acquireTokenPopup).then(o=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,requestId:o.requestId,accountType:En(o.account)}),o)).catch(o=>{if(o instanceof Mn&&lr(o))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(o instanceof tn)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),o}):r=this.createPopupClient(t).acquireToken(e),r.then(o=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(Y.LOGIN_SUCCESS,z.Popup,o):this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_SUCCESS,z.Popup,o),n.end({success:!0,requestId:o.requestId,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length,accountType:En(o.account)}),o)).catch(o=>(i.length>0?this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_FAILURE,z.Popup,null,o):this.eventHandler.emitEvent(Y.LOGIN_FAILURE,z.Popup,null,o),n.end({success:!1},o),Promise.reject(o)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var r,o;const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(_.SsoSilent,t),(r=this.ssoSilentMeasurement)==null||r.add({scenarioId:e.scenarioId,accountType:En(e.account)}),Ta(this.initialized,this.ssoSilentMeasurement),(o=this.ssoSilentMeasurement)==null||o.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(Y.SSO_SILENT_START,z.Silent,n);let i;return this.canUseNative(n)?i=this.acquireTokenNative(n,Pe.ssoSilent).catch(a=>{if(a instanceof Mn&&lr(a))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw a}):i=this.createSilentIframeClient(n.correlationId).acquireToken(n),i.then(a=>{var c;return this.eventHandler.emitEvent(Y.SSO_SILENT_SUCCESS,z.Silent,a),(c=this.ssoSilentMeasurement)==null||c.end({success:!0,isNativeBroker:a.fromNativeBroker,requestId:a.requestId,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:En(a.account)}),a}).catch(a=>{var c;throw this.eventHandler.emitEvent(Y.SSO_SILENT_FAILURE,z.Silent,null,a),(c=this.ssoSilentMeasurement)==null||c.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const n=this.performanceClient.startMeasurement(_.AcquireTokenByCode,t);Ta(this.initialized,n),this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_BY_CODE_START,z.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw K(yb);if(e.code){const i=e.code;let r=this.hybridAuthCodeResponses.get(i);return r?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),r=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(o=>(this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_BY_CODE_SUCCESS,z.Silent,o),this.hybridAuthCodeResponses.delete(i),n.end({success:!0,isNativeBroker:o.fromNativeBroker,requestId:o.requestId,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length,accountType:En(o.account)}),o)).catch(o=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_BY_CODE_FAILURE,z.Silent,null,o),n.end({success:!1},o),o}),this.hybridAuthCodeResponses.set(i,r)),await r}else if(e.nativeAccountId)if(this.canUseNative(e,e.nativeAccountId)){const i=await this.acquireTokenNative({...e,correlationId:t},Pe.acquireTokenByCode,e.nativeAccountId).catch(r=>{throw r instanceof Mn&&lr(r)&&(this.nativeExtensionProvider=void 0),r});return n.end({accountType:En(i.account),success:!0}),i}else throw K(_b);else throw K(vb)}catch(i){throw this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_BY_CODE_FAILURE,z.Silent,null,i),n.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){var i;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(_.AcquireTokenByCodeAsync,e.correlationId),(i=this.acquireTokenByCodeAsyncMeasurement)==null||i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(r=>{var o;return(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!0,fromCache:r.fromCache,isNativeBroker:r.fromNativeBroker,requestId:r.requestId}),r}).catch(r=>{var o;throw(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!1},r),r}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(_.AcquireTokenFromCache,e.correlationId),t){case Ht.Default:case Ht.AccessToken:case Ht.AccessTokenAndRefreshToken:const n=this.createSilentCacheClient(e.correlationId);return L(n.acquireToken.bind(n),_.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw M(fi)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(_.AcquireTokenByRefreshToken,e.correlationId),t){case Ht.Default:case Ht.AccessTokenAndRefreshToken:case Ht.RefreshToken:case Ht.RefreshTokenAndNetwork:const n=this.createSilentRefreshClient(e.correlationId);return L(n.acquireToken.bind(n),_.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw M(fi)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(_.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return L(t.acquireToken.bind(t),_.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return vg(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return qd(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return YP(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return JP(e,this.logger,this.browserStorage)}getAccountByUsername(e){return XP(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return ZP(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return eO(e,this.logger,this.browserStorage)}setActiveAccount(e){tO(e,this.browserStorage)}getActiveAccount(){return nO(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=et.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(n),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw K(oa);return new Er(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!Bn.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case it.NONE:case it.CONSENT:case it.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new _O(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new bO(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new IO(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Pe.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Db(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new kO(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new PO(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Pe.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.eventHandler.enableAccountStorageEvents()}disableAccountStorageEvents(){this.eventHandler.disableAccountStorageEvents()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getEventHandler(){return this.eventHandler}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?Ii():A.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||pg})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||pg})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(_.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Ta(this.initialized,n),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw K(hb);n.add({accountType:En(i)});const r={clientId:this.config.auth.clientId,authority:e.authority||A.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:i.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},o=JSON.stringify(r),a=this.activeSilentTokenRequests.get(o);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const c=L(this.acquireTokenSilentAsync.bind(this),_.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},i).then(l=>(this.activeSilentTokenRequests.delete(o),n.end({success:!0,fromCache:l.fromCache,isNativeBroker:l.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:l.requestId,accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length}),l)).catch(l=>{throw this.activeSilentTokenRequests.delete(o),n.end({success:!1},l),l});return this.activeSilentTokenRequests.set(o,c),{...await c,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.discard(),{...await a,state:e.state}}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(_.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_START,z.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const i=await L(cO,_.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),r=e.cacheLookupPolicy||Ht.Default;return this.acquireTokenSilentNoIframe(i,r).catch(async a=>{if(OO(a,r))if(this.activeIframeRequest)if(r!==Ht.Skip){const[l,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,i.correlationId);const u=this.performanceClient.startMeasurement(_.AwaitConcurrentIframe,i.correlationId);u.add({awaitIframeCorrelationId:h});const d=await l;if(u.end({success:d}),d)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,r);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),a}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),L(this.acquireTokenBySilentIframe.bind(this),_.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);else{let l;return this.activeIframeRequest=[new Promise(h=>{l=h}),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),L(this.acquireTokenBySilentIframe.bind(this),_.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then(h=>(l(!0),h)).catch(h=>{throw l(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_SUCCESS,z.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromNativeBroker,requestId:a.requestId},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_FAILURE,z.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return Bn.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,Pe.acquireTokenSilent_silentFlow).catch(async n=>{throw n instanceof Mn&&lr(n)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,M(fi)):n})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),L(this.acquireTokenFromCache.bind(this),_.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===Ht.AccessToken)throw n;return this.eventHandler.emitEvent(Y.ACQUIRE_TOKEN_NETWORK_START,z.Silent,e),L(this.acquireTokenByRefreshToken.bind(this),_.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}}function OO(s,e){const t=!(s instanceof tn&&s.subError!==Zc),n=s.errorCode===Vt.INVALID_GRANT_ERROR||s.errorCode===fi,i=t&&n||s.errorCode===gc||s.errorCode===Nd,r=wP.includes(e);return i&&r}/*! @azure/msal-browser v3.22.0 2024-08-28 */async function NO(s,e){const t=new Ks(s);return await t.initialize(),sl.createController(t,e)}/*! @azure/msal-browser v3.22.0 2024-08-28 */class Yd{static async createPublicClientApplication(e){const t=await NO(e);return new Yd(e,t)}constructor(e,t){this.controller=t||new sl(new Ks(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e){return this.controller.addEventCallback(e)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const eu={auth:{clientId:"8a7511ff-946f-4c01-9366-190957ad8edb",redirectUri:"http://localhost:1420/about-page"},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(s,e,t)=>{if(!t)switch(s){case Ee.Error:console.error(e);return;case Ee.Warning:console.warn(e);return}}}}},MO={scopes:["User.Read"]},xO={scopes:["User.Read"],prompt:"select_account"},Ub={scopes:["User.Read"]},Ia={scopes:["User.Read","Mail.ReadWrite","Mail.Send","MailboxSettings.ReadWrite","Calendars.Read"],forceRefresh:!1},mt=new Yd(eu);class Fr{static selectAccount(){const e=mt.getAllAccounts();if(e.length===0){this.ssoSilent();return}else if(e.length===1)this.setAccount(e[0]);else if(e.length>1){console.warn("Multiple accounts detected.");let t=mt.getActiveAccount();t?(console.log("active:"),console.log(t),this.setAccount(t)):this.setAccount(e[0])}}static setAccount(e){mt.setActiveAccount(e),sessionStorage.setItem("account",JSON.stringify(e)),this.callbackOnSignin(e)}static async ssoSilent(){console.log("ssoSilent:");try{let e=await mt.ssoSilent(MO);console.log(e),this.handleResponse(e)}catch{this.signIn()}}static async signIn(){console.log("signin previous account:");try{let e=await mt.acquireTokenPopup(Ub);console.log(e),this.handleResponse(e)}catch{this.signInNewAccount()}}static async signInNewAccount(){console.log("signin new account:");let e=await mt.acquireTokenPopup(xO);console.log(e),this.handleResponse(e)}static handleResponse(e){console.log("handleResponse"),console.log(e),e!==null?this.setAccount(e.account):this.selectAccount()}static signOut(){const e={account:mt.getActiveAccount(),postLogoutRedirectUri:eu.auth.redirectUri,mainWindowRedirectUri:eu.auth.redirectUri};mt.logoutPopup(e)}}G(Fr,"callbackOnSignin");const La={graphMeEndpoint:"https://graph.microsoft.com/v1.0/me",graphMailEndpoint:"https://graph.microsoft.com/v1.0/me/messages",graphMailFoldersEndpoint:"https://graph.microsoft.com/v1.0/me/mailFolders"};class ao{static async callMSGraph(e,t,n){const i=new Headers,r=`Bearer ${t}`;i.append("Authorization",r);const o={method:"GET",headers:i};console.log("request made to Graph API at: "+new Date().toString());let c=await(await fetch(e,o)).json();console.log(c),n(c)}static async getEmails(e,t,n=10,i=0){const r=new Headers,o=`Bearer ${e}`;r.append("Authorization",o);const a={method:"GET",headers:r};let c=n,l=i*n;console.log("get emails {%d, %d}",n,i);let h=La.graphMailEndpoint+`?top=${c}&skip=${l}`,d=await(await fetch(h,a)).json();t(d)}static async updateEmail(e,t){const n=new Headers,i=`Bearer ${e}`;n.append("Authorization",i),n.append("Content-Type","application/json");let r={isRead:t.isRead};const o={method:"PATCH",headers:n,body:JSON.stringify(r)};let a=t.id,c=La.graphMailEndpoint+`/${a}`;await fetch(c,o)}static async batchUpdateMails(){}static async getFolders(e,t){const n=new Headers,i=`Bearer ${e}`;n.append("Authorization",i);const r={method:"GET",headers:n};console.log("get folders");let a=await(await fetch(La.graphMailFoldersEndpoint,r)).json();t(a)}}class Xt{static async seeProfile(e){let t=await Xt.getTokenPopup(Ub);t&&await ao.callMSGraph(La.graphMeEndpoint,t==null?void 0:t.accessToken,e)}static async getEmail(e){let t=await Xt.getTokenPopup(Ia);t&&await ao.getEmails(t==null?void 0:t.accessToken,e,10,0)}static async getMailPage(e,t){let n=await Xt.getTokenPopup(Ia);n&&await ao.getEmails(n.accessToken,e,10,t)}static async updateEmailRead(e){try{let t=await Xt.getTokenPopup(Ia);if(!t)return;await ao.updateEmail(t.accessToken,e)}catch(t){console.log("MsAccess.updateEmailRead error:"),console.log(t)}}static async seeFolders(e){let t=await Xt.getTokenPopup(Ia);t&&await ao.getFolders(t.accessToken,e)}static async getTokenPopup(e){let t=mt.getActiveAccount();if(!t){let n=sessionStorage.getItem("account");if(!n||(t=JSON.parse(n),!t))return}return mt.setActiveAccount(t),e.account=t,mt.acquireTokenSilent(e).catch(n=>{if(console.warn("silent token acquisition fails. acquiring token using popup"),n instanceof tn)return mt.acquireTokenPopup(e).then(i=>(console.log(i),i)).catch(i=>{console.error(i)});console.warn(n)})}}var $O=Object.create,Jd=Object.defineProperty,LO=Object.getOwnPropertyDescriptor,DO=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),Fb=s=>{throw TypeError(s)},BO=(s,e,t)=>e in s?Jd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,HO=(s,e)=>Jd(s,"name",{value:e,configurable:!0}),UO=s=>[,,,$O(null)],FO=["class","method","getter","setter","accessor","field","value","get","set"],Kb=s=>s!==void 0&&typeof s!="function"?Fb("Function expected"):s,KO=(s,e,t,n,i)=>({kind:FO[s],name:e,metadata:n,addInitializer:r=>t._?Fb("Already initialized"):i.push(Kb(r||null))}),VO=(s,e)=>BO(e,DO("metadata"),s[3]),jO=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},zO=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&LO(i,t));HO(i,t);for(var p=n.length-1;p>=0;p--)c=KO(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Kb(o)&&(i=o);return VO(s,i),f&&Jd(i,t,f),h?l^4?r:f:i},Vb,Xd;const jb={weekday:"long",day:"2-digit"},zb={month:"long"},ql=24*60*60*1e3;Vb=[wn(m0),nn(Yn)];class bc{constructor(e){G(this,"pinnedMailIds",new Set);G(this,"allEmails",new Map);G(this,"todaysMails",[]);G(this,"yesterdaysMails",[]);G(this,"weeksMails",[]);G(this,"monthMails",[]);G(this,"laterMails",[]);G(this,"filteredMails",[]);G(this,"inputSearchValue","");G(this,"page",0);G(this,"fetchedOnce",!1);G(this,"now",new Date);this.ea=e,this.loadPins(),this.ea.subscribe(ve.AccountSelect,t=>this.onSelectAccount(t)),this.fetchedOnce||Xt.getEmail(t=>this.onFetchEmails(t)),this.ea.subscribe(ve.EmailPinAdd,t=>this.onPinAdd(t)),this.ea.subscribe(ve.EmailPinRemove,t=>this.onPinRemove(t))}readPage(){Xt.getMailPage(e=>{this.push(e.value)},this.page++)}get thisDayHeader(){return"Aujourd'hui ("+this.now.toLocaleString(void 0,jb)+")"}get thisYesterdayHeader(){return"Hier"}get thisWeekHeader(){return"Cette semaine"}get thisMonthHeader(){return"Ce mois ("+this.now.toLocaleString(void 0,zb)+")"}get thisLaterHeader(){return"Plus tard"}loadPins(){this.pinnedMailIds=new Set;let e=sessionStorage.getItem("pins");if(e)try{let t=JSON.parse(e);for(let n of t)this.pinnedMailIds.add(n)}catch{console.warn("invalid pins value in storage")}}savePins(){sessionStorage.setItem("pins",JSON.stringify([...this.pinnedMailIds]))}get pinnedMails(){return[...this.pinnedMailIds].map(e=>this.allEmails.get(e))}onPinAdd(e){this.pinnedMailIds.add(e.id),this.savePins()}onPinRemove(e){this.pinnedMailIds.delete(e.id),this.savePins()}async onSelectAccount(e){this.fetchedOnce=!0,await Xt.getEmail(t=>this.onFetchEmails(t))}onFetchEmails(e){let t=e.value;this.set(t),this.page++,this.readPage()}async onClickRefresh(){await Xt.getEmail(e=>this.onFetchEmails(e))}onClickNext(){this.readPage(),this.readPage()}onClickNewMessage(){this.ea.publish(ve.EmailNew)}onClickSearch(){var t,n,i,r,o,a,c,l;if(this.filteredMails=[],!this.inputSearchValue)return;let e=this.inputSearchValue.toLowerCase();for(let h of this.allEmails.values())((t=h.subject)!=null&&t.toLowerCase().includes(e)||(r=(i=(n=h.sender)==null?void 0:n.emailAddress)==null?void 0:i.address)!=null&&r.toLowerCase().includes(e)||(c=(a=(o=h.sender)==null?void 0:o.emailAddress)==null?void 0:a.name)!=null&&c.toLowerCase().includes(e)||(l=h.bodyPreview)!=null&&l.toLowerCase().includes(e))&&this.filteredMails.push(h)}onInputSearchType(){this.onClickSearch()}clear(){this.allEmails.clear(),this.todaysMails=[],this.yesterdaysMails=[],this.weeksMails=[],this.weeksMails=[]}set(e){this.clear(),this.push(e)}push(e){this.sort(e)}sort(e){for(let t of e){if(this.allEmails.has(t.id))continue;this.allEmails.set(t.id,t),this.pinnedMailIds.has(t.id)&&Object.defineProperty(t,"isPinned",{value:!0});let n=new Date(t.sentDateTime),i=this.now.getTime()-n.getTime();i<1*ql?this.todaysMails.push(t):i<2*ql?this.yesterdaysMails.push(t):i<7*ql?this.weeksMails.push(t):n.getMonth()==this.now.getMonth()?this.monthMails.push(t):this.laterMails.push(t)}}delete(e){throw new Error("Function not implemented.")}}Xd=UO();bc=zO(Xd,0,"EmailList",Vb,bc);jO(Xd,1,bc);const qO=Object.freeze(Object.defineProperty({__proto__:null,get EmailList(){return bc},thisDayFormat:jb,thisMonthFormat:zb},Symbol.toStringTag,{value:"Module"})),qb="email",tu=`
<!-- Read-only email -->
<div if.bind="mail && !isEditable" class="email">
  <div class="email_header">
    <div class="close_btn" click.trigger="onInputClose()"><i class="bi bi-x-circle"></i></div> \${mail.from.emailAddress.name} \\<\${mail.from.emailAddress.address}\\>
  </div>

  <!-- <div class="content" innerhtml.bind="html"></div> -->
  <iframe class="content" srcdoc.bind="html"></iframe>
</div>

<!-- Edit email -->
<div if.bind="mail && isEditable" class="editor">

  <div>
    <button class="btn btn-primary" id="btnSend" click.trigger="onClickSend()">
      Envoyer
    </button>
    De: \${currentAccountAddress}
  </div>
  <div>
    : \${sendToAddresses}
  </div>
  <div>
    \${subject}
  </div>


</div>
`,Gb=[],Wb={};let Gl;function GO(s){Gl||(Gl=oe.define({name:qb,template:tu,dependencies:Gb,bindables:Wb})),s.register(Gl)}const WO=Object.freeze(Object.defineProperty({__proto__:null,bindables:Wb,default:tu,dependencies:Gb,name:qb,register:GO,template:tu},Symbol.toStringTag,{value:"Module"}));var QO=Object.create,Zd=Object.defineProperty,YO=Object.getOwnPropertyDescriptor,JO=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),Qb=s=>{throw TypeError(s)},XO=(s,e,t)=>e in s?Zd(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ZO=(s,e)=>Zd(s,"name",{value:e,configurable:!0}),eN=s=>[,,,QO(null)],tN=["class","method","getter","setter","accessor","field","value","get","set"],Yb=s=>s!==void 0&&typeof s!="function"?Qb("Function expected"):s,nN=(s,e,t,n,i)=>({kind:tN[s],name:e,metadata:n,addInitializer:r=>t._?Qb("Already initialized"):i.push(Yb(r||null))}),iN=(s,e)=>XO(e,JO("metadata"),s[3]),sN=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},rN=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&YO(i,t));ZO(i,t);for(var p=n.length-1;p>=0;p--)c=nN(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Yb(o)&&(i=o);return iN(s,i),f&&Zd(i,t,f),h?l^4?r:f:i},Jb,ef;Jb=[wn(WO),nn(Yn)];class wc{constructor(e){G(this,"mail");G(this,"html");G(this,"isEditable",!1);this.ea=e,this.ea.subscribe(ve.EmailClose,()=>this.onEmailClose()),this.ea.subscribe(ve.EmailRead,t=>this.onEmailRead(t)),this.ea.subscribe(ve.EmailNew,()=>this.onEmailNew())}onEmailClose(){this.mail=void 0,this.html=void 0,this.isEditable=!1}onEmailRead(e){var t;if(this.mail=e,this.mail){this.mail.isRead||(this.mail.isRead=!0,Xt.updateEmailRead(this.mail));const i=new DOMParser().parseFromString(((t=this.mail.body)==null?void 0:t.content)??"","text/html");this.html=i.documentElement.innerHTML}else this.onEmailClose()}onEmailNew(){this.mail={},this.isEditable=!0}onInputClose(){this.ea.publish(ve.EmailClose)}get currentAccountAddress(){var e;return(e=mt.getActiveAccount())==null?void 0:e.username}get sendToAddresses(){return"google@ens.etsmtl.ca"}get subject(){return"My email title"}onClickSend(){}}ef=eN();wc=rN(ef,0,"Email",Jb,wc);sN(ef,1,wc);const oN=Object.freeze(Object.defineProperty({__proto__:null,get Email(){return wc}},Symbol.toStringTag,{value:"Module"})),Xb="account-list",nu=`

<!-- Title -->
<div class="accounts-title">
  <i class="bi bi-person"></i> Accounts <button class="btn btn-primary wave-teal" click.trigger="onClickSignin()">+</button>
</div>

<!-- Accounts -->
<div class="accounts">

  <div repeat.for="account of accounts" class="waves-effect waves-teal btn-account" click.trigger="onClickAccount(account)" style.bind="accountsStyles[$index]">
    \${account.name}
    <br>
    \${account.username}
  </div>

</div>
`,Zb=[],ew={};let Wl;function aN(s){Wl||(Wl=oe.define({name:Xb,template:nu,dependencies:Zb,bindables:ew})),s.register(Wl)}const cN=Object.freeze(Object.defineProperty({__proto__:null,bindables:ew,default:nu,dependencies:Zb,name:Xb,register:aN,template:nu},Symbol.toStringTag,{value:"Module"}));var lN=Object.create,tf=Object.defineProperty,hN=Object.getOwnPropertyDescriptor,uN=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),tw=s=>{throw TypeError(s)},dN=(s,e,t)=>e in s?tf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fN=(s,e)=>tf(s,"name",{value:e,configurable:!0}),pN=s=>[,,,lN(null)],gN=["class","method","getter","setter","accessor","field","value","get","set"],nw=s=>s!==void 0&&typeof s!="function"?tw("Function expected"):s,mN=(s,e,t,n,i)=>({kind:gN[s],name:e,metadata:n,addInitializer:r=>t._?tw("Already initialized"):i.push(nw(r||null))}),vN=(s,e)=>dN(e,uN("metadata"),s[3]),yN=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},_N=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&hN(i,t));fN(i,t);for(var p=n.length-1;p>=0;p--)c=mN(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,nw(o)&&(i=o);return vN(s,i),f&&tf(i,t,f),h?l^4?r:f:i},iw,nf;iw=[wn(cN),nn(Yn)];class Cc{constructor(e){G(this,"accounts",[]);G(this,"accountsStyles",[]);this.ea=e,this.ea.subscribe(ve.AccountsRefresh,t=>{this.accounts=mt.getAllAccounts(),this.refreshStyles()})}refreshStyles(){this.accountsStyles=this.accounts.map(e=>this.isActiveAccount(e)?"color: #00aeff;":"")}get activeAccount(){return mt.getActiveAccount()}onClickAccount(e){this.isActiveAccount(e)||Fr.setAccount(e)}async onClickSignin(){await Fr.signInNewAccount()}isActiveAccount(e){var t;return((t=this.activeAccount)==null?void 0:t.homeAccountId)===e.homeAccountId}}nf=pN();Cc=_N(nf,0,"AccountList",iw,Cc);yN(nf,1,Cc);const sw=Object.freeze(Object.defineProperty({__proto__:null,get AccountList(){return Cc}},Symbol.toStringTag,{value:"Module"})),rw="box-list",iu=`<!-- Title -->
<div class="folders-title">
  <i class="bi bi-folder"></i> Folders
</div>

<!-- Folders -->
<div class="folders">

  <div repeat.for="box of boxes" class="waves-effect waves-teal btn-folder" if.bind="!box.isHidden">
    \${box.displayName} (\${box.unreadItemCount})
  </div>
  
</div>
`,ow=[],aw={};let Ql;function bN(s){Ql||(Ql=oe.define({name:rw,template:iu,dependencies:ow,bindables:aw})),s.register(Ql)}const wN=Object.freeze(Object.defineProperty({__proto__:null,bindables:aw,default:iu,dependencies:ow,name:rw,register:bN,template:iu},Symbol.toStringTag,{value:"Module"}));var CN=Object.create,sf=Object.defineProperty,SN=Object.getOwnPropertyDescriptor,AN=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),cw=s=>{throw TypeError(s)},TN=(s,e,t)=>e in s?sf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,IN=(s,e)=>sf(s,"name",{value:e,configurable:!0}),kN=s=>[,,,CN(null)],EN=["class","method","getter","setter","accessor","field","value","get","set"],lw=s=>s!==void 0&&typeof s!="function"?cw("Function expected"):s,RN=(s,e,t,n,i)=>({kind:EN[s],name:e,metadata:n,addInitializer:r=>t._?cw("Already initialized"):i.push(lw(r||null))}),PN=(s,e)=>TN(e,AN("metadata"),s[3]),ON=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},NN=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&SN(i,t));IN(i,t);for(var p=n.length-1;p>=0;p--)c=RN(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,lw(o)&&(i=o);return PN(s,i),f&&sf(i,t,f),h?l^4?r:f:i},hw,rf;hw=[wn(wN),nn(Yn)];class Sc{constructor(e){G(this,"boxes",[]);this.ea=e,this.ea.subscribe(ve.AccountSelect,t=>this.onSelectAccount(t))}async onSelectAccount(e){await Xt.seeFolders(t=>{this.boxes=t.value,this.boxes.sort((n,i)=>!n.totalItemCount&&!n.totalItemCount?0:n.totalItemCount?i.totalItemCount?n.totalItemCount<i.totalItemCount?1:n.totalItemCount>i.totalItemCount?-1:0:-1:1)})}onClickCreateFolder(e){throw new Error("Function not implemented.")}onClickSelectFolder(e){throw new Error("Function not implemented.")}}rf=kN();Sc=NN(rf,0,"BoxList",hw,Sc);ON(rf,1,Sc);const uw=Object.freeze(Object.defineProperty({__proto__:null,get BoxList(){return Sc}},Symbol.toStringTag,{value:"Module"})),dw="main-page",su=`




<div class="content" id="content" ref="container" mousemove.trigger="onMouseMoveDivider($event)">

  <!-- email list -->
  <div class="col-emails" ref="col1">
    <!-- <button class="btn btn-primary wave-teal" click.trigger="onClickSignout()">Signout</button> -->
    <email-list></email-list>
  </div>

  <!-- divider -->
  <div class="divider" mousedown.trigger="onMouseDownDivider($event)" mouseup.trigger="onMouseUpDivider($event)" click.trigger="onClickDivider($event)"></div>

  <!-- email viewport -->
  <div class="col-email" ref="col2">
    <email></email>
  </div>

</div>
`,fw=[qO,oN,sw,uw],pw={};let Yl;function MN(s){Yl||(Yl=oe.define({name:dw,template:su,dependencies:fw,bindables:pw})),s.register(Yl)}const xN=Object.freeze(Object.defineProperty({__proto__:null,bindables:pw,default:su,dependencies:fw,name:dw,register:MN,template:su},Symbol.toStringTag,{value:"Module"}));var $N=Object.create,of=Object.defineProperty,LN=Object.getOwnPropertyDescriptor,DN=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),gw=s=>{throw TypeError(s)},BN=(s,e,t)=>e in s?of(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,HN=(s,e)=>of(s,"name",{value:e,configurable:!0}),UN=s=>[,,,$N(null)],FN=["class","method","getter","setter","accessor","field","value","get","set"],mw=s=>s!==void 0&&typeof s!="function"?gw("Function expected"):s,KN=(s,e,t,n,i)=>({kind:FN[s],name:e,metadata:n,addInitializer:r=>t._?gw("Already initialized"):i.push(mw(r||null))}),VN=(s,e)=>BN(e,DN("metadata"),s[3]),jN=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},zN=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&LN(i,t));HN(i,t);for(var p=n.length-1;p>=0;p--)c=KN(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,mw(o)&&(i=o);return VN(s,i),f&&of(i,t,f),h?l^4?r:f:i},vw,af;vw=[wn(xN),nn(Yn)];var Hn;let Ac=(Hn=class{constructor(e){G(this,"isDividerDragging",!1);G(this,"container");G(this,"col1");G(this,"col2");this.ea=e}async attached(){this.loadDivider()}onClickSignout(){Fr.signOut(),this.ea.publish(ve.AccountsRefresh)}loadDivider(){let e=sessionStorage.getItem("email-divider")??Hn.defaultDivider.toString(),t=parseFloat(e),n=1-t;this.col1&&this.col2&&(this.col1.style.flex=t.toString(),this.col2.style.flex=n.toString())}onMouseDownDivider(e){this.isDividerDragging=!0,document.body.style.cursor="col-resize"}onMouseUpDivider(e){this.isDividerDragging=!1,document.body.style.cursor="default"}onClickDivider(e){e.detail===2&&this.col1&&this.col2&&(this.col1.style.flex=Hn.defaultDivider.toString(),this.col2.style.flex=(1-Hn.defaultDivider).toString(),sessionStorage.setItem("email-divider",Hn.defaultDivider.toString()))}onMouseMoveDivider(e){var r;if(!this.isDividerDragging)return;const t=(r=this.container)==null?void 0:r.getBoundingClientRect(),n=(e.clientX-t.x)/t.width,i=1-n;this.col1&&this.col2&&(this.col1.style.flex=n.toString(),this.col2.style.flex=i.toString(),sessionStorage.setItem("email-divider",n.toString()))}},G(Hn,"defaultDivider",.35),Hn);af=UN();Ac=zN(af,0,"MainPage",vw,Ac);jN(af,1,Ac);let qN=Ac;const GN=Object.freeze(Object.defineProperty({__proto__:null,MainPage:qN},Symbol.toStringTag,{value:"Module"})),yw="tool-bar",ru=`<div class="btn-tool" load="main-page">
  <i class="bi bi-envelope"></i>
</div>
<div class="btn-tool" load="main-page">
  <i class="bi bi-calendar"></i>
</div>
<div class="btn-tool" load="settings-page">
  <i class="bi bi-gear"></i>
</div>
`,_w=[],bw={};let Jl;function WN(s){Jl||(Jl=oe.define({name:yw,template:ru,dependencies:_w,bindables:bw})),s.register(Jl)}const QN=Object.freeze(Object.defineProperty({__proto__:null,bindables:bw,default:ru,dependencies:_w,name:yw,register:WN,template:ru},Symbol.toStringTag,{value:"Module"}));var YN=Object.create,cf=Object.defineProperty,JN=Object.getOwnPropertyDescriptor,XN=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),ww=s=>{throw TypeError(s)},ZN=(s,e,t)=>e in s?cf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,eM=(s,e)=>cf(s,"name",{value:e,configurable:!0}),tM=s=>[,,,YN(null)],nM=["class","method","getter","setter","accessor","field","value","get","set"],Cw=s=>s!==void 0&&typeof s!="function"?ww("Function expected"):s,iM=(s,e,t,n,i)=>({kind:nM[s],name:e,metadata:n,addInitializer:r=>t._?ww("Already initialized"):i.push(Cw(r||null))}),sM=(s,e)=>ZN(e,XN("metadata"),s[3]),rM=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},oM=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&JN(i,t));eM(i,t);for(var p=n.length-1;p>=0;p--)c=iM(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Cw(o)&&(i=o);return sM(s,i),f&&cf(i,t,f),h?l^4?r:f:i},Sw,lf;Sw=[wn(QN)];class Tc{}lf=tM();Tc=oM(lf,0,"ToolBar",Sw,Tc);rM(lf,1,Tc);const Aw=Object.freeze(Object.defineProperty({__proto__:null,get ToolBar(){return Tc}},Symbol.toStringTag,{value:"Module"})),Tw="side-bar",ou=`



<!-- sidebar content -->
<div class="main-left" mousemove.trigger="onMouseMoveDivider($event)" ref="container">
  <account-list class="col-share" component.ref="account_list" ref="div1"></account-list>
  <div class="divider" mousedown.trigger="onMouseDownDivider($event)" mouseup.trigger="onMouseUpDivider($event)" click.trigger="onClickDivider($event)"></div>
  <box-list class="col-share" component.ref="box_list" ref="div2"></box-list>
</div>

<!-- navigation (emails, calendar, settings) -->
<tool-bar></tool-bar>
`,Iw=[sw,uw,Aw],kw={};let Xl;function aM(s){Xl||(Xl=oe.define({name:Tw,template:ou,dependencies:Iw,bindables:kw})),s.register(Xl)}const cM=Object.freeze(Object.defineProperty({__proto__:null,bindables:kw,default:ou,dependencies:Iw,name:Tw,register:aM,template:ou},Symbol.toStringTag,{value:"Module"}));var lM=Object.create,hf=Object.defineProperty,hM=Object.getOwnPropertyDescriptor,uM=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),Ew=s=>{throw TypeError(s)},dM=(s,e,t)=>e in s?hf(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,fM=(s,e)=>hf(s,"name",{value:e,configurable:!0}),pM=s=>[,,,lM(null)],gM=["class","method","getter","setter","accessor","field","value","get","set"],Rw=s=>s!==void 0&&typeof s!="function"?Ew("Function expected"):s,mM=(s,e,t,n,i)=>({kind:gM[s],name:e,metadata:n,addInitializer:r=>t._?Ew("Already initialized"):i.push(Rw(r||null))}),vM=(s,e)=>dM(e,uM("metadata"),s[3]),yM=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},_M=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&hM(i,t));fM(i,t);for(var p=n.length-1;p>=0;p--)c=mM(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,Rw(o)&&(i=o);return vM(s,i),f&&hf(i,t,f),h?l^4?r:f:i},Pw,uf;Pw=[wn(cM)];var Un;let Ic=(Un=class{constructor(){G(this,"account_list");G(this,"box_list");G(this,"isDragging",!1);G(this,"container");G(this,"div1");G(this,"div2")}async attached(){this.loadDivider()}loadDivider(){let e=sessionStorage.getItem("side-divider")??Un.defaultDivider.toString(),t=parseFloat(e),n=1-t;this.div1&&this.div2&&(this.div1.style.flex=t.toString(),this.div2.style.flex=n.toString())}onMouseDownDivider(e){this.isDragging=!0,document.body.style.cursor="row-resize"}onMouseUpDivider(e){this.isDragging=!1,document.body.style.cursor="default"}onClickDivider(e){e.detail===2&&this.div1&&this.div2&&(this.div1.style.flex=Un.defaultDivider.toString(),this.div2.style.flex=(1-Un.defaultDivider).toString(),sessionStorage.setItem("side-divider",Un.defaultDivider.toString()))}onMouseMoveDivider(e){var r;if(!this.isDragging)return;const t=(r=this.container)==null?void 0:r.getBoundingClientRect(),n=e.clientY/t.height,i=1-n;console.log("divider flex: %d",n),this.div1&&this.div2&&(this.div1.style.flex=n.toString(),this.div2.style.flex=i.toString(),sessionStorage.setItem("side-divider",n.toString()))}},G(Un,"defaultDivider",.5),Un);uf=pM();Ic=_M(uf,0,"SideBar",Pw,Ic);yM(uf,1,Ic);let bM=Ic;const wM=Object.freeze(Object.defineProperty({__proto__:null,SideBar:bM},Symbol.toStringTag,{value:"Module"})),Ow="my-app",au=`






<template ref="templ" title="asdf" style.bind="styleObj"> 

  <div class="row" id="app">

    <!-- sidebar -->
    <div class="col-md-2">
      <side-bar></side-bar>
    </div>

    <!-- main view (emails, settings, calendar..) -->
    <div class="col-lg">
      <au-viewport default="main-page" fallback="missing-page"></au-viewport>
    </div>

  </div>

</template>
`,Nw=[mE,PE,i0,GN,Aw,wM],Mw={};let Zl;function CM(s){Zl||(Zl=oe.define({name:Ow,template:au,dependencies:Nw,bindables:Mw})),s.register(Zl)}const SM=Object.freeze(Object.defineProperty({__proto__:null,bindables:Mw,default:au,dependencies:Nw,name:Ow,register:CM,template:au},Symbol.toStringTag,{value:"Module"}));var AM=Object.create,df=Object.defineProperty,TM=Object.getOwnPropertyDescriptor,IM=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),xw=s=>{throw TypeError(s)},kM=(s,e,t)=>e in s?df(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,EM=(s,e)=>df(s,"name",{value:e,configurable:!0}),RM=s=>[,,,AM(null)],PM=["class","method","getter","setter","accessor","field","value","get","set"],$w=s=>s!==void 0&&typeof s!="function"?xw("Function expected"):s,OM=(s,e,t,n,i)=>({kind:PM[s],name:e,metadata:n,addInitializer:r=>t._?xw("Already initialized"):i.push($w(r||null))}),NM=(s,e)=>kM(e,IM("metadata"),s[3]),MM=(s,e,t,n)=>{for(var i=0,r=s[e>>1],o=r&&r.length;i<o;i++)r[i].call(t);return n},xM=(s,e,t,n,i,r)=>{var o,a,c,l=e&7,h=!!(e&16),u=0,d=s[u]||(s[u]=[]),f=l&&(i=i.prototype,l<5&&(l>3||!h)&&TM(i,t));EM(i,t);for(var p=n.length-1;p>=0;p--)c=OM(l,t,a={},s[3],d),o=(0,n[p])(i,c),a._=1,$w(o)&&(i=o);return NM(s,i),f&&df(i,t,f),h?l^4?r:f:i},Lw,ff;Lw=[wn(SM),nn(Yn,Bs)];class kc{constructor(e,t){G(this,"styleObj",{"background-image":'url("src/assets/bed.png")'});G(this,"templ");this.ea=e,this.settings=t,this.ea.subscribe(ve.SettingsStyle,()=>this.onSettingsStyleChanged())}async attached(){await mt.initialize(),Fr.callbackOnSignin=e=>this.handlerOnMsSelectAccount(e),Fr.selectAccount()}handlerOnMsSelectAccount(e){console.log("WELCOME: "+e.username),this.ea.publish(ve.AccountSelect,e),this.ea.publish(ve.AccountsRefresh)}onSettingsStyleChanged(){this.templ.style.backgroundImage=`url(${this.settings.styles.backgroundImage})`}}ff=RM();kc=xM(ff,0,"MyApp",Lw,kc);MM(ff,1,kc);Eo.register(kt.customize({useUrlFragmentHash:!1})).register(Ci.singleton(Bs,Bs)).app(kc).start();
